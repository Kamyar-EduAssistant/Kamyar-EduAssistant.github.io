<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="logo-d.svg" sizes="512x512">
    <link rel="icon" type="image/svg+xml" href="logo-n.svg" media="(prefers-color-scheme: dark)">
    <title>✨کمک‌یار آموزشی</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Vazirmatn Font -->
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans+Code:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri+Quran&display=swap" rel="stylesheet">

    <!-- KaTeX for Math Formulas -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" xintegrity="sha384-n8MVd4RsNIU0KOVEMckDpbCjaWr2Ugeh4/EGactnsCJO8e2i7gqY+2eJV6gwUqML" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" xintegrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" xintegrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>

    <!-- Function Plotter for Graphs -->
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/function-plot/dist/function-plot.js"></script>

    <!-- Three.js for 3D Vector Ploting -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.150.0/build/three.min.js"></script>
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.150.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.150.0/examples/jsm/"
        }
    }
    </script>

    <script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

    // متصل کردن به پنجره برای استفاده در توابع قدیمی شما
    window.THREE = THREE;
    window.OrbitControls = OrbitControls;
    
    // اگر تابعی دارید که باید بلافاصله اجرا شود اینجا صدا بزنید
    console.log("Libraries Loaded Successfully");
    </script>

    <!-- Prism.js for Highlight Code Blocks -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-coy.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" xintegrity="sha384-n8MVd4RsNIU0KOVEMckDpbCjaWr2Ugeh4/EGactnsCJO8e2i7gqY+2eJV6gwUqML" crossorigin="anonymous">

    <style>
        html {
            scrollbar-width: thin; /* باریک کردن اسکرول‌بار */
        }
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: #f8fafc; /* A slightly off-white for better viewing */
            margin: 0;
            padding: 0;
        }

        .bg-header {
            background-color: #f8fafc52; /* A slightly off-white for better viewing */
        }

        .bg-AIInput {
            background-color: #FFFFFF;
            border: 1px solid #E1E3E1;
            transition: box-shadow 0.2s;
        }
        .bg-AIOutput {
            background-color: #FFFFFF;
            --tw-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            --tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);
            box-shadow: var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow);
        }

        /* General button style */
        .btn-3d {
            border-radius: 12px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06), inset 0 -3px 0 0 rgba(0, 0, 0, 0.2);
            transition: all 0.15s ease-in-out;
            transform: translateY(0);
        }

        .btn-3d:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px -1px rgba(0, 0, 0, 0.1), 0 4px 6px -1px rgba(0, 0, 0, 0.07), inset 0 -3px 0 0 rgba(0, 0, 0, 0.2);
        }
        
        .btn-3d:active, .btn-3d.active {
            transform: translateY(1px);
            box-shadow: 0 2px 3px -1px rgba(0, 0, 0, 0.1), inset 0 -2px 0 0 rgba(0, 0, 0, 0.2);
        }

        /* Specific colors */
        .btn-green {
            background-color: #15803d; /* dark green */
            color: white;
        }
        .btn-green:hover {
            background-color: #16a34a; /* lighter green */
        }
        .btn-gray {
            background-color: #f1f5f9; /* light gray */
            color: #1e293b;
        }
        .btn-gray:hover {
            background-color: #e2e8f0;
        }
        button.btn-3d.rounded-full {
            border-radius: 999999999999px;
        }

        .btn-red {
            background-color: #f1f5f9;
            color: #dc2626; /* red */
        }
        .btn-red:hover {
             background-color: #e2e8f0;
        }

        .help-button {
            background-color: #fff;
            color: #333;
            border: 2px solid #333;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            animation: popIn 0.5s ease-out, pulse 1.5s infinite;
        }
        
        @keyframes popIn {
            from { transform: scale(0); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(51, 51, 51, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(51, 51, 51, 0); }
            100% { box-shadow: 0 0 0 0 rgba(51, 51, 51, 0); }
        }

        .help-button:hover {
            background-color: #333;
            color: white;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            transform: scale(1.1);
        }

        /* Hide pages by default */
        .page {
            display: none;
        }
        .page.active {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { transform: scale(0.3); opacity: 0; transform: translateY(-20px); }
            to { transform: scale(1); opacity: 1; transform: translateY(0); }
        }

        @keyframes wipeLeft {
            from { transform: scale(0.3); opacity: 0; transform: translateX(-20px); }
            to { transform: scale(1); opacity: 1; transform: translateX(0); }
        }

    	.fadeIn-active {
            animation: fadeIn 0.5s ease-out forwards;
	    }

        .wipeLeft {
            animation: wipeLeft 0.5s ease-out forwards;
        }
        .popIn {
            animation: popIn 0.5s ease-out forwards;
        }
        
        /* Splash Screen Animation */
        #splash-screen {
            transition: opacity 1s ease-in-out;
        }

        /* Calculator display style */
        .calculator-bg {
            background-color: rgb(226 232 240);
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06), inset 0 -3px 0 0 rgba(0, 0, 0, 0.2);
        }
        .calculator-display {
            background-color: #dcfce7; /* very light green */
            border-radius: 8px;
            padding: 1rem;
            text-align: left;
            overflow-x: auto;
            direction: ltr; /* Display for numbers is LTR */
            position: relative; /* Needed for backspace button positioning */
        }
        .calculator-display .history {
            color: #6b7280; /* gray */
            font-size: 0.9rem;
            min-height: 1.5rem;
        }
        .calculator-display .current-input {
            color: #1e293b; /* black */
            font-size: 2.2rem;
            font-weight: bold;
            word-wrap: break-word;
            padding-right: 2.5rem; /* Make space for backspace button */
        }
        .calc-backspace {
            color: rgb(71 85 105)
        }
        .calc-backspace:hover {
            color: rgb(15 23 42)
        }

        .text-slate-600 {
            color: rgb(71 85 105)
        }

        .text-slate-900 {
            color: rgb(15 23 42)
        }
        .text-yellow-600 {
            color: #ffd700; /* gold */
        }

        /* Custom Message Box (Modal) */
        .message-box-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.5); display: flex;
            justify-content: center; align-items: center; z-index: 100;
            opacity: 0; pointer-events: none; transition: opacity 0.3s ease-in-out;
        }
        .message-box-overlay.visible { opacity: 1; pointer-events: auto; }
        .message-box {
            background-color: white; padding: 2rem; border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); text-align: center;
            max-width: 100%; width: 600px; transform: scale(0.9);
            transition: transform 0.3s ease-in-out;
        }
        .message-box-overlay.visible .message-box { transform: scale(1); }

        /* KaTeX display formulas alignment */
        .katex-display { margin-left: auto; margin-right: auto; direction: ltr; }
        span.katex { direction: ltr; display: inline-block; }

        /* inline و block code را LTR می‌کند */
        code, pre code, kbd, samp {
            direction: ltr;
            unicode-bidi: isolate; /* از تداخل bidi با متن اطراف جلوگیری می‌کند */
            text-align: left;      /* اگر خواستی متن داخل کد چپ‌چین شود */
            background-color: #e7f5e7;
            border-radius: 5px;
            font-family: "Google Sans Code", monospace;
        }

        /* برای block code اگر لازم شد */
        pre code {
            display: block;
            white-space: pre-wrap; /* یا pre برای حفظ دقیق فضاها و newlineها */
            word-break: break-word; /* جلوگیری از overflow در خطوط خیلی طولانی */
            background-color: #e7f5e7;
            border-radius: 5px;
            font-family: "Google Sans Code", monospace;
        }

        .bg-green-code-head { background-color: #e7f5e7; }
        pre[class*=language-]>code {
            position: relative;
            z-index: 1;
            font-family: "Google Sans Code", monospace;
            font-weight: 400;
            border-left: 10px solid #15803d;
            box-shadow: -1px 0 0 0 #15803d, 0 0 0 1px #dfdfdf;
            background-color: #fdfdfd;
            background-image: linear-gradient(transparent 50%,rgba(69,142,209,.04) 50%);
            background-size: 3em 3em;
            background-origin: content-box;
            background-attachment: local;
        }

        /* Advanced Calculator Styles */
        .palette-tabs button { transition: all 0.2s ease-in-out; border-bottom: 3px solid transparent; }
        .palette-tabs button.active { color: #15803d; border-bottom-color: #15803d; }
        .palette-content { display: none; }
        .palette-content.active { display: grid; animation: wipeLeft 0.3s ease-in-out; }
        .math-symbol-btn { display: flex; align-items: center; justify-content: center; font-size: 1.1rem; min-height: 50px; }
        
	    .justify {
            text-align: justify;
            text-justify: inter-word;
    	}
        .h-56px {
            min-height: 3.5rem !important;
        }
        #latex-preview {
            min-height: 50px;
            text-align: center;
            direction: rtl;
            overflow-x: auto;      
            overflow-y: hidden;
            -webkit-overflow-scrolling: touch;
            white-space: nowrap;
        }
        
        #latex-preview .katex-display {
            display: inline-block;
            min-width: max-content;
            white-space: nowrap;
            direction: rtl;
        }

        #latex-preview .katex-error {
            color: #ef4444; /* red */
        }

        /* Table Styles */
        .ai-table { width: 100%; border-collapse: collapse; margin-top: 1rem; margin-bottom: 1rem; }
        .ai-table th, .ai-table td { border: 1px solid #d1d5db; padding: 0.75rem; text-align: right; }
        .ai-table th { background-color: #f3f4f6; font-weight: bold; }
        .ai-table tr:nth-child(even) { background-color: #f9fafb; }

        .converter-input {
            border-radius: 0.75rem; /* گردتر */
            padding: 1rem 1.25rem;
            width: 100%;
            border: 2px solid #e5e7eb;
            transition: border-color 0.2s, box-shadow 0.2s;
            text-align: left; /* برای اعداد لاتین */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }
        .converter-input:focus {
            border-color: #3b82f6;
            outline: none;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.3);
        }

        .plot-height {
            height: 700px;
        }
        .comp-function {
            border-left: 10px solid !important;
        }

        #three-container canvas {
            display: block;
            cursor: grab;
        }
        #three-container canvas:active {
            cursor: grabbing;
        }

        #three-container {
            cursor: move; /* نشانگر موس را به شکل جابه‌جایی در می‌آورد */
        }

        #v-tooltip {
            pointer-events: none; /* اجازه عبور کلیک از روی تولتیپ */
        }

        .solver-palette-tabs button { transition: all 0.2s ease-in-out; }
        .solver-palette-tabs button.active { color: #ffffff; border-bottom: none; background-color: #15803d; border-top-left-radius: 0.5rem; border-top-right-radius: 0.5rem; border-bottom-right-radius: 0rem; border-bottom-left-radius: 0rem; padding-bottom: 18px; margin-bottom: -10px; }
        .mt--4 {
            margin-top: -16px;
        }
        .solver-shadow-inner {box-shadow: 
            /* سایه‌ی بالا: Y را مثبت قرار می‌دهیم (سایه به سمت پایین پخش شود) */
            inset 0 10px 10px -10px rgba(0, 0, 0, 0.5), 
            
            /* سایه‌ی پایین: Y را منفی قرار می‌دهیم (سایه به سمت بالا پخش شود) */
            inset 0 -10px 10px -10px rgba(0, 0, 0, 0.5);
            grid-template-rows: 0fr; 
            transition: grid-template-rows 0.3s ease-in-out;
        }

        .solver-shadow-inner.expanded {
            grid-template-rows: 1fr;
        }

        .bg-astronomy-day-night {
            /* پس‌زمینه پیش‌فرض (حالت روشن: آسمان روز) */
            background-image: url('https://images.pexels.com/photos/55787/pexels-photo-55787.jpeg?_gl=1*140fge*_ga*MzcwNjMyNDM4LjE3NjQ0NzkyMzM.*_ga_8JE65Q40S6*czE3NjQ0ODQ4NDAkbzIkZzAkdDE3NjQ0ODQ4NDAkajYwJGwwJGgw');
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            transition: background-image 1s ease-in-out; /* برای انتقال نرم بین روز و شب */
        }
        .poet {
            font-family: 'IranNastaliq','DimaShekasteh';
            line-height: 2.5; /* نستعلیق به فاصله خط بیشتری نیاز دارد */
            font-size: xx-large;
        }
        .arabic-quran {
            font-family: 'Amiri Quran', 'QuranTaha', 'Dima Naskh';
        }

        @media (prefers-color-scheme: dark) {
            body {
            	background-color: #131314 ; /* پس‌زمینه تیره */
            	color: #ffffff; /* متن روشن */
                scrollbar-color: #444 #1a1a1a;
            }
            .bg-astronomy-day-night {
                background-image: url('https://getwallpapers.com/wallpaper/full/7/3/0/168494.jpg');
            }
            #splash-screen #splash-icon path {
            	fill: #4ade80; /* سبز روشن برای کنتراست عالی روی پس‌زمینه تیره */
            }
            #splash-screen p {
            	color: #86efac; /* رنگ سبز بسیار روشن یا سفید */
            }
            .bg-AIInput {
                background-color: #1E1F20;
                border: 1px #1E1F20;
            }
            .bg-AIOutput {
                background: none;
                box-shadow: none;
            }
            .btn-gray {
            	background-color: #475569; /* خاکستری تیره */
            	color: #f1f5f9; /* متن روشن */
            }
            .btn-gray:hover {
            	background-color: #64748b; /* خاکستری تیره */
            }
            .btn-red {
            	background-color: #475569; /* خاکستری تیره */
            	color: #ff0000; /* red */
            }
            .btn-red:hover {
            	background-color: #64748b; /* خاکستری تیره */
            }
            .calculator-bg {
            	background-color: #121212; /* تیره */
            }
            .calculator-display {
            	background-color: #334155; /* تیره */
            }
            .calculator-display .history {
            	color: #94a3b8; /* خاکستری روشن‌تر */
            }
            .calculator-display .current-input {
            	color: #f8fafc; /* متن روشن */
            }
            .text-black {
                color: #ffffff !important;
            }
            .text-slate-900 {
            	color: #f8fafc !important; /* light text */
            }
            .text-slate-800 {
            	color: #ffffff !important;
            }
            .text-slate-600 {
            	color: #f1f5f9 !important; /* light text */
            }
            .text-gray-600 {
            	color: #cbd5e1 !important; /* light gray text */
            }
            .text-gray-500 {
            	color: #f1f6ff !important; /* light gray text */
            }
            .text-gray-700 {
            	color: #f1f6ff !important; /* light gray text */
            }
            .hover\:text-gray-700:hover {
            	color: #ffffff !important; 
            }
            .text-green-700 {
            	color: #4ade80 !important; 
            }
            .hover\:text-green-800:hover {
            	color: #0bff0b !important; 
            }
            .text-blue-700 {
            	color: #40a5ff !important; 
            }
            .text-red-700 {
            	color: #ff4c4c !important; 
            }
            .text-orange-700 {
            	color: #ffae00 !important; 
            }
            .text-purple-700 {
            	color: #ee6dff !important; 
            }
            .text-indigo-800 {
            	color: #bfbaff !important; 
            }
            .hover\:text-indigo-800:hover {
            	color: #bfbaff !important; 
            }
            .text-indigo-600 {
            	color: #bfbaff !important; 
            }
            .text-emerald-800 {
            	color: #17ff96 !important; 
            }
            .text-emerald-600 {
            	color: #17ff96 !important; 
            }
            .text-blue-800 {
                color: #76cbff !important;
            }
            #ai-output p.text-gray-500 {
            	color: #94a3b8 !important;
            }
            #kami-output p.text-gray-500 {
            	color: #94a3b8 !important;
            }
            .palette-tabs button.active { color: #4ade80; border-bottom-color: #4ade80; }
            .border-gray-200 {
            	border-color: #47556970 !important; /* Darker border */
            }
            .bg-white {
            	background-color: #30343b !important; /* Dark Blue-Gray */
            	border-color: #475569 !important; /* Darker border */
            }
            .bg-slate-200 {
            	background-color: #121212 !important; /* Dark */
            	border-color: #475569 !important; /* Darker border */
            }
            .bg-blue-50 {
                background-color: #262a2f !important;
            }
            .bg-blue-100 {
                background-color: #1f2125 !important;
            }
            .hover\:bg-indigo-100:hover {
            	background-color: #312e81c2 !important; 
            }
            .hover\:bg-emerald-100:hover {
            	background-color: #283931e3 !important; 
            }
            .hover\:bg-gray-100:hover {
            	background-color: rgb(31 41 55) !important; 
            }
            .hover\:bg-blue-100:hover {
            	background-color: rgb(30 58 138 / 49%) !important; 
            }
            .hover\:bg-blue-200:hover {
            	background-color: #3f4852 !important; 
            }
            .bg-gray-50 {
            	background-color: #282b29 !important; 
            	border-color: #475569 !important; /* Darker border */
            }
            .bg-gray-100 {
            	background-color: #1b1e1cf2 !important; 
            	border-color: #475569 !important; /* Darker border */
            }
            .bg-plotformula {
            	background-color: #30343b !important; 
            }
            .message-box {
            	background-color: #161e21;
            	color: #f8fafc;
            }
            .ai-table th, .ai-table td { 
            	border: 1px solid #415c3b; /* خطوط روشن‌تر */
            }
            .ai-table th { 
            	background-color: #3c5736ab; 
            }
            .ai-table tr:nth-child(even) { 
            	background-color: #3e493b8f; 
            }
            .ai-table tr:nth-child(odd) { 
            	background-color: #222b2394; /* یا رنگ اصلی بدنه */
            }
            code, pre code, kbd, samp {
                background-color: #394739;
            }

            /* برای block code اگر لازم شد */
            pre code {
                background-color: #394739;
            }
            .bg-green-code-head { background-color: #394739; }
            :not(pre)>code[class*=language-], pre[class*=language-] {
                background-color: #30343b;
                -webkit-box-sizing: border-box;
                -moz-box-sizing: border-box;
                box-sizing: border-box;
                margin-bottom: 1em;
            }
            pre[class*=language-]>code {
                background-color: #171a1a;
            }
            code[class*=language-], pre[class*=language-] {
                color: #ffffff;
            }
            .token.punctuation {
                color: #acb6b9;
            }
            .token.entity, .token.operator, .token.url, .token.variable {
                color: #b3895f;
                background: none;
            }
            .language-css .token.string, .style .token.string {
                color: #a67f59;
                background: none;
            }
            pre[class*=language-]:after, pre[class*=language-]:before {
                box-shadow: 0 13px 8px #161616;
            }
        }

        @media (max-width: 640px), (orientation: portrait) and (max-width: 900px) {
            /* ورودی پیشرفته — کوچکتر و راحت‌تر برای موبایل */
            #advanced-calc-input {
                font-size: 0.9rem !important;         /* از 1.25rem یا بیشتر به 1rem بکاهید */
                padding: 0.5rem 3rem 0.5rem 0.75rem !important;
                height: auto;
            }

            /* دکمه "=" داخل کادر ورودی */
            #advanced-calc-input + button,
            .relative button[onclick^="solveWithAI"] {
                width: 36px !important;
                height: 36px !important;
                font-size: 1.25rem !important;
                right: 0.2rem !important;
            }

            /* math-palette سبک‌تر و دکمه‌ها کوچکتر */
            #math-palette { padding: 0.5rem !important; }
            .palette-tabs button { font-size: 0.9rem !important; padding: 0.35rem 0.5rem !important; }
            .solver-palette-tabs button { font-size: 0.9rem !important; padding-left: 0.5rem !important; padding-right: 0.5rem !important; padding-top: 0.35rem !important; }
            .max-row-2 {
                /* حداکثر ارتفاع مورد نظر شما برای محتوای پالت */
                max-height: 10rem; /* مثال: 10rem (یا هر ارتفاع دیگری که لازم دارید) */
                overflow-y: auto; /* برای نمایش اسکرول در صورت نیاز */
            }
            .palette-content.mobile-carousel {
                display: flex !important;
                gap: 0 !important;
                overflow-x: auto !important;
                overflow-y: hidden !important;
                scroll-snap-type: x mandatory;
                -webkit-overflow-scrolling: touch;
                align-items: stretch;
                padding: 0 !important;
            }
            .palette-content.mobile-carousel .palette-page {
                min-width: 100%;
                box-sizing: border-box;
                scroll-snap-align: start;
                scroll-snap-stop: always;
                padding: 0.5rem;
                display: grid;
                gap: 0.35rem;
                grid-template-columns: repeat(var(--cols, 5), 1fr); /* --cols توسط JS مقداردهی می‌شود */
                grid-auto-rows: minmax(44px, auto);
            }

            /* دکمه‌های سمبل (math-symbol-btn) */
            .palette-content.mobile-carousel .math-symbol-btn {
                font-size: 0.85rem !important;
                min-height: 40px !important;
                padding: 0.35rem !important;
                border-radius: 8px !important;
            }
            .palette-indicators {
                display: flex;
                justify-content: center;
                gap: 0.4rem;
                padding: 0.15rem 0;
            }


            /* پیش‌نمایش لاتِکس کوچکتر */
            #latex-preview {
                font-size: 0.95rem !important;
                padding: 0.5rem !important;
            }

            /* کاهش حاشیه‌ها و فاصله‌ها در موبایل برای نمایش بهتر */
            .palette-tabs, .palette-content { margin-bottom: 0.25rem !important; }

            .plot-height {
                height: 400px;
            }
            #three-container {
                touch-action: none !important; /* جلوگیری از اسکرول مرورگر */
                -webkit-tap-highlight-color: transparent; /* حذف کادر آبی هنگام لمس */
                -webkit-user-select: none; /* جلوگیری از انتخاب متن */
                user-select: none; /* استاندارد */
            }

            .solver-max-row-2 {
                /* حداکثر ارتفاع مورد نظر شما برای محتوای پالت */
                max-height: 112px; /* مثال: 10rem (یا هر ارتفاع دیگری که لازم دارید) */
                overflow-y: auto; /* برای نمایش اسکرول در صورت نیاز */
            }
            #stellarium-iframe {
                height: 55vh;
                zoom: 0.85; /* فقط برای موبایل */
            }
        }
    </style>
</head>
<body class="antialiased text-slate-800">

    <!-- Splash Screen -->
    <div id="splash-screen" class="fixed inset-0 flex flex-col items-center justify-center z-50">
	<svg id="splash-icon" xmlns="http://www.w3.org/2000/svg" width="196" height="196" viewBox="0, 0, 400,400">
        <g id="svgg">
            <path id="path1" d="M42.300 0.292 C 41.255 0.375,40.400 0.614,40.400 0.822 C 40.400 1.030,39.871 1.200,39.224 1.200 C 38.577 1.200,37.936 1.380,37.800 1.600 C 37.664 1.820,37.124 2.000,36.600 2.000 C 36.076 2.000,35.536 2.180,35.400 2.400 C 35.264 2.620,34.713 2.800,34.176 2.800 C 33.639 2.800,33.200 2.980,33.200 3.200 C 33.200 3.420,32.928 3.600,32.595 3.600 C 32.262 3.600,31.677 3.768,31.295 3.974 C 30.913 4.179,30.015 4.583,29.300 4.871 C 28.585 5.160,28.000 5.531,28.000 5.698 C 28.000 5.864,27.730 6.000,27.400 6.000 C 27.070 6.000,26.800 6.180,26.800 6.400 C 26.800 6.620,26.530 6.800,26.200 6.800 C 25.870 6.800,25.600 6.980,25.600 7.200 C 25.600 7.420,25.240 7.600,24.800 7.600 C 24.360 7.600,24.000 7.758,24.000 7.951 C 24.000 8.145,23.452 8.530,22.783 8.807 C 22.113 9.085,21.014 9.826,20.340 10.456 C 19.667 11.085,18.967 11.600,18.786 11.600 C 18.357 11.600,11.600 18.357,11.600 18.786 C 11.600 18.967,11.085 19.667,10.456 20.340 C 9.826 21.014,9.085 22.113,8.807 22.783 C 8.530 23.452,8.145 24.000,7.951 24.000 C 7.758 24.000,7.600 24.360,7.600 24.800 C 7.600 25.240,7.420 25.600,7.200 25.600 C 6.980 25.600,6.800 25.870,6.800 26.200 C 6.800 26.530,6.620 26.800,6.400 26.800 C 6.180 26.800,6.000 27.070,6.000 27.400 C 6.000 27.730,5.864 28.000,5.698 28.000 C 5.531 28.000,5.160 28.585,4.871 29.300 C 4.583 30.015,4.179 30.913,3.974 31.295 C 3.768 31.677,3.600 32.262,3.600 32.595 C 3.600 32.928,3.420 33.200,3.200 33.200 C 2.980 33.200,2.800 33.639,2.800 34.176 C 2.800 34.713,2.620 35.264,2.400 35.400 C 2.180 35.536,2.000 36.076,2.000 36.600 C 2.000 37.124,1.820 37.664,1.600 37.800 C 1.380 37.936,1.200 38.562,1.200 39.190 C 1.200 39.819,0.975 40.408,0.700 40.500 C -0.036 40.745,-0.036 359.255,0.700 359.500 C 0.975 359.592,1.200 360.181,1.200 360.810 C 1.200 361.438,1.380 362.064,1.600 362.200 C 1.820 362.336,2.000 362.876,2.000 363.400 C 2.000 363.924,2.180 364.464,2.400 364.600 C 2.620 364.736,2.800 365.287,2.800 365.824 C 2.800 366.361,2.980 366.800,3.200 366.800 C 3.420 366.800,3.600 367.072,3.600 367.405 C 3.600 367.738,3.768 368.323,3.974 368.705 C 4.179 369.087,4.583 369.985,4.871 370.700 C 5.160 371.415,5.531 372.000,5.698 372.000 C 5.864 372.000,6.000 372.270,6.000 372.600 C 6.000 372.930,6.180 373.200,6.400 373.200 C 6.620 373.200,6.800 373.470,6.800 373.800 C 6.800 374.130,6.980 374.400,7.200 374.400 C 7.420 374.400,7.600 374.760,7.600 375.200 C 7.600 375.640,7.758 376.000,7.951 376.000 C 8.145 376.000,8.530 376.548,8.807 377.217 C 9.085 377.887,9.826 378.986,10.456 379.660 C 11.085 380.333,11.600 381.033,11.600 381.214 C 11.600 381.643,18.357 388.400,18.786 388.400 C 18.967 388.400,19.667 388.915,20.340 389.544 C 21.014 390.174,22.113 390.915,22.783 391.193 C 23.452 391.470,24.000 391.822,24.000 391.974 C 24.000 392.126,24.630 392.498,25.400 392.800 C 26.170 393.102,26.800 393.496,26.800 393.675 C 26.800 393.854,27.070 394.000,27.400 394.000 C 27.730 394.000,28.000 394.136,28.000 394.302 C 28.000 394.469,28.585 394.840,29.300 395.129 C 30.015 395.417,30.913 395.821,31.295 396.026 C 31.677 396.232,32.262 396.400,32.595 396.400 C 32.928 396.400,33.200 396.580,33.200 396.800 C 33.200 397.020,33.639 397.200,34.176 397.200 C 34.713 397.200,35.264 397.380,35.400 397.600 C 35.536 397.820,36.076 398.000,36.600 398.000 C 37.124 398.000,37.664 398.180,37.800 398.400 C 37.936 398.620,38.562 398.800,39.190 398.800 C 39.819 398.800,40.408 399.025,40.500 399.300 C 40.745 400.036,359.255 400.036,359.500 399.300 C 359.592 399.025,360.181 398.800,360.810 398.800 C 361.438 398.800,362.064 398.620,362.200 398.400 C 362.336 398.180,362.876 398.000,363.400 398.000 C 363.924 398.000,364.464 397.820,364.600 397.600 C 364.736 397.380,365.287 397.200,365.824 397.200 C 366.361 397.200,366.800 397.020,366.800 396.800 C 366.800 396.580,367.072 396.400,367.405 396.400 C 367.738 396.400,368.323 396.232,368.705 396.026 C 369.087 395.821,369.985 395.417,370.700 395.129 C 371.415 394.840,372.000 394.469,372.000 394.302 C 372.000 394.136,372.270 394.000,372.600 394.000 C 372.930 394.000,373.200 393.854,373.200 393.675 C 373.200 393.496,373.830 393.102,374.600 392.800 C 375.370 392.498,376.000 392.126,376.000 391.974 C 376.000 391.822,376.548 391.470,377.217 391.193 C 377.887 390.915,378.986 390.174,379.660 389.544 C 380.333 388.915,381.033 388.400,381.214 388.400 C 381.643 388.400,388.400 381.643,388.400 381.214 C 388.400 381.033,388.915 380.333,389.544 379.660 C 390.174 378.986,390.915 377.887,391.193 377.217 C 391.470 376.548,391.822 376.000,391.974 376.000 C 392.126 376.000,392.498 375.370,392.800 374.600 C 393.102 373.830,393.496 373.200,393.675 373.200 C 393.854 373.200,394.000 372.930,394.000 372.600 C 394.000 372.270,394.136 372.000,394.302 372.000 C 394.469 372.000,394.840 371.415,395.129 370.700 C 395.417 369.985,395.821 369.087,396.026 368.705 C 396.232 368.323,396.400 367.738,396.400 367.405 C 396.400 367.072,396.580 366.800,396.800 366.800 C 397.020 366.800,397.200 366.361,397.200 365.824 C 397.200 365.287,397.380 364.736,397.600 364.600 C 397.820 364.464,398.000 363.924,398.000 363.400 C 398.000 362.876,398.180 362.336,398.400 362.200 C 398.620 362.064,398.800 361.438,398.800 360.810 C 398.800 360.181,399.025 359.592,399.300 359.500 C 400.036 359.255,400.036 40.745,399.300 40.500 C 399.025 40.408,398.800 39.819,398.800 39.190 C 398.800 38.562,398.620 37.936,398.400 37.800 C 398.180 37.664,398.000 37.124,398.000 36.600 C 398.000 36.076,397.820 35.536,397.600 35.400 C 397.380 35.264,397.200 34.713,397.200 34.176 C 397.200 33.639,397.020 33.200,396.800 33.200 C 396.580 33.200,396.400 32.928,396.400 32.595 C 396.400 32.262,396.232 31.677,396.026 31.295 C 395.821 30.913,395.417 30.015,395.129 29.300 C 394.840 28.585,394.469 28.000,394.302 28.000 C 394.136 28.000,394.000 27.730,394.000 27.400 C 394.000 27.070,393.820 26.800,393.600 26.800 C 393.380 26.800,393.200 26.530,393.200 26.200 C 393.200 25.870,393.020 25.600,392.800 25.600 C 392.580 25.600,392.400 25.240,392.400 24.800 C 392.400 24.360,392.242 24.000,392.049 24.000 C 391.855 24.000,391.470 23.452,391.193 22.783 C 390.915 22.113,390.174 21.014,389.544 20.340 C 388.915 19.667,388.400 18.967,388.400 18.786 C 388.400 18.357,381.643 11.600,381.214 11.600 C 381.033 11.600,380.333 11.085,379.660 10.456 C 378.986 9.826,377.887 9.085,377.217 8.807 C 376.548 8.530,376.000 8.178,376.000 8.026 C 376.000 7.874,375.370 7.502,374.600 7.200 C 373.830 6.898,373.200 6.504,373.200 6.325 C 373.200 6.146,372.930 6.000,372.600 6.000 C 372.270 6.000,372.000 5.864,372.000 5.698 C 372.000 5.531,371.415 5.160,370.700 4.871 C 369.985 4.583,369.087 4.179,368.705 3.974 C 368.323 3.768,367.738 3.600,367.405 3.600 C 367.072 3.600,366.800 3.420,366.800 3.200 C 366.800 2.980,366.361 2.800,365.824 2.800 C 365.287 2.800,364.736 2.620,364.600 2.400 C 364.464 2.180,363.924 2.000,363.400 2.000 C 362.876 2.000,362.336 1.820,362.200 1.600 C 362.064 1.380,361.438 1.200,360.810 1.200 C 360.181 1.200,359.592 0.975,359.500 0.700 C 359.344 0.230,48.072 -0.170,42.300 0.292 M198.404 25.838 C 199.512 25.985,200.515 26.262,200.633 26.453 C 200.751 26.644,201.128 26.800,201.470 26.800 C 202.028 26.800,208.393 29.301,212.600 31.174 C 213.480 31.566,214.830 32.115,215.600 32.395 C 216.370 32.675,217.810 33.257,218.800 33.688 C 219.790 34.119,220.960 34.621,221.400 34.804 C 221.840 34.986,224.599 36.140,227.530 37.368 C 230.462 38.595,232.947 39.600,233.052 39.600 C 233.158 39.600,233.999 39.932,234.922 40.339 C 235.845 40.745,238.490 41.841,240.800 42.773 C 243.110 43.705,245.720 44.787,246.600 45.177 C 247.480 45.567,248.830 46.116,249.600 46.398 C 250.370 46.679,252.125 47.425,253.501 48.055 C 254.877 48.685,256.209 49.200,256.462 49.200 C 256.715 49.200,258.065 49.740,259.462 50.400 C 260.859 51.060,262.236 51.600,262.521 51.600 C 262.806 51.600,263.211 51.755,263.420 51.945 C 263.629 52.135,265.960 53.146,268.600 54.193 C 271.240 55.240,273.940 56.330,274.600 56.616 C 275.260 56.901,277.870 57.970,280.400 58.991 C 282.930 60.012,285.540 61.086,286.200 61.378 C 286.860 61.669,288.840 62.483,290.600 63.187 C 293.834 64.479,295.378 65.122,297.200 65.933 C 297.750 66.178,299.190 66.748,300.400 67.200 C 301.610 67.652,302.960 68.187,303.400 68.390 C 303.840 68.592,305.190 69.145,306.400 69.620 C 309.849 70.972,310.527 71.260,311.662 71.849 C 312.246 72.152,312.931 72.400,313.184 72.400 C 313.437 72.400,314.489 72.770,315.522 73.222 C 316.555 73.674,317.850 74.233,318.400 74.464 C 318.950 74.695,319.940 75.114,320.600 75.396 C 321.260 75.677,323.201 76.495,324.913 77.213 C 333.414 80.780,333.334 86.078,324.726 89.536 C 322.897 90.272,320.860 91.101,320.200 91.380 C 319.540 91.659,318.550 92.077,318.000 92.308 C 317.450 92.539,316.190 93.083,315.200 93.517 C 314.210 93.951,311.330 95.150,308.800 96.181 C 306.270 97.212,303.660 98.294,303.000 98.586 C 302.340 98.877,301.350 99.300,300.800 99.525 C 298.451 100.485,287.876 104.853,284.132 106.409 C 281.244 107.610,279.620 108.555,278.532 109.669 L 277.000 111.238 276.903 124.719 C 276.850 132.134,276.805 138.334,276.803 138.499 C 276.792 139.588,273.856 141.935,272.289 142.107 C 268.503 142.523,260.923 143.661,259.800 143.982 C 259.140 144.171,257.250 144.624,255.600 144.989 C 243.837 147.594,225.926 154.568,218.200 159.552 C 216.102 160.905,215.117 161.509,214.472 161.838 C 212.638 162.773,205.427 167.856,201.400 171.053 C 196.914 174.613,193.780 174.204,187.400 169.222 C 184.162 166.694,177.447 162.221,172.744 159.459 C 168.391 156.904,157.307 151.536,152.900 149.850 C 148.878 148.312,148.086 148.028,146.000 147.377 C 144.790 147.000,143.440 146.543,143.000 146.362 C 142.300 146.074,140.623 145.585,134.800 143.973 C 134.030 143.760,132.050 143.299,130.400 142.949 C 128.750 142.599,126.680 142.148,125.800 141.946 C 124.920 141.745,122.850 141.377,121.200 141.128 C 114.874 140.173,114.732 139.796,114.829 124.232 L 114.904 112.149 113.871 110.512 C 112.786 108.794,111.967 108.311,106.200 105.993 C 104.440 105.286,102.460 104.475,101.800 104.190 C 101.140 103.906,99.790 103.363,98.800 102.983 C 97.810 102.602,96.419 102.039,95.709 101.731 C 92.059 100.147,90.797 102.814,90.809 112.087 C 90.819 119.775,91.002 120.532,93.714 124.069 C 96.019 127.074,96.979 131.348,95.548 132.232 C 95.357 132.350,95.200 133.056,95.200 133.800 C 95.200 134.544,95.020 135.264,94.800 135.400 C 94.304 135.706,94.270 137.872,94.756 138.173 C 94.951 138.294,95.200 138.979,95.307 139.696 C 95.415 140.413,95.899 142.260,96.382 143.800 C 99.657 154.228,98.647 155.400,86.379 155.400 L 78.016 155.400 76.708 154.092 C 75.188 152.572,75.039 150.873,76.102 147.184 C 78.032 140.488,78.545 134.803,77.400 132.800 C 76.124 130.567,76.847 127.155,79.289 123.883 C 81.549 120.854,81.600 120.527,81.600 108.932 C 81.600 98.204,81.598 98.183,80.626 96.752 C 79.816 95.560,76.045 93.200,74.950 93.200 C 74.824 93.200,74.154 92.954,73.460 92.653 C 68.887 90.670,66.247 89.600,65.929 89.600 C 64.872 89.600,61.273 86.762,60.641 85.430 C 59.333 82.673,61.418 79.401,65.462 77.863 C 67.509 77.085,75.327 73.884,77.460 72.951 C 78.154 72.648,78.824 72.400,78.950 72.400 C 79.075 72.400,80.128 71.976,81.289 71.458 C 82.450 70.940,84.390 70.109,85.600 69.612 C 86.810 69.115,88.113 68.549,88.495 68.354 C 88.877 68.159,89.364 68.000,89.577 68.000 C 89.790 68.000,91.097 67.486,92.482 66.858 C 93.867 66.229,96.350 65.171,98.000 64.505 C 108.634 60.217,108.152 60.415,110.878 59.222 C 111.911 58.770,112.874 58.400,113.018 58.400 C 113.161 58.400,113.936 58.109,114.740 57.753 C 117.516 56.522,118.607 56.063,120.400 55.373 C 121.390 54.992,122.371 54.527,122.580 54.340 C 122.789 54.153,123.194 54.000,123.479 54.000 C 123.764 54.000,125.123 53.482,126.499 52.850 C 127.875 52.217,130.080 51.281,131.400 50.770 C 132.720 50.258,133.971 49.696,134.180 49.520 C 134.389 49.344,134.794 49.200,135.079 49.200 C 135.364 49.200,136.723 48.681,138.099 48.046 C 139.475 47.411,141.500 46.568,142.600 46.173 C 143.700 45.778,144.955 45.217,145.389 44.927 C 145.823 44.637,146.395 44.400,146.661 44.400 C 146.927 44.400,148.311 43.860,149.737 43.200 C 151.163 42.540,152.446 42.000,152.589 42.000 C 152.733 42.000,153.783 41.578,154.925 41.062 C 156.066 40.547,157.810 39.795,158.800 39.392 C 159.790 38.988,161.320 38.355,162.200 37.983 C 163.080 37.612,164.661 36.987,165.713 36.595 C 166.765 36.202,167.721 35.728,167.837 35.541 C 167.952 35.353,168.306 35.200,168.623 35.200 C 168.939 35.200,170.341 34.660,171.738 34.000 C 173.135 33.340,174.487 32.800,174.744 32.800 C 175.001 32.800,175.523 32.633,175.905 32.429 C 176.637 32.038,180.041 30.544,181.400 30.018 C 181.840 29.848,183.010 29.346,184.000 28.902 C 184.990 28.458,186.700 27.785,187.800 27.405 C 188.900 27.026,190.160 26.573,190.600 26.399 C 191.776 25.934,195.322 25.293,195.895 25.442 C 196.167 25.513,197.296 25.691,198.404 25.838 M313.794 154.300 C 317.554 156.563,317.204 148.688,317.204 231.152 C 317.204 303.070,317.198 303.656,316.394 305.521 C 314.819 309.171,314.327 309.290,299.200 309.655 C 292.050 309.828,285.750 310.083,285.200 310.221 C 284.650 310.359,282.130 310.714,279.600 311.011 C 271.864 311.916,262.175 313.876,255.200 315.946 C 250.181 317.436,247.849 318.976,248.656 320.269 C 249.185 321.116,249.337 321.110,255.800 320.006 C 276.942 316.395,284.150 315.842,305.832 316.164 L 320.665 316.385 321.832 315.166 L 323.000 313.947 323.099 247.356 C 323.189 186.891,323.257 180.647,323.846 179.482 C 326.376 174.474,332.090 174.891,334.669 180.274 C 335.369 181.734,335.400 184.813,335.399 251.800 C 335.398 328.794,335.576 323.335,332.985 325.894 C 329.955 328.886,330.072 328.859,321.515 328.604 C 300.318 327.974,278.055 328.417,273.400 329.560 C 272.520 329.777,270.696 330.049,269.347 330.166 C 267.998 330.282,266.108 330.558,265.147 330.778 C 264.186 330.999,262.320 331.380,261.000 331.627 C 259.680 331.873,257.430 332.336,256.000 332.655 C 254.570 332.974,252.680 333.389,251.800 333.576 C 250.920 333.764,248.940 334.307,247.400 334.783 C 245.860 335.259,243.970 335.797,243.200 335.980 C 241.500 336.383,239.432 337.087,237.740 337.840 C 237.046 338.148,236.299 338.400,236.079 338.400 C 235.741 338.400,228.362 341.244,225.800 342.361 C 221.490 344.241,209.647 350.355,206.908 352.113 C 205.977 352.711,205.060 353.200,204.870 353.200 C 204.680 353.200,204.213 353.543,203.833 353.963 C 199.880 358.331,192.905 358.610,187.400 354.619 C 186.258 353.791,180.872 350.495,179.600 349.845 C 179.270 349.677,177.920 348.936,176.600 348.199 C 172.825 346.091,165.056 342.363,161.600 341.001 C 160.610 340.611,159.260 340.061,158.600 339.779 C 157.940 339.496,155.150 338.530,152.400 337.631 C 149.650 336.732,146.860 335.806,146.200 335.573 C 145.540 335.341,143.560 334.796,141.800 334.362 C 140.040 333.928,137.724 333.309,136.654 332.987 C 135.584 332.664,134.306 332.400,133.814 332.400 C 133.322 332.400,132.398 332.221,131.760 332.002 C 130.448 331.552,127.243 331.000,121.400 330.218 C 119.200 329.923,117.130 329.572,116.800 329.437 C 114.554 328.522,79.900 327.580,77.200 328.361 C 73.859 329.328,62.300 329.068,60.787 327.992 C 58.860 326.623,57.682 325.272,56.785 323.400 C 55.605 320.939,55.579 181.547,56.758 179.000 C 59.215 173.695,65.596 173.423,67.678 178.536 C 68.305 180.076,68.357 185.172,68.378 246.981 L 68.400 313.762 69.666 315.068 L 70.932 316.374 85.766 316.159 C 100.808 315.942,108.229 316.230,117.600 317.396 C 123.383 318.115,124.222 318.235,127.200 318.769 C 128.410 318.986,130.480 319.352,131.800 319.581 C 135.626 320.247,140.133 321.302,146.200 322.952 C 156.962 325.878,158.000 326.006,158.000 324.408 C 158.000 323.564,155.226 321.536,152.400 320.313 C 147.210 318.066,145.029 317.200,144.562 317.200 C 144.268 317.200,143.436 316.948,142.714 316.639 C 141.496 316.119,140.302 315.750,135.000 314.252 C 133.900 313.941,131.560 313.392,129.800 313.033 C 128.040 312.673,125.790 312.201,124.800 311.984 C 122.016 311.373,114.309 310.394,109.000 309.977 C 106.360 309.770,102.751 309.420,100.979 309.200 C 99.208 308.980,93.394 308.800,88.059 308.800 C 77.610 308.800,77.182 308.727,75.200 306.606 L 74.200 305.536 74.200 238.402 L 74.200 171.269 75.400 169.573 C 76.642 167.817,76.846 167.659,79.224 166.609 C 82.760 165.049,125.388 166.738,128.328 168.555 C 128.524 168.677,130.195 169.053,132.042 169.392 C 136.467 170.205,137.976 170.544,141.800 171.589 C 143.560 172.070,145.450 172.553,146.000 172.664 C 146.550 172.774,147.540 173.101,148.200 173.389 C 148.860 173.678,150.660 174.318,152.200 174.812 C 156.785 176.282,158.928 177.056,160.895 177.952 C 161.918 178.418,162.859 178.800,162.985 178.800 C 163.111 178.800,165.843 180.060,169.056 181.600 C 172.269 183.140,175.056 184.400,175.249 184.400 C 175.442 184.400,175.600 184.542,175.600 184.716 C 175.600 184.890,176.635 185.549,177.900 186.181 C 179.165 186.812,181.421 188.110,182.912 189.064 C 184.404 190.019,185.704 190.800,185.802 190.800 C 185.899 190.800,188.115 192.240,190.727 194.000 C 197.139 198.320,196.719 198.346,203.800 193.200 C 207.629 190.418,208.803 189.593,211.210 188.000 C 212.041 187.450,213.769 186.281,215.050 185.402 C 216.331 184.523,217.846 183.533,218.417 183.202 C 218.989 182.871,221.513 181.356,224.028 179.837 C 233.449 174.142,246.435 167.799,256.200 164.122 C 257.080 163.790,258.391 163.267,259.114 162.960 C 259.836 162.652,260.709 162.400,261.053 162.400 C 261.397 162.400,262.246 162.154,262.940 161.853 C 263.633 161.552,265.280 160.988,266.600 160.601 C 267.920 160.213,269.440 159.728,269.977 159.522 C 270.514 159.316,271.684 158.991,272.577 158.799 C 273.470 158.608,275.730 158.069,277.600 157.601 C 279.470 157.133,281.900 156.598,283.000 156.412 C 284.100 156.226,286.080 155.884,287.400 155.651 C 295.949 154.145,302.946 153.344,308.284 153.259 C 311.648 153.205,312.126 153.295,313.794 154.300 M300.400 165.159 C 300.070 165.343,298.270 165.598,296.400 165.725 C 293.150 165.947,292.201 166.098,285.800 167.412 C 278.717 168.866,276.687 169.361,270.200 171.215 C 266.286 172.334,259.471 174.788,255.800 176.401 C 254.920 176.787,253.217 177.506,252.016 177.999 C 249.724 178.939,235.505 186.127,233.344 187.438 C 232.654 187.857,230.404 189.243,228.344 190.517 C 226.285 191.792,224.240 193.052,223.800 193.317 C 223.360 193.583,222.910 193.897,222.800 194.016 C 222.690 194.135,221.340 195.057,219.800 196.064 C 216.767 198.049,206.029 205.918,204.395 207.354 C 203.331 208.289,200.770 209.588,198.324 210.433 C 195.823 211.298,193.658 210.361,186.200 205.188 C 181.349 201.823,178.424 199.996,173.000 196.942 C 169.310 194.865,156.736 188.800,156.119 188.800 C 155.854 188.800,150.504 186.747,148.140 185.738 C 147.446 185.442,146.589 185.200,146.234 185.200 C 145.879 185.200,145.277 185.042,144.895 184.848 C 143.491 184.138,139.308 182.930,135.000 181.992 C 134.120 181.800,131.690 181.261,129.600 180.795 C 125.575 179.896,122.608 179.401,117.400 178.762 C 115.640 178.545,113.390 178.180,112.400 177.950 C 111.410 177.720,105.895 177.431,100.145 177.307 C 88.597 177.058,87.783 177.214,86.769 179.880 C 86.258 181.225,86.265 292.393,86.776 293.738 C 87.646 296.025,89.701 296.797,94.993 296.827 C 100.922 296.861,112.903 297.759,118.000 298.552 C 124.613 299.581,128.925 300.351,131.400 300.946 C 135.996 302.051,138.618 302.744,141.400 303.589 C 142.940 304.057,144.740 304.597,145.400 304.789 C 147.578 305.423,152.571 307.240,154.296 308.027 C 155.228 308.452,156.111 308.800,156.257 308.800 C 156.856 308.800,166.941 313.722,169.415 315.221 C 170.303 315.759,171.383 316.426,171.815 316.703 C 172.247 316.979,172.870 317.325,173.200 317.470 C 175.297 318.398,184.142 324.575,189.400 328.785 C 195.283 333.494,195.915 333.598,199.769 330.487 C 201.054 329.449,202.448 328.400,202.868 328.156 C 203.287 327.911,204.028 327.344,204.515 326.895 C 205.428 326.054,215.732 319.150,216.800 318.664 C 217.130 318.514,217.940 318.043,218.600 317.618 C 220.750 316.233,229.691 311.600,230.215 311.600 C 230.341 311.600,231.533 311.060,232.863 310.400 C 234.194 309.740,235.439 309.200,235.630 309.200 C 235.822 309.200,236.928 308.771,238.089 308.247 C 240.892 306.982,246.292 305.053,250.000 303.992 C 251.650 303.520,253.270 303.025,253.600 302.893 C 253.930 302.762,255.190 302.430,256.400 302.157 C 261.779 300.942,262.635 300.734,263.200 300.504 C 263.530 300.370,265.240 300.012,267.000 299.708 C 278.803 297.670,282.219 297.308,293.600 296.892 C 300.885 296.626,301.919 296.504,302.867 295.796 C 305.360 293.936,305.200 298.391,305.200 230.747 C 305.200 162.727,305.387 167.546,302.673 165.700 C 301.190 164.690,301.225 164.699,300.400 165.159 M201.400 216.930 C 204.665 217.516,208.296 218.629,208.980 219.253 C 209.189 219.444,209.684 219.600,210.080 219.600 C 210.476 219.600,210.800 219.753,210.800 219.939 C 210.800 220.126,211.561 220.621,212.492 221.039 C 215.194 222.254,219.981 227.296,221.758 230.800 C 227.553 242.223,224.763 254.383,214.600 261.999 C 213.500 262.823,211.970 264.072,211.200 264.773 C 210.430 265.475,209.151 266.474,208.357 266.993 C 206.423 268.259,203.308 272.705,202.185 275.803 C 200.139 281.442,198.360 282.723,192.826 282.543 C 179.724 282.116,182.809 267.160,198.400 255.518 C 201.763 253.007,204.385 250.363,205.335 248.525 C 206.950 245.402,207.663 241.934,206.800 241.400 C 206.580 241.264,206.400 240.727,206.400 240.207 C 206.400 239.290,204.112 235.898,202.831 234.916 C 195.642 229.402,185.066 231.696,180.984 239.655 C 178.021 245.430,168.894 247.336,164.500 243.097 C 161.008 239.729,164.518 230.356,171.359 224.781 C 172.702 223.687,174.017 222.614,174.283 222.396 C 174.549 222.178,174.856 222.000,174.966 222.000 C 175.075 222.000,176.028 221.492,177.082 220.871 C 178.137 220.250,179.360 219.634,179.800 219.501 C 180.240 219.369,181.860 218.811,183.400 218.262 C 184.940 217.712,187.280 217.134,188.600 216.977 C 189.920 216.820,191.360 216.538,191.800 216.350 C 192.815 215.918,197.262 216.186,201.400 216.930 M198.388 291.994 C 207.908 296.800,204.569 310.800,193.902 310.800 C 190.553 310.800,186.259 307.951,184.974 304.876 C 184.320 303.311,184.191 297.776,184.800 297.400 C 185.020 297.264,185.200 296.828,185.200 296.431 C 185.200 295.409,188.945 292.031,190.400 291.740 C 191.069 291.606,191.714 291.340,191.832 291.148 C 192.339 290.328,196.033 290.805,198.388 291.994 " stroke="none" fill="#15803d" fill-rule="evenodd"></path>
        </g>
    </svg>
        <p class="text-3xl text-center mt-4 font-bold text-green-800">✨کمک‌یار آموزشی✨</p>
    </div>

    <!-- Header -->
    <header id="page-header" class="sticky top-0 backdrop-blur-sm py-3 z-10 hidden">
        <div class="flex items-center justify-between sm:px-6 lg:px-8 py-3 max-w-7xl mx-auto px-4">
            <h1 id="page-title" class="text-3xl font-bold text-slate-900"></h1>
            <div class="flex items-center gap-2">
                    <button onclick="navigateTo('home-page')" class="btn-3d btn-gray p-2 rounded-full">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                </button>
                <button onclick="goBack()" class="btn-3d btn-gray p-2 rounded-full">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div id="main-container" class="max-w-7xl mx-auto p-4 opacity-0 transition-opacity duration-500">

        <!-- Home Page -->
        <div id="home-page" class="page active">
             <h1 class="text-3xl font-bold text-center mb-8 text-slate-900">🏠 صفحه اصلی</h1>
             <div class="grid grid-cols-6 md:grid-cols-6 gap-4 text-lg">
                <!-- Row 1 -->
                <button onclick="navigateTo('ai-solver-page', '🤖 پاسخ مسئله با هوش مصنوعی')" class="w-full text-center p-6 btn-3d btn-green col-span-6 md:col-span-6">🤖 پاسخ مسئله با هوش مصنوعی</button>
                
                <!-- Row 2 -->
                <button onclick="navigateTo('calculator-page', 'ماشین حساب')" class="w-full text-center p-6 btn-3d btn-green col-span-3 md:col-span-3">🧮 ماشین حساب</button>
                <button onclick="navigateTo('converter-page', '📏 تبدیل واحد')" class="w-full text-center p-6 btn-3d btn-green col-span-3 md:col-span-3">📏 تبدیل واحد</button>

                <!-- Row 3 -->
                <button onclick="navigateTo('math-page', 'ریاضیات')" class="w-full text-center p-6 btn-3d btn-green col-span-3 md:col-span-3">📐 ریاضیات</button>
                <button onclick="navigateTo('physics-page', 'فیزیک')" class="w-full text-center p-6 btn-3d btn-green col-span-3 md:col-span-3">⚛️ فیزیک</button>

                <!-- Row 4 -->
                <button onclick="navigateTo('chemistry-page', 'شیمی')" class="w-full text-center p-6 btn-3d btn-green col-span-3 md:col-span-3">🧪 شیمی</button>
                <button onclick="navigateTo('biology-page', 'زیست‌شناسی')" class="w-full text-center p-6 btn-3d btn-green col-span-3 md:col-span-3">🧬 زیست</button>

                <!-- Row 5 -->
                <button onclick="navigateTo('geology-page', 'زمین‌شناسی')" class="w-full text-center p-6 btn-3d btn-green col-span-3 md:col-span-3">🌍 زمین‌شناسی</button>
                <button onclick="navigateTo('astronomy-page', 'نجوم')" class="w-full text-center p-6 btn-3d btn-green col-span-3 md:col-span-3">🔭 نجوم</button>

                <!-- Row 6 -->
                <button onclick="navigateTo('persian-page', 'ادبیات فارسی')" class="w-full text-center p-6 btn-3d btn-green col-span-2 md:col-span-2">📜 ادبیات فارسی ✍️</button>
                <button onclick="navigateTo('english-page', 'انگلیسی')" class="w-full text-center p-6 btn-3d btn-green col-span-2 md:col-span-2">🇬🇧 زبان انگلیسی ✍️</button>
                <button onclick="navigateTo('arabic-page', 'عربی')" class="w-full text-center p-6 btn-3d btn-green col-span-2 md:col-span-2">🇸🇦 زبان عربی ✍️</button>
                 
                <!-- Row 7 -->
                <button onclick="navigateTo('simulations-page', 'آزمایشات')" class="w-full text-center p-6 btn-3d btn-green col-span-3 md:col-span-3">🔬 آزمایشات</button>
                <button onclick="navigateTo('games-page', 'بازی‌ها')" class="w-full text-center p-6 btn-3d btn-green col-span-3 md:col-span-3">🎮 بازی‌ها</button>
             </div>
             <footer class="text-center mt-7 text-gray-500">
                <p>سازنده: کامیار گرگانلی دوجی</p>
             </footer>
        </div>

        <!-- AI Solver Page -->
        <div id="ai-solver-page" class="page">
            <div class="text-center">
                <h2 class="text-2xl font-bold">KamiAI</h2>
                <p class="mb-4 mt-2 text-gray-600">
                    این بخش با استفاده از هوش مصنوعی KamiAI مسائل پیچیده شما را حل می‌کند.
                </p>
            </div>

            <div class="flex flex-col bg-AIInput rounded-3xl shadow-lg p-2">
                <!-- File Preview Container -->
                <div id="file-preview-container" class="flex w-full justify-between hidden items-center justify-between p-2 rounded-xl bg-gray-100 self-right">
                    <div class="flex items-center gap-2 overflow-hidden">
                        <img id="file-preview-image" src="" alt="Preview" class="w-16 h-16 object-cover rounded">
                        <span id="file-preview-name" class="text-sm text-gray-700 truncate"></span>
                    </div>
                    <button onclick="cancelFile()" title="لغو فایل" class="p-1 text-red-500 hover:text-red-700">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </div>
                <textarea id="ai-input" class="justify flex-grow w-full p-4 bg-transparent focus:outline-none resize-none text-slate-800 self-center" data-gramm="false" contenteditable="true" role="textbox" aria-multiline="true" max-row="7" placeholder="مسئله خود را وارد کنید..." rows="1" style="overflow: hidden;"></textarea>
                <div class="flex w-full justify-between items-center px-2">
                	<button title="ضمیمه کردن فایل" onclick="document.getElementById('file-input').click()" class="mb-2 p-2 btn-3d rounded-full self-right bg-AIInput text-gray-500 hover:text-slate-900">
	                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-paperclip"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg>
	                </button>
                	<input type="file" id="file-input" class="hidden" accept="image/*">
                	<button onclick="solveWithAI(false)" title="بپرس" class="mb-2 p-2 btn-3d btn-green text-xl h-full rounded-full self-left"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"  viewBox="0 0 2200 2200"><g transform="scale(2.25) translate(-1050, -150)"><path style="fill:#FFFFFF;" d="M1346.535,606.039c2.16,4.919,2.16,10.561,0,15.479l-117.291,267.063		c-9.539,21.723-4.693,46.429,12.349,62.936c10.795,10.455,24.719,15.916,38.917,15.916c8.219,0,16.531-1.83,24.38-5.581		l622.408-297.39c19.711-9.418,31.955-28.838,31.955-50.683c0-21.845-12.244-41.266-31.955-50.684l-622.407-297.39		c-21.409-10.229-46.254-6.173-63.298,10.335c-17.043,16.508-21.89,41.211-12.349,62.936L1346.535,606.039z M1267.282,302.563		c1.64-1.587,6.434-5.566,13.233-5.566c2.556,0,5.395,0.563,8.456,2.025l622.408,297.39c6.855,3.276,10.949,9.768,10.949,17.367		H1385.07c0-7.705-1.576-15.41-4.729-22.588l-117.291-267.063C1258.058,312.758,1265.027,304.747,1267.282,302.563z"/></g></svg></button>
                </div>
            </div>

            <div class="relative p-4 bg-AIOutput rounded-xl min-h-[100px] mt-6">
                 <div id="ai-output" dir="auto" class="justify">
                    <p class="text-gray-500 text-center">پاسخ در اینجا نمایش داده می‌شود...</p>
                 </div>
                 <div id="ai-controls" class="flex item-center gap-2 mt-8 hidden">
                 <button id="copy-button" onclick="copyAiResponse()" class="absolute bottom-2 left-12 p-2 text-gray-500 hover:bg-gray-100 rounded-full transition" title="کپی کردن پاسخ">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-copy"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                 </button>
                 <button id="tts-button" onclick="playTTS()" class="absolute bottom-2 left-2 p-2 text-gray-500 hover:bg-gray-100 rounded-full transition" title="خواندن متن">
                    <!-- Speaker Icon -->
                    <svg id="tts-icon-play" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
                    <!-- Loading Icon -->
                    <svg id="tts-icon-loading" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-loader animate-spin hidden"><line x1="12" y1="2" x2="12" y2="6"></line><line x1="12" y1="18" x2="12" y2="22"></line><line x1="4.93" y1="4.93" x2="7.76" y2="7.76"></line><line x1="16.24" y1="16.24" x2="19.07" y2="19.07"></line><line x1="2" y1="12" x2="6" y2="12"></line><line x1="18" y1="12" x2="22" y2="12"></line><line x1="4.93" y1="19.07" x2="7.76" y2="16.24"></line><line x1="16.24" y1="7.76" x2="19.07" y2="4.93"></line></svg>
                     <!-- Pause Icon -->
                    <svg id="tts-icon-pause" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-pause hidden"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>
                 </button>
                 </div>
            </div>
        </div>

        <!-- Calculator Page -->
        <div id="calculator-page" class="page">
            <div id="calculator-container" class="max-w-sm mx-auto calculator-bg p-4 rounded-xl shadow-lg">
            	<div class="text-center mb-3">
                 	<button id="calc-mode-toggle" class="px-20 py-2 btn-3d btn-gray" onclick="navigateTo('advanced-calculator-page', 'ماشین حساب پیشرفته')">ماشین حساب پیشرفته</button>
            	</div>
                <!-- Display -->
                <div class="calculator-display mb-4">
                    <div id="calc-history" class="history"></div>
                    <div id="calc-input" class="current-input">0</div>
                    <button id="calc-backspace" class="absolute top-1/2 right-3 -translate-y-1/2 text-slate-600 hover:text-slate-900 active:scale-90 transition-transform">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 4H8l-7 8 7 8h13a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z"></path><line x1="18" y1="9" x2="12" y2="15"></line><line x1="12" y1="9" x2="18" y2="15"></line></svg>
                    </button>
                </div>
                <!-- Buttons Grid -->
                <div class="grid grid-cols-4 gap-3 text-2xl font-semibold">
                    <!-- Standard Buttons -->
                    <button data-key="C" class="btn-3d btn-red p-4">C</button>
                    <button data-key=")" class="btn-3d btn-gray p-4">(</button>
                    <button data-key="(" class="btn-3d btn-gray p-4">)</button>
                    <button data-key="÷" class="btn-3d btn-gray p-4">÷</button>

                    <button data-key="7" class="btn-3d btn-gray p-4">7</button>
                    <button data-key="8" class="btn-3d btn-gray p-4">8</button>
                    <button data-key="9" class="btn-3d btn-gray p-4">9</button>
                    <button data-key="×" class="btn-3d btn-gray p-4">×</button>

                    <button data-key="4" class="btn-3d btn-gray p-4">4</button>
                    <button data-key="5" class="btn-3d btn-gray p-4">5</button>
                    <button data-key="6" class="btn-3d btn-gray p-4">6</button>
                    <button data-key="-" class="btn-3d btn-gray p-4">-</button>

                    <button data-key="1" class="btn-3d btn-gray p-4">1</button>
                    <button data-key="2" class="btn-3d btn-gray p-4">2</button>
                    <button data-key="3" class="btn-3d btn-gray p-4">3</button>
                    <button data-key="+" class="btn-3d btn-gray p-4">+</button>
                    
                    <button data-key="±" class="btn-3d btn-gray p-4">+/-</button>
                    <button data-key="0" class="btn-3d btn-gray p-4">0</button>
                    <button data-key="." class="btn-3d btn-gray p-4">.</button>
                    <button data-key="=" class="btn-3d btn-green p-4">=</button>
                </div>
            </div>
        </div>

        <!-- Advanced Calculator Page -->
        <div id="advanced-calculator-page" class="page">
             <div class="flex flex-col items-center gap-2 bg-white border rounded-lg shadow-inner p-2">
                 <div class="relative w-full">
                     <input type="text" id="advanced-calc-input" class="w-full p-3 bg-transparent focus:outline-none text-xl !text-left pr-14 overflow-x-auto" dir="ltr" placeholder="آنچه می خواهید محاسبه کنید را وارد کنید...">
                     <button onclick="solveWithAI(true)" class="absolute right-2 top-1/2 -translate-y-1/2 p-2 rounded-lg bg-green-700 text-white hover:bg-green-800 transition-colors font-bold text-2xl w-10 h-10 flex items-center justify-center" title="محاسبه">
                         =
                     </button>
                 </div>
                 <div class="w-full h-px bg-slate-200"></div>
                 <div class="flex items-center gap-2 w-full">
                    <button title="ضمیمه کردن فایل" onclick="document.getElementById('file-input-advanced').click()" class="p-2 text-gray-500 hover:text-gray-800">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg>
                    </button>
                    <input type="file" id="file-input-advanced" class="hidden" accept="image/*">
                    <div id="file-preview-container-advanced" class="hidden flex-grow items-center justify-between p-1 bg-gray-100 rounded-lg text-sm">
                         <span id="file-preview-name-advanced" class="truncate"></span>
                         <button onclick="cancelFileAdvanced()" title="لغو فایل" class="p-1 text-red-500 hover:text-red-700">
                             <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                         </button>
                    </div>
                 </div>
             </div>

            <!-- Live LaTeX Preview -->
            <div id="latex-preview" class="p-4 rounded-lg mt-2 text-xl overflow-x-auto" dir="rtl"></div>

             <!-- Math Palette -->
             <div id="math-palette" class="bg-slate-200 rounded-lg p-2 mt-4">
                 <div class="palette-tabs flex justify-around border-b border-slate-300 mb-2 text-xl md:text-2xl text-slate-500">
                     <button class="p-2 active" data-palette="basic" title="پایه">★</button>
                     <button class="p-2" data-palette="radical" title="توان‌ها">√</button>
                     <button class="p-2" data-palette="calculus" title="حسابان">∫∂</button>
                     <button class="p-2" data-palette="matrix" title="‌ماتریس‌ها">(::)</button>
                     <button class="p-2" data-palette="trig" title="مثلثات">sin</button>
                     <button class="p-2" data-palette="operators" title="عملگرها">✘✚</button>
                     <button class="p-2" data-palette="greeks" title="نمادها و حروف یونانی">αω</button>
                     <button class="p-2" data-palette="accents" title="علائم تزئینی و ساختاری">ä</button>
                 </div>
                 <div class="max-row-2 transition duration-100">
                    <div id="palette-content-basic" class="palette-content active grid-cols-5 md:grid-cols-8 gap-1"></div>
                    <div id="palette-content-radical" class="palette-content grid-cols-5 md:grid-cols-8 gap-1"></div>
                    <div id="palette-content-calculus" class="palette-content grid-cols-5 md:grid-cols-8 gap-1"></div>
                    <div id="palette-content-matrix" class="palette-content grid-cols-4 md:grid-cols-8 gap-1"></div>
                    <div id="palette-content-trig" class="palette-content grid-cols-5 md:grid-cols-8 gap-1"></div>
                    <div id="palette-content-operators" class="palette-content grid-cols-5 md:grid-cols-9 gap-1"></div>
                    <div id="palette-content-greeks" class="palette-content grid-cols-5 md:grid-cols-11 gap-1"></div>
                    <div id="palette-content-accents" class="palette-content grid-cols-6 md:grid-cols-12 lg:grid-cols-16 gap-1"></div>
                 </div>
             </div>

             <div id="plot-container" class="my-6 item-center bg-white mb-2 rounded-lg shadow plot-height hidden"></div>
             <div id="kami-output" dir="auto" class="justify bg-white p-4 rounded-lg shadow min-h-[150px] mt-6" prose prose-slate max-w-none text-justify">
                 <p class="text-gray-500 text-center">پاسخ KamiAI در اینجا نمایش داده می‌شود...</p>
             </div>
        </div>

        <!-- Unit Converter Page -->
        <div id="converter-page" class="page">
             <div class="border-b border-gray-200 bg-white shadow rounded-lg">
                 <nav class="flex-nowrap overflow-x-auto flex -mb-px" id="converter-tabs">
                    <button class="converter-tab-btn whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300 transition duration-200" data-target="con-length" data-quantity-key="طول">طول</button>
                    <button class="converter-tab-btn whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300 transition duration-200" data-target="con-area" data-quantity-key="مساحت">مساحت</button>
                    <button class="converter-tab-btn whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300 transition duration-200" data-target="con-volume" data-quantity-key="حجم">حجم</button>
                    <button class="converter-tab-btn whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300 transition duration-200" data-target="con-mass" data-quantity-key="جرم">جرم</button>
                    <button class="converter-tab-btn whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300 transition duration-200" data-target="con-time" data-quantity-key="زمان">زمان</button>
                    <button class="converter-tab-btn whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300 transition duration-200" data-target="con-energy" data-quantity-key="انرژی">انرژی</button>
                    <button class="converter-tab-btn whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300 transition duration-200" data-target="con-temp" data-quantity-key="دما">دما</button>
                    <button class="converter-tab-btn whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300 transition duration-200" data-target="con-angle" data-quantity-key="زاویه">زاویه</button>
                    <button class="converter-tab-btn whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300 transition duration-200" data-target="con-vlocity" data-quantity-key="سرعت">سرعت</button>
                    <button class="converter-tab-btn whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300 transition duration-200" data-target="con-data" data-quantity-key="داده">داده</button>
                    <button class="converter-tab-btn whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300 transition duration-200" data-target="con-charge" data-quantity-key="بار الکتریکی">بار الکتریکی</button>
                    <button class="converter-tab-btn whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300 transition duration-200" data-target="con-B" data-quantity-key="میدان مغناطیسی">میدان مغناطیسی</button>
                 </nav>
                 <div id="error-message" class="mb-4 text-center text-sm font-medium text-red-600 hidden p-3 bg-red-100 rounded-lg">لطفاً یک عدد معتبر برای تبدیل وارد کنید.</div>
                 <div id="conversion-content-wrapper" class="relative border-t border-gray-200">
                    <!-- Tab content containers -->
                    <div id="con-length" class="con-tab-content space-y-2"></div>
                    <div id="con-area" class="con-tab-content space-y-2 hidden"></div>
                    <div id="con-volume" class="con-tab-content space-y-2 hidden"></div>
                    <div id="con-mass" class="con-tab-content space-y-2 hidden"></div>
                    <div id="con-time" class="con-tab-content space-y-2 hidden"></div>
                    <div id="con-energy" class="con-tab-content space-y-2 hidden"></div>
                    <div id="con-temp" class="con-tab-content space-y-2 hidden"></div>
                    <div id="con-angle" class="con-tab-content space-y-2 hidden"></div>
                    <div id="con-vlocity" class="con-tab-content space-y-2 hidden"></div>
                    <div id="con-data" class="con-tab-content space-y-2 hidden"></div>
                    <div id="con-charge" class="con-tab-content space-y-2 hidden"></div>
                    <div id="con-B" class="con-tab-content space-y-2 hidden"></div>
                 </div>
             </div>
        	<div class="mt-6 border-t border-gray-200">
                    <h2 class="mt-3 text-2xl font-bold text-center">✨مبدل واحد هوشمند📏</h2>
                    <p class="mt-2 text-gray-600 text-center">درخواست تبدیل خود را که در برنامه نبوده است، به زبان ساده وارد کنید تا با کمک هوش مصنوعی KamiCAI به درخواستتان پاسخ دهیم.</p>
                    <div class="flex mt-2 items-center gap-2 p-2">
                         <textarea id="converter-input" class="justify flex-grow w-full p-4 h-56px bg-white focus:outline-none overflow-x-auto border rounded-lg shadow-inner resize-none text-slate-800" dir="rtl" placeholder="مثال: ۱۰ مایل به کیلومتر" data-gramm="false" contenteditable="true" role="textbox" aria-multiline="true" max-row="7" rows="1" style="overflow: hidden;"></textarea>
                         <button onclick="convertWithAI()" title="تبدیل" class="p-2 btn-3d btn-green rounded-full shrink-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"  viewBox="0 0 2200 2200"><g transform="scale(2.25) translate(-1050, -150)"><path style="fill:#FFFFFF;" d="M1346.535,606.039c2.16,4.919,2.16,10.561,0,15.479l-117.291,267.063		c-9.539,21.723-4.693,46.429,12.349,62.936c10.795,10.455,24.719,15.916,38.917,15.916c8.219,0,16.531-1.83,24.38-5.581		l622.408-297.39c19.711-9.418,31.955-28.838,31.955-50.683c0-21.845-12.244-41.266-31.955-50.684l-622.407-297.39		c-21.409-10.229-46.254-6.173-63.298,10.335c-17.043,16.508-21.89,41.211-12.349,62.936L1346.535,606.039z M1267.282,302.563		c1.64-1.587,6.434-5.566,13.233-5.566c2.556,0,5.395,0.563,8.456,2.025l622.408,297.39c6.855,3.276,10.949,9.768,10.949,17.367		H1385.07c0-7.705-1.576-15.41-4.729-22.588l-117.291-267.063C1258.058,312.758,1265.027,304.747,1267.282,302.563z"/></g></svg></button>
                    </div>
            
                    <div id="converter-loading" class="text-center p-4 hidden">
                         <svg class="animate-spin h-8 w-8 text-green-700 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                         <p class="mt-2 text-gray-600">در حال محاسبه...</p>
                    </div>
            
                    <div id="converter-output" class="bg-white p-4 rounded-lg shadow min-h-[100px] mt-3" dir="auto"><p class="text-gray-500 text-center">پاسخ در اینجا نمایش داده می‌شود...</p></div>
            	</div>
        </div>

        <!-- Math Page -->
        <div id="math-page" class="page">
            <h2 class="math-heading text-2xl text-center font-bold">🛠️ابزارهای ریاضی</h2>
            <div id="math-tool-buttons" class="mt-2 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                <button class="w-full p-4 btn-3d btn-green" onclick="showMathTool('prime-checker', 'آیا عدد اول است؟')">عدد اول است یا نه؟</button>
                <button class="w-full p-4 btn-3d btn-green" onclick="showMathTool('pythagorean-theorem', 'قضیه فیثاغورس')">قضیه فیثاغورس</button>
                <button class="w-full p-4 btn-3d btn-green" onclick="showMathTool('shape-perimeter', 'محیط اشکال')">محیط اشکال</button>
                <button class="w-full p-4 btn-3d btn-green" onclick="showMathTool('shape-area', 'مساحت اشکال')">مساحت اشکال</button>
                <button class="w-full p-4 btn-3d btn-green" onclick="showMathTool('shape-volume', 'حجم اشکال')">حجم اشکال</button>
                <button class="w-full p-4 btn-3d btn-green" onclick="showMathTool('math-tool-plot', 'رسم نمودار تابع')">رسم نمودار تابع</button>
                <button class="w-full p-4 btn-3d btn-green" onclick="showMathTool('math-tool-venn', 'رسم نمودار ون')">رسم نمودار ون</button>
                <button class="w-full p-4 btn-3d btn-green" onclick="showMathTool('math-tool-divisibility', 'بخش پذیری دو عدد')">بخش پذیری دو عدد</button>
                <button class="w-full p-4 btn-3d btn-green" onclick="showMathTool('math-tool-divisors', 'شمارنده ها')">شمارنده ها</button>
                <button class="w-full p-4 btn-3d btn-green" onclick="showMathTool('math-tool-sequences', 'دنباله‌ها')">دنباله‌ها</button>
                <button class="w-full p-4 btn-3d btn-green" onclick="showMathTool('math-tool-gcd-lcm', 'ب.م.م و ک.م.م')">ب.م.م و ک.م.م</button>
                <button class="w-full p-4 btn-3d btn-green" onclick="showMathTool('vector-calculator', 'محاسبات بردارها')">محاسبات بردارها</button>
                 <!-- Add other math buttons here -->
            </div>
            <div id="math-tool-container">
                <!-- Prime Checker -->
                <div id="prime-checker" class="math-tool hidden bg-white p-4 rounded-lg shadow">
                    <p class="mb-2"><b>عدد اول:</b> عددی طبیعی است که فقط بر ۱ و خودش بخش‌پذیر باشد.</p>
                    <p class="mb-2"><b>عدد مرکب:</b> عددی طبیعی است که بر عددی غیر از ۱ و خودش نیز بخش‌پذیر باشد.</p>
                    <p class="mb-2 text-center">عددی را وارد کنید تا مشخص شود اول است یا مرکب.</p>
                    <input type="number" inputmode="numeric" id="prime-input" dir="ltr" class="p-2 border focus:outline-none rounded-lg bg-white text-center w-full mb-2" placeholder="عدد را وارد کنید" min="1">
                    <button onclick="checkPrime()" class="p-3 w-full btn-3d btn-green">بررسی</button>
                    <p id="prime-result" class="mt-4 text-2xl text-center font-bold"></p>
                </div>
                <!-- Pythagorean Theorem -->
                <div id="pythagorean-theorem" class="math-tool hidden bg-white p-4 rounded-lg shadow">
                    <p class="mb-4 text-center"><b>قضیۀ فیثاغورس:</b> در یک مثلث قائم‌الزاویه، مربع طول وتر (ضلع روبروی زاویه 90 درجه که بلندترین ضلع مثلث است) برابر است با مجموع مربع طول دو ضلع دیگر (که به آن‌ها ساق گفته می‌شود).</p>
                    <svg class="w-60 h-45 mb-4 text-green-700 mx-auto" viewBox="0 0 300 250" xmlns="http://www.w3.org/2000/svg"><polygon points="50,20 50,220 250,220" style="fill:none; stroke:#15803d; stroke-width:3;" /><rect x="50" y="200" width="20" height="20" style="fill:none; stroke:#e74c3c; stroke-width:2;" /><text x="30" y="120" font-family="Cambria Math" font-size="18" fill="#2c3e50" text-anchor="middle">a</text><text x="150" y="245" font-family="Cambria Math" font-size="18" fill="#2c3e50" text-anchor="middle">b</text><text x="150" y="100" font-family="Cambria Math" font-size="18" fill="#2c3e50" text-anchor="middle">c</text><circle cx="50" cy="20" r="4" fill="#34495e" /><circle cx="50" cy="220" r="4" fill="#34495e" /><circle cx="250" cy="220" r="4" fill="#34495e" /><text x="40" y="15" font-family="Cambria Math" font-size="14" fill="#34495e">A</text><text x="40" y="230" font-family="Cambria Math" font-size="14" fill="#34495e">B</text><text x="260" y="230" font-family="Cambria Math" font-size="14" fill="#34495e">C</text></svg>
                    <p class="text-center text-lg mb-4">$a^2 + b^2 = c^2$</p>
                    <p class="mb-2 text-center">اندازه دو ضلع مثلث قائم‌الزاویه را وارد کنید تا ضلع سوم محاسبه شود.</p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                         <input type="number" inputmode="numeric" id="pythagorean-a" dir="ltr" class="p-2 focus:outline-none border rounded-lg bg-white text-center" placeholder="ضلع a" step="any" min="0">
                         <input type="number" inputmode="numeric" id="pythagorean-b" dir="ltr" class="p-2 focus:outline-none border rounded-lg bg-white text-center" placeholder="ضلع b" step="any" min="0">
                         <input type="number" inputmode="numeric" id="pythagorean-c" dir="ltr" class="p-2 focus:outline-none border rounded-lg bg-white text-center" placeholder="وتر c (خالی بگذارید)" step="any" min="0">
                    </div>
                    <button onclick="calculatePythagorean()" class="p-3 w-full mt-4 btn-3d btn-green" title="اندازه دو ضلع مثلث قائم‌الزاویه را وارد کنید تا ضلع سوم محاسبه شود.">محاسبه</button>
                    <p id="pythagorean-result" class="mt-4 text-2xl text-center font-bold"></p>
                </div>

                 <!-- Shape perimeter -->
                <div id="shape-perimeter" class="math-tool hidden bg-white p-4 rounded-lg shadow">
                     <div id="perimeter-shape-selection" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <!-- Square -->
                        <button class="flex flex-col items-center p-4 btn-3d btn-gray" onclick="showperimeterShape('perimeter-tool-square')">
                            <svg class="w-20 h-20 mb-2 text-green-700" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect x="10" y="10" width="80" height="80" stroke="currentColor" stroke-width="4"/>
                                <text x="50" y="55" font-family="Cambria Math" font-size="20" fill="currentColor" text-anchor="middle" alignment-baseline="middle">a</text>
                            </svg>
                            <span class="font-bold">مربع</span>
                        </button>
                        <!-- Circle -->
                        <button class="flex flex-col items-center p-4 btn-3d btn-gray" onclick="showperimeterShape('perimeter-tool-circle')">
                             <svg class="w-20 h-20 mb-2 text-green-700" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="50" cy="50" r="40" stroke="currentColor" stroke-width="4"/>
                                <line x1="50" y1="50" x2="90" y2="50" stroke="currentColor" stroke-width="2" stroke-dasharray="4 4"/>
                                <text x="70" y="45" font-family="Cambria Math" font-size="20" fill="currentColor" text-anchor="middle">r</text>
                            </svg>
                            <span class="font-bold">دایره</span>
                        </button>
                        <!-- Triangle -->
                        <button class="flex flex-col items-center p-4 btn-3d btn-gray" onclick="showperimeterShape('perimeter-tool-triangle')">
                             <svg class="w-20 h-20 mb-2 text-green-700" viewBox="0 0 105 105" fill="none" xmlns="http://www.w3.org/2000/svg">
                            	<path d="M10 90 L 90 90 L 50 10 Z" stroke="currentColor" stroke-width="4" fill="none"/>
                            	<text x="50" y="100" font-family="Cambria Math" font-size="20" fill="currentColor" text-anchor="middle">a</text>
                            	<text x="81" y="50" font-family="Cambria Math" font-size="20" fill="currentColor">b</text>
                            	<text x="28" y="50" font-family="Cambria Math" font-size="20" fill="currentColor">c</text>
                            </svg>
                            <span class="font-bold">مثلث</span>
                        </button>
                    	<!-- Rectangle -->
                    	<button class="flex flex-col items-center p-4 btn-3d btn-gray" onclick="showperimeterShape('perimeter-tool-rectangle')">
                             <svg class="w-20 h-20 mb-2 text-green-700 mx-auto" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect x="10" y="25" width="80" height="50" stroke="currentColor" stroke-width="4" fill="rgba(0,0,0,0.05)"/>
                                <text x="50" y="90" font-family="Cambria Math" font-size="20" fill="currentColor" text-anchor="middle">a</text>
                                <text x="20" y="50" font-family="Cambria Math" font-size="20" fill="currentColor" text-anchor="middle" alignment-baseline="middle">b</text>
                             </svg>
     	                   <span class="font-bold">مستطیل</span>
                    	</button>
                        <!-- Parallelogram -->
                        <button class="flex flex-col items-center p-4 btn-3d btn-gray" onclick="showperimeterShape('perimeter-tool-parallelogram')">
                            <svg class="w-20 h-20 mb-2 text-green-700" viewBox="0 0 100 105" xmlns="http://www.w3.org/2000/svg"><polygon points="20,20 80,20 60,80 0,80" stroke="currentColor" stroke-width="4" fill="none"/></svg>
                            <span class="font-bold">متوازی‌الاضلاع</span>
                        </button>
                        <!-- Rhombus -->
                        <button class="flex flex-col items-center p-4 btn-3d btn-gray" onclick="showperimeterShape('perimeter-tool-rhombus')">
                            <svg class="w-20 h-20 mb-2 text-green-700" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><polygon points="50,10 90,50 50,90 10,50" stroke="currentColor" stroke-width="4" fill="none"/></svg>
                            <span class="font-bold">لوزی</span>
                        </button>
                        <!-- Trapezoid -->
                        <button class="flex flex-col items-center p-4 btn-3d btn-gray" onclick="showperimeterShape('perimeter-tool-trapezoid')">
                            <svg class="w-20 h-20 mb-2 text-green-700" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><polygon points="15,80 85,80 65,20 35,20" stroke="currentColor" stroke-width="4" fill="none"/></svg>
                            <span class="font-bold">ذوزنقه</span>
                        </button>
                        <!-- Sector -->
                        <button class="flex flex-col items-center p-4 btn-3d btn-gray" onclick="showperimeterShape('perimeter-tool-sector')">
                            <svg class="w-20 h-20 mb-2 text-green-700" viewBox="40 0 70 70" xmlns="http://www.w3.org/2000/svg"><path d="M50 50 L90 50 A40 40 0 0 0 50 10 Z" stroke="currentColor" stroke-width="3" fill="none"/></svg>
                            <span class="font-bold">قطاع دایره</span>
                        </button>
                        <!-- Ellipse -->
                        <button class="flex flex-col items-center p-4 btn-3d btn-gray" onclick="showperimeterShape('perimeter-tool-ellipse')">
                            <svg class="w-20 h-20 mb-2 text-green-700" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><ellipse cx="50" cy="50" rx="38" ry="24" stroke="currentColor" stroke-width="4" fill="none"/></svg>
                            <span class="font-bold">بیضی</span>
                        </button>
                     </div>
                     
                     <!-- perimeter Sub-Pages -->
                     <div id="perimeter-tool-square" class="perimeter-tool-page hidden">
                         <h3 class="text-xl font-bold mb-2 text-center">محیط مربع</h3>
                         <svg class="w-32 h-32 mb-4 text-green-700 mx-auto" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="10" y="10" width="80" height="80" stroke="currentColor" stroke-width="4" fill="rgba(0,0,0,0.05)"/>
                            <text x="50" y="55" font-family="Cambria Math" font-size="20" fill="currentColor" text-anchor="middle" alignment-baseline="middle">a</text>
                        </svg>
                         <p class="text-center text-lg mb-4">محیط مربع: 4 برابر یک ضلع.</p>
                         <p class="text-center text-lg mb-4">$P = 4a$</p>
                         <input type="number" inputmode="numeric" id="perimeter-square-side" dir="ltr" class="p-2 focus:outline-none border rounded-lg bg-white text-center w-full mb-2" placeholder="ضلع (a)">
                         <button onclick="calculatePerimeter('square')" class="p-3 btn-3d btn-green w-full">محاسبه</button>
                         <p id="perimeter-square-result" class="mt-4 font-bold"></p>
                     </div>
                     
                     <div id="perimeter-tool-circle" class="perimeter-tool-page hidden">
                         <h3 class="text-xl font-bold mb-2 text-center">محیط دایره</h3>
                          <svg class="w-32 h-32 mb-4 text-green-700 mx-auto" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="50" cy="50" r="40" stroke="currentColor" stroke-width="4" fill="rgba(0,0,0,0.05)"/>
                            <line x1="50" y1="50" x2="90" y2="50" stroke="currentColor" stroke-width="2" stroke-dasharray="4 2"/>
                            <text x="70" y="45" font-family="Cambria Math" font-size="20" fill="currentColor" text-anchor="middle">r</text>
                        </svg>
                         <p class="text-center text-lg mb-4">محیط دایره: حاصل‌ضرب عدد پی در قطر</p>
                         <p class="text-center text-lg mb-4">$A = 2 \pi r$</p>
                         <input type="number" inputmode="numeric" id="perimeter-circle-radius" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full mb-2" placeholder="شعاع (r)">
                         <button onclick="calculatePerimeter('circle')" class="p-3 btn-3d btn-green w-full">محاسبه</button>
                         <p id="perimeter-circle-result" class="mt-4 font-bold"></p>
                     </div>
                     
                     <div id="perimeter-tool-triangle" class="perimeter-tool-page hidden">
                         <h3 class="text-xl font-bold mb-2 text-center">محیط مثلث</h3>
                         <svg class="w-32 h-32 mb-4 text-green-700 mx-auto" viewBox="0 0 110 110" fill="none" xmlns="http://www.w3.org/2000/svg">
                            	<path d="M10 90 L 90 90 L 50 10 Z" stroke="currentColor" stroke-width="4" fill="none"/>
                            	<text x="50" y="103" font-family="Cambria Math" font-size="20" fill="currentColor" text-anchor="middle">a</text>
                            	<text x="82" y="50" font-family="Cambria Math" font-size="20" fill="currentColor">b</text>
                            	<text x="28" y="50" font-family="Cambria Math" font-size="20" fill="currentColor">c</text>
                        </svg>
                         <p class="text-center text-lg mb-4">محیط مثلث: مجموع سه ضلع</p>
                         <p class="text-center text-lg mb-4">$P = a + b + c$</p>
                         <input type="number" inputmode="numeric" id="perimeter-triangle-a" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full mb-2" placeholder="ضلع اول (a)">
                         <input type="number" inputmode="numeric" id="perimeter-triangle-b" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full mb-2" placeholder="ضلع دوم (b)">
                         <input type="number" inputmode="numeric" id="perimeter-triangle-c" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full mb-2" placeholder="ضلع سوم (c)">
                         <button onclick="calculatePerimeter('triangle')" class="p-3 btn-3d btn-green w-full">محاسبه</button>
                         <p id="perimeter-triangle-result" class="mt-4 font-bold"></p>
                     </div>
   	             <!-- Rectangle perimeter -->
   	             <div id="perimeter-tool-rectangle" class="perimeter-tool-page hidden">
   	                <h3 class="text-xl font-bold mb-2 text-center">محیط مستطیل</h3>
             	        <svg class="w-32 h-32 mb-2 text-green-700 mx-auto" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="10" y="25" width="80" height="50" stroke="currentColor" stroke-width="4" fill="rgba(0,0,0,0.05)"/>
                            <text x="50" y="90" font-family="Cambria Math" font-size="20" fill="currentColor" text-anchor="middle">a</text>
                            <text x="20" y="50" font-family="Cambria Math" font-size="20" fill="currentColor" text-anchor="middle" alignment-baseline="middle">b</text>
             	        </svg>
    	                <p class="text-center text-lg mb-4">محیط مستطیل: دوبرابر حاصل جمع طول و عرض</p>
    	                <p class="text-center text-xl mb-4">$A = 2(a+b)$</p>
    	                <input type="number" inputmode="numeric" id="perimeter-rectangle-length" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full mb-2" placeholder="طول (a)">
    	                <input type="number" inputmode="numeric" id="perimeter-rectangle-width" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full mb-2" placeholder="عرض (b)">
     	               <button onclick="calculatePerimeter('rectangle')" class="p-3 btn-3d btn-green w-full">محاسبه</button>
     	               <p id="perimeter-rectangle-result" class="mt-4 font-bold text-center"></p>
   	             </div>
                    <div id="perimeter-tool-parallelogram" class="perimeter-tool-page hidden">
                        <h3 class="text-xl font-bold mb-2 text-center">محیط متوازی‌الاضلاع</h3>
                        <svg class="w-32 h-32 mb-2 text-green-700 mx-auto" viewBox="0 0 100 105" xmlns="http://www.w3.org/2000/svg">
                            <polygon points="20,20 80,20 60,80 0,80" stroke="currentColor" stroke-width="4" fill="none"/>
                            <text x="30" y="95" font-family="Cambria Math" font-size="20" fill="currentColor" text-anchor="middle">a</text>
                            <text x="85" y="55" font-family="Cambria Math" font-size="20" fill="currentColor" text-anchor="middle">b</text>
                        </svg>
                        <p class="text-center text-lg mb-4">محیط متوازی‌الاضلاع: دوبرابر حاصل جمع قاعده و بُعد جانبی</p>
                        <p class="text-center text-lg mb-2">$P = 2(a + b)$</p>
                        <input type="number" inputmode="numeric" id="perimeter-par-a" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full mb-2" placeholder="قاعده a">
                        <input type="number" inputmode="numeric" id="perimeter-par-b" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full mb-2" placeholder="بُعد جانبی b">
                        <button onclick="calculatePerimeter('parallelogram')" class="p-3 btn-3d btn-green w-full">محاسبه</button>
                        <p id="perimeter-par-result" class="mt-4 font-bold text-center"></p>
                    </div>
                    
                    <div id="perimeter-tool-rhombus" class="perimeter-tool-page hidden">
                        <h3 class="text-xl font-bold mb-2 text-center">محیط لوزی</h3>
                        <svg class="w-32 h-32 mb-2 text-green-700 mx-auto" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <polygon points="50,10 90,50 50,90 10,50" stroke="currentColor" stroke-width="4" fill="none"/>
                            <text x="25" y="85" font-family="Cambria Math" font-size="20" fill="currentColor" text-anchor="middle">a</text>
                        </svg>
                        <p class="text-center text-lg mb-4">محیط لوزی: چهاربرابر ضلع</p>
                        <p class="text-center text-lg mb-2">$P = 4a$</p>
                        <input type="number" inputmode="numeric" id="perimeter-rhombus-side" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full mb-2" placeholder="ضلع (a)">
                        <button onclick="calculatePerimeter('rhombus')" class="p-3 btn-3d btn-green w-full">محاسبه</button>
                        <p id="perimeter-rhombus-result" class="mt-4 font-bold text-center"></p>
                    </div>
                    
                    <div id="perimeter-tool-trapezoid" class="perimeter-tool-page hidden">
                        <h3 class="text-xl font-bold mb-2 text-center">محیط ذوزنقه</h3>
                        <svg class="w-32 h-32 mb-2 text-green-700 mx-auto" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <polygon points="15,80 85,80 65,20 35,20" stroke="currentColor" stroke-width="4" fill="none"/>
                            <text x="50" y="94" font-family="Cambria Math" font-size="15" font-weight="bold" fill="currentColor" text-anchor="middle">c</text>
                            <text x="87" y="50" font-family="Cambria Math" font-size="15" font-weight="bold" fill="currentColor" text-anchor="start">b</text>
                            <text x="50" y="15" font-family="Cambria Math" font-size="15" font-weight="bold" fill="currentColor" text-anchor="middle">a</text>
                            <text x="13" y="50" font-family="Cambria Math" font-size="15" font-weight="bold" fill="currentColor" text-anchor="end">d</text>
                        </svg>
                        <p class="text-center text-lg mb-4">محیط ذوزنقه: مجموع چهار ضلع</p>
                        <p class="text-center text-lg mb-2">$$P = a + b + c + d$$</p>
                        <input type="number" inputmode="numeric" id="perimeter-trap-a" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full mb-2" placeholder="پایه بالا (a)">
                        <input type="number" inputmode="numeric" id="perimeter-trap-b" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full mb-2" placeholder="پایه پایین (b)">
                        <input type="number" inputmode="numeric" id="perimeter-trap-c" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full mb-2" placeholder="ضلع (c)">
                        <input type="number" inputmode="numeric" id="perimeter-trap-d" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full mb-2" placeholder="ضلع (d)">
                        <button onclick="calculatePerimeter('trapezoid')" class="p-3 btn-3d btn-green w-full">محاسبه</button>
                        <p id="perimeter-trap-result" class="mt-4 font-bold text-center"></p>
                    </div>
                    
                    <div id="perimeter-tool-sector" class="perimeter-tool-page hidden">
                        <h3 class="text-xl font-bold mb-2 text-center">محیط قطاع دایره</h3>
                        <svg class="w-32 h-32 mb-2 text-green-700 mx-auto" viewBox="40 0 70 70" xmlns="http://www.w3.org/2000/svg">
                            <path d="M50 50 L90 50 A40 40 0 0 0 50 10 Z" stroke="currentColor" stroke-width="3" fill="none"/>
                            <line x1="50" y1="50" x2="90" y2="50" stroke="currentColor" stroke-width="3"/>
                            <line x1="50" y1="50" x2="50" y2="10" stroke="currentColor" stroke-width="3"/>
                            <text x="70" y="63" font-family="Cambria Math" font-size="14" fill="currentColor" text-anchor="middle">r</text>
                            <text x="45" y="30" font-family="Cambria Math" font-size="14" fill="currentColor" text-anchor="start">r</text>
                            <path d="M58 50 A8 8 0 0 0 50 42" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            <text x="60" y="40" font-family="Cambria Math" font-size="14" fill="currentColor" text-anchor="middle">θ</text>
                            <text x="80" y="17" font-family="Cambria Math" font-size="14" fill="currentColor" text-anchor="middle">ℓ</text>
                        </svg>
                        <p class="text-center text-lg mb-4">محیط قطاع دایره: مجموع طول کمان (حاصل‌ضرب شعاع در زاویه برحسب رادیان) و دو شعاع</p>
                        <p class="text-center text-lg mb-2">$P=\ell+2r=r(\theta_\text{rad}+2)=r(\frac{\pi\theta^{\circ}}{180^{\circ}}+2)$</p>
                        <input type="number" id="perimeter-sector-r" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full mb-2" placeholder="شعاع (r)">
                        <input type="number" id="perimeter-sector-angle" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full mb-2" placeholder="θ زاویه (درجه)">
                        <p class="text-center text-sm text-gray-500 mb-2">زاویه را بر حسب درجه وارد کنید</p>
                        <button onclick="calculatePerimeter('sector')" class="p-3 btn-3d btn-green w-full">محاسبه</button>
                        <p id="perimeter-sector-result" class="mt-4 font-bold text-center"></p>
                    </div>
                    
                    <div id="perimeter-tool-ellipse" class="perimeter-tool-page hidden">
                        <h3 class="text-xl font-bold mb-2 text-center">محیط بیضی</h3>
                        <svg class="w-32 h-32 mb-2 text-green-700 mx-auto" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <ellipse cx="50" cy="50" rx="38" ry="24" stroke="currentColor" stroke-width="3" fill="none"/>
                            <line x1="50" y1="50" x2="88" y2="50" stroke="currentColor" stroke-width="2" stroke-dasharray="2,2"/>
                            <text x="70" y="45" font-family="Cambria Math" font-size="12" fill="currentColor" text-anchor="middle">a</text>
                            <line x1="50" y1="50" x2="50" y2="26" stroke="currentColor" stroke-width="2" stroke-dasharray="2,2"/>
                            <text x="60" y="38" font-family="Cambria Math" font-size="12" fill="currentColor" text-anchor="start">b</text>
                        </svg>
                        <p class="text-center text-lg mb-4">$$P=4\int_{0}^{a} {{\sqrt{1+\frac{b^2x^2}{a^2(a^2-x^2)}}} d{x}}$$</p>
                        <p class="text-center text-sm mb-2">فرمول تقریبی اول رامانوجان:</p>
                        <p class="text-center text-sm mb-2">$$P \simeq \pi [3(a+b) - \sqrt{((3a+b)(a+3b))}]$$</p>
                        <input type="number" id="perimeter-ellipse-a" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full mb-2" placeholder="نیم محور بزرگ (a)">
                        <input type="number" id="perimeter-ellipse-b" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full mb-2" placeholder="نیم محور کوچک (b)">
                        <button onclick="calculatePerimeter('ellipse')" class="p-3 btn-3d btn-green w-full">محاسبه</button>
                        <p id="perimeter-ellipse-result" class="mt-4 font-bold text-center"></p>
                    </div>
                </div>

                 <!-- Shape Area -->
                <div id="shape-area" class="math-tool hidden bg-white p-4 rounded-lg shadow">
                     <div id="area-shape-selection" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <!-- Square -->
                        <button class="flex flex-col items-center p-4 btn-3d btn-gray" onclick="showAreaShape('area-tool-square')">
                            <svg class="w-20 h-20 mb-2 text-green-700" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect x="10" y="10" width="80" height="80" stroke="currentColor" stroke-width="4"/>
                                <text x="50" y="55" font-family="Cambria Math" font-size="20" fill="currentColor" text-anchor="middle" alignment-baseline="middle">a</text>
                            </svg>
                            <span class="font-bold">مربع</span>
                        </button>
                        <!-- Circle -->
                        <button class="flex flex-col items-center p-4 btn-3d btn-gray" onclick="showAreaShape('area-tool-circle')">
                             <svg class="w-20 h-20 mb-2 text-green-700" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="50" cy="50" r="40" stroke="currentColor" stroke-width="4"/>
                                <line x1="50" y1="50" x2="90" y2="50" stroke="currentColor" stroke-width="2" stroke-dasharray="4 4"/>
                                <text x="70" y="45" font-family="Cambria Math" font-size="20" fill="currentColor" text-anchor="middle">r</text>
                            </svg>
                            <span class="font-bold">دایره</span>
                        </button>
                        <!-- Triangle -->
                        <button class="flex flex-col items-center p-4 btn-3d btn-gray" onclick="showAreaShape('area-tool-triangle')">
                             <svg class="w-20 h-20 mb-2 text-green-700" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M10 90 L 50 10 L 90 90 Z" stroke="currentColor" stroke-width="4" fill="rgba(0,0,0,0.05)"/>
                                <line x1="50" y1="10" x2="50" y2="90" stroke="currentColor" stroke-width="2" stroke-dasharray="4 4"/>
                                <text x="60" y="50" font-family="Cambria Math" font-size="20" fill="currentColor">h</text>
                                <text x="50" y="95" font-family="Cambria Math" font-size="20" fill="currentColor" text-anchor="middle">b</text>
                            </svg>
                            <span class="font-bold">مثلث</span>
                        </button>
                    	<!-- Rectangle -->
                    	<button class="flex flex-col items-center p-4 btn-3d btn-gray" onclick="showAreaShape('area-tool-rectangle')">
                             <svg class="w-20 h-20 mb-2 text-green-700 mx-auto" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect x="10" y="25" width="80" height="50" stroke="currentColor" stroke-width="4" fill="rgba(0,0,0,0.05)"/>
                                <text x="50" y="90" font-family="Cambria Math" font-size="20" fill="currentColor" text-anchor="middle">a</text>
                                <text x="20" y="50" font-family="Cambria Math" font-size="20" fill="currentColor" text-anchor="middle" alignment-baseline="middle">b</text>
                             </svg>
     	                   <span class="font-bold">مستطیل</span>
                    	</button>
                        <button class="flex flex-col items-center p-4 btn-3d btn-gray" onclick="showAreaShape('area-tool-parallelogram')">
                            <svg class="w-20 h-20 mb-2 text-green-700" viewBox="0 0 100 105"><polygon points="20,20 80,20 60,80 0,80" stroke="currentColor" stroke-width="4" fill="rgba(0,0,0,0.05)"/></svg>
                            <span class="font-bold">متوازی‌الاضلاع</span>
                        </button>
                        <button class="flex flex-col items-center p-4 btn-3d btn-gray" onclick="showAreaShape('area-tool-rhombus')">
                            <svg class="w-20 h-20 mb-2 text-green-700" viewBox="0 0 100 100"><polygon points="50,10 80,50 50,90 20,50" stroke="currentColor" stroke-width="4" fill="rgba(0,0,0,0.05)"/></svg>
                            <span class="font-bold">لوزی</span>
                        </button>
                        <button class="flex flex-col items-center p-4 btn-3d btn-gray" onclick="showAreaShape('area-tool-trapezoid')">
                            <svg class="w-20 h-20 mb-2 text-green-700" viewBox="0 0 100 100"><polygon points="15,80 85,80 65,20 35,20" stroke="currentColor" stroke-width="4" fill="rgba(0,0,0,0.05)"/></svg>
                            <span class="font-bold">ذوزنقه</span>
                        </button>
                        <button class="flex flex-col items-center p-4 btn-3d btn-gray" onclick="showAreaShape('area-tool-sector')">
                            <svg class="w-20 h-20 mb-2 text-green-700" viewBox="40 0 70 70" xmlns="http://www.w3.org/2000/svg"><path d="M50 50 L90 50 A40 40 0 0 0 50 10 Z" stroke="currentColor" stroke-width="3" fill="none"/></svg>
                            <span class="font-bold">قطاع دایره</span>
                        </button>
                        <button class="flex flex-col items-center p-4 btn-3d btn-gray" onclick="showAreaShape('area-tool-ellipse')">
                            <svg class="w-20 h-20 mb-2 text-green-700" viewBox="0 0 100 100"><ellipse cx="50" cy="50" rx="38" ry="24" stroke="currentColor" stroke-width="4" fill="rgba(0,0,0,0.05)"/></svg>
                            <span class="font-bold">بیضی</span>
                        </button>
                     </div>
                     
                     <!-- Area Sub-Pages -->
                     <div id="area-tool-square" class="area-tool-page hidden">
                         <h3 class="text-xl font-bold mb-2 text-center">مساحت مربع</h3>
                         <svg class="w-32 h-32 mb-4 text-green-700 mx-auto" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="10" y="10" width="80" height="80" stroke="currentColor" stroke-width="4" fill="rgba(0,0,0,0.05)"/>
                            <text x="50" y="55" font-family="Cambria Math" font-size="20" fill="currentColor" text-anchor="middle" alignment-baseline="middle">a</text>
                        </svg>
                         <p class="text-center text-lg mb-4">مساحت مربع: حاصل‌ضرب یک ضلع در خودش</p>
                         <p class="text-center text-lg mb-4">$A = a^2$</p>
                         <input type="number" id="area-square-side" dir="ltr" class="p-2 focus:outline-none border rounded-lg text-center bg-white w-full mb-2" placeholder="ضلع (a)">
                         <button onclick="calculateArea('square')" class="p-3 btn-3d btn-green w-full">محاسبه</button>
                         <p id="area-square-result" class="mt-4 font-bold"></p>
                     </div>
                     
                     <div id="area-tool-circle" class="area-tool-page hidden">
                         <h3 class="text-xl font-bold mb-2 text-center">مساحت دایره</h3>
                          <svg class="w-32 h-32 mb-4 text-green-700 mx-auto" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="50" cy="50" r="40" stroke="currentColor" stroke-width="4" fill="rgba(0,0,0,0.05)"/>
                            <line x1="50" y1="50" x2="90" y2="50" stroke="currentColor" stroke-width="2" stroke-dasharray="4 2"/>
                            <text x="70" y="45" font-family="Cambria Math" font-size="20" fill="currentColor" text-anchor="middle">r</text>
                        </svg>
                         <p class="text-center text-lg mb-4">مساحت دایره: حاصل‌ضرب عدد پی در شعاع به توان دو</p>
                         <p class="text-center text-lg mb-4">$A = \pi r^2$</p>
                         <input type="number" id="area-circle-radius" dir="ltr" class="p-2 focus:outline-none border text-center rounded-lg bg-white w-full mb-2" placeholder="شعاع (r)">
                         <button onclick="calculateArea('circle')" class="p-3 btn-3d btn-green w-full">محاسبه</button>
                         <p id="area-circle-result" class="mt-4 font-bold"></p>
                     </div>
                     
                     <div id="area-tool-triangle" class="area-tool-page hidden">
                         <h3 class="text-xl font-bold mb-2 text-center">مساحت مثلث</h3>
                         <svg class="w-32 h-32 mb-4 text-green-700 mx-auto" viewBox="0 0 110 110" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M10 90 L 50 10 L 90 90 Z" stroke="currentColor" stroke-width="4" fill="rgba(0,0,0,0.05)"/>
                            <line x1="50" y1="10" x2="50" y2="90" stroke="currentColor" stroke-width="2" stroke-dasharray="4 4"/>
                            <text x="45" y="65" font-family="Cambria Math" font-size="20" fill="currentColor">h</text>
                            <text x="65" y="110" font-family="Cambria Math" font-size="20" fill="currentColor" text-anchor="middle">b</text>
                        </svg>
                         <p class="text-center text-lg mb-4">مساحت مثلث: نصف حاصل‌ضرب قاعده در ارتفاع متناظر</p>
                         <p class="text-center text-lg mb-4">$A = \frac{1}{2} b h$</p>
                         <input type="number" id="area-triangle-base" dir="ltr" class="p-2 border focus:outline-none bg-white text-center rounded-lg w-full mb-2" placeholder="قاعده (b)">
                         <input type="number" id="area-triangle-height" dir="ltr" class="p-2 focus:outline-none border bg-white text-center rounded-lg w-full mb-2" placeholder="ارتفاع (h)">
                         <button onclick="calculateArea('triangle')" class="p-3 btn-3d btn-green w-full">محاسبه</button>
                         <p id="area-triangle-result" class="mt-4 font-bold"></p>
                     </div>
   	             <!-- Rectangle Area -->
   	             <div id="area-tool-rectangle" class="area-tool-page hidden">
   	                <h3 class="text-xl font-bold mb-2 text-center">مساحت مستطیل</h3>
             	        <svg class="w-32 h-32 mb-2 text-green-700 mx-auto" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="10" y="25" width="80" height="50" stroke="currentColor" stroke-width="4" fill="rgba(0,0,0,0.05)"/>
                            <text x="50" y="90" font-family="Cambria Math" font-size="20" fill="currentColor" text-anchor="middle">a</text>
                            <text x="20" y="50" font-family="Cambria Math" font-size="20" fill="currentColor" text-anchor="middle" alignment-baseline="middle">b</text>
             	        </svg>
    	                <p class="text-center text-lg mb-4">مساحت مستطیل: حاصل‌ضرب طول در عرض</p>
    	                <p class="text-center text-xl mb-4">$A = a \times b$</p>
    	                <input type="number" id="area-rectangle-length" dir="ltr" class="p-2 border focus:outline-none bg-white text-center rounded-lg w-full mb-2" placeholder="طول (a)">
    	                <input type="number" id="area-rectangle-width" dir="ltr" class="p-2 border focus:outline-none text-center bg-white rounded-lg w-full mb-2" placeholder="عرض (b)">
     	               <button onclick="calculateArea('rectangle')" class="p-3 btn-3d btn-green w-full">محاسبه</button>
     	               <p id="area-rectangle-result" class="mt-4 font-bold text-center"></p>
   	             </div>

                    <div id="area-tool-parallelogram" class="area-tool-page hidden">
                        <h3 class="text-xl font-bold mb-2 text-center">مساحت متوازی‌الاضلاع</h3>
                        <svg class="w-32 h-32 mb-2 text-green-700 mx-auto" viewBox="0 0 100 105" xmlns="http://www.w3.org/2000/svg">
                            <polygon points="10,20 90,20 80,80 0,80" stroke="currentColor" stroke-width="4" fill="rgba(0,0,0,0.05)"/>
                            <text x="40" y="95" font-family="Cambria Math" font-size="14" fill="currentColor" text-anchor="middle">a</text>
                            <line x1="10" y1="80" x2="10" y2="20" stroke="currentColor" stroke-width="2" stroke-dasharray="3,3"/>
                            <line x1="5" y1="80" x2="10" y2="80" stroke="currentColor" stroke-width="2"/>
                            <text x="15" y="50" font-family="Cambria Math" font-size="14" fill="currentColor" text-anchor="end">h</text>
                        </svg>
                        <p class="text-center text-lg mb-2">مساحت متوازی‌الاضلاع: ارتفاع ضربدر قاعده</p>
                        <p class="text-center text-lg mb-2">$A = a \times h$</p>
                        <input type="number" id="area-par-base" dir="ltr" class="p-2 border focus:outline-none bg-white text-center rounded-lg w-full mb-2" placeholder="قاعده (a)">
                        <input type="number" id="area-par-height" dir="ltr" class="p-2 border focus:outline-none bg-white text-center rounded-lg w-full mb-2" placeholder="ارتفاع (h)">
                        <button onclick="calculateArea('parallelogram')" class="p-3 btn-3d btn-green w-full">محاسبه</button>
                        <p id="area-par-result" class="mt-4 font-bold text-center"></p>
                    </div>
                    
                    <div id="area-tool-rhombus" class="area-tool-page hidden">
                        <h3 class="text-xl font-bold mb-2 text-center">مساحت لوزی</h3>
                        <svg class="w-32 h-32 mb-2 text-green-700 mx-auto" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <polygon points="50,10 80,50 50,90 20,50" stroke="currentColor" stroke-width="4" fill="rgba(0,0,0,0.05)"/>                            <line x1="20" y1="50" x2="80" y2="50" stroke="red" stroke-width="1.5" stroke-dasharray="4,2"/>
                            <text x="43" y="43" font-family="Cambria Math" font-size="13" fill="red" text-anchor="middle">d₁</text>
                            <line x1="50" y1="10" x2="50" y2="90" stroke="blue" stroke-width="1.5" stroke-dasharray="4,2"/>
                            <text x="63" y="60" font-family="Cambria Math" font-size="13" fill="blue" dominant-baseline="middle">d₂</text>
                        </svg>
                        <p class="text-center text-lg mb-2">مساحت لوزی: حاصل‌ضرب دو قطر تقسیم بر 2<p>
                        <p class="text-center text-lg mb-2">$A=\frac{d_1 d_2}{2}$</p>
                        <input type="number" id="area-rhombus-d1" dir="ltr" class="p-2 border focus:outline-none bg-white text-center rounded-lg w-full mb-2" placeholder="قطر اول (d₁)">
                        <input type="number" id="area-rhombus-d2" dir="ltr" class="p-2 border focus:outline-none bg-white text-center rounded-lg w-full mb-2" placeholder="قطر دوم (d₂)">
                        <button onclick="calculateArea('rhombus')" class="p-3 btn-3d btn-green w-full">محاسبه</button>
                        <p id="area-rhombus-result" class="mt-4 font-bold text-center"></p>
                    </div>
                    
                    <div id="area-tool-trapezoid" class="area-tool-page hidden">
                        <h3 class="text-xl font-bold mb-2 text-center">مساحت ذوزنقه</h3>
                        <svg class="w-32 h-32 mb-2 text-green-700 mx-auto" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <polygon points="15,80 85,80 65,20 35,20" stroke="currentColor" stroke-width="4" fill="rgba(0,0,0,0.05)"/>
                            <line x1="35" y1="20" x2="35" y2="80" stroke="red" stroke-width="2" stroke-dasharray="4,2"/>
                            <text x="40" y="50" font-family="Cambria Math" font-size="14" fill="red" text-anchor="end">h</text>
                            <text x="50" y="93" font-family="Cambria Math" font-size="14" fill="currentColor" text-anchor="middle">a</text>
                        </svg>
                        <p class="text-center text-lg mb-2">مساحت لوزی: حاصل‌جمع دو قاعده تقسیم بر 2 ضربدر ارتفاع</p>
                        <p class="text-center text-lg mb-2">$A = \frac{(a + b)}{2} h$</p>
                        <input type="number" id="area-trap-a" dir="ltr" class="p-2 border focus:outline-none bg-white text-center rounded-lg w-full mb-2" placeholder="قاعده اول (a)">
                        <input type="number" id="area-trap-b" dir="ltr" class="p-2 border focus:outline-none bg-white text-center rounded-lg w-full mb-2" placeholder="قاعده دوم (b)">
                        <input type="number" id="area-trap-h" dir="ltr" class="p-2 border focus:outline-none bg-white text-center rounded-lg w-full mb-2" placeholder="ارتفاع (h)">
                        <button onclick="calculateArea('trapezoid')" class="p-3 btn-3d btn-green w-full">محاسبه</button>
                        <p id="area-trap-result" class="mt-4 font-bold text-center"></p>
                    </div>
                    
                    <div id="area-tool-sector" class="area-tool-page hidden">
                        <h3 class="text-xl font-bold mb-2 text-center">مساحت قطاع دایره</h3>
                        <svg class="w-32 h-32 mb-2 text-green-700 mx-auto" viewBox="40 0 70 70" xmlns="http://www.w3.org/2000/svg">
                            <path d="M50 50 L90 50 A40 40 0 0 0 50 10 Z" stroke="currentColor" stroke-width="3" fill="none"/>
                            <line x1="50" y1="50" x2="90" y2="50" stroke="currentColor" stroke-width="3"/>
                            <line x1="50" y1="50" x2="50" y2="10" stroke="currentColor" stroke-width="3"/>
                            <text x="70" y="63" font-family="Cambria Math" font-size="14" fill="currentColor" text-anchor="middle">r</text>
                            <path d="M58 50 A8 8 0 0 0 50 42" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            <text x="60" y="40" font-family="Cambria Math" font-size="14" fill="currentColor" text-anchor="middle">θ</text>
                        </svg>
                        <p class="text-center text-sm mb-2">$A = (\frac{θ}{360})\times \pi r^2$ (زاویه بر حسب درجه)</p>
                        <input type="number" id="area-sector-r" dir="ltr" class="p-2 border focus:outline-none bg-white text-center rounded-lg w-full mb-2" placeholder="شعاع (r)">
                        <input type="number" id="area-sector-angle" dir="ltr" class="p-2 border focus:outline-none bg-white text-center rounded-lg w-full mb-2" placeholder="زاویه (درجه)">
                        <button onclick="calculateArea('sector')" class="p-3 btn-3d btn-green w-full">محاسبه</button>
                        <p id="area-sector-result" class="mt-4 font-bold text-center"></p>
                    </div>
                    
                    <div id="area-tool-ellipse" class="area-tool-page hidden">
                        <h3 class="text-xl font-bold mb-2 text-center">مساحت بیضی</h3>
                        <svg class="w-32 h-32 mb-2 text-green-700 mx-auto" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <ellipse cx="50" cy="50" rx="38" ry="24" stroke="currentColor" stroke-width="3" fill="none"/>
                            <line x1="50" y1="50" x2="88" y2="50" stroke="currentColor" stroke-width="2" stroke-dasharray="2,2"/>
                            <text x="70" y="45" font-family="Cambria Math" font-size="12" fill="currentColor" text-anchor="middle">a</text>
                            <line x1="50" y1="50" x2="50" y2="26" stroke="currentColor" stroke-width="2" stroke-dasharray="2,2"/>
                            <text x="60" y="38" font-family="Cambria Math" font-size="12" fill="currentColor" text-anchor="start">b</text>
                        </svg>
                        <p class="text-center text-lg mb-2">مساحت بیضی: حاصل‌ضرب دو نیم‌محور در عدد پی</p>
                        <p class="text-center text-lg mb-2">$A = \pi a b$</p>
                        <input type="number" id="area-ellipse-a" dir="ltr" class="p-2 border focus:outline-none bg-white text-center rounded-lg w-full mb-2" placeholder="نیم‌محور بزرگ (a)">
                        <input type="number" id="area-ellipse-b" dir="ltr" class="p-2 border focus:outline-none bg-white text-center rounded-lg w-full mb-2" placeholder="نیم‌محور کوچک (b)">
                        <button onclick="calculateArea('ellipse')" class="p-3 btn-3d btn-green w-full">محاسبه</button>
                        <p id="area-ellipse-result" class="mt-4 font-bold text-center"></p>
                    </div>
                </div>

                 <!-- Shape Volume -->
                <div id="shape-volume" class="math-tool hidden bg-white p-4 rounded-lg shadow">
                    <div id="volume-shape-selection" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <!-- Cube -->
                        <button class="flex flex-col items-center p-4 btn-3d btn-gray" onclick="showVolumeShape('volume-tool-cube')">
                            <svg class="w-20 h-20 mb-2 text-green-700" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M20 30 L 60 30 L 60 70 L 20 70 Z" stroke="currentColor" stroke-width="4" fill="rgba(0,0,0,0.05)"/>
                                <path d="M60 30 L 80 10 L 80 50 L 60 70" stroke="currentColor" stroke-width="4" fill="rgba(0,0,0,0.05)"/>
                                <path d="M20 30 L 40 10 L 80 10" stroke="currentColor" stroke-width="4"/>
                                <path d="M20 70 L 40 50 L 80 50" stroke="currentColor" stroke-width="2" stroke-dasharray="4 4"/>
                                <path d="M40 10 L 40 50" stroke="currentColor" stroke-width="2" stroke-dasharray="4 4"/>
                            </svg>
                            <span class="font-bold">مکعب</span>
                        </button>
                        <!-- Sphere -->
                        <button class="flex flex-col items-center p-4 btn-3d btn-gray" onclick="showVolumeShape('volume-tool-sphere')">
                             <svg class="w-20 h-20 mb-2 text-green-700" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="50" cy="50" r="40" stroke="currentColor" stroke-width="4" fill="rgba(0,0,0,0.05)"/>
                                <ellipse cx="50" cy="50" rx="40" ry="15" stroke="currentColor" stroke-width="2" stroke-dasharray="4 4"/>
                                <line x1="50" y1="50" x2="90" y2="50" stroke="currentColor" stroke-width="2"/>
                                <text x="70" y="45" font-family="Cambria Math" font-size="20" fill="currentColor" text-anchor="middle">r</text>
                            </svg>
                            <span class="font-bold">کره</span>
                        </button>
                    	<!-- Cylinder -->
                    	<button class="flex flex-col items-center p-4 btn-3d btn-gray" onclick="showVolumeShape('volume-tool-cylinder')">
                            <svg class="w-20 h-20 mb-2 text-green-700" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <ellipse cx="50" cy="25" rx="40" ry="15" stroke="currentColor" stroke-width="4" fill="rgba(0,0,0,0.05)"/>
                                <line x1="10" y1="25" x2="10" y2="75" stroke="currentColor" stroke-width="4"/>
                                <line x1="90" y1="25" x2="90" y2="75" stroke="currentColor" stroke-width="4"/>
                                <path d="M10 75 A 40 15 0 0 0 90 75" stroke="currentColor" stroke-width="4" fill="rgba(0,0,0,0.05)"/>
                                <line x1="50" y1="25" x2="50" y2="75" stroke="currentColor" stroke-width="2" stroke-dasharray="4 4"/>
                                <text x="50" y="55" font-family="Cambria Math" font-size="20" fill="currentColor" text-anchor="middle">h</text>
                                <line x1="50" y1="25" x2="90" y2="25" stroke="currentColor" stroke-width="2" stroke-dasharray="4 4"/>
                                <text x="70" y="20" font-family="Cambria Math" font-size="20" fill="currentColor" text-anchor="middle">r</text>
                            </svg>
                            <span class="font-bold">استوانه</span>
                    	</button>
                        <button class="flex flex-col items-center p-4 btn-3d btn-gray" onclick="showVolumeShape('volume-tool-rectprism')">
                            <svg class="w-20 h-20 mb-2 text-green-700" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect x="20" y="30" width="60" height="50" stroke="currentColor" stroke-width="2" fill="rgba(0,0,0,0.05)"/>
                                <rect x="30" y="40" width="60" height="50" stroke="currentColor" stroke-width="4" fill="none"/>
                                <line x1="20" y1="30" x2="30" y2="40" stroke="currentColor" stroke-width="2"/>
                                <line x1="80" y1="30" x2="90" y2="40" stroke="currentColor" stroke-width="2"/>
                                <line x1="80" y1="80" x2="90" y2="90" stroke="currentColor" stroke-width="2"/>
                                <line x1="20" y1="80" x2="30" y2="90" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            <span class="font-bold">مکعب‌مستطیل</span>
                        </button>
                        <button class="flex flex-col items-center p-4 btn-3d btn-gray" onclick="showVolumeShape('volume-tool-parallelepiped')">
                            <svg class="w-20 h-20 mb-2 text-green-700" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <polygon points="10,20 70,20 80,50 20,50" stroke="currentColor" stroke-width="2" fill="rgba(0,0,0,0.05)"/>
                                <polygon points="30,50 90,50 100,80 40,80" stroke="currentColor" stroke-width="4" fill="none"/>
                                <line x1="30" y1="50" x2="10" y2="20" stroke="currentColor" stroke-width="2"/>
                                <line x1="90" y1="50" x2="70" y2="20" stroke="currentColor" stroke-width="2"/>
                                <line x1="100" y1="80" x2="80" y2="50" stroke="currentColor" stroke-width="2"/>
                                <line x1="40" y1="80" x2="20" y2="50" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            <span class="font-bold">منشور متوازی‌الاضلاع</span>
                        </button>
                        <button class="flex flex-col items-center p-4 btn-3d btn-gray" onclick="showVolumeShape('volume-tool-capsule')">
                            <svg class="w-20 h-20 mb-2 text-green-700" viewBox="0 0 100 100"><rect x="30" y="20" width="40" height="60" rx="20" stroke="currentColor" stroke-width="3" fill="rgba(0,0,0,0.03)"/></svg>
                            <span class="font-bold">کپسول</span>
                        </button>
                        <button class="flex flex-col items-center p-4 btn-3d btn-gray" onclick="showVolumeShape('volume-tool-pyramid')">
                            <svg class="w-20 h-20 mb-2 text-green-700" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <polygon points="20,80 80,80 90,65 30,65" stroke="currentColor" stroke-width="4" fill="rgba(0,0,0,0.05)"/>
                                <circle cx="50" cy="20" r="2" fill="currentColor" stroke-width="2"/>
                                <line x1="50" y1="20" x2="20" y2="80" stroke="currentColor" stroke-width="2"/>
                                <line x1="50" y1="20" x2="80" y2="80" stroke="currentColor" stroke-width="2"/>    
                                <line x1="50" y1="20" x2="90" y2="65" stroke="currentColor" stroke-width="2"/>
                                <line x1="50" y1="20" x2="30" y2="65" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            <span class="font-bold">هرم</span>
                        </button>
                        <button class="flex flex-col items-center p-4 btn-3d btn-gray" onclick="showVolumeShape('volume-tool-cone')">
                            <svg class="w-20 h-20 mb-2 text-green-700" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="50" cy="20" r="2" fill="currentColor"/>
                                <ellipse cx="50" cy="80" rx="30" ry="10" stroke="currentColor" stroke-width="4" fill="rgba(0,0,0,0.05)"/>
                                <line x1="50" y1="20" x2="20" y2="80" stroke="currentColor" stroke-width="4"/>
                                <line x1="50" y1="20" x2="80" y2="80" stroke="currentColor" stroke-width="4"/>
                            </svg>
                            <span class="font-bold">مخروط</span>
                        </button>
                        <button class="flex flex-col items-center p-4 btn-3d btn-gray" onclick="showVolumeShape('volume-tool-frustum')">
                            <svg class="w-20 h-20 mb-2 text-green-700" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <ellipse cx="50" cy="30" rx="15" ry="5" stroke="currentColor" stroke-width="4" fill="rgba(0,0,0,0.05)"/>
                                <ellipse cx="50" cy="80" rx="30" ry="10" stroke="currentColor" stroke-width="4" fill="none"/>
                                <line x1="35" y1="30" x2="20" y2="80" stroke="currentColor" stroke-width="4"/>
                                <line x1="65" y1="30" x2="80" y2="80" stroke="currentColor" stroke-width="4"/>
                            </svg>
                            <span class="font-bold">مخروط ناقص</span>
                        </button>
                        <button class="flex flex-col items-center p-4 btn-3d btn-gray" onclick="showVolumeShape('volume-tool-hexprism')">
                            <svg class="w-20 h-20 mb-2 text-green-700" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <polygon points="50,80 75,70 75,40 50,30 25,40 25,70" stroke="currentColor" stroke-width="2" fill="rgba(0,0,0,0.05)"/>
                                <polygon points="50,60 75,50 75,20 50,10 25,20 25,50" stroke="currentColor" stroke-width="4" fill="none"/>
                                <line x1="50" y1="80" x2="50" y2="60" stroke="currentColor" stroke-width="2"/>
                                <line x1="75" y1="70" x2="75" y2="50" stroke="currentColor" stroke-width="2"/>
                                <line x1="25" y1="70" x2="25" y2="50" stroke="currentColor" stroke-width="2"/>
                                <line x1="75" y1="40" x2="75" y2="20" stroke="currentColor" stroke-width="2" stroke-dasharray="3 3"/>
                                <line x1="50" y1="30" x2="50" y2="10" stroke="currentColor" stroke-width="2" stroke-dasharray="3 3"/>
                                <line x1="25" y1="40" x2="25" y2="20" stroke="currentColor" stroke-width="2" stroke-dasharray="3 3"/>
                            </svg>
                            <span class="font-bold">منشور شش‌ضلعی</span>
                        </button>
                    </div>
                    
                    <!-- Volume Sub-Pages -->
                    <div id="volume-tool-cube" class="volume-tool-page hidden">
                        <h3 class="text-xl font-bold mb-2 text-center">حجم مکعب</h3>
                        <svg class="w-32 h-32 mb-4 text-green-700 mx-auto" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M20 30 L 60 30 L 60 70 L 20 70 Z" stroke="currentColor" stroke-width="4" fill="rgba(0,0,0,0.05)"/>
                            <path d="M60 30 L 80 10 L 80 50 L 60 70" stroke="currentColor" stroke-width="4" fill="rgba(0,0,0,0.05)"/>
                            <path d="M20 30 L 40 10 L 80 10" stroke="currentColor" stroke-width="4"/>
                            <path d="M20 70 L 40 50 L 80 50" stroke="currentColor" stroke-width="2" stroke-dasharray="4 4"/>
                            <path d="M40 10 L 40 50" stroke="currentColor" stroke-width="2" stroke-dasharray="4 4"/>
                            <text x="10" y="50" font-family="Cambria Math" font-size="20" fill="currentColor">a</text>
                        </svg>
                        <p class="text-center text-lg mb-4">حجم مکعب: ضلع به توان سه</p>
                        <p class="text-center text-lg mb-4">$V = a^3$</p>
                        <input type="number" id="volume-cube-side" dir="ltr" class="p-2 focus:outline-none border rounded-lg text-center bg-white w-full mb-2" placeholder="ضلع (a)">
                        <button onclick="calculateVolume('cube')" class="p-3 btn-3d btn-green w-full">محاسبه</button>
                        <p id="volume-cube-result" class="mt-4 font-bold"></p>
                    </div>
                    
                    <div id="volume-tool-sphere" class="volume-tool-page hidden">
                         <h3 class="text-xl font-bold mb-2 text-center">حجم کره</h3>
                         <svg class="w-32 h-32 mb-4 text-green-700 mx-auto" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="50" cy="50" r="40" stroke="currentColor" stroke-width="4" fill="rgba(0,0,0,0.05)"/>
                            <ellipse cx="50" cy="50" rx="40" ry="15" stroke="currentColor" stroke-width="2" stroke-dasharray="4 4"/>
                            <line x1="50" y1="50" x2="90" y2="50" stroke="currentColor" stroke-width="2"/>
                            <text x="70" y="45" font-family="Cambria Math" font-size="20" fill="currentColor" text-anchor="middle">r</text>
                        </svg>
                        <p class="text-center text-lg mb-4">حجم کره: چهار سوم حاصل‌ضرب عدد پی در شعاع به توان سه</p>
                        <p class="text-center text-lg mb-4">$V = \frac{4}{3} \pi r^3$</p>
                        <input type="number" id="volume-sphere-radius" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full mb-2" placeholder="شعاع (r)">
                        <button onclick="calculateVolume('sphere')" class="p-3 btn-3d btn-green w-full">محاسبه</button>
                        <p id="volume-sphere-result" class="mt-4 font-bold"></p>
                    </div>

                    <!-- Cylinder Volume -->
                    <div id="volume-tool-cylinder" class="volume-tool-page hidden">
                         <h3 class="text-xl font-bold mb-2 text-center text-gray-600">حجم استوانه</h3>
                        <svg class="w-32 h-32 mb-2 text-green-700 mx-auto" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <ellipse cx="50" cy="25" rx="40" ry="15" stroke="currentColor" stroke-width="4" fill="rgba(0,0,0,0.05)"/>
                            <line x1="10" y1="25" x2="10" y2="75" stroke="currentColor" stroke-width="4"/>
                            <line x1="90" y1="25" x2="90" y2="75" stroke="currentColor" stroke-width="4"/>
                            <path d="M10 75 A 40 15 0 0 0 90 75" stroke="currentColor" stroke-width="4" fill="rgba(0,0,0,0.05)"/>
                            <line x1="50" y1="25" x2="50" y2="75" stroke="currentColor" stroke-width="2" stroke-dasharray="4 4"/>
                            <text x="40" y="60" font-family="Cambria Math" font-size="20" fill="currentColor" text-anchor="middle">h</text>
                            <line x1="50" y1="25" x2="90" y2="25" stroke="currentColor" stroke-width="2" stroke-dasharray="4 4"/>
                            <text x="70" y="20" font-family="Cambria Math" font-size="20" fill="currentColor" text-anchor="middle">r</text>
                        </svg>
                         <p class="text-center text-lg mb-4">حجم استوانه: حاصل‌ضرب مساحت قاعده (دایره) در ارتفاع</p>
                         <p class="text-center text-xl mb-4">$V = \pi r^2 h$</p>
                         <input type="number" id="volume-cylinder-radius" dir="ltr" class="p-2 focus:outline-none border bg-white text-center rounded-lg w-full mb-2" placeholder="شعاع (r)">
                         <input type="number" id="volume-cylinder-height" dir="ltr" class="p-2 focus:outline-none border bg-white text-center rounded-lg w-full mb-2" placeholder="ارتفاع (h)">
                         <button onclick="calculateVolume('cylinder')" class="p-3 btn-3d btn-green w-full">محاسبه</button>
                         <p id="volume-cylinder-result" class="mt-4 font-bold text-center"></p>
                    </div>
                    <div id="volume-tool-rectprism" class="volume-tool-page hidden">
                        <h3 class="text-xl font-bold mb-2 text-center">حجم مکعب‌مستطیل</h3>
                        <svg class="w-32 h-32 mb-2 text-green-700 mx-auto" viewBox="0 0 110 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="20" y="30" width="60" height="50" stroke="currentColor" stroke-width="2" fill="rgba(0,0,0,0.05)"/>
                            <rect x="30" y="40" width="60" height="50" stroke="currentColor" stroke-width="4" fill="none"/>
                            <line x1="20" y1="30" x2="30" y2="40" stroke="currentColor" stroke-width="2"/>
                            <line x1="80" y1="30" x2="90" y2="40" stroke="currentColor" stroke-width="2"/>
                            <line x1="80" y1="80" x2="90" y2="90" stroke="currentColor" stroke-width="2"/>
                            <line x1="20" y1="80" x2="30" y2="90" stroke="currentColor" stroke-width="2"/>
                            <text x="60" y="102" font-family="Cambria Math" font-size="12" fill="currentColor" text-anchor="middle">ℓ</text>
                            <text x="95" y="65" font-family="Cambria Math" font-size="12" fill="currentColor" text-anchor="end">h</text>
                            <text x="22" y="92" font-family="Cambria Math" font-size="12" fill="currentColor" text-anchor="start">w</text>
                        </svg>
                        <p class="text-center text-lg mb-4">حجم مکعب‌مستطیل: حاصل‌ضرب طول در عرض در ارتفاع</p>
                        <p class="text-center text-lg mb-4">$V = \ell \times w \times h$</p>
                        <input type="number" id="volume-rect-l" dir="ltr" class="p-2 border focus:outline-none bg-white text-center rounded-lg w-full mb-2" placeholder="طول (ℓ)">
                        <input type="number" id="volume-rect-w" dir="ltr" class="p-2 border focus:outline-none bg-white text-center rounded-lg w-full mb-2" placeholder="عرض (w)">
                        <input type="number" id="volume-rect-h" dir="ltr" class="p-2 border focus:outline-none bg-white text-center rounded-lg w-full mb-2" placeholder="ارتفاع (h)">
                        <button onclick="calculateVolume('rectprism')" class="p-3 btn-3d btn-green w-full">محاسبه</button>
                        <p id="volume-rect-result" class="mt-4 font-bold text-center"></p>
                    </div>
                    
                    <div id="volume-tool-parallelepiped" class="volume-tool-page hidden">
                        <h3 class="text-xl font-bold mb-2 text-center">حجم منشور متوازی‌الاضلاع</h3>
                        <button class="items-center text-center w-full" onclick="showMathTool('shape-area', 'مساحت اشکال')"><svg class="w-40 h-40 mb-2 text-green-700 mx-auto" viewBox="0 0 110 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <polygon points="10,20 70,20 80,50 20,50" stroke="currentColor" stroke-width="2" fill="rgba(0,0,0,0.05)"/>
                            <polygon points="30,50 90,50 100,80 40,80" stroke="currentColor" stroke-width="4" fill="none"/>
                            <line x1="30" y1="50" x2="10" y2="20" stroke="currentColor" stroke-width="2"/>
                            <line x1="90" y1="50" x2="70" y2="20" stroke="currentColor" stroke-width="2"/>
                            <line x1="100" y1="80" x2="80" y2="50" stroke="currentColor" stroke-width="2"/>
                            <line x1="40" y1="80" x2="20" y2="50" stroke="currentColor" stroke-width="2"/>
                            <text x="65" y="90" font-family="Cambria Math, Arial" font-size="12" fill="currentColor" text-anchor="middle">a</text>
                            <text x="102" y="65" font-family="Cambria Math, Arial" font-size="12" fill="currentColor" text-anchor="middle">b</text>
                            <line x1="90" y1="80" x2="90" y2="50" stroke="red" stroke-width="1.5" stroke-dasharray="4 2"/>
                            <text x="75" y="65" font-family="Cambria Math, Arial" font-size="12" fill="red" text-anchor="end">h₂</text>
                            <rect x="85" y="75" width="5" height="5" fill="none" stroke="red" stroke-width="1"/>
                            <line x1="90" y1="50" x2="70" y2="20" stroke="blue" stroke-width="3" stroke-dasharray="3 3"/>
                            <text x="88" y="35" font-family="Cambria Math, Arial" font-size="12" fill="blue" text-anchor="end">h</text>
                        </svg></button>
                        <p class="text-center text-lg mb-4">حجم منشور متوازی‌الاضلاع = (طول قاعده $×$ ارتفاع قاعده) $×$ ارتفاع منشور</p>
                        <p class="text-center text-lg mb-4">$V = A\times h = (a\times h_2)\times h = (ab\sin\theta)h$</p>
                        <input type="number" id="volume-par-basearea" dir="ltr" class="p-2 border focus:outline-none bg-white text-center rounded-lg w-full mb-2" placeholder="مساحت قاعده (مثلاً a×h)">
                        <input type="number" id="volume-par-height" dir="ltr" class="p-2 border focus:outline-none bg-white text-center rounded-lg w-full mb-2" placeholder="ارتفاع (h)">
                        <button onclick="calculateVolume('parallelepiped')" class="p-3 btn-3d btn-green w-full">محاسبه</button>
                        <p id="volume-parallelepiped-result" class="mt-4 font-bold text-center"></p>
                    </div>
                    
                    <div id="volume-tool-capsule" class="volume-tool-page hidden">
                        <h3 class="text-xl font-bold mb-2 text-center">حجم کپسول</h3>
                        <svg class="w-40 h-28 mb-2 text-green-700 mx-auto" viewBox="0 0 140 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="10" y="10" width="120" height="40" rx="20" ry="20" stroke="currentColor" stroke-width="3" fill="rgba(0,0,0,0.05)"/>
                            <line x1="112" y1="30" x2="130" y2="30" stroke="red" stroke-width="1.5" stroke-dasharray="3 3"/>
                            <line x1="28" y1="50" x2="112" y2="50" stroke="blue" stroke-width="2" stroke-dasharray="3 3"/>
                            <text x="120" y="25" font-family="Cambria Math, Arial" font-size="14" fill="red" text-anchor="middle">r</text>
                            <text x="70" y="63" font-family="Cambria Math, Arial" font-size="14" fill="blue" text-anchor="middle">h</text>
                        </svg>
                        <p class="text-center text-lg mb-2">حجم کپسول: مجموع حجم دو نیمکره و استوانۀ میانی</p>
                        <p class="text-center text-lg mb-2">$V = \pi r^2 h + \frac{4}{3} \pi r^3$</p>
                        <input type="number" id="volume-capsule-r" dir="ltr" class="p-2 border focus:outline-none bg-white text-center rounded-lg w-full mb-2" placeholder="شعاع (r)">
                        <input type="number" id="volume-capsule-h" dir="ltr" class="p-2 border focus:outline-none bg-white text-center rounded-lg w-full mb-2" placeholder="طول استوانه میانی (h)">
                        <button onclick="calculateVolume('capsule')" class="p-3 btn-3d btn-green w-full">محاسبه</button>
                        <p id="volume-capsule-result" class="mt-4 font-bold text-center"></p>
                    </div>
                    
                    <div id="volume-tool-pyramid" class="volume-tool-page hidden">
                        <h3 class="text-xl font-bold mb-2 text-center">حجم هرم</h3>
                        <button class="items-center text-center w-full" onclick="showMathTool('shape-area', 'مساحت اشکال')"><svg class="w-36 h-36 mb-2 text-green-700 mx-auto" viewBox="0 0 100 95" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <polygon points="20,80 80,80 90,65 30,65" stroke="currentColor" stroke-width="4" fill="rgb(191 0 0 / 15%)"/>
                            <circle cx="50" cy="20" r="2" fill="currentColor" stroke-width="2"/>
                            <line x1="50" y1="20" x2="20" y2="80" stroke="currentColor" stroke-width="2"/>
                            <line x1="50" y1="20" x2="80" y2="80" stroke="currentColor" stroke-width="2"/>    
                            <line x1="50" y1="20" x2="90" y2="65" stroke="currentColor" stroke-width="2" stroke-dasharray="6 1"/>
                            <line x1="50" y1="20" x2="30" y2="65" stroke="currentColor" stroke-width="2" stroke-dasharray="6 1"/>
                            <line x1="50" y1="20" x2="50" y2="72.5" stroke="blue" stroke-width="2" stroke-dasharray="4 2"/>
                            <rect x="50" y="67.5" width="5" height="5" fill="none" stroke="blue" stroke-width="1"/>
                            <text x="60" y="48" font-family="Cambria Math, Arial" font-size="14" fill="blue" text-anchor="start">h</text>
                            <text x="50" y="93" font-family="Cambria Math, Arial" font-size="14" fill="red" text-anchor="middle" font-weight="bold">A</text>
                        </svg></button>
                        <p class="text-center text-lg mb-4">حجم هرم: ثلث حاصل‌ضرب مساحت قاعده در ارتفاع</p>
                        <p class="text-center text-lg mb-4">$V = \frac{1}{3} A h$</p>
                        <input type="number" id="volume-pyramid-basearea" dir="ltr" class="p-2 border focus:outline-none bg-white text-center rounded-lg w-full mb-2" placeholder="مساحت قاعده (A)">
                        <input type="number" id="volume-pyramid-h" dir="ltr" class="p-2 border focus:outline-none bg-white text-center rounded-lg w-full mb-2" placeholder="ارتفاع (h)">
                        <button onclick="calculateVolume('pyramid')" class="p-3 btn-3d btn-green w-full">محاسبه</button>
                        <p id="volume-pyramid-result" class="mt-4 font-bold text-center"></p>
                    </div>
                    
                    <div id="volume-tool-cone" class="volume-tool-page hidden">
                        <h3 class="text-xl font-bold mb-2 text-center">حجم مخروط</h3>
                        <svg class="w-32 h-32 mb-2 text-green-700 mx-auto" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="50" cy="20" r="2" fill="currentColor"/>
                            <ellipse cx="50" cy="80" rx="30" ry="10" stroke="currentColor" stroke-width="4" fill="rgba(0,0,0,0.05)"/>
                            <line x1="50" y1="20" x2="20" y2="80" stroke="currentColor" stroke-width="4"/>
                            <line x1="50" y1="20" x2="80" y2="80" stroke="currentColor" stroke-width="4"/>
                            <line x1="50" y1="20" x2="50" y2="80" stroke="blue" stroke-width="2" stroke-dasharray="5 3"/>
                            <text x="55" y="55" font-family="Cambria Math, Arial" font-size="14" fill="blue" text-anchor="middle">h</text>
                            <line x1="50" y1="80" x2="80" y2="80" stroke="red" stroke-width="2" stroke-dasharray="3 3"/>
                            <text x="65" y="75" font-family="Cambria Math, Arial" font-size="14" fill="red" text-anchor="middle">r</text>
                        </svg>
                        <p class="text-center text-lg mb-4">حجم مخروط: ثلث حاصل‌ضرب مساحت قاعده (دایره) در ارتفاع مخروط</p>
                        <p class="text-center text-lg mb-4">$V = \frac{1}{3}\pi r^{2} h$</p>
                        <input type="number" id="volume-cone-r" dir="ltr" class="p-2 border focus:outline-none bg-white text-center rounded-lg w-full mb-2" placeholder="شعاع (r)">
                        <input type="number" id="volume-cone-h" dir="ltr" class="p-2 border focus:outline-none bg-white text-center rounded-lg w-full mb-2" placeholder="ارتفاع (h)">
                        <button onclick="calculateVolume('cone')" class="p-3 btn-3d btn-green w-full">محاسبه</button>
                        <p id="volume-cone-result" class="mt-4 font-bold text-center"></p>
                    </div>
                    
                    <div id="volume-tool-frustum" class="volume-tool-page hidden">
                        <h3 class="text-xl font-bold mb-2 text-center">حجم مخروط ناقص</h3>
                        <svg class="w-32 h-32 mb-2 text-green-700 mx-auto" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <line x1="50" y1="30" x2="50" y2="80" stroke="blue" stroke-width="2" stroke-dasharray="5 3"/>
                            <text x="55" y="55" font-family="Cambria Math, Arial" font-size="14" fill="blue" text-anchor="middle">h</text>
                            <line x1="50" y1="30" x2="65" y2="30" stroke="red" stroke-width="2" stroke-dasharray="3 3"/>
                            <line x1="50" y1="80" x2="80" y2="80" stroke="red" stroke-width="2" stroke-dasharray="3 3"/>
                            <ellipse cx="50" cy="30" rx="15" ry="5" stroke="currentColor" stroke-width="4" fill="rgba(0,0,0,0.05)"/>
                            <ellipse cx="50" cy="80" rx="30" ry="10" stroke="currentColor" stroke-width="4" fill="none"/>
                            <line x1="35" y1="30" x2="20" y2="80" stroke="currentColor" stroke-width="4"/>
                            <line x1="65" y1="30" x2="80" y2="80" stroke="currentColor" stroke-width="4"/>
                            <text x="65" y="75" font-family="Cambria Math, Arial" font-size="14" fill="red" text-anchor="middle">R</text>
                            <text x="57" y="25" font-family="Cambria Math, Arial" font-size="14" fill="red" text-anchor="start">r</text>
                        </svg>
                        <p class="text-center text-lg mb-2">تفاضل حجم مخروط بزرگ اولیه و مخروط کوچک بریده شده</p>
                        <p class="text-center text-lg mb-2">$V = \frac{1}{3}\pi h (R^2 + R r + r^2)$</p>
                        <input type="number" id="volume-frustum-R" dir="ltr" class="p-2 border focus:outline-none bg-white text-center rounded-lg w-full mb-2" placeholder="شعاع بزرگ (R)">
                        <input type="number" id="volume-frustum-r" dir="ltr" class="p-2 border focus:outline-none bg-white text-center rounded-lg w-full mb-2" placeholder="شعاع کوچک (r)">
                        <input type="number" id="volume-frustum-h" dir="ltr" class="p-2 border focus:outline-none bg-white text-center rounded-lg w-full mb-2" placeholder="ارتفاع (h)">
                        <button onclick="calculateVolume('frustum')" class="p-3 btn-3d btn-green w-full">محاسبه</button>
                        <p id="volume-frustum-result" class="mt-4 font-bold text-center"></p>
                    </div>
                    
                    <div id="volume-tool-hexprism" class="volume-tool-page hidden">
                        <h3 class="text-xl font-bold mb-2 text-center">حجم منشور شش‌ضلعی منتظم</h3>
                        <svg class="w-24 h-40 mb-2 text-green-700 mx-auto" viewBox="0 0 100 82" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <polygon points="50,90 75,80 75,50 50,40 25,50 25,80" stroke="currentColor" stroke-width="2" fill="rgba(0,0,0,0.05)"/>
                            <polygon points="50,10 75,0 75,-30 50,-40 25,-30 25,0" stroke="currentColor" stroke-width="4" fill="none"/>
                            <line x1="50" y1="90" x2="50" y2="10" stroke="currentColor" stroke-width="2"/>
                            <line x1="75" y1="80" x2="75" y2="0" stroke="currentColor" stroke-width="2"/>
                            <line x1="25" y1="80" x2="25" y2="0" stroke="currentColor" stroke-width="2"/>
                            <line x1="75" y1="50" x2="75" y2="-30" stroke="currentColor" stroke-width="2" stroke-dasharray="3 3"/>
                            <line x1="50" y1="40" x2="50" y2="-40" stroke="currentColor" stroke-width="2" stroke-dasharray="3 3"/>
                            <line x1="25" y1="50" x2="25" y2="-30" stroke="currentColor" stroke-width="2" stroke-dasharray="3 3"/>
                            <line x1="25" y1="80" x2="25" y2="0" stroke="blue" stroke-width="2" stroke-dasharray="3 3"/>
                            <rect x="25" y="75" width="5" height="5" fill="none" stroke="blue" stroke-width="1"/>
                            <text x="15" y="40" font-family="Cambria Math, Arial" font-size="16" fill="blue" text-anchor="end">h</text>
                            <line x1="50" y1="90" x2="75" y2="80" stroke="red" stroke-width="2" stroke-dasharray="6 2"/>
                            <text x="66" y="95" font-family="Cambria Math, Arial" font-size="16" fill="red" text-anchor="middle">a</text>
                        </svg>
                        <p class="text-center mb-2">حجم منشور شش‌ضلعی منتظم: حاصل‌ضرب مساحت قاعده (شش‌ضلعی منتظم) در ارتفاع منشور</p>
                        <p class="text-center text-lg mb-2">$V = \frac{3\sqrt{3}}{2} a^2 \times h$</p>
                        <input type="number" id="volume-hex-a" dir="ltr" class="p-2 border focus:outline-none bg-white text-center rounded-lg w-full mb-2" placeholder="طول ضلع قاعده (a)">
                        <input type="number" id="volume-hex-h" dir="ltr" class="p-2 border focus:outline-none bg-white text-center rounded-lg w-full mb-2" placeholder="ارتفاع (h)">
                        <button onclick="calculateVolume('hexprism')" class="p-3 btn-3d btn-green w-full">محاسبه</button>
                        <p id="volume-hex-result" class="mt-4 font-bold text-center"></p>
                    </div>
                </div>

                <!-- Function Plotter -->
                <div id="math-tool-plot" class="math-tool hidden bg-white p-4 rounded-lg shadow">
                    <div class="border-b border-gray-200">
                        <nav class="flex-nowrap overflow-x-auto flex -mb-px" id="plot-tabs">
                            <button class="plot-tab-btn whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm text-green-600 border-green-600" data-target="plot-simple">توابع ساده</button>
                            <button class="plot-tab-btn whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300 transition duration-200" data-target="plot-piecewise">توابع چندضابطه‌ای</button>
                            <button class="plot-tab-btn whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300 transition duration-200" data-target="plot-comparison">مقایسه توابع</button>
                        </nav>
                    </div>

                    <div id="plot-simple" class="plot-tab-content mt-4 space-y-2">
                        <p class="mb-2 justify">ضابطه تابع را وارد کنید (مثلا به جای $x^2 + \sin(x)$ وارد کنید <code>x*x+sin(x)</code>).</p>
                        <div class="flex items-center gap-2">
                            <input type="text" id="math-plot-input" oninput="updateSimpleLatex()" class="p-2 border focus:outline-none rounded-lg w-full bg-white text-left" dir="ltr" placeholder="ضابطۀ تابع: f(x) =">
                            <button onclick="showPlotterHelp()" class="p-2 focus:outline-none btn-3d help-button font-bold shrink-0" title="راهنما">!</button>
                        </div>
                        <p class="mt-2 mb-2">دامنۀ تابع:</p>
                        <div class="grid grid-cols-2 flex items-center gap-2">
                            <input type="number" inputmode="numeric" id="math-plot-xMin" class="plot-domain p-2 focus:outline-none border bg-white rounded-lg w-full text-center" dir="ltr" placeholder="حداقل x">
                            <input type="number" inputmode="numeric" id="math-plot-xMax" class="plot-domain p-2 focus:outline-none border bg-white rounded-lg w-full text-center" dir="ltr" placeholder="حداکثر x">
                        </div>
                        <button onclick="plotMathFunction()" class="mt-2 p-3 btn-3d btn-green w-full">رسم کن</button>
                        <div id="math-simple-latex" class="text-center my-4 p-3 border rounded-lg bg-gray-100 min-h-[50px] shadow-inner flex items-center justify-center relative">
                            <span class="text-gray-500">پیش‌نمایش فرمول تابع</span>
                        </div>
                        <div id="math-plot-target" class="mt-2 item-center w-full plot-height popIn"></div>
                    </div>

                    <div id="plot-piecewise" class="plot-tab-content mt-4 space-y-2 hidden">
                        <p class="mb-2">ضابطه‌های تابع چندضابطه‌ای را وارد کنید:</p>
                        <div id="piecewise-formulas-container" class="space-y-3">
                        	<div class="piecewise-formula flex items-center gap-2 border p-3 rounded-lg bg-gray-50">
                            		<span class="font-bold text-slate-900">اگر</span>
                            		<input type="text" class="piecewise-condition p-2 border focus:outline-none bg-white rounded-lg text-left w-1/3" dir="ltr" placeholder="شرط (مثلاً x<0)">
                            		<span class="font-bold text-slate-900">آنگاه</span>
                            		<input type="text" class="piecewise-function p-2 border focus:outline-none bg-white rounded-lg text-left w-2/3" dir="ltr" placeholder="ضابطه (مثلاً -x)">
                        	</div>
                        	<div class="piecewise-formula flex items-center gap-2 border p-3 rounded-lg bg-gray-50">
                            		<span class="font-bold text-slate-900">اگر</span>
                            		<input type="text" class="piecewise-condition p-2 border focus:outline-none rounded-lg bg-white text-left w-1/3" dir="ltr" placeholder="شرط (مثلاً x>=0)">
                            		<span class="font-bold text-slate-900">آنگاه</span>
                            		<input type="text" class="piecewise-function p-2 border focus:outline-none rounded-lg bg-white text-left w-2/3" dir="ltr" placeholder="ضابطه (مثلاً x)">
                        	</div>
                        </div>
                        <button onclick="addPiecewiseFormula()" class="p-2 btn-3d btn-blue w-full">+ افزودن ضابطه</button>
                        <p class="mt-4 mb-2">دامنۀ نهایی نمودار:</p>
                        <div class="grid grid-cols-2 flex items-center gap-2">
                        	<input type="number" inputmode="numeric" id="piecewise-xMin" class="plot-domain p-2 focus:outline-none border bg-white rounded-lg w-full text-center" dir="ltr" placeholder="حداقل x">
                        	<input type="number" inputmode="numeric" id="piecewise-xMax" class="plot-domain p-2 focus:outline-none border bg-white rounded-lg w-full text-center" dir="ltr" placeholder="حداکثر x">
                        </div>

                        <button onclick="plotPiecewiseFunction()" class="mt-2 p-3 btn-3d btn-green w-full">رسم کن</button>

                        <div id="math-piecewise-latex" class="text-center my-4 p-3 border rounded-lg bg-gray-100 min-h-[50px] shadow-inner">
                        	<span class="text-gray-500">پیش‌نمایش ضوابط تابع</span>
                        </div>

                        <div id="math-piecewise-target" class="mt-2 item-center w-full plot-height popIn"></div>
                    </div>

                    <div id="plot-comparison" class="plot-tab-content mt-4 space-y-2 hidden">
                        <p class="mb-2">ضابطه‌های چند تابع را برای رسم نمودار و مقایسۀ توابع وارد کنید.</p>
                        <div id="comparison-formulas-container" class="space-y-3">
                            	<div class="comparison-formula items-center">
                            		<input type="text" class="mt-2 comp-function p-2 border border-green-400 text-green-700 pr-3 focus:outline-none bg-plotformula rounded-lg text-left w-full" dir="ltr" placeholder="f(x)=">
                            		<input type="text" class="mt-2 comp-function p-2 border border-blue-400 text-blue-700 pr-3 focus:outline-none bg-plotformula rounded-lg text-left w-full" dir="ltr" placeholder="g(x)=">
                            	</div>

                        </div>
                        <button id="plotComparisonButton" onclick="addComparisonFormula()" class="p-2 btn-3d btn-blue w-full">+ افزودن تابع</button>
                        <p class="mt-4 mb-2">دامنۀ نهایی نمودار:</p>
                        <div class="grid grid-cols-2 flex items-center gap-2">
                            <input type="number" inputmode="numeric" id="comparison-xMin" class="plot-domain p-2 focus:outline-none border bg-white rounded-lg w-full text-center" dir="ltr" placeholder="حداقل x">
                            <input type="number" inputmode="numeric" id="comparison-xMax" class="plot-domain p-2 focus:outline-none border bg-white rounded-lg w-full text-center" dir="ltr" placeholder="حداکثر x">
                        </div>
                        <button onclick="plotComparisonFunctions()" class="mt-2 p-3 btn-3d btn-green w-full">رسم کن</button>
                        <div id="math-comparison-target" class="mt-2 item-center w-full plot-height popIn"></div>
                    </div>
                </div>
                
                <!-- Venn Diagram -->
                <div id="math-tool-venn" class="math-tool hidden bg-white p-4 rounded-lg shadow">
                    <p class="mb-2">عبارت مجموعه را وارد کنید (مثال: $(A \cup B) - (A \cap C)$).</p>
                    <p class="mb-2 text-sm text-gray-500">از $A, B, C$، $\cup$ (<code>\cup</code>، اجتماع)، $\cap$ (<code>\cap</code>، اشتراک)، $-$ (تفاضل) و $\Delta$ (<code>\Delta</code>، تفاضل متقارن) و مثلا برای متمم مجموعه A از <code>U-(A)</code> استفاده کنید.</p>
                    <div class="flex items-center gap-2">
                        <input type="text" id="venn-input" class="p-2 focus:outline-none border rounded-lg bg-white w-full text-left" dir="ltr" placeholder="A ∪ (U - B) ∩ C">
                        <button onclick="drawVennDiagram()" class="p-3 btn-3d btn-green shrink-0">رسم کن</button>
                    </div>
                    <div class="flex justify-center items-center mt-4 p-2 bg-slate-200 rounded-lg">
                        <canvas id="venn-canvas" class="items-center" width="520" height="300"></canvas>
                    </div>
                </div>

                <!-- Divisibility -->
                <div id="math-tool-divisibility" class="math-tool hidden bg-white p-4 rounded-lg shadow">
                    <p class="mb-2">بررسی کنید آیا عدد $A$ بر عدد $B$ بخش‌پذیر است یا خیر.</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input type="number" id="div-a" dir="ltr" class="p-2 focus:outline-none border bg-white text-center rounded-lg" placeholder="عدد A (مقسوم)">
                        <input type="number" id="div-b" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg" placeholder="عدد B (مقسوم علیه)">
                    </div>
                    <button onclick="checkDivisibility()" class="p-3 mt-4 w-full btn-3d btn-green">بررسی کن</button>
                    <p id="divisibility-result" class="mt-4 text-center text-2xl font-bold"></p>
                </div>
                
                <!-- Divisors -->
                <div id="math-tool-divisors" class="math-tool hidden bg-white p-4 rounded-lg shadow">
                    <p class="mb-2">عدد مورد نظر را برای تحلیل شمارنده‌ها وارد کنید.</p>
                    <input type="number" id="divisor-input" class="p-2 focus:outline-none border rounded-lg w-full bg-white text-center mb-2" dir="ltr" placeholder="عدد را وارد کنید (مثبت)">
                    <button onclick="analyzeDivisors()" class="p-3 btn-3d btn-green w-full">تحلیل کن</button>
                    <div id="divisor-results" class="mt-4 hidden overflow-x-auto">
                        <table class="w-full text-center border-collapse border border-gray-300 table-fixed">
                            <tbody class="align-center">
                                <tr class="bg-gray-50"><td class="border p-3 font-bold w-1/3">تجزیه به عوامل اول</td><td id="divisor-factorization" class="border p-3 text-center" dir="ltr"></td></tr>
                                <tr><td class="border p-3 font-bold">شمارنده‌ها</td><td id="divisor-list" class="border p-3" style="word-break: break-word;" dir="ltr"></td></tr>
                                <tr class="bg-gray-50"><td class="border p-3 font-bold">تعداد شمارنده‌ها</td><td id="divisor-count" class="border p-3" dir="ltr"></td></tr>
                                <tr><td class="border p-3 font-bold">شمارنده‌های اول</td><td id="divisor-prime-list" class="border p-3" style="word-break: break-word;" dir="ltr"></td></tr>
                                <tr class="bg-gray-50"><td class="border p-3 font-bold">تعداد شمارنده‌های اول</td><td id="divisor-prime-count" class="border p-3" dir="ltr"></td></tr>
                                <tr><td class="border p-3 font-bold">شمارنده‌های مرکب</td><td id="divisor-composite-list" class="border p-3" style="word-break: break-word;" dir="ltr"></td></tr>
                                <tr class="bg-gray-50"><td class="border p-3 font-bold">تعداد شمارنده‌های مرکب</td><td id="divisor-composite-count" class="border p-3" dir="ltr"></td></tr>
                                <tr><td class="border p-3 font-bold">تعداد شمارنده‌های زوج</td><td id="divisor-even-count" class="border p-3" dir="ltr"></td></tr>
                                <tr class="bg-gray-50"><td class="border p-3 font-bold">تعداد شمارنده‌های فرد</td><td id="divisor-odd-count" class="border p-3" dir="ltr"></td></tr>
                                <tr><td class="border p-3 font-bold">تعداد شمارنده‌های صحیح</td><td id="divisor-integer-count" class="border p-3" dir="ltr"></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Sequence Tools -->
                <div id="math-tool-sequences" class="math-tool hidden bg-white p-4 rounded-lg shadow">
                    <div class="border-b border-gray-200">
                        <nav class="flex-nowrap overflow-x-auto flex -mb-px" id="sequence-type-tabs">
                            <button class="seq-type-tab-btn whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm text-green-600 border-green-600" data-target="seq-arithmetic">دنباله حسابی</button>
                            <button class="seq-type-tab-btn whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300 transition duration-200" data-target="seq-geometric">دنباله هندسی</button>
                            <button class="seq-type-tab-btn whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300 transition duration-200" data-target="seq-triangular">دنباله مثلثی</button>
                            <button class="seq-type-tab-btn whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300 transition duration-200" data-target="seq-fibonacci">دنباله فیبوناچی</button>
                        </nav>
                    </div>
                    
                    <div class="mt-4">

                        <div id="seq-arithmetic" class="seq-type-content space-y-2">
                            <label for="arithmetic-operation" class="block font-bold mb-2">انتخاب عملیات:</label>
                            <div class="relative custom-select-container" data-sequence-type="arithmetic">
                                <button type="button" id="arithmetic-operation" data-operation=""
                                	class="custom-select-trigger w-full flex justify-between items-center border border-green-500 rounded-xl p-4 text-lg font-extrabold text-green-700 shadow-md hover:bg-emerald-100 transition duration-150 focus:outline-none focus:ring-4 focus:ring-green-500 focus:ring-opacity-50"
                                	onclick="toggleDropdown(this)">
                                	<span id="arithmetic-operation-label">عملیات مورد نظر را انتخاب کنید...</span>
                                	<svg id="arithmetic-chevron" class="w-6 h-6 text-emerald-800 transition-transform transform rotate-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M19 9l-7 7-7-7"></path></svg>
                                </button>
                                <div id="arithmetic-operation-options"
                                	class="custom-select-options absolute z-20 w-full mt-2 bg-white border border-gray-200 rounded-xl shadow-2xl max-h-60 overflow-y-auto hidden">
                                	<button type="button" class="select-option w-full text-right p-3 hover:bg-gray-100 transition duration-100" data-value="nth" onclick="selectSequenceOperation('arithmetic', 'nth', 'محاسبه جمله n-ام')">محاسبه جمله n-ام ($a_n$)</button>
                                	<button type="button" class="select-option w-full text-right p-3 hover:bg-gray-100 transition duration-100" data-value="sum_n" onclick="selectSequenceOperation('arithmetic', 'sum_n', 'محاسبه جمع n جمله اول')">محاسبه جمع n جمله اول ($S_n$ با $a_1, d$)</button>
                                	<button type="button" class="select-option w-full text-right p-3 hover:bg-gray-100 transition duration-100" data-value="sum_fl" onclick="selectSequenceOperation('arithmetic', 'sum_fl', 'محاسبه جمع با جمله اول و آخر')">محاسبه جمع با جمله اول و آخر ($S_n$ با $a_1, a_n$)</button>
                                </div>
                            </div>
                            <div id="arithmetic-fields-container" class="space-y-3 pt-3">
                                <p class="text-center text-gray-500">پس از انتخاب عملیات، فرمول و کادرهای ورودی نمایش داده می‌شود.</p>
			    </div>
                            <button onclick="calculateSequence('arithmetic')" class="p-3 btn-3d btn-green w-full">محاسبه</button>
                            <p id="arithmetic-result" class="mt-4 text-2xl text-center font-bold"></p>
                        </div>
                        

                        <div id="seq-geometric" class="seq-type-content hidden space-y-2">
                            <label for="geometric-operation" class="block font-bold mb-2">انتخاب عملیات:</label>
                            <div class="relative custom-select-container" data-sequence-type="geometric">
                                <button type="button" id="geometric-operation" data-operation=""
                                	class="custom-select-trigger w-full flex justify-between items-center border border-blue-500 rounded-xl p-4 text-lg font-extrabold text-blue-700 shadow-md hover:bg-blue-100 transition duration-150 focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50"
                                	onclick="toggleDropdown(this)">
                                	<span id="geometric-operation-label">عملیات مورد نظر را انتخاب کنید...</span>
                                	<svg id="geometric-chevron" class="w-6 h-6 text-blue-600 transition-transform transform rotate-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M19 9l-7 7-7-7"></path></svg>
                                </button>
                                <div id="geometric-operation-options"
                                	class="custom-select-options absolute z-20 w-full mt-2 bg-white border border-gray-200 rounded-xl shadow-2xl max-h-60 overflow-y-auto hidden">
                                	<button type="button" class="select-option w-full text-right p-3 hover:bg-gray-100 transition duration-100" data-value="nth" onclick="selectSequenceOperation('geometric', 'nth', 'محاسبه جمله n-ام')">محاسبه جمله n-ام ($a_n$)</button>
                                	<button type="button" class="select-option w-full text-right p-3 hover:bg-gray-100 transition duration-100" data-value="sum_n" onclick="selectSequenceOperation('geometric', 'sum_n', 'محاسبه جمع n جمله اول')">محاسبه جمع n جمله اول ($S_n$)</button>
                                	<button type="button" class="select-option w-full text-right p-3 hover:bg-gray-100 transition duration-100" data-value="sum_fl" onclick="selectSequenceOperation('geometric', 'sum_inf', 'محاسبه جمع نامتناهی')">محاسبه جمع نامتناهی ($S_\infty$)</button>
                                </div>
                            </div>
                            <div id="geometric-fields-container" class="space-y-3 pt-3">
                                <p class="text-center text-gray-500">پس از انتخاب عملیات، فرمول و کادرهای ورودی نمایش داده می‌شود.</p>
			    </div>
                            <button onclick="calculateSequence('geometric')" class="p-3 btn-3d btn-green w-full">محاسبه</button>
                            <p id="geometric-result" class="mt-4 text-2xl text-center font-bold"></p>
                        </div>
                        

                        <div id="seq-triangular" class="seq-type-content hidden space-y-2">
                            <p class="text-center font-bold pb-2">محاسبه عدد مثلثی n-ام ($T_n$)</p>
                            <p class="text-center text-xl font-semibold">$$T_n = \frac{n(n+1)}{2}$$</p>
                            <input type="number" id="triangular-n" dir="ltr" class="p-2 focus:outline-none border bg-white text-center rounded-lg w-full" placeholder="شماره جمله (n)">
                            <button onclick="calculateSequence('triangular')" class="p-3 btn-3d btn-green w-full">محاسبه</button>
                            <p id="triangular-result" class="mt-4 text-2xl text-center font-bold"></p>
                        </div>

                        <div id="seq-fibonacci" class="seq-type-content hidden space-y-2">
                            <p class="text-center font-bold pb-2">محاسبه جمله n-ام دنبالۀ فیبوناچی ($F_n$)</p>
                            <p class="text-center text-xl font-semibold">$$F_n = \frac{\phi^n - (-\phi)^{-n}}{\sqrt{5}}$$</p>
                            <input type="number" id="fibonacci-n" dir="ltr" class="p-2 focus:outline-none border bg-white text-center rounded-lg w-full" placeholder="شماره جمله (n)">
                            <button onclick="calculateSequence('fibonacci')" class="p-3 btn-3d btn-green w-full">محاسبه</button>
                            <p id="fibonacci-result" class="mt-4 text-2xl text-center font-bold"></p>
                        </div>
                    </div>
                </div>
                <div id="math-tool-gcd-lcm" class="math-tool hidden bg-white p-4 rounded-lg shadow">
                    <p class="mb-2 justify"><b>ب.م.م (بزرگ‌‌ترین مقسوم‌ٌعلیه مشترک):</b> بزرگترین عددی که هر دو عدد بر آن بخش‌پذیر باشند $(x,y,...)$.</p>
                    <p class="mb-4 justify"><b>ک.م.م (کوچک‌ترین مضرب مشترک):</b> کوچکترین عددی که بر هر دو عدد بخش‌پذیر باشد $[x,y,...]$.</p>
                    <p class="text-gray-500 text-center text-sm mb-2">اعداد را با "فاصله" یا "کاما" از هم جدا کنید (مثلاً: 12, 18, 30)</p>
                    <div class="mb-4">
                        <input type="text" id="gcd-lcm-input" dir="ltr" inputmode="tel" 
                            class="p-3 border focus:outline-none rounded-lg bg-white text-center w-full shadow-sm" 
                            placeholder="12 18 30 ...">
                    </div>
                    <button onclick="calculateMultiGcdLcm()" class="p-3 w-full btn-3d btn-green">محاسبه</button>
                    
                    <div id="gcd-lcm-result" class="mt-6 text-2xl text-center p-4 rounded-lg hidden"></div>
                </div>
                <div id="vector-calculator" class="math-tool hidden bg-white p-6 rounded-xl shadow-lg">
                    <div class="flex gap-2 items-center mb-2" dir="ltr">
                        <p class="w-10"></p>
                        <p class="w-full font-bold text-gray-600 text-center">$x$</p>
                        <p class="w-full font-bold text-gray-600 text-center">$y$</p>
                        <p class="w-full font-bold text-gray-600 text-center">$z$</p>
                    </div>
                    <div id="vector-list" class="space-y-3 mb-4">
                        <div id="v-row-1" class="flex gap-2 items-center" dir="ltr">
                            <span class="w-10 font-bold text-gray-600">$\vec{V_1}:$</span>
                            <input type="number" step="any" placeholder="x" class="v-x p-2 focus:outline-none border bg-white text-center rounded-lg w-full">
                            <input type="number" step="any" placeholder="y" class="v-y p-2 focus:outline-none border bg-white text-center rounded-lg w-full">
                            <input type="number" step="any" placeholder="z" class="v-z p-2 focus:outline-none border bg-white text-center rounded-lg w-full">
                        </div>
                        <div id="v-row-2" class="flex gap-2 items-center" dir="ltr">
                            <span class="w-10 font-bold text-gray-600">$\vec{V_2}:$</span>
                            <input type="number" step="any" placeholder="x" class="v-x p-2 focus:outline-none border bg-white text-center rounded-lg w-full">
                            <input type="number" step="any" placeholder="y" class="v-y p-2 focus:outline-none border bg-white text-center rounded-lg w-full">
                            <input type="number" step="any" placeholder="z" class="v-z p-2 focus:outline-none border bg-white text-center rounded-lg w-full">
                        </div>
                    </div>
                    <button onclick="addVectorRow()" class="px-4 py-2 w-full btn-3d bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 font-bold">+ افزودن بردار</button>
                    <div class="flex flex-wrap grid grid-cols-2 md:grid-cols-4 gap-2 mb-6 mt-2">
                        <button onclick="calculateAll('sum')" class="px-4 py-2 btn-3d btn-green">برآیند ($\sum$)</button>
                        <button onclick="calculateAll('diff')" class="px-4 py-2 btn-3d bg-red-600 text-white">تفاضل ($\vec{a}-\vec{b}$)</button>
                        <button onclick="calculateAll('cross')" class="px-4 py-2 btn-3d bg-blue-600 text-white">ضرب خارجی ($\vec{a} \times \vec{b}$)</button>
                        <button onclick="calculateAll('dot')" class="px-4 py-2 btn-3d bg-purple-600 text-white">ضرب داخلی ($\vec{a} \cdot \vec{b}$)</button>
                    </div>

                    <div id="vector-latex-result" class="p-4 bg-gray-50 text-lg text-center rounded-lg border-r-4 border-blue-500 mb-4 hidden"></div>

                    <div id="three-container" class="w-full rounded-lg overflow-hidden relative" style="height: 55vh;">
                        <div class="absolute top-2 right-2 text-white text-xs bg-black/50 p-1 rounded">نمای سه‌بعدی تعاملی</div>
                    </div>
                    <div id="v-tooltip" style="position: absolute; display: none; background: rgba(0,0,0,0.8); color: white; padding: 5px 10px; border-radius: 5px; pointer-events: none; font-size: 14px; z-index: 1000;"></div>
                    <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4 text-sm border-t pt-4 text-gray-700">
                        <div class="bg-blue-50 p-3 rounded-lg">
                            <h4 class="font-bold text-blue-800 mb-2 flex items-center">
                                <svg class="w-4 h-4 ml-1" fill="currentColor" stroke="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M281.674 253.424c11.553-14.585 24.288-28.14 38.208-40.267l-68.978-69.013c-10.828-10.867-28.404-10.867-39.275 0-10.831 10.831-10.831 28.404 0 39.235l70.046 70.043zM506.013 142.469c0.268 0 0.494 0 0.802 0 9.109 0 18.109 0.571 26.955 1.487l0-93.986c0-15.327-12.432-27.757-27.76-27.757s-27.721 12.429-27.721 27.757l0 93.968c8.846-0.895 17.842-1.469 26.956-1.469 0.27 0 0.534 0 0.762 0zM730.414 253.388l69.971-70.007c10.866-10.831 10.866-28.404 0-39.235-10.794-10.867-28.405-10.867-39.277 0l-69.018 69.013c13.958 12.123 26.695 25.664 38.324 40.227zM213.494 450.225c0-13.403 1.07-26.519 2.633-39.483l-98.682 0c-15.289 0-27.722 12.432-27.722 27.757 0 15.328 12.434 27.757 27.722 27.757l96.393 0c-0.229-5.28-0.345-10.581-0.345-16.033zM894.563 410.745l-98.643 0c1.6 12.964 2.633 26.082 2.633 39.483 0 5.45-0.115 10.753-0.305 16.033l96.315 0c15.332 0 27.722-12.429 27.722-27.757s-12.39-27.757-27.722-27.757zM745.017 638.262c-11.286 16.547-23.218 30.843-34.695 43.77l50.787 50.829c10.868 10.831 28.483 10.831 39.277 0 10.866-10.867 10.866-28.404 0-39.275l-55.37-55.324zM211.627 693.585c-10.831 10.867-10.831 28.404 0 39.275 10.868 10.831 28.448 10.831 39.275 0l50.83-50.863c-11.475-12.889-23.412-27.222-34.699-43.731l-55.403 55.324zM760.039 450.225c0.037-57.556-19.138-110.785-51.438-153.414-28.33-37.442-66.806-66.802-111.379-84.036l0.229-1.222-19.026-5.586c-14.798-4.29-30.051-7.265-45.605-8.867l-2.211-0.246-0.075 0-0.079-0.019c-7.623-0.724-15.557-1.279-23.83-1.279l-1.218 0c-8.276 0-16.207 0.557-23.833 1.279l-0.115 0.019-2.286 0.246c-15.535 1.6-30.791 4.575-45.549 8.867l-18.416 5.374 0.19 1.222c-44.802 17.214-83.505 46.651-111.99 84.244-32.258 42.628-51.438 95.854-51.438 153.414 0 41.274 7.132 75.207 18.227 103.29 16.661 42.114 42.094 70.559 62.533 92.138 10.22 10.754 19.22 19.941 25.317 27.795 6.254 7.892 9.265 13.995 10.141 18.837 4.459 23.565 4.917 53.306 4.917 60.854l0 2.174c0 34.085 27.609 61.617 61.659 61.655l142.51 0c34.092-0.037 61.659-27.609 61.659-61.655l0-2.097c-0.037-7.474 0.458-37.291 4.919-60.893 0.608-3.278 2.058-7.017 4.917-11.591 4.88-7.97 14.11-17.883 25.548-29.819 17.083-17.959 38.815-40.604 56.091-72.805 17.312-32.161 29.703-73.706 29.626-127.882zM701.813 537.676c-13.614 34.336-34.053 57.575-53.763 78.391-9.841 10.411-19.487 20.095-27.911 30.812-8.311 10.562-15.745 22.65-18.606 37.481-5.377 28.94-5.607 59.978-5.638 68.862 0 1.181 0 1.828 0 2.096-0.037 10.295-8.314 18.606-18.608 18.606l-142.51 0c-5.223 0-9.761-2.059-13.194-5.45-3.391-3.434-5.412-7.934-5.412-13.154 0-0.268 0-0.953 0-2.172-0.037-8.957-0.306-39.921-5.682-68.783-1.828-9.797-5.834-18.571-10.674-26.348-8.579-13.612-19.559-24.819-30.889-36.832-17.116-17.842-35.232-37.119-49.341-63.41-14.07-26.309-24.517-59.745-24.557-107.54 0.037-47.947 15.862-91.95 42.706-127.427 26.845-35.442 64.595-62.209 108.175-75.246l5.377-1.638c10.524-2.708 21.315-4.861 32.429-6.026l0.075 0 2.06-0.229c6.519-0.627 12.847-1.03 19.103-1.066l1.105 0.115 1.106-0.076c6.212 0 12.579 0.42 19.063 1.03l-0.079 0 2.137 0.229 0.037 0c11.093 1.163 21.887 3.277 32.372 6.026l5.451 1.638c43.582 13.037 81.329 39.807 108.175 75.246 26.801 35.478 42.666 79.482 42.666 127.427 0.003 36.409-6.094 64.511-15.169 87.446zM532.782 197.107l0.079 0zM479.17 197.107l0 0c0 0 0.037 0 0.075 0l-0.075 0zM576.706 833.825l-141.369 0c-14.604 0-26.499 11.822-26.499 26.539 0 14.564 11.899 26.465 26.499 26.465l141.369 0c14.604 0 26.499-11.899 26.499-26.465 0-14.721-11.899-26.539-26.499-26.539zM576.706 900.704l-141.369 0c-14.604 0-26.499 11.857-26.499 26.464 0 14.678 11.899 26.539 26.499 26.539l141.369 0c14.604 0 26.499-11.857 26.499-26.539 0-14.605-11.899-26.464-26.499-26.464zM518.406 968.116l-72.805 0c0 0.801-0.154 1.561-0.154 2.404 0 14.643 22.498 26.499 43.297 26.499l34.546 0c20.818 0 43.277-11.857 43.277-26.499 0-0.837-0.115-1.6-0.115-2.404l-48.044 0z"  /></svg>
                                راهنمای تعاملی
                            </h4>
                            <ul class="list-disc list-inside space-y-1 justify">
                                <li>با <b>کلیک و کشیدن</b> موس یا انگشت خود، زاویه دوربین را تغییر دهید.</li>
                                <li>با <b>اسکرول (Scroll)</b> یا کشیدن انگشت خود به بیرون، روی بردارها زوم کنید.</li>
                                <li>با <b>نگه داشتن موس یا کلیک</b> روی هر بردار، مختصات آن را ببینید.</li>
                                <li>بردار <span class="text-yellow-600 font-bold">طلایی</span> همواره نتیجه نهایی محاسبه است.</li>
                            </ul>
                        </div>
                        <div class="bg-gray-50 p-3 rounded-lg">
                            <h4 class="font-bold text-black mb-2 flex items-center">
                                <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                نکات ریاضی
                            </h4>
                            <p class="leading-relaxed justify">
                                <b>بردار (Vector):</b> بردار، کمیتی است که اندازه و جهت را با هم دارد (پاره‌خط جهت‌دار).<br>
                                <b>ضرب داخلی:</b> حاصل یک عدد (اسکالر) است که تصویر یک بردار بر دیگری را نشان می‌دهد و به ما می‌گوید دو بردار چقدر با هم هم‌جهت هستند.<br>
                                <b>ضرب خارجی:</b> حاصل برداری است که بر هر دو بردار اولیه <b>عمود</b> است (قانون دست راست) و طول این بردار برابر با <b>مساحت متوازی‌الاضلاعی</b> است که این دو بردار می‌سازند.<br>
                                <b>تفاضل:</b> برآیند بردار اول با قرینۀ بردار[های] بعدی؛ $\vec{a}-\vec{b}=\vec{a}+(-\vec{b})$.
                            </p>
                        </div>
                        <div class="bg-blue-50 p-4 md:col-span-2 rounded-lg">
                            <h4 class="font-bold text-blue-800 mb-3 flex items-center text-base">
                                <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>
                                دانشنامۀ فرمول‌های برداری
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 items-center">
                                <p class="text-center">
                                    $$\vec{a} = a_x\hat{i} + a_y\hat{j} + a_z\hat{k} = \begin{bmatrix} {a_x} \\ {a_y} \\ {a_z} \end{bmatrix} = (a_x, a_y, a_z)$$
                                </p>
                                <p class="text-center">
                                    $$|\vec{a}| = \sqrt{a_x^2 + a_y^2 + a_z^2}$$
                                </p>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 overflow-x-auto">
                                <div>
                                    <p class="font-bold text-blue-700">۱. مختصات برآیند و تفاضل:</p>
                                    $$\vec{R} = \vec{a} \pm \vec{b} = \begin{bmatrix} {a_x \pm b_x} \\ {a_y \pm b_y} \\ {a_z \pm b_z} \end{bmatrix}$$
                                    <p class="font-bold text-blue-700 mt-2">۲. بزرگی یا اندازۀ برآیند (قانون کسینوس‌ها):</p>
                                    $$|\vec{R}| = \sqrt{|\vec{a}|^2 + |\vec{b}|^2 + 2|\vec{a}||\vec{b}|\cos(\theta)}$$
                                    <p class="font-bold text-blue-700 mt-2">۳. بزرگی تفاضل:</p>
                                    $$|\vec{D}| = \sqrt{|\vec{a}|^2 + |\vec{b}|^2 - 2|\vec{a}||\vec{b}|\cos(\theta)}$$
                                </div>
                                <div>
                                    <p class="font-bold text-blue-700">۴. ضرب داخلی و زاویه:</p>
                                    $$\vec{a}\cdot\vec{b} = a_x b_x + a_y b_y + a_z b_z = |\vec{a}||\vec{b}|\cos(\theta) \\ \implies \theta = \cos^{-1}\left(\frac{\vec{a}\cdot\vec{b}}{|\vec{a}||\vec{b}|}\right)$$
                                    <p class="font-bold text-blue-700 mt-2">۵. ضرب خارجی:</p>
                                    $$\vec{a}\times\vec{b} = \begin{vmatrix} \hat{i} & \hat{j} & \hat{k} \\ a_x & a_y & a_z \\ b_x & b_y & b_z \end{vmatrix}=\begin{bmatrix} {a_y b_z - a_z b_y} \\ {a_x b_z - a_z b_x} \\ {a_x b_y - a_y b_x} \end{bmatrix} \\ |\vec{a}\times\vec{b}| = |\vec{a}||\vec{b}|\sin(\theta)$$
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="math-split-border" class="mt-5 border-t"></div>
            <h2 class="math-heading mt-5 text-2xl text-center font-bold">✨ابزارهای هوشمند ریاضی🛠️</h2>
            <div id="math-smartTool-buttons" class="mt-2 grid grid-cols-1 md:grid-cols-2 gap-4">
                <button class="w-full p-4 btn-3d btn-green" onclick="showMathTool('math-explainer', 'توضیح مفاهیم و نظریات ریاضی')">توضیح مفاهیم و نظریات ریاضی</button>
                <button class="w-full p-4 btn-3d btn-green" onclick="showMathTool('math-solver', 'حل گام به گام مسائل ریاضی')">حل گام به گام مسائل ریاضی</button>
            </div>

            <div id="math-smartTool-container">
                <!-- Math Explainer -->
                <div id="math-explainer" class="math-tool hidden">
                    <p class="mb-4 text-center text-gray-700">مفهوم، قضیه یا نظریه ریاضی مورد نظر خود را وارد کنید تا با هوش مصنوعی KamiMAIT آموزش و توضیحی جامع و شیوا دریافت کنید.</p>
                    <textarea 
                        id="math-explainer-input" 
                        dir="rtl" 
                        class="p-3 border focus:outline-none rounded-lg shadow-inner bg-white text-justify w-full mb-3 resize-none" 
                        rows="3" 
                        placeholder="مثال: قضیه فیثاغورس، مفهوم انتگرال، تابع درجه دو"></textarea>
                    <button onclick="getMathExplanation()" class="p-3 w-full btn-3d btn-green">توضیح بده</button>
                    <div id="math-explainer-loading" class="mt-4 text-center hidden">
                        <div class="spinner-border animate-spin inline-block w-8 h-8 border-4 border-t-transparent border-green-600 rounded-full" role="status"></div>
                    </div>
                    <div id="math-explainer-result" dir="auto" class="mt-4 p-4 border rounded-lg bg-white text-justify w-full min-h-[100px] shadow">
                        <p class="text-gray-500 text-center">پاسخ هوش مصنوعی در اینجا نمایش داده خواهد شد...</p>
                    </div>
                </div>

            </div>
        </div>
        
        <!-- Physics Page -->
        <div id="physics-page" class="page">
            <div id="physics-tool-buttons" class="mt-2 grid grid-cols-1 gap-4">
                <button class="w-full p-4 btn-3d btn-green" onclick="showPhysicsTool('', '')">توضیح مفاهیم و پدیده‌های فیزیکی</button>
                <button class="w-full p-4 btn-3d btn-green" onclick="showPhysicsTool('', '')">حل مسائل فیزیک</button>
                <button class="w-full p-5 btn-3d btn-green" onclick="showPhysicsTool('CPhysQuantity', '🧮محاسبۀ کمیت‌های فیزیکی')">محاسبۀ کمیت‌های فیزیکی</button>
            </div>
            <div id="physics-tool-container">
                <!-- Calculation of Physical Quantities -->
                <div id="CPhysQuantity" class="physics-tool hidden">
                    <!-- شاخه ها -->
                    <p id="physical-branch-selection-label" class="text-lg text-center font-bold mb-4">شاخۀ مورد نظر را انتخاب کنید:</p>
                    <div id="physical-branch-selection" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <button class="w-full p-4 btn-3d btn-green" onclick="showPhysicsBranch('mechanics')">مکانیک</button>
                        <button class="w-full p-4 btn-3d btn-green" onclick="showPhysicsBranch('oscillations-waves')">نوسان و موج</button>
                        <button class="w-full p-4 btn-3d btn-green" onclick="showPhysicsBranch('statistical-physics')">فیزیک آماری</button>
                        <button class="w-full p-4 btn-3d btn-green" onclick="showPhysicsBranch('thermodynamics')">ترمودینامیک</button>
                        <button class="w-full p-4 btn-3d btn-green" onclick="showPhysicsBranch('electromagnetism')">الکترومغناطیس</button>
                        <button class="w-full p-4 btn-3d btn-green" onclick="showPhysicsBranch('optics')">اپتیک (نورشناسی)</button>
                        <button class="w-full p-4 btn-3d btn-green" onclick="showPhysicsBranch('relativity')">نسبیت</button>
                        <button class="w-full p-4 btn-3d btn-green" onclick="showPhysicsBranch('nuclear-physics')">فیزیک هسته‌ای</button>
                        <button class="w-full p-4 btn-3d btn-green" onclick="showPhysicsBranch('quantum-physics')">فیزیک کوانتوم</button>
                        <button class="w-full p-4 btn-3d btn-green" onclick="showPhysicsBranch('particle-physics')">فیزیک ذرات</button>
                        <button class="w-full p-4 btn-3d btn-green" onclick="showPhysicsBranch('astrophysics')">اخترفیزیک</button>
                        <button class="w-full p-4 btn-3d btn-green" onclick="showPhysicsBranch('fluid-mechanics')">مکانیک سیالات</button>
                        <button class="w-full p-4 btn-3d btn-green" onclick="showPhysicsBranch('black-holes')">سیاهچاله‌ها</button>
                    </div>
                    <!-- مکانیک -->
                    <div id="mechanics" class="physics-branch-tool hidden">
                        <!-- زیرشاخه های مکانیک -->
                        <h3 class="physical-subbranch-selection-label text-3xl text-center font-bold mb-6">مکانیک</h3>
                        <p class="physical-subbranch-selection-label text-lg text-center font-bold mb-4">زیرشاخۀ مورد نظر را انتخاب کنید:</p>
                        <div id="physical-mechanics-selection" class="physical-subbranch-selection grid grid-cols-2 md:grid-cols-4 gap-4">
                            <button class="w-full p-4 btn-3d btn-green" onclick="showPhysicsSubBranch('kinetic')">سینتیک (نیروشناسی)</button>
                            <button class="w-full p-4 btn-3d btn-green" onclick="showPhysicsSubBranch('kinematic')">سینماتیک (حرکت‌شناسی)</button>
                            <button class="w-full p-4 btn-3d btn-green" onclick="showPhysicsSubBranch('elastomechanics')">مکانیک کِشسانی</button>
                            <button class="w-full p-4 btn-3d btn-green" onclick="showPhysicsSubBranch('classical-mechanical-systems')">مکانیک کلاسیک سیستم‌ها</button>
                        </div>
                        <p class="physical-subbranch-selection-label text-sm text-center mt-8">قوانین حاکم بر حرکت اجسام، از سقوط یک سیب تا گردش سیارات را کاوش کنید.</p>
                        <!-- سینتیک -->
                        <div id="kinetic" class="physics-subbranch-tool hidden">
                            <h4 class="physical-subbranch-compute-label text-3xl text-center font-bold mb-4">سینتیک (نیروشناسی)</h4>
                            <p class="physical-subbranch-compute-label text-sm text-center mb-4">قوانین حاکم بر حرکت اجسام تحت تأثیر نیروها را کاوش کنید.</p>
                            <div class="physical-subbranch-compute-selection grid grid-cols-2 md:grid-cols-4 gap-3">
                                <button class="p-3 btn-3d btn-green" onclick="showPhysicsComputeTool('kinetic-newton')">قانون دوم نیوتن</button>
                                <button class="p-3 btn-3d btn-green" onclick="showPhysicsComputeTool('kinetic-impulse')">ضربه</button>
                                <button class="p-3 btn-3d btn-green" onclick="showPhysicsComputeTool('kinetic-friction')">نیروی اصطکاک</button>
                                <button class="p-3 btn-3d btn-green" onclick="showPhysicsComputeTool('kinetic-work')">کار انجام شده</button>
                                <button class="p-3 btn-3d btn-green" onclick="showPhysicsComputeTool('kinetic-kinetic-energy')">انرژی جنبشی</button>
                                <button class="p-3 btn-3d btn-green" onclick="showPhysicsComputeTool('kinetic-power')">توان</button>
                                <button class="p-3 btn-3d btn-green" onclick="showPhysicsComputeTool('kinetic-torque')">گشتاور</button>
                                <button class="p-3 btn-3d btn-green" onclick="showPhysicsComputeTool('kinetic-centripetal-acceleration')">شتاب مرکزگرا</button>
                                <button class="p-3 btn-3d btn-green" onclick="showPhysicsComputeTool('kinetic-coriolis-acceleration')">شتاب کوریولیس</button>
                                <button class="p-3 btn-3d btn-green" onclick="showPhysicsComputeTool('kinetic-mechanical-advantage')">مزیت مکانیکی</button>
                                <button class="p-3 btn-3d btn-green" onclick="showPhysicsComputeTool('kinetic-inclined-plane-motion')">حرکت روی سطوح شیب‌دار</button>
                            </div>
                            <div id="kinetic-newton" class="physics-comp-tool mt-6 hidden p-4 border rounded-lg bg-white shadow">
                                <h5 class="text-2xl font-bold text-center text-green-700 mb-4 mt-2">قانون دوم نیوتن</h5>
                                <p class="text-gray-500 text-sm text-center">اساسی‌ترین رابطه در فیزیک کلاسیک که بیان می‌کند شتاب یک جسم با نیروی وارد بر آن رابطه مستقیم و با جرم آن رابطه عکس دارد.</p>
                                <p class="my-3 text-xl">$$\sum\vec{F}=m\vec{a}$$</p>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <input type="number" inputmode="numeric" id="kinetic-newton-F" dir="ltr" class="p-2 focus:outline-none border bg-white text-center rounded-lg w-full" placeholder="نیروی خالص (F) برحسب N">
                                    <input type="number" id="kinetic-newton-m" dir="ltr" class="p-2 focus:outline-none border bg-white text-center rounded-lg w-full" placeholder="جرم (m) برحسب kg">
                                    <input type="number" inputmode="numeric" id="kinetic-newton-a" dir="ltr" class="p-2 focus:outline-none border bg-white text-center rounded-lg w-full" placeholder="شتاب (a) برحسب m/s²">
                                </div>
                                <button onclick="calculateNewton2ndLaw()" class="mt-4 p-3 btn-3d btn-green w-full">محاسبه کن</button>
                                <p id="kinetic-newton-result" class="mt-4 text-2xl text-center"></p>
                                <p class="text-gray-500 text-sm mt-6">
                                    * $F$ (نیرو): نماد Force؛ واحد آن نیوتن ($\text{N}$) است و $\Sigma\vec{F}$ با حرف یونانی سیگما ($\Sigma$) یعنی برایند یا مجموع بردارهای نیرو. (بردار)<br>
                                    * $m$ (جرم): نماد mass؛ واحد آن کیلوگرم ($\text{kg}$) است. (اسکالر)<br>
                                    * $a$ (شتاب): نماد acceleration؛ واحد آن متر بر مجذور ثانیه ($\text{m}/\text{s}^2$) است. (بردار)
                                </p>
                            </div>

                            <div id="kinetic-impulse" class="physics-comp-tool mt-6 hidden p-4 border rounded-lg bg-white shadow">
                                <h5 class="text-2xl font-bold text-center text-green-700 mb-2">ضربه (Impulse)</h5>
                                <p class="text-gray-500 text-sm text-center mb-4">ضربه پلی است میان دنیای نیروها (سینتیک) و دنیای سرعت‌ها (سینماتیک).</p>
                                
                                <div class="flex border-b mb-4">
                                    <button class="flex-1 py-2 font-bold text-green-600 border-b-2 border-green-600 focus:outline-none transition duration-100" id="tab-impulse-ft" onclick="switchImpulseTab('ft')">نیرو - زمان ($J=F\Delta t$)</button>
                                    <button class="flex-1 py-2 font-bold text-gray-500 focus:outline-none transition duration-100" id="tab-impulse-mv" onclick="switchImpulseTab('mv')">تغییر تکانه ($J=m\Delta v$)</button>
                                </div>

                                <div id="impulse-ft-content" class="wipeLeft transition duration-100">
                                    <p class="text-gray-500 text-sm mt-2 text-center">ضربه نشان می‌دهد که چگونه یک نیروی کوچک در زمانی طولانی، یا یک نیروی عظیم در لحظه‌ای کوتاه، می‌توانند اثرات حرکتی یکسانی ایجاد کنند.</p>
                                    <p class="my-3 text-xl text-center">$$\vec{J} = \Delta \vec{p} = \sum\vec{F} \times \Delta t$$</p>
                                    <p class="text-gray-500 text-sm my-3">
                                        * $J$ (ضربه): نماد Impulse؛ واحد آن در سیستم SI نیوتن-ثانیه ($\text{N} \cdot \text{s}$) است. (کمیت برداری)<br>
                                        * $F$ (نیرو): نماد Force؛ واحد آن نیوتن ($\text{N}$) است.<br>
                                        * $\Delta t$ (زمان): نماد مدت زمانی؛ واحد آن ثانیه ($\text{s}$) است.<br>
                                        * $\Delta p$: تغییرات تکانه؛ $\Delta p=p_2-p_1$؛ واحد آن کیلوگرم در متر بر ثانیه ($\text{kg}\cdot\text{m}/\text{s}$) است.
                                    </p>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <input type="number" inputmode="numeric" id="impulse-J1" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full" placeholder="ضربه (J) [N·s]">
                                        <input type="number" inputmode="numeric" id="impulse-F" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full" placeholder="نیرو (F) [N]">
                                        <input type="number" inputmode="numeric" id="impulse-t" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full" placeholder="زمان (Δt) [s]">
                                    </div>
                                </div>

                                <div id="impulse-mv-content" class="hidden wipeLeft transition duration-100">
                                    <p class="text-gray-500 text-sm mt-2 text-center">هرچه ضربه بیشتر، تغییر در سرعت یا جرم در حال حرکت محسوس‌تر.</p>
                                    <p class="my-3 text-xl text-center">$$\mathbf{J} = \Delta \mathbf{p} = m(\mathbf{v}_2 - \mathbf{v}_1)$$</p>
                                    <p class="text-gray-500 text-sm my-3">
                                        * $m$: جرم.<br>
                                        * $v_1$ (سرعت اولیه): نماد Initial Velocity؛ واحد آن متر بر ثانیه ($\text{m/s}$) است.<br>
                                        * $v_2$ (سرعت ثانویه): نماد Final Velocity؛ واحد آن متر بر ثانیه ($\text{m/s}$) است.<br>
                                        * $\Delta v$ (تغییرات سرعت): تفاضل سرعت ثانویه از اولیه ($v_2 - v_1$).<br>
                                        * $p$ (تکانه/اندازه حرکت): نماد Momentum؛ حاصل‌ضرب جرم در سرعت؛ $\mathbf{p} = m\mathbf{v}$.
                                    </p>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <input type="number" inputmode="numeric" id="impulse-J2" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full" placeholder="ضربه (J) [kg·m/s]">
                                        <input type="number" inputmode="numeric" id="impulse-m" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full" placeholder="جرم (m) [kg]">
                                        <input type="number" inputmode="numeric" id="impulse-v1" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full" placeholder="سرعت اول (v1) [m/s]">
                                        <input type="number" inputmode="numeric" id="impulse-v2" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full" placeholder="سرعت دوم (v2) [m/s]">
                                    </div>
                                </div>

                                <button onclick="calculateImpulse()" class="mt-4 p-3 btn-3d btn-green w-full">محاسبه کن</button>
                                <p id="kinetic-impulse-result" class="mt-4 text-2xl text-center"></p>
                            </div>

                            <div id="kinetic-friction" class="physics-comp-tool mt-6 hidden p-4 border rounded-lg bg-white shadow">
                                <h5 class="text-2xl font-bold text-center text-green-700 mb-2">نیروی اصطکاک (Friction)</h5>
                                <p class="text-gray-500 text-sm text-center mb-4">نیرویی که در برابر لغزش دو سطح بر روی یکدیگر مقاومت می‌کند.</p>
                                
                                <div class="flex border-b mb-4">
                                    <button class="flex-1 py-2 font-bold text-green-600 border-b-2 border-green-600 focus:outline-none transition duration-100" id="tab-friction-static" onclick="switchFrictionTab('static')">ایستایی ($f_s = \mu_s N$)</button>
                                    <button class="flex-1 py-2 font-bold text-gray-500 focus:outline-none transition duration-100" id="tab-friction-kinetic" onclick="switchFrictionTab('kinetic')">جنبشی ($f_k = \mu_k N$)</button>
                                </div>

                                <div id="friction-static-content" class="wipeLeft transition duration-100">
                                    <p class="text-gray-500 text-sm mt-2 text-center">نیروی اصطکاک ایستایی، مانع از شروع حرکت جسم می‌شود و تا آستانه حرکت افزایش می‌یابد.</p>
                                    <p class="mt-3 text-xl text-center">$$f_{s,max} = \mu_s N$$</p>
                                    <p class="mb-3 mt-1 text-xl text-center">$$f_s \leq \mu_s N$$</p>
                                    <p class="text-gray-500 text-sm my-3">
                                        * $f_{s,max}$ (اصطکاک ایستایی): حداکثر نیروی مقاومت قبل از حرکت و واحد آن نیوتن [N] است.<br>
                                        * $\mu_s$ (ضریب اصطکاک ایستایی): وابستگی جنس سطوح؛ معمولاً بین ۰ و ۱.<br>
                                        * $N$ یا $F_N$ (نیروی عمودی سطح): نیرویی که دو سطح را به هم می‌فشارد [N].
                                    </p>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <input type="number" inputmode="numeric" id="fric-fs" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full" placeholder="بیشینۀ نیروی اصطکاک ایستایی (fs) [N]">
                                        <input type="number" inputmode="numeric" id="fric-us" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full" placeholder="ضریب اصطکاک ایستایی (μs)">
                                        <input type="number" inputmode="numeric" id="fric-ns" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full" placeholder="نیروی عمودی (N) [N]">
                                    </div>
                                </div>

                                <div id="friction-kinetic-content" class="hidden wipeLeft transition duration-100">
                                    <p class="text-gray-500 text-sm mt-2 text-center">وقتی جسم در حال لغزش است، این نیرو در خلاف جهت حرکت به آن وارد می‌شود.</p>
                                    <p class="my-3 text-xl text-center">$$f_k = \mu_k N$$</p>
                                    <p class="text-gray-500 text-sm my-3">
                                        * $f_k$ (اصطکاک جنبشی): نیروی مقاوم در حین حرکت [N].<br>
                                        * $\mu_k$ (ضریب اصطکاک جنبشی): معمولاً کمتر از ضریب ایستایی است.<br>
                                        * $N$ یا $F_N$ (نیروی عمودی سطح): واحد آن نیوتن [N] است.
                                    </p>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <input type="number" inputmode="numeric" id="fric-fk" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full" placeholder="نیروی اصطکاک جنبشی (fk) [N]">
                                        <input type="number" inputmode="numeric" id="fric-uk" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full" placeholder="ضریب اصطکاک جنبشی (μk)">
                                        <input type="number" inputmode="numeric" id="fric-nk" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full" placeholder="نیروی عمودی (N) [N]">
                                    </div>
                                </div>

                                <button onclick="calculateFriction()" class="mt-4 p-3 btn-3d btn-green w-full">محاسبه کن</button>
                                <p id="kinetic-friction-result" class="mt-4 text-2xl text-center mb-6"></p>
                                <img src="https://encrypted-tbn1.gstatic.com/licensed-image?q=tbn:ANd9GcQ3HcJECKEyDijfyPEchQT5Y8UrwKMG6QLiTNCW8mFagrTpnFElrbMQNOxrZ-tXhXvoGS0amVG_e_A-MIWSF6jcv6ST2uFQv_ThmMhRCTSp2mBhfPU" class="w-full lg:max-w-3xl rounded-lg mx-auto h-auto">
                            </div>
                            <div id="kinetic-work" class="physics-comp-tool mt-6 hidden p-4 border rounded-lg bg-white shadow">
                                <h5 class="text-2xl font-bold text-center text-green-700 mb-2">کار انجام شده (Work)</h5>
                                <p class="text-gray-500 text-sm text-center mb-4">انتقال انرژی که با اعمال نیرو و جابه‌جایی جسم صورت می‌گیرد.</p>
                                
                                <div class="flex border-b mb-4 overflow-x-auto flex-wrap">
                                    <button class="flex-1 py-2 px-2 font-bold text-green-600 border-b-2 border-green-600 focus:outline-none transition duration-100 whitespace-nowrap" id="tab-work-fd" onclick="switchWorkTab('fd')">نیرو-جابه‌جایی ($Fd\cos\theta$)</button>
                                    <button class="flex-1 py-2 px-2 font-bold text-gray-500 focus:outline-none transition duration-100 whitespace-nowrap" id="tab-work-mad" onclick="switchWorkTab('mad')">شتاب ثابت ($mad$)</button>
                                    <button class="flex-1 py-2 px-2 font-bold text-gray-500 focus:outline-none transition duration-100 whitespace-nowrap" id="tab-work-rot" onclick="switchWorkTab('rot')">حرکت دورانی ($\tau\theta$)</button>
                                </div>

                                <div id="work-fd-content" class="wipeLeft transition duration-100">
                                    <p class="text-gray-500 text-sm text-center my-1">در فیزیک، فقط آن بخش از نیرو که در راستای حرکت است کار انجام می‌دهد.</p>
                                    <p class="my-3 text-xl text-center">$$W = \vec{F} \cdot \vec{d}=Fd\cos(\theta)$$</p>
                                    <p class="text-gray-500 text-sm mb-2">
                                        * $W$ (کار): نماد Work؛ واحد آن در سیستم SI ژول ($\text{J}=\text{N}\cdot\text{m}$) است. (کمیت نرده‌ای) <br>
                                        * $F$ (نیرو): نماد Force؛ واحد آن نیوتن (N) است. <br>
                                        * $d$ (جابه‌جایی): نماد Displacement؛ واحد آن متر (m) است. (برداری) <br>
                                        * $\theta$ (زاویه): زاویه بین بردار نیرو و جابه‌جایی برحسب درجه ($^\circ$).
                                    </p>
                                    <p class="text-gray-500 text-center mb-3">
                                        زاویه‌ ($\theta$) را به <b>درجه</b> وارد کنید (پیش‌فرض ۰ است). اگر نیرو و جابه‌جایی هم‌جهت هستند: ۰، اگر خلاف جهت (نیروی مقاوم): ۱۸۰ وارد کنید.
                                    </p>
                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                        <input type="number" inputmode="numeric" id="work-w1" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full" placeholder="کار (W) [J]">
                                        <input type="number" inputmode="numeric" id="work-f" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full" placeholder="نیرو (F) [N]">
                                        <input type="number" inputmode="numeric" id="work-d1" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full" placeholder="جابه‌جایی (d) [m]">
                                        <input type="number" inputmode="numeric" id="work-theta" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full" placeholder="زاویه (deg) - پیش‌فرض 0">
                                    </div>
                                </div>

                                <div id="work-mad-content" class="hidden wipeLeft transition duration-100">
                                    <p class="text-gray-500 text-sm my-1">محاسبه کار زمانی که جسم با شتاب ثابت جابه‌جا می‌شود (نیرو از قانون دوم نیوتن حاصل می‌شود).</p>
                                    <p class="my-3 text-xl text-center">$$W = m a d$$</p>
                                    <p class="text-gray-500 text-sm my-3">
                                        * $m$: جرم<br>
                                        * $a$ (شتاب): نماد acceleration؛ واحد آن متر بر مجذور ثانیه ($\text{m}/\text{s}^2$) است. (بردار) <br>
                                        * $d$ (جابه‌جایی): نماد Displacement؛ واحد آن متر (m) است. (بردار)
                                    </p>
                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                        <input type="number" inputmode="numeric" id="work-w2" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full" placeholder="کار (W) [J]">
                                        <input type="number" inputmode="numeric" id="work-m" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full" placeholder="جرم (m) [kg]">
                                        <input type="number" inputmode="numeric" id="work-a" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full" placeholder="شتاب (a) [m/s²]">
                                        <input type="number" inputmode="numeric" id="work-d2" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full" placeholder="جابه‌جایی (d) [m]">
                                    </div>
                                </div>

                                <div id="work-rot-content" class="hidden wipeLeft transition duration-100">
                                    <p class="text-gray-500 text-sm text-center my-1">کار لزوماً در یک خط راست نیست؛ وقتی پیچی را می‌چرخانید، گشتاور شما در بازه زاویه‌ای که پیچیده شده، کار انجام می‌دهد</p>
                                    <p class="my-3 text-xl text-center">$$W = \vec{\tau} \cdot \Delta\vec{\theta}_{rad}$$</p>
                                    <p class="text-gray-500 text-sm mb-2">
                                        * $\tau$ (گشتاور): نماد Torque؛ واحد آن نیوتن-متر ($\text{N} \cdot \text{m}$) است. (کمیت برداری) <br>
                                        * $\Delta\theta_{rad}$ (زاویه دوران برحسب رادیان): تغییر زاویه دوران در واحد رادیان. <br>
                                        * $\theta$ (زاویه): زاویه بین بردار نیرو و جابه‌جایی برحسب درجه ($^\circ$).
                                    </p>
                                    <p class="text-gray-500 text-center my-3">زاویه چرخیده شده را به <b>درجه</b> وارد کنید؛ برنامه خودکار به رادیان تبدیل می‌کند.</p>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <input type="number" inputmode="numeric" id="work-w3" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full" placeholder="کار (W) [J]">
                                        <input type="number" inputmode="numeric" id="work-tau" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full" placeholder="گشتاور (τ) [N·m]">
                                        <input type="number" inputmode="numeric" id="work-deg" dir="ltr" class="p-2 focus:outline-none border text-center bg-white rounded-lg w-full" placeholder="زاویه دوران (deg)">
                                    </div>
                                </div>

                                <button onclick="calculateWork()" class="mt-4 p-3 btn-3d btn-green w-full">محاسبه کن</button>
                                <p id="kinetic-work-result" class="mt-4 text-2xl text-center"></p>
                            </div>
                        </div>
                        <!-- سینماتیک -->
                        <div id="kinematic" class="physics-subbranch-tool hidden">
                        </div>
                        <!-- مکانیک کِشسانی -->
                        <div id="elastomechanics" class="physics-subbranch-tool hidden">
                        </div>
                        <!-- مکانیک کلاسیک سیستم‌ها -->
                        <div id="classical-mechanical-systems" class="physics-subbranch-tool hidden">
                        </div>
                    </div>
                    <div id="oscillations-waves" class="physics-branch-tool hidden">
                    </div>
                    <div id="statistical-physics" class="physics-branch-tool hidden">
                    </div>
                    <div id="thermodynamics" class="physics-branch-tool hidden">
                    </div>
                    <div id="electromagnetism" class="physics-branch-tool hidden">
                    </div>
                    <div id="optics" class="physics-branch-tool hidden">
                    </div>
                    <div id="relativity" class="physics-branch-tool hidden">
                    </div>
                    <div id="nuclear-physics" class="physics-branch-tool hidden">
                    </div>
                    <div id="quantum-physics" class="physics-branch-tool hidden">
                    </div>
                    <div id="particle-physics" class="physics-branch-tool hidden">
                    </div>
                    <div id="astrophysics" class="physics-branch-tool hidden">
                    </div>
                    <div id="fluid-mechanics" class="physics-branch-tool hidden">
                    </div>
                    <div id="black-holes" class="physics-branch-tool hidden">
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Chemistry Page -->
        <div id="chemistry-page" class="page">
             <!-- Content for Chemistry page -->
        </div>

        <!-- Biology Page -->
        <div id="biology-page" class="page">
             <!-- Content for Biology page -->
        </div>

        <!-- Geology Page -->
        <div id="geology-page" class="page">
             <!-- Content for Geology page -->
        </div>

        <!-- Astronomy Page -->
        <div id="astronomy-page" class="page">
            <div id="astronomy-tool-buttons" class="mt-2 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                <button class="w-full p-4 btn-3d btn-green" onclick="showAstronomyTool('', '')">توضیح مفاهیم و پدیده‌های نجومی</button>
                <button class="w-full p-4 btn-3d btn-green" onclick="showAstronomyTool('', '')">حل مسائل پیشرفتۀ نجوم و کیهان‌شناسی</button>
                <button class="w-full p-4 btn-3d btn-green" onclick="showAstronomyTool('stellarium', '🌃مشاهدۀ زندۀ آسمان🪐')">🌠مشاهدۀ زندۀ آسمان (Sky Live)</button>
                <button class="w-full p-4 btn-3d btn-green" onclick="showAstronomyTool('', '♈معرفی صور فلکی')">معرفی صور فلکی</button>
            </div>
            <div id="astronomy-tool-container">
                <!-- Sky Live -->
                <div id="stellarium" class="astronomy-tool hidden bg-white p-1 rounded-lg shadow">
                    <p class="mt-2 mb-4 text-lg text-center"><b>کاوش کنید، یاد بگیرید و شگفتی کیهان را در همین لحظه ببینید.</b></p>
                    <iframe 
                        id="stellarium-iframe" 
                        src="" style="height: 85vh;"
                        frameborder="0" allowfullscreen 
                        class="w-full h-full border rounded-lg shadow-lg"
                        title="Stellarium Web Viewer">
                    </iframe>
                    <p class="mt-4 text-center">با <b>Stellarium Web</b> پنجرۀ خود را به آسمان بی‌کران باز کنید و هر ستاره، سیاره و صورت فلکی را که اکنون بر فراز شما قرار دارد، مشاهده و کشف کنید.</p>
                    <p class="p-2 mt-2 text-lg">* می‌توانید با کلیک روی<span class="inline-block align-middle mr-1"><svg class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></span> آزادی بیشتری داشته باشید.</p>
                    <p class="p-2 mt-2 text-lg">* اگر از موبایل استفاده می‌کنید، برای تجربۀ کاربری بهتر می‌توانید صفحه را افقی گرفته و یا گزینۀ<span class="inline-block align-middle mr-1"><svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentcolor"><path d="m0 0h24v24h-24z" fill="none"/><path d="m7 14h-2v5h5v-2h-3v-3zm-2-4h2v-3h3v-2h-5v5zm12 7h-3v2h5v-5h-2v3zm-3-12v2h3v3h2v-5h-5z"/></svg></span> را انتخاب کنید تا آسمان را تمام صفحه مشاهده کنید.</p>
                </div>
            </div>
        </div>

        <!-- Persian Page -->
        <div id="persian-page" class="page">
             <!-- Content for Persian page -->             
        </div>

        <!-- English Page -->
        <div id="english-page" class="page">
             <!-- Content for English page -->
        </div>

        <!-- Arabic Page -->
        <div id="arabic-page" class="page">
             <!-- Content for Arabic page -->
        </div>

        <!-- Labs Page -->
        <div id="simulations-page" class="page">
            <h2 class="text-2xl font-bold text-center mb-6 text-slate-900">🔬 آزمایش‌های مجازی (PhET)</h2>
            <div id="subject-buttons" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <button data-subject="riazi" class="subject-btn w-full p-4 btn-3d bg-blue-600 text-white text-lg flex flex-col items-center hover:bg-blue-700">ریاضی</button>
                <button data-subject="fizik" class="subject-btn w-full p-4 btn-3d bg-red-600 text-white text-lg flex flex-col items-center hover:bg-red-700">فیزیک</button>
                <button data-subject="shimi" class="subject-btn w-full p-4 btn-3d bg-purple-600 text-white text-lg flex flex-col items-center hover:bg-purple-700">شیمی</button>
                <button data-subject="zist" class="subject-btn w-full p-4 btn-3d bg-green-600 text-white text-lg flex flex-col items-center hover:bg-green-710">زیست</button>
            </div>
            
            <div id="lab-main-content" class="bg-white rounded-lg shadow-xl p-4">
                <div id="lab-list-container">
                    <h3 id="lab-list-title" class="text-xl font-semibold mb-4 text-center text-gray-700">لطفاً یک موضوع را انتخاب کنید.</h3>
                    <div id="lab-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                </div>
                <div id="lab-iframe-container" class="hidden relative pt-[75%] bg-gray-100 rounded-lg shadow-inner">
                    <iframe id="lab-iframe" src="" class="absolute top-0 left-0 w-full h-full border-0 rounded-lg" allowfullscreen title="شبیه‌ساز PhET"></iframe>
                </div>
            </div>
        </div>
        
        <!-- Games Page -->
        <div id="games-page" class="page">
            <div id="game-buttons" class="grid grid-cols-2 sm:grid-cols-3 gap-4 mb-6"></div>
            <div id="game-iframe-container" class="hidden relative pt-[160%] md:pt-[75%] bg-gray-100 rounded-lg shadow-inner">
                <iframe id="game-iframe" src="" class="absolute top-0 left-0 w-full h-full border-0 rounded-lg" title="بازی"></iframe>
                <div id="iframe-placeholder" class="absolute inset-0 flex items-center justify-center text-gray-500 font-semibold text-lg p-4 bg-white rounded-lg">
                    لطفاً یک بازی را انتخاب کنید.
                </div>
            </div>
        </div>

    </div>
    <!-- Math Solver -->
    <div id="math-solver" class="math-tool mt--4 hidden">
        <p class="mb-4 sm:px-6 lg:px-8 py-3 p-4 max-w-7xl mx-auto text-center text-gray-700">مسئله ریاضی خود را به زبان طبیعی یا به زبان ریاضی (بین <code>$...$</code> یا <code>$$...$$</code>) وارد کنید تا <b>KamiMAIS</b> آن را گام به گام حل کند و توضیح دهد.</p>
        <div class="sm:px-6 lg:px-8 p-4 max-w-7xl mx-auto">
            <textarea 
                id="math-solver-input" 
                dir="rtl" oninput="updateLatexPreview()" 
                class="p-3 border border-green-500 focus:outline-none ring-4 ring-green-500 ring-opacity-50 rounded-lg shadow-inner bg-white justify w-full resize-none" 
                rows="4" 
                placeholder="مثال: مشتق تابع f(x) = sin(x^2) را حساب کن. یا: معادله 2x+5=11 را حل کن."></textarea>
        </div>
        <!-- Live LaTeX Preview -->
        <div id="solver-latex-preview" class="p-2 rounded-lg overflow-x-auto sm:px-6 lg:px-8 py-3 p-4 max-w-7xl mx-auto" dir="rtl"></div>
        <!-- Math Palette -->
        <div id="math-solver-palette" class="rounded-lg">
            <div class="solver-palette-tabs flex bg-white-50 justify-around text-xl md:text-2xl text-green-700 sm:px-6 lg:px-8 px-4 max-w-7xl mx-auto">
                <button class="p-2 active" data-palette="basic" title="پایه">★</button>
                <button class="p-2" data-palette="radical" title="توان‌ها">√</button>
                <button class="p-2" data-palette="calculus" title="حسابان">∫∂</button>
                <button class="p-2" data-palette="matrix" title="‌بردارها و ماتریس‌ها">(::)</button>
                <button class="p-2" data-palette="trig" title="مثلثات">sin</button>
                <button class="p-2" data-palette="operators" title="عملگرها">✘✚</button>
                <button class="p-2" data-palette="greeks" title="نمادها و حروف یونانی">αω</button>
                <button class="p-2" data-palette="accents" title="علائم تزئینی و ساختاری">ä</button>
            </div>
            <div class="solver-max-row-2 bg-green-700 solver-shadow-inner transition duration-1000 ease-in-out">
                <div id="solver-palette-content-basic" class="palette-content active sm:px-6 lg:px-8 py-2 p-4 max-w-7xl mx-auto grid-cols-5 md:grid-cols-8 lg:grid-cols-10 gap-1"></div>
                <div id="solver-palette-content-radical" class="palette-content sm:px-6 lg:px-8 py-2 p-4 max-w-7xl mx-auto grid-cols-5 md:grid-cols-8 lg:grid-cols-11 gap-1"></div>
                <div id="solver-palette-content-calculus" class="palette-content sm:px-6 lg:px-8 py-2 p-4 max-w-7xl mx-auto grid-cols-5 md:grid-cols-8 lg:grid-cols-10 gap-1"></div>
                <div id="solver-palette-content-matrix" class="palette-content sm:px-6 lg:px-8 py-2 p-4 max-w-7xl mx-auto grid-cols-4 md:grid-cols-8 lg:grid-cols-9 gap-1"></div>
                <div id="solver-palette-content-trig" class="palette-content sm:px-6 lg:px-8 py-2 p-4 max-w-7xl mx-auto grid-cols-5 md:grid-cols-8 lg:grid-cols-11 gap-1"></div>
                <div id="solver-palette-content-operators" class="palette-content sm:px-6 lg:px-8 py-2 p-4 max-w-7xl mx-auto grid-cols-5 md:grid-cols-12 lg:grid-cols-15 gap-1"></div>
                <div id="solver-palette-content-greeks" class="palette-content sm:px-6 lg:px-8 py-2 p-4 max-w-7xl mx-auto grid-cols-6 md:grid-cols-12 lg:grid-cols-16 gap-1"></div>
                <div id="solver-palette-content-accents" class="palette-content sm:px-6 lg:px-8 py-2 p-4 max-w-7xl mx-auto grid-cols-6 md:grid-cols-12 lg:grid-cols-16 gap-1"></div>
            </div>
        </div>
        <div class="sm:px-6 lg:px-8 py-3 max-w-7xl mx-auto p-4">
            <button onclick="getMathSolution()" class="w-full btn-3d btn-green p-3 mt-4">حل کن</button>
            <div id="math-solver-loading" class="mt-4 text-center hidden">
                <div class="spinner-border animate-spin inline-block w-8 h-8 border-4 border-t-transparent border-green-600 rounded-full" role="status"></div>
            </div>
            <div id="math-solver-result" dir="auto" class="mt-4 p-4 border rounded-lg bg-white text-justify w-full min-h-[100px] shadow">
                <p class="text-gray-500 text-center">پاسخ هوش مصنوعی و مراحل حل مسئله در اینجا نمایش داده خواهد شد...</p>
            </div>
        </div>
    </div>

    <!-- Custom Message Box HTML -->
    <div id="message-box-container" class="message-box-overlay">
        <div class="message-box">
            <h3 id="message-box-title" class="text-xl font-bold mb-4"></h3>
            <p id="message-box-content" class="mb-6"></p>
            <button onclick="hideMessageBox()" class="btn-3d btn-green px-6 py-2">باشه</button>
        </div>
    </div>


    <script>
        // --- Navigation and Page Management ---
        const pageHistory = ['home-page'];
        const pageHeader = document.getElementById('page-header');
        const pageTitle = document.getElementById('page-title');

        function navigateTo(pageId, title = '') {
            const body = document.body;
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            const newPage = document.getElementById(pageId);
            if(newPage) {
                newPage.classList.add('active');
            } else {
                console.error(`Page with ID "${pageId}" not found.`);
                document.getElementById('home-page').classList.add('active'); // Fallback to home
            }

            if (pageId === 'home-page') {
                pageHeader.classList.add('hidden');
                body.classList.remove('bg-astronomy-day-night');
                body.style.backgroundImage = ''; // حذف استایل مستقیم
                document.getElementById('math-solver').classList.add('hidden');
            } else {
                pageHeader.classList.remove('hidden');
                // Handle complex page titles and resets
                if (pageId === 'math-page') {
                    // Reset math page to show button grid
                    document.querySelectorAll('.math-heading').forEach(h => h.classList.remove('hidden'));
                    document.getElementById('math-tool-buttons').classList.remove('hidden');
                    document.getElementById('math-smartTool-buttons').classList.remove('hidden');
                    document.querySelectorAll('.math-tool').forEach(tool => tool.classList.add('hidden'));
                    title = 'ریاضیات'; // Force title to be correct
                };
                if (pageId === 'astronomy-page') {
                    body.classList.add('bg-astronomy-day-night'); // اعمال کلاس ثابت
                    document.getElementById('page-header').classList.add('bg-header');
                    document.getElementById('astronomy-tool-buttons').classList.remove('hidden');
                    document.querySelectorAll('.astronomy-tool').forEach(tool => {
                        tool.classList.add('hidden');
                    });
                    title = '🔭نجوم';
                } else {
                    body.classList.remove('bg-astronomy-day-night');
                    body.style.backgroundImage = ''; // حذف استایل مستقیم
                    document.getElementById('page-header').classList.remove('bg-header');
                };
                if (pageId === 'physics-page') {
                    document.getElementById('physics-tool-buttons').classList.remove('hidden');
                    document.querySelectorAll('.physics-tool').forEach(tool => {
                        tool.classList.add('hidden');
                    });
                    document.querySelectorAll('.physics-branch-tool').forEach(tool => {
                        tool.classList.add('hidden');
                    });
                    document.querySelectorAll('.physics-subbranch-tool').forEach(tool => {
                        tool.classList.add('hidden');
                    });
                    title = '⚛️فیزیک';
                };
                pageTitle.textContent = title;
            }

            if (pageHistory[pageHistory.length - 1] !== pageId) {
                pageHistory.push(pageId);
                pushNewState();
            }
            window.scrollTo(0, 0);
        }

        function goBack() {
            const currentPageId = pageHistory[pageHistory.length - 1];
            // --- Custom Back Logic for Math Page ---
            if (currentPageId === 'math-page') {

                // Check for active Perimeter sub-tool
                const activeperimeterPage = document.querySelector('#shape-perimeter .perimeter-tool-page:not(.hidden)');
                if (activeperimeterPage) {
                    activeperimeterPage.classList.add('hidden');
                    document.getElementById('perimeter-shape-selection').classList.remove('hidden');
                    return; // Stay on math-page, show perimeter selection
                }

                // Check for active Area sub-tool
                const activeAreaPage = document.querySelector('#shape-area .area-tool-page:not(.hidden)');
                if (activeAreaPage) {
                    activeAreaPage.classList.add('hidden');
                    document.getElementById('area-shape-selection').classList.remove('hidden');
                    return; // Stay on math-page, show area selection
                }
                
                // Check for active Volume sub-tool
                const activeVolumePage = document.querySelector('#shape-volume .volume-tool-page:not(.hidden)');
                if (activeVolumePage) {
                    activeVolumePage.classList.add('hidden');
                    document.getElementById('volume-shape-selection').classList.remove('hidden');
                    return; // Stay on math-page, show volume selection
                }

                // Check for active main math tool
                const toolButtons = document.getElementById('math-tool-buttons');
                if (toolButtons.classList.contains('hidden')) {
                    document.querySelectorAll('.math-heading').forEach(h => h.classList.remove('hidden'));
                    document.getElementById('math-smartTool-buttons').classList.remove('hidden');
                    document.getElementById('math-split-border').classList.remove('hidden');
                    toolButtons.classList.remove('hidden');
                    document.querySelectorAll('.math-tool').forEach(tool => tool.classList.add('hidden'));
                    pageTitle.textContent = 'ریاضیات';
                    return; // Stay on math-page, show tool grid
                }
            };
            if (currentPageId === 'astronomy-page') {
                // Check for active main astronomy tool
                const toolButtons = document.getElementById('astronomy-tool-buttons');
                if (toolButtons.classList.contains('hidden')) {
                    toolButtons.classList.remove('hidden');
                    document.querySelectorAll('.astronomy-tool').forEach(tool => tool.classList.add('hidden'));
                    pageTitle.textContent = '🔭نجوم';
                    return; // Stay on astronomy-page, show tool grid
                }
            }

            if (currentPageId === 'physics-page') {

                // Check for active mechanics branch
                const activeMechanicsSubBranchPage = document.querySelector('#mechanics .physics-subbranch-tool:not(.hidden)');
                if (activeMechanicsSubBranchPage) {
                    activeMechanicsSubBranchPage.classList.add('hidden');
                    document.getElementById('physical-mechanics-selection').classList.remove('hidden');
                    document.querySelectorAll('.physical-subbranch-selection-label').forEach(label => label.classList.remove('hidden'));
                    return; // Stay on mechanics-page, show subbranch selection
                }

                // Check for active CPhysQuantity sub-tool
                const activeBranchPage = document.querySelector('#CPhysQuantity .physics-branch-tool:not(.hidden)');
                if (activeBranchPage) {
                    activeBranchPage.classList.add('hidden');
                    document.getElementById('physical-branch-selection').classList.remove('hidden');
                    document.getElementById('physical-branch-selection-label').classList.remove('hidden');
                    return; // Stay on physics-page, show branch selection
                }

                // Check for active main physics tool
                const toolButtons = document.getElementById('physics-tool-buttons');
                if (toolButtons.classList.contains('hidden')) {
                    toolButtons.classList.remove('hidden');
                    document.querySelectorAll('.physics-tool').forEach(tool => tool.classList.add('hidden'));
                    pageTitle.textContent = '⚛️فیزیک';
                    return; // Stay on physics-page, show tool grid
                }
            }

            if (pageHistory.length > 1) {
                pageHistory.pop();
                const previousPageId = pageHistory[pageHistory.length - 1];
                // This is a simplification. A more robust solution would store titles with history.
                const previousPageTitle = document.querySelector(`[onclick*="${previousPageId}"]`)?.textContent || '';
                navigateTo(previousPageId, previousPageTitle); 
            } else {
                navigateTo('home-page');
            }
        }

        // --- Splash Screen & Initializers ---
        window.onload = () => {
            const splashScreen = document.getElementById('splash-screen');
            const mainContainer = document.getElementById('main-container');
            setTimeout(() => {
                splashScreen.style.opacity = '0';
                setTimeout(() => {
                    splashScreen.style.display = 'none';
                    mainContainer.style.opacity = '1';
                    
                    // Render KaTeX for any static math formulas on the page
                    if(window.renderMathInElement) {
                        renderMathInElement(document.body, { delimiters: [{left: '$$', right: '$$', display: true}, {left: '$', right: '$', display: false}] });
                    }
                    if (window.Prism) {
                        Prism.highlightAll();
                    }
                }, 1000); 
            }, 1000); 
	        initializeMathPalette();
            initializeMathSolverPalette()
		    initializeGamesPage();
            initializeLabsPage();
            initializeVennDiagram();
            initializeConverter();
        };

        document.addEventListener('keydown', (event) => {
            // 1. بررسی کلید Escape
            if (event.key === 'Escape') {
                event.preventDefault(); // جلوگیری از رفتار پیش‌فرض (مثل خروج از حالت تمام صفحه)
                goBack();
            } 
            
            // 2. بررسی ترکیب Alt + ArrowLeft
            else if (event.altKey && event.key === 'ArrowLeft') {
                event.preventDefault(); // جلوگیری از رفتار پیش‌فرض (مثل رفتن به صفحه قبلی در مرورگر)
                goBack();
            } else if (event.key === 'BrowserBack') {
                event.preventDefault();
                goBack();
            }
        });

        // ۱. وقتی ابزار یا منوی خاصی باز می‌شود، یک وضعیت جدید به تاریخچه اضافه کن
        function pushNewState() {
            window.history.pushState({ noBackExitsApp: true }, '');
        }

        // ۲. گوش دادن به رویداد بازگشت (هم دکمه فیزیکی گوشی، هم دکمه Back مرورگر)
        window.addEventListener('popstate', (event) => {
            // اگر تابعی برای بازگشت داری، اینجا صدا بزن
            goBack();
        });

        // ۳. اصلاح تابع goBack خودت (اختیاری اما پیشنهادی)
        // بهتر است وقتی دستی دکمه بستن را می‌زنی، تاریخچه را هم پاک کنی تا دکمه برگشت گوشی دو بار عمل نکند
        const originalGoBack = goBack; 
        goBack = function() {
            // اگر هنوز در وضعیت جعلی هستیم، آن را به عقب برگردان
            // این کار برای هماهنگی دکمه ضربدر روی صفحه و دکمه گوشی است
            originalGoBack();
        };


        // --- Event Listener for AI Input Enter Key ---
	function isTouchDevice() {
            return ('ontouchstart' in window) || (navigator.maxTouchPoints > 0) || (navigator.msMaxTouchPoints > 0);
	}

        document.getElementById('ai-input').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
            	if (!isTouchDevice()) {
			if (!event.shiftKey) {
                	event.preventDefault(); // Prevent default action (like form submission)
                	solveWithAI(false);
            		}
            	}
            } else if (event.key === 'Enter' && event.ctrlKey) {
                event.preventDefault(); // Prevent default action (like form submission)
                solveWithAI(false);
            } else {}
            setTimeout(autoResizeTextarea, 0);
        });

        document.getElementById('ai-input').addEventListener('keydown', (event) => {
            if (event.key === 'Enter' && event.ctrlKey) {
                event.preventDefault(); // Prevent default action (like form submission)
                solveWithAI(false);
            } else {}
        });

        // --- Global state for the uploaded file ---
        let attachedFile = null;
        // --- Global state for Text-to-Speech ---
        let ttsAudio = null;
        let ttsState = 'idle'; // idle, loading, playing, paused

        // --- File Attachment & Cancellation Logic ---
        function cancelFile() {
            document.getElementById('file-preview-container').classList.add('hidden');
            document.getElementById('file-input').value = ''; // Clear the file input
            attachedFile = null;
        }
        
        document.getElementById('file-input').addEventListener('change', (event) => {
             const file = event.target.files[0];
             if (file) {
                if (!file.type.startsWith('image/')) {
                    showMessageBox('خطای فایل', 'در حال حاضر فقط فایل‌های تصویری پشتیبانی می‌شوند.');
                    cancelFile();
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    const base64Data = e.target.result.split(',')[1];
                    attachedFile = {
                        mimeType: file.type,
                        data: base64Data
                    };
                    
                    document.getElementById('file-preview-image').src = e.target.result;
                    document.getElementById('file-preview-name').textContent = file.name;
                    document.getElementById('file-preview-container').classList.remove('hidden', 'items-center', 'justify-between', 'p-2', 'bg-gray-100', 'rounded-lg');
                    document.getElementById('file-preview-container').classList.add('flex', 'items-center', 'justify-between', 'p-2', 'bg-gray-100', 'rounded-lg');
                }
                reader.readAsDataURL(file);
             }
        });
        

        // --- Calculator Logic ---
        const calcInputEl = document.getElementById('calc-input');
        const calculatorContainer = document.getElementById('calculator-container');
        const backspaceBtn = document.getElementById('calc-backspace');

        let expression = '0';

        function updateCalculatorDisplay() {
            calcInputEl.textContent = expression;
        }

        function handleCalculatorInput(key) {
            const operators = ['+', '-', '×', '÷'];
            const lastChar = expression.slice(-1);

            if (expression === 'خطا' || expression === 'Infinity') {
                expression = '0';
            }

            if (/\d/.test(key)) { // Digit
                if (expression === '0') {
                    expression = key;
                } else {
                    expression += key;
                }
            } else if (key === '.') { // Decimal
                const parts = expression.replace(/[+\-×÷()]/g, ' ').split(' ');
                const lastPart = parts[parts.length - 1];
                if (lastPart && !lastPart.includes('.')) {
                    expression += '.';
                }
            } else if (key === '(') {
                if (expression === '0') {
                    expression = '(';
                } else if (!isNaN(lastChar) || lastChar === ')') {
                    expression += '×(';
                } else {
                    expression += '(';
                }
            } else if (key === ')') {
                const openParenCount = (expression.match(/\(/g) || []).length;
                const closeParenCount = (expression.match(/\)/g) || []).length;
                if (openParenCount > closeParenCount && !operators.includes(lastChar) && lastChar !== '(') {
                    expression += ')';
                }
            } else if (operators.includes(key)) {
                if (operators.includes(lastChar)) {
                    expression = expression.slice(0, -1) + key;
                } else if (lastChar !== '(') {
                    expression += key;
                }
            } else if (key === 'C') { // Clear
                expression = '0';
            } else if (key === '⌫') { // Backspace
                if (expression.length > 1) {
                    expression = expression.slice(0, -1);
                } else {
                    expression = '0';
                }
            } else if (key === '±') { // Plus/Minus
                // Simple implementation: only works if the expression is a single number
                if (!isNaN(Number(expression))) {
                    expression = String(Number(expression) * -1);
                }
            } else if (key === '=') { // Equals
                if (expression.trim() === '' || operators.includes(lastChar)) return;
                try {
                    let evalExpression = expression.replace(/×/g, '*').replace(/÷/g, '/');
                    const result = new Function('return ' + evalExpression)();
                    expression = String(parseFloat(result.toFixed(10)));
                } catch (error) {
                    console.error("Calculation Error:", error);
                    expression = 'خطا';
                }
            }
            updateCalculatorDisplay();
        }

        calculatorContainer.addEventListener('click', (event) => {
            const button = event.target.closest('button');
            if (!button || button.id === 'calc-backspace') return;
            const key = button.dataset.key || button.textContent.trim();
            handleCalculatorInput(key);
        });

        backspaceBtn.addEventListener('click', () => {
            handleCalculatorInput('⌫');
        });

        document.addEventListener('keydown', (event) => {
            if (!document.getElementById('calculator-page').classList.contains('active')) return;

            let key = event.key;
            let mappedKey = null;

            if (/\d/.test(key) || key === '.') {
                mappedKey = key;
            } else if (['+', '-', '(', ')'].includes(key)) {
                mappedKey = key;
            } else if (key === '*') {
                mappedKey = '×';
            } else if (key === '/') {
                mappedKey = '÷';
            } else if (key === 'Enter' || key === '=') {
                mappedKey = '=';
            } else if (key === 'Backspace') {
                mappedKey = '⌫';
            } else if (key === 'Escape' || key.toLowerCase() === 'c' || event.key === 'Delete') {
                mappedKey = 'C';
            }
            
            if (mappedKey) {
                event.preventDefault();
                const button = document.querySelector(`#calculator-container button[data-key="${mappedKey.replace('×', '*').replace('÷', '/')}"]`);
                 if (button) {
                    button.classList.add('active');
                    setTimeout(() => button.classList.remove('active'), 100);
                 }
                handleCalculatorInput(mappedKey);
            }
        });
        
        document.getElementById('calc-mode-toggle').addEventListener('click', (e) => {
            navigateTo('advanced-calculator-page', 'ماشین حساب پیشرفته');
        });

        // --- Advanced Calculator & KamiAI Logic ---
        function autoResizeTextareaAI() {
            const textarea = document.getElementById('ai-input');
                textarea.style.height = 'auto'
                textarea.style.height = textarea.scrollHeight + 'px';
        }

        const inputElement = document.getElementById('ai-input');

        if (inputElement) {
            inputElement.addEventListener('input', autoResizeTextareaAI);
            autoResizeTextareaAI(); 
        }

        let attachedFileAdvanced = null;
        const advancedCalcInput = document.getElementById('advanced-calc-input');
        const latexPreview = document.getElementById('latex-preview');

        function isPersianChar(ch) {
            if (!ch) return false;
            return /[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF\u200c]/.test(ch);
        }

        function preprocessPersian(input) {
            let out = '';
            let i = 0;
            const n = input.length;
            // stack to track open \text{ ... } blocks and their inner-brace depth
            const textStack = [];

            while (i < n) {
                // detect existing \text{ and copy it verbatim while tracking its depth
                if (input.startsWith('\\text{', i)) {
                    out += '\\text{';
                    i += 6; // skip "\\text{"
                    textStack.push(1); // we've opened one level for this \text{
                    continue;
                }

                const ch = input[i];

                // if we're inside an existing \text{...} block, copy until it's closed
                if (textStack.length > 0) {
                    if (ch === '{') {
                        textStack[textStack.length - 1]++;
                        out += ch;
                        i++;
                        continue;
                    }
                    if (ch === '}') {
                        textStack[textStack.length - 1]--;
                        out += ch;
                        i++;
                        if (textStack[textStack.length - 1] === 0) textStack.pop();
                        continue;
                    }
                    // normal char inside \text{...}
                    out += ch;
                    i++;
                    continue;
                }

                // not inside \text{...}
                // if current char is Persian, collect a run and wrap it
                if (isPersianChar(ch)) {
                    let j = i;
                    let hasPersian = false;
                    // gather until we hit a backslash (macro), a brace, or an ASCII letter (likely latex commands/variables)
                    while (j < n) {
                        const c = input[j];
                        if (c === '\\' || c === '{' || c === '}') break;
                        if (/[A-Za-z]/.test(c)) break;
                        if (isPersianChar(c)) hasPersian = true;
                        j++;
                    }
                    // if we collected something, wrap it; otherwise emit single char
                    if (j > i && hasPersian) {
                        const run = input.slice(i, j);
                        out += '\\text{' + run + '}';
                        i = j;
                        continue;
                    }
                }

                // otherwise copy one character (preserve macros as-is)
                if (ch === '\\') {
                    // copy backslash and following letters (macro name)
                    let k = i + 1;
                    while (k < n && /[A-Za-z]/.test(input[k])) k++;
                    out += input.slice(i, k);
                    i = k;
                    continue;
                }

                out += ch;
                i++;
            }

            return out;
        }

        // Live LaTeX Preview handler
        advancedCalcInput.addEventListener('input', () => {
            const text = advancedCalcInput.value;
            if (text.trim() === '') {
                latexPreview.innerHTML = '';
                return;
            }
            try {
                // Render the text directly. KaTeX will process it.
                katex.render(preprocessPersian(text), latexPreview, {
                    throwOnError: true,
                    displayMode: true
                });
            } catch (error) {
                latexPreview.innerHTML = `<span class="katex-error">${error.message.replace(/KaTeX parse error: /g, '')}</span>`;
            }
        });

        function insertAtCursor(inputElement, textToInsert) {
            const startPos = inputElement.selectionStart;
            const endPos = inputElement.selectionEnd;
            const text = inputElement.value;
            
            let finalInsert = textToInsert.replace(/\{\}/g, '');
            let cursorPos = textToInsert.indexOf('{ }');

            inputElement.value = text.substring(0, startPos) + finalInsert + text.substring(endPos);
            
            if (cursorPos !== -1) {
                const newCursorPos = startPos + cursorPos + 1;
                inputElement.focus();
                inputElement.setSelectionRange(newCursorPos, newCursorPos);
            } else {
                const newCursorPos = startPos + finalInsert.length;
                inputElement.focus();
                inputElement.setSelectionRange(newCursorPos, newCursorPos);
            }
        }

        const mathPalettes = {
            basic: [ { display: '\\frac{\\square}{\\square}', insert: '\\frac{ }{ }', title: "کسر" }, { display: '\\square^\\square', insert: '{ }^{ }', title: "توان" }, { display: '\\sqrt{\\square}', insert: '\\sqrt{ }', title: "رادیکال" }, { display: '\\sqrt[3]{\\square}', insert: '\\sqrt[3]{ }', title: "رادیکال با فُرجۀ 3" }, { display: '\\sqrt[\\square]{\\square}', insert: '\\sqrt[ ]{ }', title: "رادیکال با فرجۀ n" }, { display: '\\frac{d}{d\\square}', insert: '\\frac{d}{d{ }}({ })', title: "مشتق اول" } , { display: '\\frac{d^2}{{d\\square}^2}', insert: '\\frac{d^2}{d{ }^2}({ })', title: "مشتق دوم" } , { display: '\\int{\\square}', insert: '\\int{ }d{ }', title: "انتگرال" }, { display: '\\int_{\\square}^{\\square}', insert: '\\int_{ }^{ } {{ } d{ }}', title: "انتگرال معین" }, { display: '\\sum_{\\square = \\square}^{\\square}', insert: '\\sum_{{ } = { }}^{ } { }', title: "جمع‌زنی" }, { display: '\\lim_{\\square \\to \\square}', insert: '\\lim_{{ } \\to { }}{ }', title: "حد" }, { display: '[\\square, \\square, \\square]', insert: '[{ }, { }, { }]', title: "بردار ردیفی 3×1" }, { display: '\\begin{pmatrix} \\square & \\square \\\\ \\square & \\square \\end{pmatrix}', insert: '\\begin{pmatrix} { } & { } \\\\ { } & { } \\end{pmatrix}', title: "ماتریس 2×2" }, { display: '\\vec{\\square}', insert: '\\vec{ }', title: "بردار" },{ display: '\\stackrel{\\frown}{AB}', insert: '\\stackrel{\\frown}{ }', title: "کمان" },{display: '\\{{\\square} \\}', insert: '\\left\\{{ }\\right\\}', title: "آکولاد" } , { display: '\\boxed{x}', insert: '\\boxed{ }', title: "باکس" }, { display: '\\overbrace{\\square}^{\\square}', insert: '\\overbrace{ }^{ }', title: "آکوبند بالا" } ],
            radical: [ { display: '\\frac{\\square}{\\square}', insert: '\\frac{ }{ }', title: "کسر" } , { display: '\\square^2', insert: '{ }^{2}', title: "مربع (مجذور)" } , { display: '\\square^\\square', insert: '{ }^{ }', title: "توان" } , { display: '\\sqrt{\\square}', insert: '\\sqrt{ }', title: "جذر" }, { display: '\\sqrt[3]{\\square}', insert: '\\sqrt[3]{ }', title: "رادیکال با فرجۀ 3" }, { display: '\\sqrt[n]{\\square}', insert: '\\sqrt[n]{ }', title: "ریشۀ nاُم" }, { display: '\\infty', insert: '\\infty ', title: "بی‌نهایت" }, { display: '-\\infty', insert: '-\\infty ', title: "منفی بی‌نهایت" }, { display: '\\pi', insert: '\\pi ', title: "عدد پی" }, { display: 'e', insert: 'e ', title: "عدد اویلر یا عدد نپر" }, { display: 'e^{\\square}', insert: 'e^{ }', title: "تابع نمایی" }, { display: '\\ln(\\square)', insert: '\\ln()', title: "لگاریتم طبیعی" }, { display: '\\log(\\square)', insert: '\\log()', title: "لگاریتم بر مبنای 10" }, { display: '\\log_{\\square}(\\square)', insert: '\\log_{ }({ })', title: "لگاریتم" }, { display: '|\\square|', insert: '\\left| { } \\right|', title: "قدر مطلق" }, { display: '\\square \\leq \\square', insert: '{ } \\leq { }', title: "کوچکتر یا مساویِ" }, { display: '\\square \\geq \\square', insert: '{ } \\geq { }', title: "بزرگتر یا مساویِ" }, { display: '\\square \\neq \\square', insert: '{ } \\neq { }', title: "نامساویِ" } ],
            calculus: [ { display: '\\frac{d}{d\\square}', insert: '\\frac{d}{d{ }}({ })', title: "مشتق اول" } , { display: '\\frac{d^2}{{d\\square}^2}', insert: '\\frac{d^2}{d{ }^2}({ })', title: "مشتق دوم" } , { display: '\\frac{\\partial}{\\partial\\square}', insert: '\\frac{\\partial}{\\partial{ }}({ })', title: "مشتق جزئی" } , { display: '\\frac{\\partial^2}{{\\partial\\square}^2}', insert: '\\frac{\\partial^2}{\\partial{ }^2}({ })', title: "مشتق جزئی دوم" } , { display: '\\frac{\\partial^2}{\\partial\\square\\partial\\square}', insert: '\\frac{\\partial^2}{\\partial{ }\\partial{ }}({ })', title: "مشتق جزئی مختلط" } , { display: '\\int{\\square}', insert: '\\int{ }d{ }', title: "انتگرال نامعین" }, { display: '\\int_{a}^{b}', insert: '\\int_{ }^{ } {{ } d{ }}', title: "انتگرال معین" }, { display: '\\iint{\\square\\square}', insert: '\\iint{ } d{ } d{ }', title: "انتگرال نامعین دوگانه" } , { display: '\\int_{\\square}^{\\square}\\int_{\\square}^{\\square}', insert: '\\int_{ }^{ }\\int_{ }^{ } {{ } d{ } d{ }}', title: "انتگرال معین دوگانه" } , { display: '\\iiint\\square\\square\\square', insert: '\\int\\int\\int {{ } d{ } d{ } d{ }}', title: "انتگرال نامعین سه‌گانه" } , { display: '\\int_{\\square}^{\\square}\\int_{\\square}^{\\square}\\int_{\\square}^{\\square}', insert: '\\int_{ }^{ }\\int_{ }^{ }\\int_{ }^{ } {{ } d{ } d{ } d{ }}', title: "انتگرال معین سه‌گانه" } , { display: '\\oint_{\\square}\\square', insert: '\\oint_{ }{{ } d{ }}', title: "انتگرال کانتوری (روی مسیر بسته)" }, { display: '\\oiint_{\\square}\\square', insert: '\\oiint_{ }{{ } d{ }}', title: "انتگرال سطحی بسته" } , { display: '\\sum_{\\square = \\square}^{\\square}', insert: '\\sum_{{ } = { }}^{ } { }', title: "جمع‌زنی" }, { display: '\\prod_{\\square = \\square}^{\\square}', insert: '\\prod_{{ } = { }}^{ } { }', title: "حاصل‌ضرب" }, { display: '\\lim_{\\square \\to \\square}', insert: '\\lim_{{ } \\to { }} { }', title: "حد" }, { display: '\\lim_{\\square \\to \\square^-}', insert: '\\lim_{{ } \\to { }^-} { }', title: "حد چپ" }, { display: '\\lim_{\\square \\to \\square^+}', insert: '\\lim_{{ } \\to { }^+} { }', title: "حد راست" }, { display: 'f\'_\+(x)', insert: 'f(x)={ }, f\'_\+(x)=?', title: "مشتق راست" } , { display: 'f\'_\-(x)', insert: 'f(x)={ }, f\'_\-(x)=?', title: "مشتق چپ" }, { display: '\\begin{cases} \\square & \\square \\\\ \\square & \\square \\end{cases}', insert: '\\begin{cases} { } & { } \\\\ { } & { } \\end{cases}', title: "تابع چندضابطه‌ای" }, { display: '\\begin{cases} \\square & \\square \\\\ \\square & \\square \\\\ \\square & \\square \\end{cases}', insert: '\\begin{cases} { } & { } \\\\ { } & { } \\\\ { } & { } \\end{cases}', title: "تابع چندضابطه‌ای" }, { display: '\\mathcal{F}_{\\square}[\\square](\\square)', insert: '\\mathcal{F}_{{ \\text{متغیر اصلی} } \\to { \\text{متغیر تبدیل} }}\\left\\{{ \\text{تابع ورودی} }\\right\\}', title: "تبدیل فوریه" }, { display: '\\mathcal{F}^{-1}_{\\square}[\\square](\\square)', insert: '\\mathcal{F}^{-1}_{{ \\text{متغیر اصلی} } \\to { \\text{متغیر تبدیل} }}\\left\\{{ \\text{تابع ورودی} }\\right\\}', title: "وارون فوریه" }, { display: '\\mathcal{L}_{\\square}[\\square](\\square)', insert: '\\mathcal{L}_{{ \\text{متغیر اصلی} } \\to { \\text{متغیر تبدیل} }}\\left\\{{ \\text{تابع ورودی} }\\right\\}', title: "تبدیل لاپلاس" }, { display: '\\mathcal{L}^{-1}_{\\square}[\\square](\\square)', insert: '\\mathcal{L}^{-1}_{{ \\text{متغیر اصلی} } \\to { \\text{متغیر تبدیل} }}\\left\\{{ \\text{تابع ورودی} }\\right\\}', title: "وارون لاپلاس" } ],
            matrix: [ { display: '[\\square,\\square]', insert: '[{ },{ }]', title: "بردار ردیفی 2×1" }, { display: '[\\square,\\square,\\square]', insert: '[{ },{ },{ }]', title: "بردار ردیفی 3×1" }, { display: '[\\square,\\square,\\square,\\square]', insert: '[{ },{ },{ },{ }]', title: "بردار ردیفی 4×1" }, { display: '\\begin{bmatrix} \\square \\\\ \\square \\end{bmatrix}', insert: '\\begin{bmatrix} { } \\\\ { } \\end{bmatrix}', title: "بردار ستونی 1×2" } , { display: '\\begin{bmatrix} \\square \\\\ \\square \\\\ \\square \\end{bmatrix}', insert: '\\begin{bmatrix} { } \\\\ { } \\\\ { } \\end{bmatrix}', title: "بردار ستونی 1×3" } , { display: '\\begin{bmatrix} \\square \\\\ \\square \\\\ \\square \\\\ \\square \\end{bmatrix}', insert: '\\begin{bmatrix} { } \\\\ { } \\\\ { } \\\\ { } \\end{bmatrix}', title: "بردار ستونی 1×4" } , { display: '\\begin{pmatrix} \\square & \\square \\\\ \\square & \\square \\end{pmatrix}', insert: '\\begin{pmatrix} { } & { } \\\\ { } & { } \\end{pmatrix}', title: "ماتریس 2×2" }, {display: '\\begin{pmatrix} \\square & \\square & \\square \\\\ \\square & \\square & \\square \\end{pmatrix}', insert: '\\begin{pmatrix} { } & { } & { } \\\\ { } & { } & { } \\end{pmatrix}', title: "ماتریس 3×2" } , {display: '\\begin{pmatrix} \\square & \\square \\\\ \\square & \\square \\\\ \\square & \\square \\end{pmatrix}', insert: '\\begin{pmatrix} { } & { } \\\\ { } & { } \\\\ { } & { } \\end{pmatrix}', title: "ماتریس 2×3" } , {display: '\\begin{pmatrix} \\square & \\square & \\square \\\\ \\square & \\square & \\square \\\\ \\square & \\square & \\square \\end{pmatrix}', insert: '\\begin{pmatrix} { } & { } & { } \\\\ { } & { } & { } \\\\ { } & { } & { } \\end{pmatrix}', title: "ماتریس 3×3" },{"display": "\\tiny \\begin{pmatrix} a_{11} & \\cdots & a_{1n} \\\\ \\vdots & \\ddots & \\vdots \\\\ a_{m1} & \\cdots & a_{mn} \\end{pmatrix}","insert": "\\begin{pmatrix} { } & \\cdots & { } \\\\ \\vdots & \\ddots & \\vdots \\\\ { } & \\cdots & { } \\end{pmatrix}", "title": "ماتریس عمومی m×n"},{ "display": "\\det(A)", "insert": "\\det({ })", "title": "دترمینان" },{ "display": "A^{-1}", "insert": "{ }^{-1}", "title": "ماتریس معکوس" },{ "display": "A^{T}", "insert": "{ }^{T}", "title": "ترانَهاده" },{ "display": "\\bar{A}", "insert": "\\bar{ }", "title": "مزدوج مختلط" },{ "display": "A^{\\dagger}", "insert": "{ }^{\\dagger}", "title": "ترانَهادۀ مزدوج" },{ "display": "\\text{adj}(A)", "insert": "\\text{adj}({ })", "title": "ماتریس الحاقی" },{ "display": "\\text{tr}(A)", "insert": "\\text{tr}({ })", "title": "ترِیس ماتریس" },{ "display": "\\text{I}", "insert": "\\text{I}", "title": "ماتریس یکه/ماتریس همانی" },{ "display": "\\lambda", "insert": "\\lambda ", "title": "مقدار ویژه" },{ "display": "\\mathbf{v}", "insert": "\\mathbf{v}", "title": "بردار ویژه" },{ "display": "\\begin{vmatrix} \\square & \\square \\\\ \\square & \\square \\end{vmatrix}", "insert": "\\begin{vmatrix} { } & { } \\\\ { } & { } \\end{vmatrix}", "title": "دترمینان 2×2 (نماد)" } ],
            trig: [ { display: '\\pi', insert: '\\pi', title: "عدد پی" }, { display: '^{\\circ}', insert: '^{\\circ}', title: "درجه" }, { display: '\\text{rad}', insert: '\\text{rad}', title: "رادیان" }, { display: '\\sin \\square', insert: '\\sin({ })', title: "سینوس" }, { display: '\\cos \\square', insert: '\\cos({ })', title: "کسینوس" }, { display: '\\tan \\square', insert: '\\tan({ })', title: "تانژانت" }, { display: '\\sec \\square', insert: '\\sec({ })', title: "سکانت" }, { display: '\\csc \\square', insert: '\\csc({ })', title: "کسکانت" }, { display: '\\cot \\square', insert: '\\cot({ })', title: "کتانژانت" }, { display: '\\sin^{-1} \\square', insert: '\\arcsin({ })', title: "وارون سینوس" }, { display: '\\cos^{-1} \\square', insert: '\\arccos({ })', title: "وارون کسینوس" }, { display: '\\tan^{-1} \\square', insert: '\\arctan({ })', title: "وارون تانژانت" }, { display: '\\sinh \\square', insert: '\\sinh({ })', title: "سینوس هذلولی" }, { display: '\\cosh \\square', insert: '\\cosh({ })', title: "کسینوس هذلولی" }, { display: '\\tanh \\square', insert: '\\tanh({ })', title: "تانژانت هذلولی" }, { display: '\\mathrm{sech} \\square', insert: '\\mathrm{sech}({ })', title: "سکانت هذلولی" }, { display: '\\mathrm{csch} \\square', insert: '\\mathrm{csch}({ })', title: "کسکانت هذلولی" }, { display: '\\coth \\square', insert: '\\coth({ })', title: "کتانژانت هذلولی" }, { display: '\\sinh^{-1} \\square', insert: '\\operatorname{arsinh}({ })', title: "وارون سینوس هذلولی" }, { display: '\\cosh^{-1} \\square', insert: '\\operatorname{arcosh}({ })', title: "وارون کسینوس هذلولی" }, { display: '\\tanh^{-1} \\square', insert: '\\operatorname{artanh}({ })', title: "وارون تانژانت هذلولی" }, { display: '\\text{sech}^{-1} \\text{ } \\square', insert: '\\operatorname{arsech}({ })', title: "وارون سکانت هذلولی" }, { display: '\\text{csch}^{-1} \\text{ } \\square', insert: '\\operatorname{arcsch}({ })', title: "وارون کسکانت هذلولی" }, { display: '\\coth^{-1} \\square', insert: '\\operatorname{arrcoth}({ })', title: "وارون کتانژانت هذلولی" } ],
            operators: [
  { "display": "\\times", "insert": " \\times ", "title": "ضرب [خارجی]" },
  { "display": "\\div", "insert": " \\div ", "title": "تقسیم" },
  { "display": "\\cdot", "insert": " \\cdot ", "title": "ضرب نقطه‌ای)" },
  { "display": "\\forall", "insert": "\\forall ", "title": "برای همه" },
  { "display": "\\exists", "insert": "\\exists ", "title": "وجود دارد" },
  { "display": "\\nexists", "insert": "\\nexists ", "title": "وجود ندارد" },
  { "display": "\\cup", "insert": "\\cup ", "title": "اجتماع" },
  { "display": "\\cap", "insert": "\\cap ", "title": "اشتراک" },
  { "display": "\\subseteq", "insert": " \\subseteq ", "title": "زیرمجموعه (با تساوی)" },
  { "display": "\\supseteq", "insert": "\\supseteq", "title": "فرا مجموعه یا اَبَرمجموعه (با تساوی)" },
  { "display": "\\subset", "insert": "\\subset", "title": "زیرمجموعه محض یا زیرمجموعۀ سِره" },
  { "display": "\\wedge", "insert": "\\wedge ", "title": "عطف (واوِ منطقی، And)" },
  { "display": "\\vee", "insert": "\\vee ", "title": "فصل (یا منطقی، Or)" },
  { "display": "\\parallel", "insert": "\\parallel ", "title": "موازی است با" },
  { "display": "\\perp", "insert": "\\perp ", "title": "عمود است بر" },
  { "display": "\\in", "insert": "\\in ", "title": "عضوی از" },
  { "display": "\\notin", "insert": "\\notin ", "title": "نیست عضوی از" },
  { "display": "\\\\n(A)", "insert": "\\n()", "title": "تعداد اعضای مجموعه" },
  { "display": "\\Biggm|", "insert": "\\Biggm| ", "title": "به طوری که" },
  { "display": "\\mid", "insert": "\\mid ", "title": "عاد می‌کند" },
  { "display": "\\nmid", "insert": "\\nmid ", "title": "عاد نمی‌کند" },
  { "display": "\\rightleftharpoons", "insert": "\\rightleftharpoons ", "title": "تعادل شیمیایی" },
  { "display": "\\to", "insert": "\\to", "title": "حد/تابع به سمت/پیکان" },
  { "display": "\\Rightarrow", "insert": "\\Rightarrow", "title": "پیکان بالا/پایین نویس" },
  { "display": "\\xrightarrow[\\square]{\\square}", "insert": "\\xrightarrow[{ }]{ }", "title": "نتیجه‌گیری / دلالت/آنگاه" },
  { "display": "\\oplus", "insert": "\\oplus ", "title": "جمع در دایره" },
  { "display": "\\otimes", "insert": "\\otimes ", "title": "ضرب در دایره" },
  { "display": "\\odot", "insert": "\\odot ", "title": "نقطه در دایره" },
  { "display": "\\neq", "insert": "\\neq", "title": "نامساوی" },
  { "display": "\\geq", "insert": "\\geq", "title": "بزرگتر مساوی" },
  { "display": "\\leq", "insert": "\\leq", "title": "کوچکتر مساوی" },
  { "display": "\\equiv", "insert": "\\equiv", "title": "همانی/به طور همانی برابر است" },
  { "display": "\\sim", "insert": "\\sim ", "title": "تشابه" },
  { "display": "\\simeq", "insert": "\\simeq ", "title": "تقریباً برابر" },
  { "display": "\\approx", "insert": "\\approx ", "title": "تقریباً مساوی" },
  { "display": "\\cong", "insert": "\\cong ", "title": "هم‌نهشت" },
  { "display": "\\propto", "insert": "\\propto ", "title": "متناسب است با" },
  { "display": "\\therefore", "insert": "\\therefore ", "title": "بنابراین" },
  { "display": "\\because", "insert": "\\because ", "title": "زیرا" }
],
            greeks: [
  { "display": "\\pi", "insert": "\\pi ", "title": "عدد پی" },
  { "display": "^{\\circ}", "insert": "^{\\circ}", "title": "درجه" },
  { "display": "\\infty", "insert": "\\infty ", "title": "بی‌نهایت" },
  { "display": "\\pm", "insert": "\\pm ", "title": "بعلاوه/منهای یا مثبت‌منفی" },
  { "display": "\\emptyset", "insert": "\\emptyset ", "title": "مجموعه تهی" },
  { "display": "\\nabla", "insert": "\\nabla ", "title": "نابلا (دِل)" },
  { "display": "\\Delta", "insert": "\\Delta ", "title": "دلتا بزرگ / تغییرات" },
  { "display": "\\mathbb{N}", "insert": "\\mathbb{N}", "title": "اعداد طبیعی" },
  { "display": "\\mathbb{W}", "insert": "\\mathbb{W}", "title": "اعداد حسابی" },
  { "display": "\\mathbb{Z}", "insert": "\\mathbb{Z}", "title": "اعداد صحیح" },
  { "display": "\\mathbb{Q}", "insert": "\\mathbb{Q}", "title": "اعداد گویا" },
  { "display": "\\mathbb{Q}^c", "insert": "\\mathbb{Q}^c", "title": "اعداد گنگ" },
  { "display": "\\mathbb{R}", "insert": "\\mathbb{R}", "title": "اعداد حقیقی" },
  { "display": "\\mathbb{C}", "insert": "\\mathbb{C}", "title": "اعداد مختلط" },
  { "display": "\\mathbb{P}", "insert": "\\mathbb{P}", "title": "اعداد اول" },
  { "display": "\\alpha", "insert": "\\alpha ", "title": "آلفا" },
  { "display": "\\beta", "insert": "\\beta ", "title": "بتا" },
  { "display": "\\gamma", "insert": "\\gamma ", "title": "گاما (کوچک)" },
  { "display": "\\delta", "insert": "\\delta ", "title": "دلتا (کوچک)" },
  { "display": "\\epsilon", "insert": "\\epsilon ", "title": "اِپسیلون" },
  { "display": "\\varepsilon", "insert": "\\varepsilon ", "title": "اِپسیلون" },
  { "display": "\\zeta", "insert": "\\zeta ", "title": "زِتا" },
  { "display": "\\eta", "insert": "\\eta ", "title": "اِتا" },
  { "display": "\\theta", "insert": "\\theta ", "title": "تِتا" },
  { "display": "\\iota", "insert": "\\iota ", "title": "یوتا" },
  { "display": "\\kappa", "insert": "\\kappa ", "title": "کاپّا" },
  { "display": "\\lambda", "insert": "\\lambda ", "title": "لاندا" },
  { "display": "\\mu", "insert": "\\mu ", "title": "مو (میکرو)" },
  { "display": "\\nu", "insert": "\\nu ", "title": "نو" },
  { "display": "\\xi", "insert": "\\xi ", "title": "کسی" },
  { "display": "\\omicron", "insert": "\\omicron ", "title": "اُمیکرون" },
  { "display": "\\rho", "insert": "\\rho ", "title": "رو" },
  { "display": "\\sigma", "insert": "\\sigma ", "title": "سیگما (کوچک)" },
  { "display": "\\tau", "insert": "\\tau ", "title": "تاو" },
  { "display": "\\upsilon", "insert": "\\upsilon ", "title": "اوپسیلون" },
  { "display": "\\phi", "insert": "\\phi ", "title": "فی" },
  { "display": "\\varphi", "insert": "\\varphi ", "title": "فی" },
  { "display": "\\chi", "insert": "\\chi ", "title": "خی" },
  { "display": "\\psi", "insert": "\\psi ", "title": "پسی" },
  { "display": "\\omega", "insert": "\\omega ", "title": "اومگا (کوچک)" },
  { "display": "\\Gamma", "insert": "\\Gamma ", "title": "گاما (بزرگ)" },
  { "display": "\\Theta", "insert": "\\Theta ", "title": "تِتا (بزرگ)" },
  { "display": "\\Lambda", "insert": "\\Lambda ", "title": "لاندا (بزرگ)" },
  { "display": "\\Xi", "insert": "\\Xi ", "title": "کسی (بزرگ)" },
  { "display": "\\Upsilon", "insert": "\\Upsilon ", "title": "اوپسیلون (بزرگ)" },
  { "display": "\\Phi", "insert": "\\Phi ", "title": "فی (بزرگ)" },
  { "display": "\\Psi", "insert": "\\Psi ", "title": "پسی (بزرگ)" },
  { "display": "\\Omega", "insert": "\\Omega ", "title": "اومگا (بزرگ/اهم)" },
  { "display": "\\mho", "insert": "\\mho ", "title": "زیمِنس یا مهو (رسانایی)" },
  { "display": "\\AA", "insert": "\\AA ", "title": "آنگستروم" },
  { "display": "\\hbar", "insert": "\\hbar ", "title": "اچ‌بار (ثابت پلانک کاهش یافته)" }
],
            accents: [{ display: '\\dot{\\square}', insert: '\\dot{ }', title: "نقطه" }, { display: '\\ddot{\\square}', insert: '\\ddot{ }', title: "دونقطه" }, { display: '\\acute{\\square}', insert: '\\acute{ }', title: "اَکسانتگو" }, { display: '\\grave{\\square}', insert: '\\grave{ }', title: "گراو" }, { display: '\\check{\\square}', insert: '\\check{ }', title: "هاتچک" }, { display: '\\breve{\\square}', insert: '\\breve{ }', title: "بریو" }, { display: '\\tilde{\\square}', insert: '\\tilde{ }', title: "مَدَّک" }, { display: '\\bar{\\square}', insert: '\\bar{ }', title: "بار" }, { display: '\\vec{\\square}', insert: '\\vec{ }', title: "بردار" }, { display: '\\mathbf{A}', insert: '\\mathbf{ }', title: "بردار" } , { display: '\\hat{\\square}', insert: '\\hat{ }', title: "زاویه" },{ display: '\\widehat{\\square}', insert: '\\widehat{ }', title: "کلاه (برآوردگر)" }, { display: '\\overset{\\scriptscriptstyle \\triangle}{\\square}', insert: '\\overset{\\scriptscriptstyle\\triangle}{ }', title: "مثلث" }, { display: '\\overline{\\square}', insert: '\\overline{ }', title: "خط بالا" }, { display: '\\underline{\\square}', insert: '\\underline{ }', title: "خط پایین" }, { display: '\\stackrel{\\frown}{AB}', insert: '\\stackrel{\\frown}{ }', title: "کمان" }, {display: '\\{{\\square} \\}', insert: '\\left\\{{ }\\right\\}', title: "آکولاد" } , { display: '\\boxed{x}', insert: '\\boxed{ }', title: "باکس" }, { display: '\\overbrace{\\square}^{\\square}', insert: '\\overbrace{ }^{ }', title: "آکوبند بالا" }]
        };

        function initializeMathPalette() {
            Object.keys(mathPalettes).forEach(key => {
                const container = document.getElementById(`palette-content-${key}`);
                if(!container) return;
                container.innerHTML = ''; // Clear previous buttons
                const symbols = mathPalettes[key];
                symbols.forEach(symbol => {
                    const btn = document.createElement('button');
                    btn.className = 'btn-3d btn-gray math-symbol-btn relative group';
                    btn.dataset.insert = symbol.insert;
                    if (symbol.title) {
	                    btn.title = symbol.title;
                    }
                    container.appendChild(btn);
                    try {
                        katex.render(symbol.display, btn, { throwOnError: false, displayMode: false });
                    } catch (e) { btn.textContent = symbol.insert; }
                    btn.addEventListener('click', () => insertAtCursor(advancedCalcInput, btn.dataset.insert));
                });
            });

            const tabs = document.querySelectorAll('.palette-tabs button');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    document.querySelectorAll('.palette-content').forEach(c => c.classList.remove('active'));
                    const paletteContent = document.getElementById(`palette-content-${tab.dataset.palette}`);
                    if(paletteContent) {
                        paletteContent.classList.add('active');
                    }
                });
            });
        }
        
        document.getElementById('file-input-advanced').addEventListener('change', (event) => {
            const file = event.target.files[0]; if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                const base64Data = e.target.result.split(',')[1];
                attachedFileAdvanced = { mimeType: file.type, data: base64Data };
                document.getElementById('file-preview-name-advanced').textContent = file.name;
                document.getElementById('file-preview-container-advanced').classList.remove('hidden');
            }
            reader.readAsDataURL(file);
        });

        function cancelFileAdvanced() {
            document.getElementById('file-preview-container-advanced').classList.add('hidden');
            document.getElementById('file-input-advanced').value = '';
            attachedFileAdvanced = null;
        }

        advancedCalcInput.addEventListener('keydown', (event) => { if (event.key === 'Enter') { event.preventDefault(); solveWithAI(true); } });
        
        async function solveWithAI(isAdvanced = false) {
            
            const inputElement = document.getElementById(isAdvanced ? 'advanced-calc-input' : 'ai-input');
            const outputElement = document.getElementById(isAdvanced ? 'kami-output' : 'ai-output');
            const plotContainer = document.getElementById('plot-container');
            let userQuery = inputElement.value;
            
            if (!isAdvanced) {
                stopTTS(); 
                document.getElementById('ai-controls').classList.add('hidden');
            } else {
                plotContainer.classList.add('hidden');
                plotContainer.innerHTML = '';
            }

            const currentFile = isAdvanced ? attachedFileAdvanced : attachedFile;
            if (!userQuery.trim() && !currentFile) {
                showMessageBox('ورودی خالی', 'لطفاً یک سوال بنویسید یا یک فایل ضمیمه کنید.');
                return;
            }
            if (currentFile && !userQuery.trim()) { 
                userQuery = isAdvanced 
                    ? "این تصویر را به طور کامل توصیف کن و اگر مسئله ریاضی در آن است، آن را حل کن."
                    : "این تصویر را به طور کامل توصیف کن.";
            }

            const requestData = {
                message: userQuery,
                isAdvanced: isAdvanced, // اگر می‌خواهی سرور بداند در کدام بخش هستی
                fileData: currentFile ? currentFile.data : null,
                mimeType: currentFile ? currentFile.mimeType : null
            };

            outputElement.innerHTML = `<div class="flex justify-center items-center p-4"><svg class="animate-spin h-8 w-8 text-green-700" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg></div>`;

            try {
                const serverUrl = "https://e2u4ss1st4nt.onrender.com/chat";

                const response = await fetch(serverUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestData)
                });

                if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.error?.message || `HTTP error! status: ${response.status}`); }
                const result = await response.json();
                const candidate = result.candidates?.[0];

                if (isAdvanced) cancelFileAdvanced(); else cancelFile();
                
                if (candidate && candidate.content?.parts?.[0]?.text) {
                    let rawText = candidate.content.parts[0].text;
                    
                    if(isAdvanced) {
                        const plotMatch = rawText.match(/<plot>fn:\s*(.*?)<\/plot>/);
                        if (plotMatch && plotMatch[1]) {
                            plotContainer.classList.remove('hidden');
                            const targetElement = document.getElementById('plot-container');
                            
                            const rect = targetElement.getBoundingClientRect();
                            const plotWidth = rect.width;
                            const plotHeight = rect.height > 0 ? rect.height : 400; // خواندن ارتفاع یا پیش فرض 400
                            const isDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                            const plotColor = isDarkMode ? '#4ade80' : '#15803d'; // #4ade80 برای Dark Mode (روشن) و #15803d برای Light Mode (تیره)
                            try {
                                // function-plot uses '^' for exponents. The model is now instructed to use '^'.
                                // We replace any '**' with '^' as a safeguard in case the model makes a mistake.
                                let fnString = plotMatch[1].replace(/\*\*/g, '^').replace('pi', 'PI').replace('arc', 'a').replace('ar', 'a');

                                functionPlot({
                                    target: '#plot-container',
                                    width: plotWidth + 20,
                                    height: plotHeight,
                                    data: [{ fn: fnString, color: plotColor }],
                                    grid: true,
                                    tip: { xLine: true, yLine: true },
                                });
                            } catch (e) {
                                console.error("Plotting Error:", e);
                                plotContainer.innerHTML = `<p class="text-red-500 text-center">خطا در رسم نمودار.</p>`;
                            }
                            rawText = rawText.replace(/<plot>.*?<\/plot>/s, '');
                        }
                    }

                    outputElement.innerHTML = parseAndStyleResponse(rawText);
                    
                    if (!isAdvanced) { document.getElementById('ai-controls').classList.remove('hidden'); }
                    if (window.renderMathInElement) { renderMathInElement(outputElement, { delimiters: [{left: '$$', right: '$$', display: true}, {left: '$', right: '$', display: false}] }); }
                    if (window.Prism) { Prism.highlightAll(); }

                } else { throw new Error('پاسخ معتبری از هوش مصنوعی دریافت نشد.'); }
            } catch (error) {
                console.error('AI Error:', error);
                if (error instanceof TypeError && error.message.includes('Failed to fetch')) { showMessageBox('خطای اتصال', 'لطفا VPN خود را روشن کنید.'); } 
                else { showMessageBox('خطای API', `متاسفانه خطایی در ارتباط با هوش مصنوعی رخ داد. (${error.message})`); }
                outputElement.innerHTML = `<p class="text-red-500 text-center">خطا در دریافت پاسخ.</p>`;
                if (isAdvanced) cancelFileAdvanced(); else cancelFile();
            }
        }
        
        async function fetchWithRetry(url, options, retries = 3, delay = 1000) {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.status !== 429 && response.status < 500) {
                        return response;
                    }
                    // Don't log retry attempts to console
                } catch (error) {
                    if (i === retries - 1) throw error;
                }
                await new Promise(res => setTimeout(res, delay * (i + 1)));
            }
        }

        // --- Text-to-Speech (TTS) Logic ---

        function updateTtsButton(state) {
            const icons = { play: document.getElementById('tts-icon-play'), loading: document.getElementById('tts-icon-loading'), pause: document.getElementById('tts-icon-pause') };
            Object.values(icons).forEach(icon => icon.classList.add('hidden'));
            if (state === 'loading') icons.loading.classList.remove('hidden');
            else if (state === 'playing') icons.pause.classList.remove('hidden');
            else icons.play.classList.remove('hidden');
            ttsState = state;
        }

        function stopTTS() { if (ttsAudio) { ttsAudio.pause(); ttsAudio = null; } updateTtsButton('idle'); }

        async function playTTS() {
            if (ttsState === 'loading') return;
            if (ttsState === 'playing') { ttsAudio.pause(); updateTtsButton('paused'); return; }
            if (ttsState === 'paused') { ttsAudio.play(); updateTtsButton('playing'); return; }
            
            const textToSpeak = document.getElementById('ai-output').textContent;
            if (!textToSpeak.trim()) return;
            
            updateTtsButton('loading');

            const ttsUrl = "https://e2u4ss1st4nt.onrender.com/tts";

            try {
                const response = await fetch(ttsUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: textToSpeak })
                });
                if (!response.ok) throw new Error(`TTS API Error: ${response.statusText}`);
                const result = await response.json();
                const audioData = result?.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data;
                const mimeType = result?.candidates?.[0]?.content?.parts?.[0]?.inlineData?.mimeType;

                if (!audioData || !mimeType.startsWith("audio/")) { throw new Error('داده صوتی معتبری دریافت نشد.'); }
                
                const sampleRate = parseInt(mimeType.match(/rate=(\d+)/)?.[1] || "24000", 10);
                const pcmData = base64ToArrayBuffer(audioData);
                const wavBlob = pcmToWav(new Int16Array(pcmData), sampleRate);
                ttsAudio = new Audio(URL.createObjectURL(wavBlob));
                ttsAudio.play();
                updateTtsButton('playing');
                ttsAudio.onended = () => updateTtsButton('idle');

            } catch(error) {
                console.error("TTS Error:", error);
                showMessageBox('خطای صدا', 'متاسفانه امکان پخش صدا وجود ندارد.');
                updateTtsButton('idle');
            }
        }

        function base64ToArrayBuffer(base64) { const bs = window.atob(base64); const len = bs.length; const bytes = new Uint8Array(len); for (let i = 0; i < len; i++) { bytes[i] = bs.charCodeAt(i); } return bytes.buffer; }
        function pcmToWav(pcmData, sampleRate) {
            const buffer = new ArrayBuffer(44 + pcmData.length * 2);
            const view = new DataView(buffer);
            const writeString = (offset, str) => { for (let i = 0; i < str.length; i++) view.setUint8(offset + i, str.charCodeAt(i)); };
            writeString(0, 'RIFF'); view.setUint32(4, 36 + pcmData.length * 2, true); writeString(8, 'WAVE');
            writeString(12, 'fmt '); view.setUint32(16, 16, true); view.setUint16(20, 1, true);
            view.setUint16(22, 1, true); view.setUint32(24, sampleRate, true); view.setUint32(28, sampleRate * 2, true);
            view.setUint16(32, 2, true); view.setUint16(34, 16, true); writeString(36, 'data');
            view.setUint32(40, pcmData.length * 2, true);
            for (let i = 0; i < pcmData.length; i++) { view.setInt16(44 + i * 2, pcmData[i], true); }
            return new Blob([view], { type: 'audio/wav' });
        }

        /**
        * کپی کردن متن پاسخ هوش مصنوعی (innerText) در کلیپ بورد.
        * از Fallback (ایجاد TextArea موقت) برای سازگاری در دستگاه‌های موبایل استفاده می‌کند.
        */
        function copyAiResponse() {
            const outputDiv = document.getElementById('ai-output');
            // استفاده از innerText برای گرفتن متن خالص بدون HTML
            const responseText = outputDiv.innerText;

            // --- تابع کمکی Fallback برای کپی کردن ---
            function fallbackCopy(text) {
                let success = false;
                try {
                    // 1. ایجاد یک textarea موقت و پنهان
                    const textarea = document.createElement('textarea');
                    textarea.value = text;
                    
                    // پنهان کردن textarea و جلوگیری از اسکرول صفحه
                    textarea.style.position = 'fixed'; 
                    textarea.style.top = '0';
                    textarea.style.left = '0';
                    textarea.style.opacity = '0'; // کاملا مخفی
                    
                    document.body.appendChild(textarea);
                    
                    // 2. انتخاب و اجرای دستور کپی
                    textarea.focus();
                    textarea.select();
                    
                    // document.execCommand('copy') - روش قدیمی اما سازگار با موبایل‌ها
                    success = document.execCommand('copy'); 
                    
                    document.body.removeChild(textarea);

                } catch (err) {
                    console.error('Fallback copy failed:', err);
                    success = false;
                }
                
                return success;
            }

            // --- اجرای منطق اصلی کپی ---

            // 1. اگر API مدرن در دسترس است، آن را امتحان کن
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(responseText).then(() => {	
                    console.log("متن پاسخ با موفقیت کپی شد (مدرن).");
                    showMessageBox("کپی شد!", "پاسخ با موفقیت کپی شد.");
                }).catch(err => {
                    console.warn('Modern clipboard failed. Trying fallback...', err);
                    // 2. اگر روش مدرن شکست خورد، از Fallback استفاده کن
                    const success = fallbackCopy(responseText);
                    
                    if (success) {
                        console.log("متن پاسخ با موفقیت کپی شد (Fallback).");
                        showMessageBox("کپی شد!", "پاسخ با موفقیت کپی شد.");
                    } else {
                        console.error('خطا در کپی کردن متن:', err);
                        showMessageBox("خـطا!", "خطا در کپی کردن متن!");
                    }
                });
            } else {
                // 3. اگر navigator.clipboard وجود ندارد، مستقیماً Fallback را اجرا کن
                const success = fallbackCopy(responseText);
                
                if (success) {
                    console.log("متن پاسخ با موفقیت کپی شد (Fallback مستقیم).");
                    showMessageBox("کپی شد!", "پاسخ با موفقیت کپی شد.");
                } else {
                    console.error('خطا در کپی کردن متن: navigator.clipboard در دسترس نیست.');
                    showMessageBox("خـطا!", "خطا در کپی کردن متن!");
                }
            }
        }

        //<!-- Unit Converter Logic -->
        
        const unitData = {
            // Base: Meter (متر)
            "طول": {
                "متر (m)": 1,
                "کیلومتر (km)": 1000,
                "سانتی‌متر (cm)": 0.01,
                "میلی‌متر (mm)": 0.001,
                "اینچ (in)": 0.0254,
                "فوت (ft)": 0.3048,
                "مایل (mi)": 1609.344,
                "یارد (yd)": 0.9144,
            },
            // Base: Square Meter (متر مربع)
            "مساحت": {
                "متر مربع (m²)": 1,
                "کیلومتر مربع (km²)": 1000000,
                "سانتی‌متر مربع (cm²)": 0.0001,
                "هکتار (ha)": 10000,
                "جریب (acre)": 4046.86,
                "فوت مربع (ft²)": 0.092903,
            },
            // Base: Cubic Meter (متر مکعب)
            "حجم": {
                "متر مکعب (m³)": 1,
                "لیتر (L)": 0.001,
                "میلی‌لیتر (mL)": 0.000001,
                "گالن آمریکایی (US gal)": 0.00378541,
                "فوت مکعب (ft³)": 0.0283168,
            },
            // Base: Kilogram (کیلوگرم)
            "جرم": {
                "کیلوگرم (kg)": 1,
                "گرم (g)": 0.001,
                "میلی‌گرم (mg)": 0.000001,
                "تن (tonne)": 1000,
                "اونس (oz)": 0.0283495,
                "پوند (lb)": 0.453592,
            },
            // Base: Second (ثانیه)
            "زمان": {
                "ثانیه (s)": 1,
                "دقیقه (min)": 60,
                "ساعت (h)": 3600,
                "روز (day)": 86400,
                "هفته (week)": 604800,
                "ماه (month)": 2629800,
                "سال (year)": 31557600, // سال زمینی تقریبی
            },
            // Base: Joule (J)
            "انرژی": {
                "ژول (J)": 1,
                "کیلوژول (kJ)": 1000,
                "کالری (cal)": 4.184,
                "کیلوکالری (kcal)": 4184,
                "وات ساعت (Wh)": 3600,
                "الکترون ولت (eV)": 1.60218e-19,
            },
            // Base: Kelvin (K) - غیر خطی
            "دما": {
                // toBase: مقدار ورودی به کلوین, fromBase: کلوین به واحد مقصد
                "سلسیوس (°C)": { toBase: v => v + 273.15, fromBase: v => v - 273.15 },
                "فارنهایت (°F)": { toBase: v => (v - 32) * 5 / 9 + 273.15, fromBase: v => (v - 273.15) * 9 / 5 + 32 },
                "کلوین (K)": { toBase: v => v, fromBase: v => v }
            },
            // Base: Radian (rad)
            "زاویه": {
                "رادیان (rad)": 1,
                "درجه (deg)": Math.PI / 180,
                "گراد (grad)": Math.PI / 200,
            },
            // Base: Meter/Second (متر بر ثانیه)
            "سرعت": {
                "متر بر ثانیه (m/s)": 1,
                "کیلومتر بر ساعت (km/h)": 1 / 3.6,
                "مایل بر ساعت (mph)": 0.44704,
                "فوت بر ثانیه (ft/s)": 0.3048,
                "گره (knot)": 0.514444,
            },
            // Base: Byte (B)
            "داده": {
                "بیت (b)": 0.125,
                "بایت (B)": 1,
                "کیلوبایت (KB)": 1024, // 1024^1
                "مگابایت (MB)": 1048576, // 1024^2
                "گیگابایت (GB)": 1073741824, // 1024^3
                "ترابایت (TB)": 1099511627776, // 1024^4
            },
            // Base: Coulomb (C)
            "بار الکتریکی": {
                "کولن (C)": 1,
                "میکروکولن (µC)": 0.000001,
                "آمپر ساعت (Ah)": 3600,
                "الکترون (e)": 1.602176634e-19, // بار بنیادی
            },
            // Base: Tesla (T)
            "میدان مغناطیسی": {
                "تسلا (T)": 1,
                "گاوس (G)": 1e-4,
                "میکروتـسلا (µT)": 1e-6,
                "وبر بر متر مربع (Wb/m²)": 1, // تعریف تسلا
            }
        };

        // المان‌های DOM
        const tabsContainer = document.getElementById('converter-tabs');
        const contentWrapper = document.getElementById('conversion-content-wrapper');
        const errorMessage = document.getElementById('error-message');

        let currentTabId = 'con-length';

        const conversionTemplate = `
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 p-4 md:p-8 rounded-xl">
                
                <!-- تبدیل از واحد (Source) -->
                <div class="space-y-3 p-4 bg-white rounded-lg border border-indigo-200 shadow-md">
                    <label class="block text-sm font-bold text-gray-500">تبدیل از:</label>
                    <!-- Custom Select for Source Unit -->
                    <div class="relative custom-select-container" data-side="source">
                        <button type="button" id="source-unit-trigger" data-unit="" 
                                class="custom-select-trigger w-full flex justify-between items-center border border-indigo-300 rounded-xl p-4 text-xl font-extrabold text-indigo-800 shadow-md hover:bg-indigo-100 transition duration-150 focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50"
                                onclick="toggleDropdown(this)">
                            <span id="source-unit-label">انتخاب واحد</span>
                            <!-- Inline SVG Chevron Down Icon -->
                            <svg class="w-6 h-6 text-indigo-600 transition-transform transform rotate-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div id="source-unit-options" 
                            class="custom-select-options absolute z-20 w-full mt-2 bg-white border border-gray-200 rounded-xl shadow-2xl max-h-60 overflow-y-auto hidden dropdown-open">
                        </div>
                    </div>
                    <input type="number" inputmode="numeric" id="source-value" class="converter-input p-2 w-full text-center text-indigo-800 text-2xl rounded-lg bg-white focus:ring-indigo-500" placeholder="مقدار را وارد کنید" oninput="convert('source')" dir="ltr">
                </div>

                <!-- تبدیل به واحد (Target) -->
                <div class="space-y-3 p-4 bg-white rounded-lg border border-emerald-200 shadow-md">
                    <label class="block text-sm font-bold text-gray-500">تبدیل به:</label>
                    <!-- Custom Select for Target Unit -->
                    <div class="relative custom-select-container" data-side="target">
                        <button type="button" id="target-unit-trigger" data-unit="" 
                                class="custom-select-trigger w-full flex justify-between items-center border border-emerald-300 rounded-xl p-4 text-xl font-extrabold text-emerald-800 shadow-md hover:bg-emerald-100 transition duration-150 focus:outline-none focus:ring-4 focus:ring-emerald-500 focus:ring-opacity-50"
                                onclick="toggleDropdown(this)">
                            <span id="target-unit-label">انتخاب واحد</span>
                            <!-- Inline SVG Chevron Down Icon -->
                            <svg class="w-6 h-6 text-emerald-600 transition-transform transform rotate-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div id="target-unit-options" 
                            class="custom-select-options absolute z-20 w-full mt-2 bg-white border border-gray-200 rounded-xl shadow-2xl max-h-60 overflow-y-auto hidden dropdown-open">
                        </div>
                    </div>
                    <input type="number" inputmode="numeric" id="target-value" class="converter-input w-full p-2 text-center text-2xl rounded-lg bg-white text-emerald-800 font-extrabold focus:ring-emerald-700" placeholder="نتیجه تبدیل" readonly dir="rtl">
                </div>
            </div>
            <div class="mt-2 text-center text-xs text-gray-500 p-2">
                با وارد کردن عدد در هر یک از کادرها، تبدیل معکوس به صورت خودکار انجام می‌شود.
            </div>
        `;

        function toggleDropdown(triggerElement) {
            const optionsList = triggerElement.nextElementSibling;
            const chevron = triggerElement.querySelector('svg');
            
            // بستن تمام لیست‌های باز به جز لیست فعلی
            document.querySelectorAll('.custom-select-options').forEach(list => {
                if (list !== optionsList) {
                    list.classList.add('hidden');
                    list.previousElementSibling.querySelector('svg').classList.remove('rotate-180');
                }
            });

            // باز و بسته کردن لیست فعلی
            optionsList.classList.toggle('hidden');
            chevron.classList.toggle('rotate-180');
        }

        /**
         * انتخاب واحد از لیست گزینه‌ها
         * @param {HTMLElement} optionElement گزینه‌ای که کلیک شده است
         */
        function selectUnit(optionElement) {
            const selectedUnit = optionElement.getAttribute('data-unit');
            const side = optionElement.closest('.custom-select-container').getAttribute('data-side');
            
            const trigger = document.querySelector(`#${currentTabId} #${side}-unit-trigger`);
            const label = document.querySelector(`#${currentTabId} #${side}-unit-label`);
            const optionsList = optionElement.closest('.custom-select-options');
            
            // به‌روزرسانی مقدار دکمه و لیبل
            trigger.setAttribute('data-unit', selectedUnit);
            label.textContent = selectedUnit;

            // به‌روزرسانی کلاس‌ها
            optionsList.querySelectorAll('.custom-option').forEach(opt => opt.classList.remove('selected'));
            optionElement.classList.add('selected');

            // بستن لیست
            optionsList.classList.add('hidden');
            trigger.querySelector('svg').classList.remove('rotate-180');

            // انجام تبدیل
            if (side === 'source') {
                convert('source');
            } else {
                convert('target'); // تبدیل معکوس برای به‌روزرسانی مقدار سورس
            }
        }
        
        // بستن دراپ‌داون‌ها هنگام کلیک در خارج از آن‌ها
        document.addEventListener('click', (event) => {
            const isSelect = event.target.closest('.custom-select-container');
            if (!isSelect) {
                document.querySelectorAll('.custom-select-options').forEach(list => {
                    list.classList.add('hidden');
                    list.previousElementSibling.querySelector('svg').classList.remove('rotate-180');
                });
            }
        });

        function switchTab(tabId, quantityKey) {
            currentTabId = tabId;
            
            // 1. به روز رسانی استایل تب‌ها
            document.querySelectorAll('.converter-tab-btn').forEach(btn => {
                btn.classList.remove('tab-active', 'text-green-600', 'border-green-600');
                btn.classList.add('text-gray-500', 'border-transparent');
                
                if (btn.getAttribute('data-target') === tabId) {
                    btn.classList.add('tab-active', 'text-green-600', 'border-green-600');
                    btn.classList.remove('text-gray-500', 'border-transparent');
                }
            });

            // 2. نمایش محتوای تب فعال و پنهان کردن بقیه
            document.querySelectorAll('.con-tab-content').forEach(content => {
                content.classList.add('hidden');
                if (content.id === tabId) {
                    content.classList.remove('hidden');
                    // اگر محتوای تب خالی است، الگو را اضافه کنید.
                    if (content.innerHTML === '') {
                        content.innerHTML = conversionTemplate;
                    }
                }
            });

            // 3. پر کردن لیست‌های انتخابی واحدها
            populateUnitSelects(quantityKey, tabId);

            // 4. اطمینان از پاک شدن و انجام تبدیل اولیه (0 به 0)
            const sourceValueInput = document.querySelector(`#${tabId} #source-value`);
            const targetValueInput = document.querySelector(`#${tabId} #target-value`);

            if (sourceValueInput) sourceValueInput.value = '';
            if (targetValueInput) targetValueInput.value = '';
            
            errorMessage.classList.add('hidden');
            convert('source');
        }

        function populateUnitSelects(quantityKey, tabId) {
            const units = Object.keys(unitData[quantityKey]);
            const sourceOptionsDiv = document.querySelector(`#${tabId} #source-unit-options`);
            const targetOptionsDiv = document.querySelector(`#${tabId} #target-unit-options`);
            
            const sourceTrigger = document.querySelector(`#${tabId} #source-unit-trigger`);
            const targetTrigger = document.querySelector(`#${tabId} #target-unit-trigger`);

            // اگر المان‌ها پیدا نشدند، متوقف شو
            if (!sourceOptionsDiv || !targetOptionsDiv) return;

            // پاک کردن گزینه‌های قبلی
            sourceOptionsDiv.innerHTML = '';
            targetOptionsDiv.innerHTML = '';
            
            units.forEach((unit, index) => {
                const optionHtml = `<div class="custom-option cursor-pointer p-3 border-b border-gray-100 last:border-b-0 text-lg text-gray-500 hover:text-indigo-800 transition duration-100" data-unit="${unit}" onclick="selectUnit(this)">${unit}</div>`;
                sourceOptionsDiv.innerHTML += optionHtml;
                targetOptionsDiv.innerHTML += optionHtml;

                // تنظیم پیش‌فرض هنگام ساخت
                if (index === 0) {
                    sourceTrigger.setAttribute('data-unit', unit);
                    document.querySelector(`#${tabId} #source-unit-label`).textContent = unit;
                }
                if (index === 1) {
                    targetTrigger.setAttribute('data-unit', unit);
                    document.querySelector(`#${tabId} #target-unit-label`).textContent = unit;
                } else if (units.length === 1 && index === 0) {
                    // اگر فقط یک واحد باشد، هر دو را یکی قرار می‌دهد
                    targetTrigger.setAttribute('data-unit', unit);
                    document.querySelector(`#${tabId} #target-unit-label`).textContent = unit;
                }
            });
            
            // کلاس selected را برای واحدهای پیش‌فرض اعمال کنید (بعد از پر شدن)
            sourceOptionsDiv.querySelector(`[data-unit="${sourceTrigger.getAttribute('data-unit')}"]`).classList.add('selected');
            targetOptionsDiv.querySelector(`[data-unit="${targetTrigger.getAttribute('data-unit')}"]`).classList.add('selected');
        }

        function convert(origin) {
            errorMessage.classList.add('hidden');
            
            // یافتن المان‌های مربوط به تب فعال
            const tabId = currentTabId;
            const sourceTrigger = document.querySelector(`#${tabId} #source-unit-trigger`);
            const targetTrigger = document.querySelector(`#${tabId} #target-unit-trigger`);
            const sourceValueInput = document.querySelector(`#${tabId} #source-value`);
            const targetValueInput = document.querySelector(`#${tabId} #target-value`);

            // اگر المان‌ها پیدا نشدند یا مقادیر واحد ست نشده‌اند
            if (!sourceTrigger || !targetTrigger || !sourceTrigger.getAttribute('data-unit')) return;

            let sourceUnit, targetUnit, value;
            
            if (origin === 'source') {
                value = parseFloat(sourceValueInput.value);
                sourceUnit = sourceTrigger.getAttribute('data-unit');
                targetUnit = targetTrigger.getAttribute('data-unit');
            } else { // origin === 'target' (تبدیل معکوس)
                value = parseFloat(targetValueInput.value);
                sourceUnit = targetTrigger.getAttribute('data-unit');
                targetUnit = sourceTrigger.getAttribute('data-unit');
            }

            // اگر ورودی عدد نیست، خروجی را پاک کنید و در صورت نیاز پیغام خطا دهید
            if (isNaN(value)) {
                if (sourceValueInput.value !== '' || targetValueInput.value !== '') {
                     errorMessage.classList.remove('hidden');
                }
                if (origin === 'source') {
                    targetValueInput.value = '';
                } else {
                    sourceValueInput.value = '';
                }
                return;
            }
            
            let targetValue;
            const quantityKey = document.querySelector(`[data-target="${tabId}"]`).getAttribute('data-quantity-key');
            const units = unitData[quantityKey];

            try {
                if (quantityKey === "دما") {
                    // تبدیل دمای غیرخطی (از واحد مبدأ به کلوین، سپس از کلوین به واحد مقصد)
                    const sourceConversion = units[sourceUnit];
                    const targetConversion = units[targetUnit];

                    const valueInBase = sourceConversion.toBase(value);
                    targetValue = targetConversion.fromBase(valueInBase);

                } else {
                    // تبدیل خطی (ضربی)
                    const sourceFactor = units[sourceUnit];
                    const targetFactor = units[targetUnit];

                    const valueInBase = value * sourceFactor;
                    targetValue = valueInBase / targetFactor;
                }

                // نمایش نتیجه با حداکثر ۱۲ رقم دقت و حذف صفرهای انتهایی
                // toPrecision(12) دقت را حفظ می‌کند، سپس parseFloat تبدیل به عدد می‌کند و صفرهای اضافی را حذف می‌کند.
                const displayValue = parseFloat(targetValue.toPrecision(12));
                
                if (origin === 'source') {
                    targetValueInput.value = displayValue.toLocaleString('en-US', {useGrouping: false});
                } else {
                    sourceValueInput.value = displayValue.toLocaleString('en-US', {useGrouping: false});
                }

            } catch (error) {
                console.error("خطا در محاسبه تبدیل:", error);
                if (origin === 'source') {
                    targetValueInput.value = 'خطای محاسبه';
                } else {
                    sourceValueInput.value = 'خطای محاسبه';
                }
            }
        }

        /**
         * مقداردهی اولیه برنامه
         */
        function initializeConverter() {
            // اضافه کردن شنونده رویداد به دکمه‌های تب
            const tabButtons = document.querySelectorAll('.converter-tab-btn');
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const tabId = button.getAttribute('data-target');
                    const quantityKey = button.getAttribute('data-quantity-key');
                    switchTab(tabId, quantityKey);
                });
            });

            // فعال کردن تب اول به صورت پیش‌فرض (طول)
            const firstTab = tabButtons[0];
            const initialTabId = firstTab.getAttribute('data-target');
            const initialQuantityKey = firstTab.getAttribute('data-quantity-key');
            
            // تنظیم کلاس فعال برای اولین تب قبل از switchTab
            firstTab.classList.add('tab-active', 'text-green-600', 'border-green-600');
            firstTab.classList.remove('text-gray-500', 'border-transparent');
            
            switchTab(initialTabId, initialQuantityKey);
        }

        // --- Smart Unit Converter ---
        function autoResizeTextarea() {
            const textarea = document.getElementById('converter-input');
                textarea.style.height = textarea.scrollHeight + 'px';
        }

        const textarea = document.getElementById('converter-input');

        if (true) {
            textarea.addEventListener('input', autoResizeTextarea);
            autoResizeTextarea(); 
        }
        async function convertWithAI() {
            const inputEl = document.getElementById('converter-input');
            const outputEl = document.getElementById('converter-output');
            const loadingEl = document.getElementById('converter-loading');
            const userQuery = inputEl.value;

            if (!userQuery.trim()) {
                showMessageBox('ورودی خالی', 'لطفاً درخواست تبدیل خود را وارد کنید.');
                return;
            }

            loadingEl.classList.remove('hidden');
            outputEl.classList.add('hidden');

            const convertUrl = "https://e2u4ss1st4nt.onrender.com/convert";

            try {
                const response = await fetch(convertUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: userQuery })
                });
                if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.error?.message || `HTTP error! status: ${response.status}`); }
                const result = await response.json();
                const candidate = result.candidates?.[0];

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    let rawText = candidate.content.parts[0].text;
                    rawText = rawText
                        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                        .replace(/`([^`\n]+)`/g, '<code>$1</code>')
                        .replace(/^### (.*$)/gm, '<h3 class="text-xl font-bold my-3 text-right">$1</h3>')
                        .replace(/```(\S*)\n([\s\S]*?)```/g, '<code>$1\n$2</code>');
                    const lines = rawText.split('\n');
                    const firstLine = lines.shift() || "";
                    const remainingText = lines.join('\n').replace(/\n/g, '<br>');
                    const styledOutput = `<div class="text-xl text-black-700 text-center mb-1">${firstLine}</div>
        		    <div dir="auto" class="justify text-black-700">${remainingText}</div>`;
                    outputEl.innerHTML = styledOutput;
                    outputEl.classList.remove('hidden');
                } else {
                    throw new Error('پاسخ معتبری دریافت نشد.');
                }
            } catch (error) {
                console.error('Converter AI Error:', error);
                showMessageBox('خطای تبدیل', `متاسفانه خطایی رخ داد: ${error.message}`);
            } finally {
                loadingEl.classList.add('hidden');
            }
            if (window.renderMathInElement) { renderMathInElement(outputEl, { delimiters: [{left: '$$', right: '$$', display: true}, {left: '$', right: '$', display: false}] }); }
        }

        document.getElementById('converter-input').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
            	if (!isTouchDevice()) {
			if (!event.shiftKey) {
                	event.preventDefault(); // Prevent default action (like form submission)
                	convertWithAI();
            		}
            	}
            } else if (event.key === 'Enter' && event.ctrlKey) {
                event.preventDefault();
                convertWithAI();
            } else {}
            setTimeout(autoResizeTextarea, 0);
        });

        // --- Math Tools Logic ---
        function showMathTool(toolId, title) {
            document.querySelectorAll('.math-heading').forEach(h => h.classList.add('hidden'));
            document.getElementById('math-tool-buttons').classList.add('hidden'); // Hide button grid
            document.getElementById('math-smartTool-buttons').classList.add('hidden');
            document.getElementById('math-split-border').classList.add('hidden');
            document.querySelectorAll('.math-tool').forEach(tool => {
                // حذف کلاس 'hidden' و کلاس انیمیشن از همه ابزارها 
                // تا فقط ابزار انتخابی نمایش داده شود (در صورت وجود منطق پیچیده‌تر)
                tool.classList.add('hidden');
                tool.classList.remove('fadeIn-active');
                tool.classList.remove('mt-6');
            });
            const tool = document.getElementById(toolId);
            if(tool) {
                tool.classList.remove('hidden');
                tool.classList.remove('mt-6');
                tool.classList.add('fadeIn-active');
                pushNewState();
                // اضافه کردن این بخش: اگر ابزار بردار انتخاب شد، Three.js را چک کن
                if (toolId === 'vector-calculator') {
                    if (!scene) {
                        initThree(); // اگر بار اول است، بساز
                    } else {
                        onWindowResize(); // اگر قبلاً ساخته شده، ابعاد را آپدیت کن
                    }
                }
                // Re-render KaTeX in case the new tool has static formulas
                if (window.renderMathInElement) {
                    renderMathInElement(tool);
                }
            }
            pageTitle.textContent = title;
        }

        const input = document.getElementById('prime-input');
        const resultEl = document.getElementById('prime-result');
        // اجرای checkPrime با Enter
        input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                checkPrime();
            }
        });

	  function checkPrime() {
	    const num = parseInt(input.value);

	    if (isNaN(num) || num < 1) {
	      resultEl.textContent = 'لطفا یک عدد طبیعی وارد کنید.';
	      resultEl.style.color = 'red';
	      return;
	    }
	
	    if (num === 1) {
	      resultEl.textContent = `عدد ${num} نه اول است و نه مرکب.`;
	      resultEl.style.color = 'black';
	      return;
	    }

	    // بررسی اول بودن و همزمان آماده‌سازی برای تجزیه
	    let isPrime = true;
	    for (let i = 2, s = Math.sqrt(num); i <= s; i++) {
	      if (num % i === 0) {
	        isPrime = false;
	        break;
	      }
	    }

	    if (isPrime) {
	      resultEl.textContent = `${num} عددی اول است.`;
	      resultEl.style.color = 'green';
	    } else {
	      const factors = primeFactorization(num);
	      const latex = `\\(${num} ${formatFactors(factors)}\\)`;
	      resultEl.innerHTML = `${num} عددی مرکب است.<br>${latex}`;
	      resultEl.style.color = 'orange';
	      // رندر KaTeX برای فرمول لاتکسی
	      renderMathInElement(resultEl, {
	        delimiters: [
	          { left: "\\(", right: "\\)", display: false },
	          { left: "\\[", right: "\\]", display: true }
	        ]
	      });

	    }
	  }

	  // تابع تجزیه به عوامل اول
	  function primeFactorization(n) {
	    const factors = {};
	    let d = 2;
	    while (n > 1) {
	      while (n % d === 0) {
	        factors[d] = (factors[d] || 0) + 1;
	        n /= d;
      }
	      d++;
    }
	    return factors;
	  }

	  // فرمت نمایش توان‌دار (مثل 24 = 2³×3)
	  function formatFactors(factors) {
	    const parts = [];
	    for (const [prime, power] of Object.entries(factors)) {
	      parts.push(power > 1 ? `${prime}^{${power}}` : `${prime}`);
	    }
	    return `= ${parts.join(' \\times ')}`;
	  }

        
        function calculatePythagorean() {
            const a = parseFloat(document.getElementById('pythagorean-a').value);
            const b = parseFloat(document.getElementById('pythagorean-b').value);
            const c = parseFloat(document.getElementById('pythagorean-c').value);
            const resultEl = document.getElementById('pythagorean-result');
            
            try {
                let resultText = '';
		if ((!isNaN(a) && a <= 0) || (!isNaN(b) && b <= 0) || (!isNaN(c) && c <= 0)) {

	             throw new Error("مقادیر ضلع‌ها باید مثبت باشند؛ زیرا این مقادیر تشکیل یک مثلث نمی‌دهند.");
	
        }
                if (!isNaN(a) && !isNaN(b) && isNaN(c)) {
		     if (Math.sqrt(a*a + b*b) >= (a + b) || (Math.sqrt(a*a + b*b) == a || Math.sqrt(a*a + b*b) == b)) throw new Error("این مقادیر تشکیل یک مثلث نمی‌دهند (قانون نابرابری مثلث نقض شد).");
                    resultText = `$c = \\sqrt{${a*a}+${b*b}} = \\boxed{\\sqrt{${(a*a+b*b)}}} = \\boxed{${Math.sqrt(a*a + b*b)}}$`;
                } else if (!isNaN(a) && isNaN(b) && !isNaN(c)) {
                     if (c < a) throw new Error("وتر باید بزرگتر از ضلع باشد.");
		     if (Math.sqrt(c*c - a*a) >= (a + c) || (Math.sqrt(c*c - a*a) == 0) || (Math.sqrt(c*c - a*a) == a || Math.sqrt(c*c - a*a) == c)) throw new Error("این مقادیر تشکیل یک مثلث نمی‌دهند (قانون نابرابری مثلث نقض شد).");
                    resultText = `$b = \\sqrt{${c*c}-${a*a}} = \\boxed{\\sqrt{${(c*c-a*a)}}} = \\boxed{${Math.sqrt(c*c - a*a)}}$`;
                } else if (isNaN(a) && !isNaN(b) && !isNaN(c)) {
                     if (c < b) throw new Error("وتر باید بزرگتر از ضلع باشد.");
		     if (Math.sqrt(c*c - b*b) >= (b + c) || (Math.sqrt(c*c - b*b) == 0) || (Math.sqrt(c*c - b*b) == b || Math.sqrt(c*c - b*b) == c)) throw new Error("این مقادیر تشکیل یک مثلث نمی‌دهند (قانون نابرابری مثلث نقض شد).");
                    resultText = `$a = \\sqrt{${c*c}-${b*b}} = \\boxed{\\sqrt{${(c*c-b*b)}}} = \\boxed{${Math.sqrt(c*c - b*b)}}$`;
                } else {
                    throw new Error("لطفا دقیقا دو کادر را پر کنید.");
                }

                resultEl.textContent = resultText;
		resultEl.style.color = 'black';
            } catch (error) {
                resultEl.textContent = `خطا: ${error.message}`;
		resultEl.style.color = 'red';
            }
            if (window.renderMathInElement) {
                renderMathInElement(resultEl, { delimiters: [{left: '$', right: '$', display: false}] });
            }
        }

        function toLatexScientificNotation(num) {
            // تبدیل عدد به رشته
            let numStr = num.toString();

            // بررسی اینکه آیا عدد منفی است یا خیر
            const isNegative = num < 0;
            const match = numStr.match(/(-?\d+\.?\d*)[eE]([+-]?)(\d+)/);

            if (match) {
                const base = match[1];     // پایه (حالا شامل علامت منفی هم می‌شود)
                const sign = match[2];     // علامت توان
                const exponent = match[3]; // عدد توان

                return `${base} \\times 10^{${sign}${exponent}}`;
            }

            return numStr.replace('Infinity', '\\infty');
        }

        // --- Perimeter Tools ---
        function showperimeterShape(shapeId) {
            document.getElementById('perimeter-shape-selection').classList.add('hidden');
            const shapeTool = document.getElementById(shapeId);
            shapeTool.classList.remove('hidden');
            pushNewState();
            if (window.renderMathInElement) { renderMathInElement(shapeTool); }
        }

        function calculatePerimeter(shape) {
            let resultEl, P = 0, resultText = '';
            try {
                if (shape === 'square') {
                    resultEl = document.getElementById('perimeter-square-result');
                    const side = parseFloat(document.getElementById('perimeter-square-side').value);
                    if (isNaN(side) || side <= 0) throw new Error("ضلع معتبر وارد کنید.");
                    P = 4 * side;
                    const Perimeter = toLatexScientificNotation(P)
                    resultText = `$P =${Perimeter}$`;
                } else if (shape === 'circle') {
                    resultEl = document.getElementById('perimeter-circle-result');
                    const radius = parseFloat(document.getElementById('perimeter-circle-radius').value);
                    if (isNaN(radius) || radius <= 0) throw new Error("شعاع معتبر وارد کنید.");
                    P = 2 * Math.PI * radius;
                    const Perimeter = toLatexScientificNotation(P)
                    resultText = `$P =${Perimeter}$`;
                } else if (shape === 'triangle') {
                    resultEl = document.getElementById('perimeter-triangle-result');
                    const a = parseFloat(document.getElementById('perimeter-triangle-a').value);
                    const b = parseFloat(document.getElementById('perimeter-triangle-b').value);
                    const c = parseFloat(document.getElementById('perimeter-triangle-c').value);
                    if (isNaN(a) || isNaN(b) || isNaN(c) || a <= 0 || b <= 0 || c <= 0) throw new Error("اضلاع معتبر وارد کنید.");
                    P = a + b + c;
                    const Perimeter = toLatexScientificNotation(P)
                    resultText = `$P =${Perimeter}$`;
                } else if (shape === 'rectangle') {
                    resultEl = document.getElementById('perimeter-rectangle-result');
                    const a = parseFloat(document.getElementById('perimeter-rectangle-length').value);
                    const b = parseFloat(document.getElementById('perimeter-rectangle-width').value);
                    if (isNaN(a) || isNaN(b) || a <= 0 || b <= 0) throw new Error("طول و عرض معتبر وارد کنید.");
                    P = (a + b) * 2;
                    const Perimeter = toLatexScientificNotation(P)
                    resultText = `$P =${Perimeter}$`;
                } else if (shape === 'parallelogram') {
                    resultEl = document.getElementById('perimeter-par-result');
                    const a = parseFloat(document.getElementById('perimeter-par-a').value);
                    const b = parseFloat(document.getElementById('perimeter-par-b').value);
                    if (isNaN(a) || isNaN(b) || a <= 0 || b <= 0) throw new Error("اعداد معتبر وارد کنید.");
                    P = 2 * (a + b);
                    const Perimeter = toLatexScientificNotation(P)
                    resultText = `$P =${Perimeter}$`;
                } else if (shape === 'rhombus') {
                    resultEl = document.getElementById('perimeter-rhombus-result');
                    const a = parseFloat(document.getElementById('perimeter-rhombus-side').value);
                    if (isNaN(a) || a <= 0) throw new Error("ضلع معتبر وارد کنید.");
                    P = 4 * a;
                    const Perimeter = toLatexScientificNotation(P)
                    resultText = `$P =${Perimeter}$`;
                } else if (shape === 'trapezoid') {
                    resultEl = document.getElementById('perimeter-trap-result');
                    const a = parseFloat(document.getElementById('perimeter-trap-a').value);
                    const b = parseFloat(document.getElementById('perimeter-trap-b').value);
                    const c = parseFloat(document.getElementById('perimeter-trap-c').value);
                    const d = parseFloat(document.getElementById('perimeter-trap-d').value);
                    if ([a,b,c,d].some(x => isNaN(x) || x <= 0)) throw new Error("همهٔ اضلاع معتبر باشند.");
                    P = a + b + c + d;
                    const Perimeter = toLatexScientificNotation(P)
                    resultText = `$P =${Perimeter}$`;
                } else if (shape === 'sector') {
                    resultEl = document.getElementById('perimeter-sector-result');
                    const r = parseFloat(document.getElementById('perimeter-sector-r').value);
                    const deg = parseFloat(document.getElementById('perimeter-sector-angle').value);
                    if (isNaN(r) || r <= 0 || isNaN(deg) || deg <= 0) throw new Error("شعاع و زاویه معتبر وارد کنید.");
                    const arc = (deg / 360) * 2 * Math.PI * r;
                    P = 2 * r + arc;
                    const Perimeter = toLatexScientificNotation(P)
                    resultText = `$P =${Perimeter}$`;
                } else if (shape === 'ellipse') {
                    resultEl = document.getElementById('perimeter-ellipse-result');
                    const a = parseFloat(document.getElementById('perimeter-ellipse-a').value);
                    const b = parseFloat(document.getElementById('perimeter-ellipse-b').value);
                    if (isNaN(a) || isNaN(b) || a <= 0 || b <= 0) throw new Error("نیم‌محورها معتبر باشند.");
                    // Ramanujan approx
                    const h = Math.pow((a - b), 2) / Math.pow((a + b), 2);
                    P = Math.PI * (a + b) * (1 + (3 * h) / (10 + Math.sqrt(4 - 3 * h)));
                    const Perimeter = toLatexScientificNotation(P)
                    resultText = `$P =${Perimeter}$`;
                }
                if (resultEl) {
                    resultEl.innerHTML = `${resultText}`;
                    resultEl.className = 'mt-4 text-2xl text-center font-bold text-green-600';
                    resultEl.style.color = 'green';
                }
		        if (window.renderMathInElement) {
			        renderMathInElement(resultEl, { delimiters: [{left: '$', right: '$', display: false}] });
            	}
            } catch (error) {
                if (resultEl)
                    resultEl.textContent = `خطا: ${error.message}`;
                    resultEl.className = 'mt-4 text-2xl text-center font-bold';
                    resultEl.style.color = 'red';
            }
        }

        document.getElementById('perimeter-square-side').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                calculatePerimeter('square');
            }
        });

        document.getElementById('perimeter-circle-radius').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                calculatePerimeter('circle');
            }
        });

        document.getElementById('perimeter-triangle-c').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                calculatePerimeter('triangle');
            }
        });

        document.getElementById('perimeter-rectangle-width').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                calculatePerimeter('rectangle');
            }
        });

        document.getElementById('perimeter-par-b').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                calculatePerimeter('parallelogram');
            }
        });
        document.getElementById('perimeter-rhombus-side').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                calculatePerimeter('rhombus');
            }
        });
        document.getElementById('perimeter-trap-d').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                calculatePerimeter('trapezoid');
            }
        });
        document.getElementById('perimeter-sector-angle').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                calculatePerimeter('sector');
            }
        });
        document.getElementById('perimeter-ellipse-b').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                calculatePerimeter('ellipse');
            }
        });

        // --- Area Tools ---
        function showAreaShape(shapeId) {
            document.getElementById('area-shape-selection').classList.add('hidden');
            const shapeTool = document.getElementById(shapeId);
            shapeTool.classList.remove('hidden');
            pushNewState();
            if (window.renderMathInElement) { renderMathInElement(shapeTool); }
        }

        function calculateArea(shape) {
            let resultEl, result = 0, resultText = '';
            try {
                if (shape === 'square') {
                    resultEl = document.getElementById('area-square-result');
                    const side = parseFloat(document.getElementById('area-square-side').value);
                    if (isNaN(side) || side <= 0) throw new Error("ضلع معتبر وارد کنید.");
                    result = side * side;
                } else if (shape === 'circle') {
                    resultEl = document.getElementById('area-circle-result');
                    const radius = parseFloat(document.getElementById('area-circle-radius').value);
                    if (isNaN(radius) || radius <= 0) throw new Error("شعاع معتبر وارد کنید.");
                    result = Math.PI * (radius ** 2);
                } else if (shape === 'triangle') {
                    resultEl = document.getElementById('area-triangle-result');
                    const base = parseFloat(document.getElementById('area-triangle-base').value);
                    const height = parseFloat(document.getElementById('area-triangle-height').value);
                    if (isNaN(base) || isNaN(height) || base <= 0 || height <= 0) throw new Error("قاعده و ارتفاع معتبر وارد کنید.");
                    result = 0.5 * base * height;
                } else if (shape === 'rectangle') {
                    resultEl = document.getElementById('area-rectangle-result');
                    const a = parseFloat(document.getElementById('area-rectangle-length').value);
                    const b = parseFloat(document.getElementById('area-rectangle-width').value);
                    if (isNaN(a) || isNaN(b) || a <= 0 || b <= 0) throw new Error("طول و عرض معتبر وارد کنید.");
                    result = a * b;
                } else if (shape === 'parallelogram') {
                    resultEl = document.getElementById('area-par-result');
                    const a = parseFloat(document.getElementById('area-par-base').value);
                    const h = parseFloat(document.getElementById('area-par-height').value);
                    if (isNaN(a) || isNaN(h) || a <= 0 || h <= 0) throw new Error("قاعده یا ارتفاع معتبر نیست.");
                    result = a * h;
                } else if (shape === 'rhombus') {
                    resultEl = document.getElementById('area-rhombus-result');
                    const d1 = parseFloat(document.getElementById('area-rhombus-d1').value);
                    const d2 = parseFloat(document.getElementById('area-rhombus-d2').value);
                    if (isNaN(d1) || isNaN(d2) || d1 <= 0 || d2 <= 0) throw new Error("قطرها معتبر نیستند.");
                    result = 0.5 * d1 * d2;
                } else if (shape === 'trapezoid') {
                    resultEl = document.getElementById('area-trap-result');
                    const a = parseFloat(document.getElementById('area-trap-a').value);
                    const b = parseFloat(document.getElementById('area-trap-b').value);
                    const h = parseFloat(document.getElementById('area-trap-h').value);
                    if (isNaN(a) || isNaN(b) || isNaN(h) || a <= 0 || b <= 0 || h <= 0) throw new Error("پارامترهای نامعتبر.");
                    result = 0.5 * (a + b) * h;
                } else if (shape === 'sector') {
                    resultEl = document.getElementById('area-sector-result');
                    const r = parseFloat(document.getElementById('area-sector-r').value);
                    const deg = parseFloat(document.getElementById('area-sector-angle').value);
                    if (isNaN(r) || r <= 0 || isNaN(deg) || deg <= 0) throw new Error("شعاع یا زاویه معتبر نیست.");
                    result = (deg / 360) * Math.PI * r * r;
                } else if (shape === 'ellipse') {
                    resultEl = document.getElementById('area-ellipse-result');
                    const a = parseFloat(document.getElementById('area-ellipse-a').value);
                    const b = parseFloat(document.getElementById('area-ellipse-b').value);
                    if (isNaN(a) || isNaN(b) || a <= 0 || b <= 0) throw new Error("نیم‌محورها معتبر نیستند.");
                    result = Math.PI * a * b;
                }
                const A = toLatexScientificNotation(result)
                resultText = `$A =${A}$`;
                resultEl.textContent = resultText;
                resultEl.className = 'mt-4 text-2xl text-center font-bold text-green-600';
		if (window.renderMathInElement) {
			renderMathInElement(resultEl, { delimiters: [{left: '$', right: '$', display: false}] });
            	}

            } catch (error) {
                if(resultEl) {
                    resultEl.textContent = `خطا: ${error.message}`;
                    resultEl.className = 'mt-4 font-bold text-2xl text-center text-red-600';
                }
            }
        }

        document.getElementById('area-square-side').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                calculateArea('square');
            }
        });

        document.getElementById('area-circle-radius').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                calculateArea('circle');
            }
        });

        document.getElementById('area-triangle-height').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                calculateArea('triangle');
            }
        });

        document.getElementById('area-rectangle-width').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                calculateArea('rectangle');
            }
        });

        document.getElementById('area-par-height').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                calculateArea('parallelogram');
            }
        });

        document.getElementById('area-rhombus-d2').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                calculateArea('rhombus');
            }
        });

        document.getElementById('area-trap-h').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                calculateArea('trapezoid');
            }
        });

        document.getElementById('area-sector-angle').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                calculateArea('sector');
            }
        });

        document.getElementById('area-ellipse-b').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                calculateArea('ellipse');
            }
        });

        // Plotter
        document.getElementById('plot-tabs').addEventListener('click', (e) => {
            if (e.target.classList.contains('plot-tab-btn')) {
                document.querySelectorAll('.plot-tab-btn').forEach(btn => {
                    btn.classList.remove('text-green-600', 'border-green-600');
                    btn.classList.add('text-gray-500', 'border-transparent', 'hover:text-gray-700', 'hover:border-gray-300');
                });
                e.target.classList.add('text-green-600', 'border-green-600');
                e.target.classList.remove('text-gray-500', 'border-transparent', 'hover:text-gray-700', 'hover:border-gray-300');
                
                document.querySelectorAll('.plot-tab-content').forEach(content => content.classList.add('hidden'));
                document.getElementById(e.target.dataset.target).classList.remove('hidden');
            }
        });

        const inputEl = document.getElementById('math-plot-input');
        inputEl.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                plotMathFunction();
            }
        });

        const plotColors = ['#15803d', '#2563eb', '#dc2626', '#f97316', '#7c3aed']; // Green, Blue, Red, Orange, Purple
        const plotColor = ['green', 'blue', 'red', 'orange', 'purple'];

        let pieceWiseFormulaCounter = 3;

        function showPlotterHelp() {
            const helpText = "از نمادهای استاندارد جاوا اسکریپت استفاده کنید:\n" +
                "ضرب: * (مثال: 2*x)\n" +
                "تقسیم: / (مثال: x/2)\n" +
                "توان: ضرب به تعداد توان (مثال: x²=x*x یا x³=x*x*x) یا از pow(b, e) استفاده کنید که به جای b پایه و به جای e توان را قرار دهید. برای توابع نمایی با پایۀ e (عدد اویلر) از exp(e) که e توان است.\n" +
                "رادیکال با فرجۀ 2: sqrt(x)\n" +
                "رادیکال با فرجۀ 3: cbrt(x)\n" +
                "قدرمطلق: abs(x)\n" +
                "مثلثاتی: sin(x), cos(x), tan(x) و ...\n" +
                "وارون مثلثاتی: asin(x), acos(x), atan(x) و ...\n" +
                "مثلثاتی هذلولی: sinh(x), cosh(x), tanh(x) و ...\n" +
                "لگاریتم: log10(x) (که 10 پایه یا مبنا است), log(x) (پایه e), log2(x) (پایه 2)؛ برای پایه‌های دیگر از قوانین لگاریتم استفاده کنید.\n" +
                "ثابت‌ها: π=pi, e=E \n" +
                "پیش‌نمایش فرمول تابع در پایین کادر ورودی ممکن‌الخطاست.";
            showMessageBox('راهنمای رسم نمودار', helpText);
        }

        // تابع کمکی برای تبدیل متن ریاضی به کد لاتکس
        function mathToLatex(text) {
            if (!text) return "";
            let str = text;

            // ۱. پیش‌پردازش ثابت‌ها و جایگزینی‌های ساده (بدون حلقه)
            str = str.replace(/pi/g, '\\pi').replace(/E/g, 'e');
            str = str.replace(/\*/g, ' \\cdot ');

            // ۲. پردازش توابع تودرتو با محدود کردن تعداد تکرار (جلوگیری از هنگ)
            const funcMap = [
                { reg: /sqrt\(([^()]+)\)/g, res: '\\sqrt{$1}' },
                { reg: /cbrt\(([^()]+)\)/g, res: '\\sqrt[3]{$1}' },
                { reg: /abs\(([^()]+)\)/g, res: '\\left|{$1}\\right|' },
                { reg: /exp\(([^()]+)\)/g, res: 'e^{$1}' },
                { reg: /pow\(([^(),]+)\s*,\s*([^()]+)\)/g, res: '{$1}^{$2}' },
                { reg: /log10\(([^()]+)\)/g, res: '\\log_{10}({$1})' },
                { reg: /log2\(([^()]+)\)/g, res: '\\log_{2}({$1})' },
                { reg: /log\(([^()]+)\)/g, res: '\\ln({$1})' },
                { reg: /sin\(([^()]+)\)/g, res: '\\sin({$1})' },
                { reg: /cos\(([^()]+)\)/g, res: '\\cos({$1})' },
                { reg: /tan\(([^()]+)\)/g, res: '\\tan({$1})' },
                { reg: /asin\(([^()]+)\)/g, res: '\\sin^{-1}({$1})' },
                { reg: /acos\(([^()]+)\)/g, res: '\\cos^{-1}({$1})' },
                { reg: /atan\(([^()]+)\)/g, res: '\\tan^{-1}({$1})' }
            ];

            let safetyCounter = 0;
            while (safetyCounter < 25) { // حداکثر ۲۵ لایه تودرتو (برای امنیت)
                let changed = false;
                let prevStr = str;
                
                funcMap.forEach(f => {
                    str = str.replace(f.reg, f.res);
                });
                
                // مدیریت توان ساده x^y
                str = str.replace(/([a-zA-Z0-9.\pi{}]+)\s*\^\s*([a-zA-Z0-9.\pi{}]+)/g, '{$1}^{$2}');

                if (str === prevStr) break; // اگر در این دور تغییری ایجاد نشد، خارج شو
                safetyCounter++;
            }

            // ۳. پردازش نهایی کسرها و تقسیم
            // ابتدا تقسیم‌های داخل پرانتز را به فراک تبدیل می‌کنیم
            str = str.replace(/\(([^()]+)\)\s*\/\s*\(([^()]+)\)/g, '\\frac{$1}{$2}');
            str = str.replace(/([a-zA-Z0-9.\pi{}]+)\s*\/\s*([a-zA-Z0-9.\pi{}]+)/g, '\\frac{$1}{$2}');
            str = str.replace(/\//g, ' \\div '); // اگر چیزی باقی ماند

            return str;
        }

        function updateSimpleLatex() {
            const input = document.getElementById('math-plot-input').value.trim();
            const latexTarget = document.getElementById('math-simple-latex');
            
            if (!input) {
                latexTarget.innerHTML = '<span class="text-gray-500">پیش‌نمایش فرمول تابع</span>';
                return;
            }

            let latexCode = 'f(x) = ' + mathToLatex(input);

            try {
                if (typeof katex !== 'undefined') {
                    katex.render(latexCode, latexTarget, { displayMode: true, throwOnError: false });
                } else {
                    latexTarget.textContent = latexCode;
                }
            } catch (e) {
                console.error("Katex error:", e);
            }
        }

	    function getPlotDimensions(targetId) {
            const targetElement = document.getElementById(targetId);
            const rect = targetElement.getBoundingClientRect();
            const plotWidth = rect.width;
            const plotHeight = rect.height;
            return { plotWidth, plotHeight };
        }

        function processFnString(fn) {
            return fn.replace(/\^/g, '**').replace(/pi/gi, 'PI');
        }

        function getDomain(minId, maxId) {
            const ixMin = document.getElementById(minId).value.trim();
            const ixMax = document.getElementById(maxId).value.trim();

            let xMin = -6;
            let xMax = 6;

            if (ixMin === '' || ixMax === '') {
                return [xMin, xMax];
            }

            xMin = parseFloat(ixMin);
            xMax = parseFloat(ixMax);

            if (isNaN(xMin) || isNaN(xMax)) {
                showMessageBox('خطای دامنه', 'مقادیر وارد شده باید عددی باشند.');
                return [-6, 6];
            }

            return [xMin, xMax];
        }

        function plotMathFunction() {
            const target = '#math-plot-target';
            let fn = inputEl.value;

            document.getElementById('math-plot-target').innerHTML = ''; // Clear previous plot

            const targetElement = document.getElementById('math-plot-target');
            
            const rect = targetElement.getBoundingClientRect();
                        
            const plotWidth = rect.width;
                        
            const plotHeight = rect.height > 0 ? rect.height : 400; // خواندن ارتفاع یا پیش فرض 400
            const isDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            const plotColour = isDarkMode ? '#4ade80' : '#15803d'; // #4ade80 برای Dark Mode (روشن) و #15803d برای Light Mode (تیره)

            if (!fn) {
                showMessageBox('خطا', 'لطفا ضابطه تابع را وارد کنید.');
                return;
            }
            
            try {
                // Process string for function-plot
                let fnString = fn.replace(/\^/g, '**').replace(/pi/gi, 'PI');
                const ixMin = document.getElementById('math-plot-xMin').value.trim();
                const ixMax = document.getElementById('math-plot-xMax').value.trim();
                let xMin = -6;
                let xMax = 6;
                if (ixMin !== '' && ixMax !== '') {
                    xMin = parseFloat(ixMin);
                    xMax = parseFloat(ixMax);
                }

                functionPlot({
                    target: target,
                    width: plotWidth + 28,
                    height: plotHeight,
                    data: [{ fn: fnString, color: plotColour, graphType: 'polyline' }], // Added color
                    grid: true,
                    tip: { xLine: true, yLine: true },
                    xAxis: { domain: [xMin, xMax], label: 'x' },
                    yAxis: { label: 'y' },
                });
            } catch (err) {
                console.error("Plotting Error:", err);
                showMessageBox('خطای فرمول', 'ضابطه تابع وارد شده معتبر نیست.');
                document.querySelector(target).innerHTML = '';
            }
        }

	    function addPiecewiseFormula() {
            const container = document.getElementById('piecewise-formulas-container');
            pieceWiseFormulaCounter++;
            const newFormulaDiv = document.createElement('div');
            newFormulaDiv.className = 'piecewise-formula flex items-center gap-2 border p-3 rounded-lg bg-gray-50';
            newFormulaDiv.setAttribute('data-id', pieceWiseFormulaCounter);
            newFormulaDiv.innerHTML = `
                <span class="font-bold text-slate-900">اگر</span>
                <input type="text" class="piecewise-condition p-2 border focus:outline-none bg-white rounded-lg text-left w-1/3" dir="ltr" placeholder="شرط (مثلاً x<0)">
                <span class="font-bold text-slate-900">آنگاه</span>
                <input type="text" class="piecewise-function p-2 border focus:outline-none bg-white rounded-lg text-left w-2/3" dir="ltr" placeholder="ضابطه (مثلاً -x)">
                <button onclick="removePiecewiseFormula(this)" class="p-2 text-red-500 hover:text-red-700 shrink-0" title="حذف ضابطه">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                </button>
            `;
            container.appendChild(newFormulaDiv);

            newFormulaDiv.querySelector('.piecewise-condition').addEventListener('input', updatePiecewiseLatex);
            newFormulaDiv.querySelector('.piecewise-function').addEventListener('input', updatePiecewiseLatex);
            updatePiecewiseLatex();
	    }

	    function removePiecewiseFormula(buttonElement) {
            const formulaDiv = buttonElement.closest('.piecewise-formula');
            if (formulaDiv) {
                formulaDiv.remove();
                updatePiecewiseLatex(); // به روزرسانی لاتک پس از حذف
            }
	    }

	    function updatePiecewiseLatex() {
            const formulas = document.querySelectorAll('#piecewise-formulas-container .piecewise-formula');
            let latexCode = 'f(x) = \\begin{cases}';
            formulas.forEach((formula, index) => {
                const condition = formula.querySelector('.piecewise-condition').value.trim();
                const fn = formula.querySelector('.piecewise-function').value.trim();
                const latexFn = mathToLatex(fn);
                const latexCond = condition.replace(/<|<=|>=|>/g, (match) => {
                    if (match === '<=') return '\\le';
                    if (match === '>=') return '\\ge';
                    return match;
                });
                if (fn && condition) {
                    latexCode += ` ${latexFn} & \\text{if } ${latexCond} \\\\`;
                } else if (fn) {
                    latexCode += ` ${latexFn} & \\text{otherwise} \\\\`;
                }
            });
            latexCode += '\\end{cases}';

            const latexTarget = document.getElementById('math-piecewise-latex');
            try {
                if (typeof katex !== 'undefined' && formulas.length > 0) {
                    katex.render(latexCode, latexTarget, { displayMode: true, throwOnError: false });
                } else if (formulas.length === 0) {
                    latexTarget.innerHTML = '<span class="text-gray-500">پیش‌نمایش ضوابط تابع</span>';
                } else {
                    latexTarget.textContent = latexCode;
                }
            } catch (e) {
                latexTarget.textContent = 'خطا در رندر لاتکس';
                console.error("Katex error:", e);
            }            
	    }

        const isDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        const plotColour = isDarkMode ? '#4ade80' : '#15803d'; // #4ade80 برای Dark Mode (روشن) و #15803d برای Light Mode (تیره)
        function plotPiecewiseFunction() {
            const { plotWidth, plotHeight } = getPlotDimensions('math-piecewise-target');
            const [xMinGlobal, xMaxGlobal] = getDomain('piecewise-xMin', 'piecewise-xMax');
            const formulas = document.querySelectorAll('#piecewise-formulas-container .piecewise-formula');

            let plotData = [];

            document.getElementById('math-piecewise-target').innerHTML = ''; // Clear previous plot

            formulas.forEach(formula => {
                const condition = formula.querySelector('.piecewise-condition').value.trim();
                const fn = formula.querySelector('.piecewise-function').value.trim();
                if (fn) {
                    let range = conditionToRange(condition, xMinGlobal, xMaxGlobal);
                    if (!condition) {
                    	range = [xMinGlobal, xMaxGlobal];
                    }
                    if (range[0] < range[1]) {
                    	plotData.push({
                    		fn: processFnString(fn),
                    		range: range,
                    		graphType: 'polyline',
                    		color: plotColour,
                    	});
                    } else if (condition) {
                    	showMessageBox('خطا در شرط', `شرط ${condition} برای تابع ${fn} نامعتبر یا خالی است.`);
                    	return;
                    }
                }
            });
            if (plotData.length === 0) {
                showMessageBox('خطا', 'لطفا حداقل یک ضابطه معتبر را وارد کنید.');
                return;
            }
            function conditionToRange(cond, xMinGlobal, xMaxGlobal) {
                cond = cond.replace(/\s/g, ''); // حذف فاصله‌ها
                let min = xMinGlobal;
                let max = xMaxGlobal;
                const rangeMatch = cond.match(/^(\d+(\.\d+)?)(<=|<)x(<=|<)(\d+(\.\d+)?)$/i);
                if (rangeMatch) {
                    min = parseFloat(rangeMatch[1]);
                    max = parseFloat(rangeMatch[5]);
                    return [min, max];
                }
                const lessThanMatch = cond.match(/^x(<=|<)(\d+(\.\d+)?)$/i);
                if (lessThanMatch) {
                    max = parseFloat(lessThanMatch[2]);
                    return [xMinGlobal, max];
                }
                const greaterThanMatch = cond.match(/^x(>=|>)(\d+(\.\d+)?)$/i);
                if (greaterThanMatch) {
                    min = parseFloat(greaterThanMatch[2]);
                    return [min, xMaxGlobal];
                }
                const reverseLessThanMatch = cond.match(/^(\d+(\.\d+)?)(<=|<)x$/i);
                if (reverseLessThanMatch) {
                    min = parseFloat(reverseLessThanMatch[1]);
                    return [min, xMaxGlobal];
                }
                return [xMinGlobal, xMaxGlobal];
            }

            try {
                functionPlot({
                    target: '#math-piecewise-target',
                    width: plotWidth + 28,
                    height: plotHeight,
                    data: plotData,
                    grid: true,
                    tip: { xLine: true, yLine: true },
                    xAxis: { domain: [xMinGlobal, xMaxGlobal], label: 'x' },
                    yAxis: { label: 'y' },
                });
            } catch (err) {
                showMessageBox('خطای فرمول', 'خطا در رسم نمودار چندضابطه‌ای. ضابطه‌ها را بررسی کنید.');
            }
	    }

	    document.addEventListener('DOMContentLoaded', () => {
            const initialPiecewiseInputs = document.querySelectorAll('#piecewise-formulas-container input');
            initialPiecewiseInputs.forEach(input => {
                input.addEventListener('input', updatePiecewiseLatex);
            });
            updatePiecewiseLatex();
            initializeVennDiagram();
            isDarkMode();
            initThree();
            onWindowResize();
            getPlotDimensions('math-piecewise-target');
            getPlotDimensions('math-comparison-target');
	    });

	    function addComparisonFormula() {
            const container = document.getElementById('comparison-formulas-container');
            const formulas = document.querySelectorAll('#comparison-formulas-container .comp-function');
            const index = formulas.length;
            const color = plotColors[index]; // چرخش رنگ‌ها
            const colors = plotColor[index]; // چرخش رنگ‌ها
            const name = ['f','g','h', 'i', 'j', 'k', 'l'][index];
            const newFormulaDiv = document.createElement('div');

            newFormulaDiv.className = 'comparison-formula flex items-center gap-2';
            newFormulaDiv.dir = 'ltr';
            newFormulaDiv.innerHTML = `
                <input type="text" class="comp-function p-2 border border-${colors}-400 text-${colors}-700 bg-plotformula pr-3 focus:outline-none rounded-lg text-left w-full" dir="ltr" placeholder="${name}(x)=">
                <button onclick="removeComparisonFormula(this)" class="p-2 text-red-500 hover:text-red-700 shrink-0" title="حذف تابع">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                </button>


            `;
            container.appendChild(newFormulaDiv);
            updateComparisonButtonState();
	    }

	    function updateComparisonButtonState() {
            const formulas = document.querySelectorAll('#comparison-formulas-container .comp-function');
            const button = document.getElementById('plotComparisonButton');

            if (formulas.length >= 5) {
                button.disabled = true;
                button.classList.add('opacity-50', 'cursor-not-allowed');
                button.classList.remove('btn-blue', 'hover:bg-blue-600');
            } else {
                button.disabled = false;
                button.classList.remove('opacity-50', 'cursor-not-allowed');
                button.classList.add('btn-blue');
            }
	    }

	    function removeComparisonFormula(buttonElement) {
            const formulaDiv = buttonElement.closest('.comparison-formula');
            if (formulaDiv) {
                formulaDiv.remove();
            }
            updateComparisonButtonState();
        }

        function plotComparisonFunctions() {
            const { plotWidth, plotHeight } = getPlotDimensions('math-comparison-target');
            const [xMin, xMax] = getDomain('comparison-xMin', 'comparison-xMax');
            const formulas = document.querySelectorAll('#comparison-formulas-container .comp-function');
            let plotData = [];
            let isValid = true;
            formulas.forEach((input, index) => {
                const fn = input.value.trim();
                if (fn) {
                    plotData.push({
                    	fn: processFnString(fn),
                    	color: plotColors[index % plotColors.length],
                    	graphType: 'polyline',
                        sampler: 'builtIn',
                    });
                }
            });
            if (plotData.length === 0) {
                showMessageBox('خطا', 'لطفا حداقل یک ضابطه را وارد کنید.');
                return;
            }
            document.getElementById('math-comparison-target').innerHTML = ''; // Clear previous plot
            try {
                functionPlot({
                    target: '#math-comparison-target',
                    width: plotWidth + 28,
                    height: plotHeight,
                    data: plotData,
                    grid: true,
                    tip: { xLine: true, yLine: true },
                    xAxis: { domain: [parseFloat(xMin), parseFloat(xMax)], label: 'x' },
                    yAxis: { label: 'y' },
                });
            } catch (err) {
                showMessageBox('خطای فرمول', 'خطا در رسم نمودار توابع مقایسه‌ای.');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const piecewiseInputs = document.querySelectorAll('#piecewise-formulas-container input');
            piecewiseInputs.forEach(input => {
                input.addEventListener('input', updatePiecewiseLatex);
            });
            updatePiecewiseLatex();
	    });

        // انتخاب تمام اینپوت‌هایی که کلاس مشخص شده را دارند
        document.querySelectorAll('.numeric-only').forEach(input => {
            input.addEventListener('input', function(e) {
                let value = e.target.value;
                const farsiDigits = ['۰', '۱', '۲', '۳', '۴', '۵', '۶', '۷', '۸', '۹'];
                const arabicDigits = ['٠', '١', '٢', '٣', '٤', '٥', '٦', '٧', '٨', '٩'];
                
                // ۱. تبدیل اعداد
                for (let i = 0; i < 10; i++) {
                    value = value.replace(new RegExp(farsiDigits[i], 'g'), i)
                                .replace(new RegExp(arabicDigits[i], 'g'), i);
                }

                // ۲. فیلتر کردن کاراکترها (فقط عدد، کاما و فاصله)
                e.target.value = value.replace(/[^0-9, \s]/g, '');
            });
        });

        // Divisibility
        function checkDivisibility() {
            const a = parseInt(document.getElementById('div-a').value);
            const b = parseInt(document.getElementById('div-b').value);
            const resultEl = document.getElementById('divisibility-result');
            
            if (isNaN(a) || isNaN(b)) {
                resultEl.textContent = 'لطفا هر دو عدد را وارد کنید.';
                resultEl.style.color = 'red';
                return;
            }
            if (b === 0) {
                resultEl.textContent = 'خطا: تقسیم بر صفر ممکن نیست.';
                resultEl.style.color = 'red';
                return;
            }
            
            if (a % b === 0) {
                resultEl.textContent = `بله، ${a} بر ${b} بخش‌پذیر است. (خارج قسمت: ${a/b})\n $$${b}\\mid ${a}$$`;
                resultEl.style.color = 'green';
            } else {
                resultEl.textContent = `خیر، ${a} بر ${b} بخش‌پذیر نیست. (باقیمانده: ${a%b})\n $$${b}\\nmid ${a}$$`;
                resultEl.style.color = 'orange';
            }

            if (window.renderMathInElement) {
			    renderMathInElement(resultEl);
            }
        }

        // Volume
        function showVolumeShape(shapeId) {
            document.getElementById('volume-shape-selection').classList.add('hidden');
            const shapeTool = document.getElementById(shapeId);
            shapeTool.classList.remove('hidden');
            pushNewState();
            if (window.renderMathInElement) { renderMathInElement(shapeTool); }
        }
        
        function calculateVolume(shape) {
            let resultEl, volume = 0;
            try {
                if (shape === 'cube') {
                    resultEl = document.getElementById('volume-cube-result'); // 💡 انتقال به ابتدای بلوک
                    const side = parseFloat(document.getElementById('volume-cube-side').value);
                    if (isNaN(side) || side <= 0) throw new Error('ضلع معتبر وارد کنید.');
                    volume = side ** 3;
                } else if (shape === 'sphere') {
                    resultEl = document.getElementById('volume-sphere-result'); // 💡 انتقال به ابتدای بلوک
                    const radius = parseFloat(document.getElementById('volume-sphere-radius').value);
                    if (isNaN(radius) || radius <= 0) throw new Error('شعاع معتبر وارد کنید.');
                    volume = (4/3) * Math.PI * (radius ** 3);
                } else if (shape === 'cylinder') {
                    resultEl = document.getElementById('volume-cylinder-result'); // 💡 انتقال به ابتدای بلوک
                    const r = parseFloat(document.getElementById('volume-cylinder-radius').value);
                    const h = parseFloat(document.getElementById('volume-cylinder-height').value);
                    if (isNaN(r) || isNaN(h) || r <= 0 || h <= 0) throw new Error('شعاع و ارتفاع معتبر وارد کنید.');
                    volume = Math.PI * (r ** 2) * h;
                } else if (shape === 'rectprism') {
                    resultEl = document.getElementById('volume-rect-result'); // 💡 انتقال به ابتدای بلوک
                    const l = parseFloat(document.getElementById('volume-rect-l').value);
                    const w = parseFloat(document.getElementById('volume-rect-w').value);
                    const h = parseFloat(document.getElementById('volume-rect-h').value);
                    if ([l,w,h].some(x => isNaN(x) || x <= 0)) throw new Error('ابعاد معتبر وارد کنید.');
                    volume = l * w * h;
                } else if (shape === 'parallelepiped') {
                    resultEl = document.getElementById('volume-parallelepiped-result'); // 💡 انتقال به ابتدای بلوک
                    const baseArea = parseFloat(document.getElementById('volume-par-basearea').value);
                    const h = parseFloat(document.getElementById('volume-par-height').value);
                    if (isNaN(baseArea) || isNaN(h) || baseArea <= 0 || h <= 0) throw new Error('مساحت قاعده و ارتفاع معتبر نیست.');
                    volume = baseArea * h;
                } else if (shape === 'capsule') {
                    resultEl = document.getElementById('volume-capsule-result'); // 💡 انتقال به ابتدای بلوک
                    const r = parseFloat(document.getElementById('volume-capsule-r').value);
                    const h = parseFloat(document.getElementById('volume-capsule-h').value);
                    if (isNaN(r) || isNaN(h) || r <= 0 || h < 0) throw new Error('پارامترها معتبر نیستند.');
                    volume = Math.PI * r * r * h + (4 / 3) * Math.PI * Math.pow(r, 3);
                } else if (shape === 'pyramid') {
                    resultEl = document.getElementById('volume-pyramid-result'); // 💡 انتقال به ابتدای بلوک
                    const baseArea = parseFloat(document.getElementById('volume-pyramid-basearea').value);
                    const h = parseFloat(document.getElementById('volume-pyramid-h').value);
                    if (isNaN(baseArea) || isNaN(h) || baseArea <= 0 || h <= 0) throw new Error('پارامترها معتبر نیستند.');
                    volume = (1 / 3) * baseArea * h;
                } else if (shape === 'cone') {
                    resultEl = document.getElementById('volume-cone-result'); // 💡 انتقال به ابتدای بلوک
                    const r = parseFloat(document.getElementById('volume-cone-r').value);
                    const h = parseFloat(document.getElementById('volume-cone-h').value);
                    if (isNaN(r) || isNaN(h) || r <= 0 || h <= 0) throw new Error('پارامترها معتبر نیستند.');
                    volume = (1 / 3) * Math.PI * r * r * h;
                } else if (shape === 'frustum') {
                    resultEl = document.getElementById('volume-frustum-result'); // 💡 انتقال به ابتدای بلوک
                    const R = parseFloat(document.getElementById('volume-frustum-R').value);
                    const r = parseFloat(document.getElementById('volume-frustum-r').value);
                    const h = parseFloat(document.getElementById('volume-frustum-h').value);
                    if ([R,r,h].some(x => isNaN(x) || x < 0) || (R <= 0 && r <= 0)) throw new Error('پارامترها معتبر نیستند.');
                    if (r>R) throw new Error('شعاع بزرگ کوچکتر از شعاع کوچک است!')
                    volume = (1 / 3) * Math.PI * h * (R * R + R * r + r * r);
                } else if (shape === 'hexprism') {
                    resultEl = document.getElementById('volume-hex-result'); // 💡 انتقال به ابتدای بلوک
                    const a = parseFloat(document.getElementById('volume-hex-a').value);
                    const h = parseFloat(document.getElementById('volume-hex-h').value);
                    if (isNaN(a) || isNaN(h) || a <= 0 || h <= 0) throw new Error('پارامترها معتبر نیستند.');
                    const baseArea = (3 * Math.sqrt(3) / 2) * a * a;
                    volume = baseArea * h;
                } else {
                    throw new Error('لطفا یک شکل را انتخاب کنید.');
                }
                
                // بخش نمایش موفقیت‌آمیز (بدون تغییر)
                const V = toLatexScientificNotation(volume)
                resultText = `$V = ${V}$`;
                resultEl.textContent = resultText;
                resultEl.className = 'mt-4 text-2xl text-center font-bold text-green-600';
                if (window.renderMathInElement) {
                    renderMathInElement(resultEl, { delimiters: [{left: '$', right: '$', display: false}] });
                }
            } catch (error) {
                // بلوک catch (بدون تغییر)
                if(resultEl) {
                    resultEl.textContent = `خطا: ${error.message}`;
                    resultEl.className = 'mt-4 text-2xl text-center font-bold text-red-600';
                }
            }
        }

        document.getElementById('volume-cube-side').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                calculateVolume('cube');
            }
        });

        document.getElementById('volume-sphere-radius').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                calculateVolume('sphere');
            }
        });

        document.getElementById('volume-cylinder-height').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                calculateVolume('cylinder');
            }
        });

        // 4. مکعب مستطیل (Rectangular Prism)
        document.getElementById('volume-rect-h').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                calculateVolume('rectprism');
            }
        });

        // 5. منشور متوازی‌الاضلاع (Parallelepiped)
        document.getElementById('volume-par-height').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                calculateVolume('parallelepiped');
            }
        });

        // 6. کپسول (Capsule)
        document.getElementById('volume-capsule-h').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                calculateVolume('capsule');
            }
        });
        
        // 7. هرم (Pyramid)
        document.getElementById('volume-pyramid-h').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                calculateVolume('pyramid');
            }
        });

        // 8. مخروط (Cone)
        document.getElementById('volume-cone-h').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                calculateVolume('cone');
            }
        });
        
        // 9. مخروط ناقص (Frustum)
        document.getElementById('volume-frustum-h').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                calculateVolume('frustum');
            }
        });
        
        // 10. منشور شش‌ضلعی (Hexagonal Prism)
        document.getElementById('volume-hex-h').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                calculateVolume('hexprism');
            }
        });

        // Divisors
        function isPrime(num) {
            if (num <= 1) return false;
            for (let i = 2, s = Math.sqrt(num); i <= s; i++)
                if (num % i === 0) return false;
            return true;
        }

        function getPrimeFactorization(num) {
            const factors = {};
            let n = num;
            for (let i = 2; i * i <= n; i++) {
                while (n % i === 0) {
                    factors[i] = (factors[i] || 0) + 1;
                    n /= i;
                }
            }
            if (n > 1) factors[n] = (factors[n] || 0) + 1;
            return factors;
        }
        
        function formatFactorization(factors) {
             return Object.entries(factors)
                .map(([base, exp]) => exp > 1 ? `${base}^{${exp}}` : `${base}`)
                .join(' \\times ');
        }

        function getAllDivisors(num) {
            const divisors = new Set();
            for (let i = 1; i * i <= num; i++) {
                if (num % i === 0) {
                    divisors.add(i);
                    divisors.add(num / i);
                }
            }
            return Array.from(divisors).sort((a, b) => a - b);
        }

        function analyzeDivisors() {
            const num = parseInt(document.getElementById('divisor-input').value);
            const resultsEl = document.getElementById('divisor-results');
            
            if (isNaN(num) || num <= 0) {
                showMessageBox('خطا', 'لطفا یک عدد طبیعی وارد کنید.');
                resultsEl.classList.add('hidden');
                return;
            }
            
            const factors = getPrimeFactorization(num);
            const divisors = getAllDivisors(num);
            const primeDivisors = divisors.filter(d => isPrime(d));
            const compositeDivisors = divisors.filter(d => d > 1 && !isPrime(d));
            const evenDivisors = divisors.filter(d => d % 2 === 0);
            const oddDivisors = divisors.filter(d => d % 2 !== 0);

            document.getElementById('divisor-factorization').textContent = `$${formatFactorization(factors)}$`;
            document.getElementById('divisor-list').textContent = '{'+divisors.join(', ')+'}';
            document.getElementById('divisor-count').textContent = divisors.length;
            document.getElementById('divisor-prime-list').textContent = '{'+primeDivisors.join(', ')+'}';
            document.getElementById('divisor-prime-count').textContent = primeDivisors.length;
            document.getElementById('divisor-composite-list').textContent = '{'+compositeDivisors.join(', ')+'}';
            document.getElementById('divisor-composite-count').textContent = compositeDivisors.length;
            document.getElementById('divisor-even-count').textContent = evenDivisors.length;
            document.getElementById('divisor-odd-count').textContent = oddDivisors.length;
            document.getElementById('divisor-integer-count').textContent = divisors.length * 2;
            
            resultsEl.classList.remove('hidden');
            // Render KaTeX for the factorization
            if (window.renderMathInElement) {
                renderMathInElement(resultsEl, { delimiters: [{left: '$', right: '$', display: false}] });
            }
        }

        document.getElementById('divisor-input').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                analyzeDivisors();
            }
        });

        // Sequence Tools
        document.getElementById('sequence-type-tabs').addEventListener('click', (e) => {
            if (e.target.classList.contains('seq-type-tab-btn')) {
                document.querySelectorAll('.seq-type-tab-btn').forEach(btn => {
                    btn.classList.remove('text-green-600', 'border-green-600');
                    btn.classList.add('text-gray-500', 'border-transparent', 'hover:text-gray-700', 'hover:border-gray-300');
                });
                e.target.classList.add('text-green-600', 'border-green-600');
                e.target.classList.remove('text-gray-500', 'border-transparent', 'hover:text-gray-700', 'hover:border-gray-300');
                
                document.querySelectorAll('.seq-type-content').forEach(content => content.classList.add('hidden'));
                document.getElementById(e.target.dataset.target).classList.remove('hidden');
            }
        });

	const sequenceFormulas = {
            'arithmetic': {
                'nth': {
                    latex: '$$a_n = a_1 + (n - 1)d$$',
                    inputs: [
                    	{ id: 'seq-arith-a1', placeholder: 'جمله اول (a₁)', type: 'number' },
                    	{ id: 'seq-arith-d', placeholder: 'قدر نسبت (d)', type: 'number' },
                    	{ id: 'seq-arith-n', placeholder: 'تعداد جملات (n)', type: 'number' },
                    ]
                },
                'sum_n': {
                    latex: '$$S_n = \\frac{n}{2}(2a_1 + (n - 1)d)$$',
                    inputs: [
                    	{ id: 'seq-arith-sumn-a1', placeholder: 'جمله اول (a₁)', type: 'number' },
                    	{ id: 'seq-arith-sumn-d', placeholder: 'قدر نسبت (d)', type: 'number' },
                    	{ id: 'seq-arith-sumn-n', placeholder: 'شماره جمله (n)', type: 'number' },
                    ]
                },
                'sum_fl': {
                    latex: '$$S_n = \\frac{n(a_1 + a_n)}{2}$$',
                    inputs: [
                    	{ id: 'seq-arith-sumfl-a1', placeholder: 'جمله اول (a₁)', type: 'number' },
                    	{ id: 'seq-arith-sumfl-an', placeholder: 'جمله آخر (aₙ)', type: 'number' },
                    	{ id: 'seq-arith-sumfl-n', placeholder: 'تعداد جملات (n)', type: 'number' },
                    ]
                }
            },
            'geometric': {
                'nth': {
                    latex: '$$a_n = a_1 r^{n-1}$$',
                    inputs: [
                    	{ id: 'seq-geom-a1', placeholder: 'جمله اول (a₁)', type: 'number' },
                    	{ id: 'seq-geom-r', placeholder: 'قدر نسبت (r)', type: 'number' },
                    	{ id: 'seq-geom-n', placeholder: 'شماره جمله (n)', type: 'number' },
                    ]
                },
                'sum_n': {
                    latex: '$$S_n = a_1 \\frac{1-r^n}{1-r}$$',
                    inputs: [
                    	{ id: 'seq-geom-sumn-a1', placeholder: 'جمله اول (a₁)', type: 'number' },
                    	{ id: 'seq-geom-sumn-r', placeholder: 'قدر نسبت (r)', type: 'number' },
                    	{ id: 'seq-geom-sumn-n', placeholder: 'تعداد جملات (n)', type: 'number' },
                    ]
                },
                'sum_inf': {
                    latex: '$$S_\\infty = \\frac{a_1}{1-r}, |r|<1$$',
                    inputs: [
                    	{ id: 'seq-geom-suminf-a1', placeholder: 'جمله اول (a₁)', type: 'number' },
                    	{ id: 'seq-geom-suminf-r', placeholder: 'قدر نسبت (r), |r|<1', type: 'number' },
                    ]
                }
            }
	}

	function toggleDropdown(triggerElement) {
            document.querySelectorAll('.custom-select-options').forEach(options => {
                if (options.id !== triggerElement.nextElementSibling.id) {
                    options.classList.add('hidden');
                }
            });
            document.querySelectorAll('.custom-select svg').forEach(svg => {
                if (svg.id !== triggerElement.querySelector('svg').id) {
                    svg.classList.remove('rotate-180');
                }
            });
            const optionsDiv = triggerElement.nextElementSibling;
            optionsDiv.classList.toggle('hidden');
            const chevron = triggerElement.querySelector('svg');
            chevron.classList.toggle('rotate-180');
	}

	function selectSequenceOperation(sequenceType, operationValue, operationLabel) {
            const triggerBtn = document.getElementById(`${sequenceType}-operation`);
            const labelSpan = document.getElementById(`${sequenceType}-operation-label`);
            const optionsDiv = document.getElementById(`${sequenceType}-operation-options`);
            const chevron = document.getElementById(`${sequenceType}-chevron`);
            triggerBtn.setAttribute('data-operation', operationValue);
            labelSpan.textContent = operationLabel;
            optionsDiv.classList.add('hidden');
            chevron.classList.remove('rotate-180');
            showSequenceFields(sequenceType, operationValue);
	}

	document.addEventListener('click', (e) => {
            if (!e.target.closest('.custom-select-container')) {
                document.querySelectorAll('.custom-select-options').forEach(options => options.classList.add('hidden'));
                document.querySelectorAll('.custom-select svg').forEach(svg => svg.classList.remove('rotate-180'));
            }
	});

	function showSequenceFields(sequenceType, operation = null) {
            if (!operation) {
                operation = document.getElementById(`${sequenceType}-operation`)?.getAttribute('data-operation');
            }
            const container = document.getElementById(`${sequenceType}-fields-container`);
            const resultEl = document.getElementById(`${sequenceType}-result`);
            container.innerHTML = '';
            resultEl.textContent = '';
            if (!operation || !sequenceFormulas[sequenceType] || !sequenceFormulas[sequenceType][operation]) {
                container.innerHTML = '<p class="text-center text-gray-500">پس از انتخاب عملیات، فرمول و کادرهای ورودی نمایش داده می‌شود.</p>';
                return;
            }
            const { latex, inputs } = sequenceFormulas[sequenceType][operation];
            const latexDiv = document.createElement('p');
            latexDiv.className = 'text-center text-xl font-semibold';
            latexDiv.innerHTML = latex;
            container.appendChild(latexDiv);
            inputs.forEach(input => {
                const inputEl = document.createElement('input');
                inputEl.type = input.type;
                inputEl.id = input.id;
                inputEl.dir = 'ltr';
                inputEl.className = 'p-2 focus:outline-none border text-center bg-white rounded-lg w-full';
                inputEl.placeholder = input.placeholder;
                container.appendChild(inputEl);
            });
            if (window.renderMathInElement) {
                window.renderMathInElement(container);
            }
	}

	function calculateSequence(sequenceType) {
            const operation = document.getElementById(`${sequenceType}-operation`)?.getAttribute('data-operation');
            const resultEl = document.getElementById(`${sequenceType}-result`);

            if (sequenceType === 'arithmetic') {
                if (operation === 'nth') return calculateArithmeticNth(resultEl);
                if (operation === 'sum_n') return calculateArithmeticSumNTerms(resultEl);
                if (operation === 'sum_fl') return calculateArithmeticSumFirstLast(resultEl);
            }

            else if (sequenceType === 'geometric') {
                if (operation === 'nth') return calculateGeometricNth(resultEl);
                if (operation === 'sum_n') return calculateGeometricSumNTerms(resultEl);
                if (operation === 'sum_inf') return calculateGeometricSumInfinite(resultEl);
            }

            else if (sequenceType === 'triangular') {
                return calculateTriangular(resultEl);
            }
            else if (sequenceType === 'fibonacci') {
                return calculateFibonacci(resultEl);
            }
            resultEl.textContent = 'لطفاً عملیات مورد نظر را انتخاب کنید.';
            resultEl.className = 'mt-4 text-xl text-center font-bold text-gray-500';
	}

        function calculateArithmeticNth(resultEl) {
            const a1 = parseFloat(document.getElementById('seq-arith-a1')?.value);
            const d = parseFloat(document.getElementById('seq-arith-d')?.value);
            const n = parseFloat(document.getElementById('seq-arith-n')?.value);


            if (isNaN(a1) || isNaN(d) || isNaN(n)) {
                resultEl.textContent = 'خطا: لطفا تمام مقادیر را وارد کنید.';
                resultEl.className = 'mt-2 text-2xl text-center font-bold text-red-600';
                return;
            }
            if (!Number.isInteger(n) || n <= 0) {

                resultEl.textContent = 'خطا: تعداد جملات (n) باید یک عدد طبیعی باشد.';

                resultEl.className = 'mt-2 text-2xl text-center font-bold text-red-600';

                return;

            }

            const an = a1 + (n - 1) * d;
            const anLatex = toLatexScientificNotation(an); // 💡 اعمال تبدیل
            resultEl.innerHTML = `جمله ${n}-ام برابر است با:` + `<br>` + `$a_{${n}}=${anLatex}$`;
            resultEl.className = 'text-2xl text-center font-bold text-green-600';
	    if (window.renderMathInElement) window.renderMathInElement(resultEl, { delimiters: [{left: '$', right: '$', display: false}] });
        }

        function calculateArithmeticSumFirstLast(resultEl) {
            const a1 = parseFloat(document.getElementById('seq-arith-sumfl-a1')?.value);
            const an = parseFloat(document.getElementById('seq-arith-sumfl-an')?.value);
            const n = parseFloat(document.getElementById('seq-arith-sumfl-n')?.value);


            if (isNaN(a1) || isNaN(an) || isNaN(n)) {
                resultEl.textContent = 'خطا: لطفا تمام مقادیر را وارد کنید.';
                resultEl.className = 'mt-2 text-2xl text-center font-bold text-red-600';
                return;
            }
            if (!Number.isInteger(n) || n <= 0) {

                resultEl.textContent = 'خطا: تعداد جملات (n) باید یک عدد طبیعی باشد.';

                resultEl.className = 'mt-2 text-2xl text-center font-bold text-red-600';

                return;

            }
            const sn = toLatexScientificNotation((n / 2) * (a1 + an));
            resultEl.innerHTML = `مجموع ${n} جمله برابر است با:`+`<br>`+ `$S_{${n}}=${sn}$`;
            resultEl.className = 'mt-2 text-2xl text-center font-bold text-green-600';
	    if (window.renderMathInElement) window.renderMathInElement(resultEl, { delimiters: [{left: '$', right: '$', display: false}] });
        }

        function calculateArithmeticSumNTerms(resultEl) {
            const a1 = parseFloat(document.getElementById('seq-arith-sumn-a1')?.value);
            const d = parseFloat(document.getElementById('seq-arith-sumn-d')?.value);
            const n = parseFloat(document.getElementById('seq-arith-sumn-n')?.value);


            if (isNaN(a1) || isNaN(d) || isNaN(n)) {
                resultEl.textContent = 'خطا: لطفا تمام مقادیر را وارد کنید.';
                resultEl.className = 'mt-2 text-2xl text-center font-bold text-red-600';
                return;
            }
            if (!Number.isInteger(n) || n <= 0) {

                resultEl.textContent = 'خطا: تعداد جملات (n) باید یک عدد طبیعی باشد.';

                resultEl.className = 'mt-2 text-2xl text-center font-bold text-red-600';

                return;

            }
            const sn = toLatexScientificNotation((n / 2) * (2 * a1 + (n - 1) * d));
            resultEl.innerHTML = `مجموع ${n} جمله برابر است با:`+`<br>`+`$S_{${n}}=${sn}$`;
            resultEl.className = 'mt-2 text-2xl text-center font-bold text-green-600';
	    if (window.renderMathInElement) window.renderMathInElement(resultEl, { delimiters: [{left: '$', right: '$', display: false}] });
        }

        function calculateGeometricNth(resultEl) {
            const a1 = parseFloat(document.getElementById('seq-geom-a1')?.value);
            const r = parseFloat(document.getElementById('seq-geom-r')?.value);
            const n = parseFloat(document.getElementById('seq-geom-n')?.value);


            if (isNaN(a1) || isNaN(r) || isNaN(n)) {
                resultEl.textContent = 'خطا: لطفا تمام مقادیر را وارد کنید.';
                resultEl.className = 'mt-2 text-2xl text-center font-bold text-red-600';
                return;
            }
            if (!Number.isInteger(n) || n <= 0) {

                resultEl.textContent = 'خطا: تعداد جملات (n) باید یک عدد طبیعی باشد.';

                resultEl.className = 'mt-2 text-2xl text-center font-bold text-red-600';

                return;

            }
            const an = toLatexScientificNotation(a1 * Math.pow(r, n - 1));
            resultEl.innerHTML = `جمله ${n}-ام برابر است با:` + `<br>`+ `$a_{${n}}=${an}$`;
            resultEl.className = 'mt-2 text-2xl text-center font-bold text-green-600';
	    if (window.renderMathInElement) window.renderMathInElement(resultEl, { delimiters: [{left: '$', right: '$', display: false}] });
        }

        function calculateGeometricSumNTerms(resultEl) {
            const a1 = parseFloat(document.getElementById('seq-geom-sumn-a1')?.value);
            const r = parseFloat(document.getElementById('seq-geom-sumn-r')?.value);
            const n = parseFloat(document.getElementById('seq-geom-sumn-n')?.value);


            if (isNaN(a1) || isNaN(r) || isNaN(n)) {
                resultEl.textContent = 'خطا: لطفا تمام مقادیر را وارد کنید.';
                resultEl.className = 'mt-2 text-2xl text-center font-bold text-red-600';
                return;
            }
            if (!Number.isInteger(n) || n <= 0) {

                resultEl.textContent = 'خطا: تعداد جملات (n) باید یک عدد طبیعی باشد.';

                resultEl.className = 'mt-2 text-2xl text-center font-bold text-red-600';

                return;

            }
            let sn;
            if (r === 1) {
                sn = a1 * n;
            } else {
                sn = a1 * (1 - Math.pow(r, n)) / (1 - r);
            }
            const SumN = toLatexScientificNotation(sn)
            resultEl.innerHTML = `مجموع ${n} جمله اول برابر است با:`+`<br>`+ `$S_{${n}}=${SumN}$`;
            resultEl.className = 'mt-2 text-2xl text-center font-bold text-green-600';
	    if (window.renderMathInElement) window.renderMathInElement(resultEl, { delimiters: [{left: '$', right: '$', display: false}] });
        }
        
        function calculateGeometricSumInfinite(resultEl) {
            const a1 = parseFloat(document.getElementById('seq-geom-suminf-a1')?.value);
            const r = parseFloat(document.getElementById('seq-geom-suminf-r')?.value);


            if (isNaN(a1) || isNaN(r) || Math.abs(r) >= 1) {
                resultEl.textContent = 'خطا: مقادیر را به درستی وارد کنید. (قدر نسبت r باید بین -1 و 1 باشد)';
                resultEl.className = 'mt-2 text-2xl text-center font-bold text-red-600';
                return;
            }
            const s_inf = toLatexScientificNotation(a1 / (1 - r));
            resultEl.innerHTML = `مجموع نامتناهی برابر است با:`+`<br>` + `$S_{\\infty}=${s_inf}$`;
            resultEl.className = 'mt-2 text-2xl text-center font-bold text-green-600';
	    if (window.renderMathInElement) window.renderMathInElement(resultEl, { delimiters: [{left: '$', right: '$', display: false}] });
        }

        function calculateTriangular(resultEl) {
            const n = parseFloat(document.getElementById('triangular-n')?.value);

            if (isNaN(n) || !Number.isInteger(n) || n <= 0) {
                resultEl.textContent = 'خطا: شماره جمله (n) باید یک عدد طبیعی باشد.';
                resultEl.className = 'mt-2 text-2xl text-center font-bold text-red-600';
                return;
            }
            const tn = toLatexScientificNotation((n * (n + 1)) / 2);
            resultEl.innerHTML = `عدد مثلثی ${n}-ام برابر است با:`+`<br>`+ `$T_{${n}}=${tn}$`;
            resultEl.className = 'mt-2 text-2xl text-center font-bold text-green-600';
	    if (window.renderMathInElement) window.renderMathInElement(resultEl, { delimiters: [{left: '$', right: '$', display: false}] });
        }

        function calculateFibonacci(resultEl) {
            const n = parseFloat(document.getElementById('fibonacci-n')?.value);


            if (isNaN(n)|| !Number.isInteger(n) || n <= 0 || n > 1500) {
                resultEl.textContent = 'خطا: شماره جمله (n) باید یک عدد صحیح و مثبت باشد (حداکثر تا 1500).';
                resultEl.className = 'mt-2 text-2xl text-center font-bold text-red-600';
                return;
            }
            if (n === 1 || n === 2) {
                var fn = 1n; // 1n نشان دهنده BigInt است
            } else {
                let a = 1n
                b = 1n;
                for (let i = 3; i <= n; i++) {
                	const next = a + b;
                	a = b;
                	b = next;
                }
                var fn = b;
            }
            resultEl.innerHTML = `جمله ${n}-ام فیبوناچی برابر است با:<br>$F_{${n}}=${fn.toString()}$`;
            resultEl.className = 'mt-2 text-2xl text-center font-bold text-green-600';
	    if (window.renderMathInElement) window.renderMathInElement(resultEl, { delimiters: [{left: '$', right: '$', display: false}] });
        }

        document.getElementById('fibonacci-n').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                calculateSequence('fibonacci')
            }
        });

        document.getElementById('triangular-n').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                calculateSequence('triangular')
            }
        });

        // Venn Diagram
    function getPlotColors() {
        const isDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    
        if (isDarkMode) {
            return {
                background: '#121212', // پس‌زمینه Canvas (تیره)
                universeFill: '#000000', // رنگ داخل یونیورس (تیره مطلق)
                universeStroke: '#9ca3af', // مرز یونیورس (روشن)
                text: '#e5e7eb', // رنگ متن (روشن)
                hatchStroke: 'rgba(229, 231, 235, 0.7)', // رنگ خطوط هاشور (روشن‌تر)
                outlineStroke: 'rgba(229, 231, 235, 0.9)', // رنگ مرز دایره‌ها (روشن)
            };
        } else {
            return {
                background: '#e2e8f0', // پس‌زمینه Canvas (روشن)
                universeFill: '#ffffff', // رنگ داخل یونیورس (سفید)
                universeStroke: '#000000', // مرز یونیورس (تیره)
                text: '#334155', // رنگ متن (تیره)
                hatchStroke: 'rgba(0, 0, 0, 0.5)', // رنگ خطوط هاشور (تیره)
                outlineStroke: 'rgba(0, 0, 0, 0.8)', // رنگ مرز دایره‌ها (تیره)
            };
        }
    }


    let hatchPattern;

    function createHatchPattern() {
        const colors = getPlotColors();
        const hatchCanvas = document.createElement('canvas');
        const hatchCtx = hatchCanvas.getContext('2d');
        hatchCanvas.width = 10;
        hatchCanvas.height = 10;
    
        hatchCtx.strokeStyle = colors.hatchStroke;
        hatchCtx.lineWidth = 1;
        hatchCtx.beginPath();
        hatchCtx.moveTo(0, 0);
        hatchCtx.lineTo(10, 10);
        hatchCtx.moveTo(0, 10);
        hatchCtx.lineTo(10, 0);
        hatchCtx.stroke();
    
        return hatchCanvas.getContext('2d').createPattern(hatchCanvas, 'repeat');
    }

    function initializeVennDiagram() {
        // باید هر بار که حالت تاریک تغییر می‌کند یا اولین بار، الگو را بسازیم
        hatchPattern = createHatchPattern(); 
        drawVennDiagram(); // Draw a default empty state
    }

// برای اطمینان از به روز رسانی هنگام تغییر حالت سیستم
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
        initializeVennDiagram();
        isDarkMode();
        initThree();
    });

    function drawVennDiagram() {
        const colors = getPlotColors(); // دریافت رنگ‌های دینامیک
        const canvas = document.getElementById('venn-canvas');
        const container = canvas.parentElement;
        const containerWidth = container.clientWidth - 10;
        const containerHeight = container.clientHeight;

        canvas.width = containerWidth;
        canvas.height = 400;
        const ctx = canvas.getContext('2d');
        const expr = document.getElementById('venn-input').value;

        // Simple parsing to detect sets
        const hasA = /[Aa]/.test(expr) || expr.trim() === "";
        const hasB = /[Bb]/.test(expr) || expr.trim() === "";
        const hasC = /[Cc]/.test(expr);

        const numSets = (hasA ? 1 : 0) + (hasB ? 1 : 0) + (hasC ? 1 : 0);

        // --- NEW ROBUST PARSER (بدون تغییر) ---
        let safeExpr = expr.trim()
            .replace(/\\cap/g, ' & ').replace(/\cap/g, ' & ').replace(/\^/g, ' & ').replace(/∩/g, ' & ') // intersection
            .replace(/\\cup/g, ' | ').replace(/\cup/g, ' | ').replace(/\+/g, ' | ').replace(/∪/g, ' | ') // union
            .replace(/\\Delta/g, ' ^ ').replace(/Δ/g, ' ^ ') // symmetric difference (JS XOR)
            .replace(/'/g, 'c').replace(/\^c/g, 'c') // normalize complement
            .replace(/[Aa]/g, 'A')
            .replace(/[Bb]/g, 'B')
            .replace(/[Cc]/g, 'C')
            .replace(/\b[Uu]\b/g, '(true)'); // Universe set (word boundary)

        // Handle complement 'c' applied to single letters, groups, or complex terms
        for (let i = 0; i < 5; i++) {
            // Case 1: Single letter complement (Ac, Bc, Cc)
            safeExpr = safeExpr.replace(/([A-Z])c/g, ' (!($1)) ');

            // Case 2: Parenthesized expression complement ((A | B)c)
            safeExpr = safeExpr.replace(/\((.*?)\)c/g, '(!($1))');
        }
        // Handle more complex nesting like ((A|B)|C)c
        for (let i = 0; i < 5; i++) {
            safeExpr = safeExpr.replace(/\((.*?)\)c/g, '(!($1))');
        }

        // Handle difference '-'
        // A - B -> (A & !B)
        safeExpr = safeExpr.replace(/\s*-\s*/g, ' & !');

        if (safeExpr.trim() === "") safeExpr = "false";
        // --- END NEW PARSER ---

        let evaluator;
        try {
            evaluator = new Function('A', 'B', 'C', `return ${safeExpr};`);
            // Test the evaluator to catch syntax errors early
            evaluator(true, false, true);
        } catch (e) {
            console.error("Venn parse error:", e);
            console.error("Failed expression:", safeExpr);
            showMessageBox('خطای عبارت', `عبارت وارد شده نامعتبر است: ${e.message}. عبارت ترجمه شده: ${safeExpr}`);
            return;
        }

        // Clear canvas
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // --- Draw Universe (U) ---
        // 1. Fill entire canvas with background color (برای حالت تاریک)
        ctx.fillStyle = colors.background;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // 2. Draw Universe (U) Box
        ctx.strokeStyle = colors.universeStroke;
        ctx.lineWidth = 2;
        ctx.strokeRect(5, 5, canvas.width - 22, canvas.height - 10);
    
        // 3. Fill the Universe Box
        ctx.fillStyle = colors.universeFill;
        ctx.fillRect(5, 5, canvas.width - 22, canvas.height - 10);

        // 4. Draw Universe Label
        ctx.fillStyle = colors.text; // استفاده از رنگ متن دینامیک
        ctx.font = '22px "Cambria Math", serif';
        ctx.fillText('U', 25, 25);

        // Define circle geometries
        const r = 70;
        const c1 = { x: canvas.width / 2 - (numSets > 1 ? r / 1.5 : 0), y: canvas.height / 2 - (numSets === 3 ? r / 2 : 0) };
        const c2 = { x: canvas.width / 2 + (numSets > 1 ? r / 1.5 : 0), y: canvas.height / 2 - (numSets === 3 ? r / 2 : 0) };
        const c3 = { x: canvas.width / 2, y: canvas.height / 2 + r / 1.2 };

        const pathA = new Path2D();
        if (hasA) pathA.arc(c1.x, c1.y, r, 0, 2 * Math.PI);

        const pathB = new Path2D();
        if (hasB) pathB.arc(c2.x, c2.y, r, 0, 2 * Math.PI);

        const pathC = new Path2D();
        if (hasC) pathC.arc(c3.x, c3.y, r, 0, 2 * Math.PI);

        // --- REDESIGNED DRAWING ORDER ---

        // 1. Draw semi-transparent base fills
        ctx.lineWidth = 2;
        if (hasA) { ctx.fillStyle = 'rgba(255, 87, 87, 0.33)'; ctx.fill(pathA); } // Red-ish
        if (hasB) { ctx.fillStyle = 'rgba(87, 87, 255, 0.33)'; ctx.fill(pathB); } // Blue-ish
        if (hasC) { ctx.fillStyle = 'rgba(87, 255, 87, 0.33)'; ctx.fill(pathC); } // Green-ish

        // 2. Draw shaded region (hatching) by iterating pixels
        // الگو (Pattern) باید قبل از این مرحله دوباره ایجاد شده باشد، چون رنگ هاشور تغییر کرده است.
        ctx.fillStyle = hatchPattern;
        const step = 2; // Check every 2 pixels for performance
        for (let x = 0; x < canvas.width; x += step) {
            for (let y = 0; y < canvas.height; y += step) {
                // Check if point is inside the Universe bounding box (5, 5) to (width-22, height-10)
                const inUniverse = x >= 5 && x <= canvas.width - 22 && y >= 5 && y <= canvas.height - 10;
                if (!inUniverse) continue; 

                const inA = hasA && ctx.isPointInPath(pathA, x, y);
                const inB = hasB && ctx.isPointInPath(pathB, x, y);
                const inC = hasC && ctx.isPointInPath(pathC, x, y);

                try {
                    if (evaluator(inA, inB, inC)) {
                        ctx.fillRect(x, y, step, step);
                    }
                } catch (e) { /* ignore eval errors during iteration, caught above */ }
            }
        }

        // 3. Draw circle outlines (on top of shading)
        ctx.strokeStyle = colors.outlineStroke; // استفاده از رنگ مرز دینامیک
        ctx.font = '22px "Cambria Math", serif';

        if (hasA) {
            ctx.stroke(pathA);
            ctx.fillStyle = colors.text; // استفاده از رنگ متن دینامیک
            ctx.fillText('A', c1.x - r - 10, c1.y);
        }
        if (hasB) {
            ctx.stroke(pathB);
            ctx.fillStyle = colors.text; // استفاده از رنگ متن دینامیک
            ctx.fillText('B', c2.x + r + 20, c2.y);
        }
        if (hasC) {
            ctx.stroke(pathC);
            ctx.fillStyle = colors.text; // استفاده از رنگ متن دینامیک
            ctx.fillText('C', c3.x, c3.y + r + 20);
        }
    }

    document.getElementById('venn-input').addEventListener('keydown', (event) => {
        if (event.key === 'Enter') {
            event.preventDefault();
            drawVennDiagram();
        }
    });

    function calculateMultiGcdLcm() {
        const inputVal = document.getElementById('gcd-lcm-input').value;
        const resultEl = document.getElementById('gcd-lcm-result');
        resultEl.style.color = isDarkMode ? 'white' : 'black';

        try {
            // استخراج اعداد از رشته (جداکننده: فاصله یا کاما)
            const nums = inputVal.split(/[\s,]+/).map(n => parseInt(n)).filter(n => !isNaN(n) && n > 0);

            if (nums.length < 2) {
                throw new Error("لطفاً حداقل دو عدد مثبت وارد کنید.")
            }

            // توابع پایه
            const gcd2 = (a, b) => b === 0 ? a : gcd2(b, a % b);
            const lcm2 = (a, b) => (a * b) / gcd2(a, b);

            // محاسبه برای کل آرایه
            const finalGcd = nums.reduce((acc, curr) => gcd2(acc, curr));
            const finalLcm = nums.reduce((acc, curr) => lcm2(acc, curr));

            // ساخت نمایش لاتکس
            const numsJoined = nums.join(', ');
            const latexGcd = `(${numsJoined}) = \\boxed{${finalGcd}}`;
            const latexLcm = `[${numsJoined}] = \\boxed{${finalLcm}}`;

            resultEl.classList.remove('hidden');
            resultEl.innerHTML = `
                <div class="text-black mb-4">$${latexGcd}$</div>
                <div class="text-black">$${latexLcm}$</div>
            `;

        } catch (error) {
            resultEl.classList.remove('hidden');
            resultEl.textContent = `خطا: ${error.message}`;
            resultEl.style.color = 'red';
        }

        // رندر کردن لاتکس (KaTeX یا MathJax)
        if (window.renderMathInElement) {
            renderMathInElement(resultEl, { delimiters: [{left: '$', right: '$', display: false}] });
        }
    }
    document.getElementById('gcd-lcm-input').addEventListener('keydown', (event) => {
        if (event.key === 'Enter') {
            event.preventDefault();
            calculateMultiGcdLcm();
        }
    });
    document.getElementById('gcd-lcm-input').addEventListener('input', function(e) {
        // ۱. تبدیل اعداد فارسی/عربی به انگلیسی
        let value = e.target.value;
        const farsiDigits = ['۰', '۱', '۲', '۳', '۴', '۵', '۶', '۷', '۸', '۹'];
        const arabicDigits = ['٠', '١', '٢', '٣', '٤', '٥', '٦', '٧', '٨', '٩'];
        
        for (let i = 0; i < 10; i++) {
            value = value.replace(new RegExp(farsiDigits[i], 'g'), i)
                        .replace(new RegExp(arabicDigits[i], 'g'), i);
        }

        // ۲. حذف کاراکترهای غیرمجاز (به جز عدد، فاصله و کاما)
        e.target.value = value.replace(/[^0-9, \s]/g, '');
    });

    let vectorCount = 2;
    let scene, camera, renderer, arrows = [], controls;

    // ایجاد ردیف جدید ورودی
    function addVectorRow() {
        vectorCount++;
        const div = document.createElement('div');
        div.className = "flex gap-2 items-center wipeLeft";
        div.id = `v-row-${vectorCount}`;
        div.dir = "ltr";
        div.innerHTML = `
            <span class="w-10 font-bold text-gray-600">$\\vec{V_{${vectorCount}}}:$</span>
            <input type="number" step="any" placeholder="x" class="v-x p-2 focus:outline-none border bg-white text-center rounded-lg w-full">
            <input type="number" step="any" placeholder="y" class="v-y p-2 focus:outline-none border bg-white text-center rounded-lg w-full">
            <input type="number" step="any" placeholder="z" class="v-z p-2 focus:outline-none border bg-white text-center rounded-lg w-full">
            <button onclick="removeVectorRow()" class="p-2 text-red-500 hover:text-red-700 shrink-0" title="حذف بردار">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
            </button>
        `;
        document.getElementById('vector-list').appendChild(div);
        if (window.renderMathInElement) {
            renderMathInElement(div, { delimiters: [{left: '$', right: '$', display: false}] });
        }
    }
    function removeVectorRow() {
        if (vectorCount > 2) {
            const row = document.getElementById(`v-row-${vectorCount}`);
            if (row) {
                row.remove();
                vectorCount--;
            }
        }
    }

    // تابع کمکی برای تشخیص تم فعلی (اگر کلاس dark در body یا html دارید)
    function getThemeColors() {
        if (isDarkMode) {
            return {
                background: 0x0f172a,
                grid: 0x334155,
                axes: 0x94a3b8
            };
        } else {
            return {
                background: 0xffffff,
                grid: 0xe2e8f0,
                axes: 0x64748b
            };
        }
    }

    let vectorColors
    if (isDarkMode) {
        vectorColors = [
            0xff4444, // V1: قرمز روشن
            0x44ff44, // V2: سبز نئونی
            0x9333ea, // V3: آبی آسمانی
            0xff00ff, // V4: سرخابی
            0xffa500, // V5: نارنجی
            0x00ffff,  // V6: فیروزه‌ای
            0xffffff,
            0xffffff,
            0xffffff,
            0xffffff,
            0xffffff,
            0xffffff,
            0xffffff,
            0xffffff
        ]
    } else {
        vectorColors = [
            0xff4444, // V1: قرمز روشن
            0x44ff44, // V2: سبز نئونی
            0x9333ea, // V3: آبی آسمانی
            0xff00ff, // V4: سرخابی
            0xffa500, // V5: نارنجی
            0x00ffff,  // V6: فیروزه‌ای
            0x000000,
            0x000000,
            0x000000,
            0x000000,
            0x000000,
            0x000000,
            0x000000,
            0x000000
        ]
    }

    // مقداردهی اولیه Three.js
    // اضافه کردن تابع برای تنظیم سایز هنگام باز شدن ابزار
    function onWindowResize() {
        const container = document.getElementById('three-container');
        if (!container || !renderer) return;
        
        camera.aspect = container.clientWidth / container.clientHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(container.clientWidth, container.clientHeight);
    }

    function initThree() {
        const container = document.getElementById('three-container');
        if (container.clientWidth === 0) return; // جلوگیری از خطا در حالت hidden
        const colors = getThemeColors();

        scene = new THREE.Scene();
        if (isDarkMode) {
            scene.background = new THREE.Color(0x0f172a);
            const gridHelper = new THREE.GridHelper(10, 10, 0x444455, 0x222233);
            const axesHelper = new THREE.AxesHelper(5);
            scene.add(gridHelper);
            scene.add(axesHelper);
        } else {
            scene.background = new THREE.Color(0xffffff);
            const gridHelper = new THREE.GridHelper(10, 10, 0xe2e8f0, 0xebebeb);
            const axesHelper = new THREE.AxesHelper(5);
            scene.add(gridHelper);
            scene.add(axesHelper);
        }
        
        
        camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
        
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(container.clientWidth, container.clientHeight);
        renderer.setPixelRatio(window.devicePixelRatio); // برای کیفیت بهتر در موبایل
        container.appendChild(renderer.domElement);

        // تعریف رندرر (اگر از قبل تعریف نشده)
        if (!renderer) {
            renderer = new THREE.WebGLRenderer({ antialias: true });
            container.appendChild(renderer.domElement);
        }
        renderer.setSize(container.clientWidth, container.clientHeight);

        // بخش کلیدی: فعال‌سازی کنترل موس
        try {
            // دقت کنید: دیگر THREE. ندارد، چون مستقیماً وارد شده
            controls = new OrbitControls(camera, renderer.domElement); 
            
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            console.log("کنترل موس با موفقیت فعال شد");

            // مخصوص موبایل:
            controls.enableTouchRotate = true; // فعال‌سازی چرخش با لمس
            controls.touchAction = 'none'; // جلوگیری از اسکرول خوردن کل صفحه موقع چرخاندن مدل
        } catch (e) {
            console.error("خطا در OrbitControls:", e);
        }

        const light = new THREE.AmbientLight(0xffffff, 1);
        scene.add(light);

        function createAxisLabel(text, position, color) {
            const canvas = document.createElement('canvas');
            canvas.width = 64;
            canvas.height = 64;
            const ctx = canvas.getContext('2d');
            ctx.font = 'bold 24px Cambria Math';
            ctx.fillStyle = color;
            ctx.textAlign = 'center';
            ctx.fillText(text, 32, 48);

            const texture = new THREE.CanvasTexture(canvas);
            const spriteMaterial = new THREE.SpriteMaterial({ map: texture });
            const sprite = new THREE.Sprite(spriteMaterial);
            sprite.position.copy(position);
            sprite.scale.set(1, 1, 1);
            return sprite;
        }

        // اضافه کردن به صحنه (انتهای تابع initThree)
        scene.add(createAxisLabel('X', new THREE.Vector3(5.5, 0, 0), '#ff4444')); // قرمز
        scene.add(createAxisLabel('Y', new THREE.Vector3(0, 5.5, 0), '#44ff44')); // سبز
        scene.add(createAxisLabel('Z', new THREE.Vector3(0, 0, 5.5), '#4444ff')); // آبی

        camera.position.set(5, 5, 8);
        camera.lookAt(0, 0, 0);
        animate();
    }

    function animate() {
        requestAnimationFrame(animate);
        
        // ابتدا چک می‌کنیم که آیا کنترل‌ها وجود دارند یا خیر
        if (controls && typeof controls.update === 'function') {
            controls.update();
        }

        // اگر می‌خواهید چرخش خودکار داشته باشید، فقط زمانی که کاربر با موس کار نمی‌کند بچرخد
        // نکته: OrbitControls ویژگی به نام active ندارد، باید از متغیر خودمان استفاده کنیم یا حذفش کنیم
        if (scene && renderer && camera) {
            scene.rotation.y += 0.001; // اگر چرخش خودکار می‌خواهید این را فعال کنید
            renderer.render(scene, camera);
        }
    }

    // محاسبات اصلی
    function calculateAll(type) {
        if (!scene) initThree();
        const colors = getThemeColors();
        scene.background.set(colors.background);
        const rows = document.querySelectorAll('#vector-list > div');
        const vecs = Array.from(rows).map(row => ({
            x: parseFloat(row.querySelector('.v-x').value) || 0,
            y: parseFloat(row.querySelector('.v-y').value) || 0,
            z: parseFloat(row.querySelector('.v-z').value) || 0
        }));

        if (vecs.length < 2) return alert("لطفاً حداقل دو بردار وارد کنید.");

        let res = { x: 0, y: 0, z: 0 };
        let latexStr = "";

        // محاسبات پایه برای دو بردار اول
        const v1 = vecs[0];
        const v2 = vecs[1];
        const mag1 = Math.sqrt(v1.x**2 + v1.y**2 + v1.z**2);
        const mag2 = Math.sqrt(v2.x**2 + v2.y**2 + v2.z**2);
        const dotProduct = (v1.x * v2.x) + (v1.y * v2.y) + (v1.z * v2.z);
        
        // محاسبه زاویه بین دو بردار
        let angleDeg = 0;
        if (mag1 > 0 && mag2 > 0) {
            let cosTheta = dotProduct / (mag1 * mag2);
            cosTheta = Math.max(-1, Math.min(1, cosTheta)); // برای جلوگیری از خطای محاسباتی
            angleDeg = (Math.acos(cosTheta) * 180 / Math.PI).toFixed(3);
        }

        // پاک کردن بردارهای قبلی از صحنه
        arrows.forEach(a => scene.remove(a));
        arrows = [];

        if (type === 'sum') {
            vecs.forEach(v => { res.x += v.x; res.y += v.y; res.z += v.z; });
            latexStr = `\\vec{R} = \\sum_{i=1}^{${vecs.length}} \\vec{V}_i = \\begin{bmatrix} {${res.x}} \\\\ {${res.y}} \\\\ {${res.z}} \\end{bmatrix} = (${res.x}, ${res.y}, ${res.z})`;
        } else if (type === 'diff') {
            // تفاضل بردار اول از دوم (یا به ترتیب ورود)
            res.x = vecs[0].x - vecs[1].x;
            res.y = vecs[0].y - vecs[1].y;
            res.z = vecs[0].z - vecs[1].z;
            // اگر بیش از دو بردار بود، بقیه را هم کم می‌کند
            for(let i=2; i<vecs.length; i++) {
                res.x -= vecs[i].x; res.y -= vecs[i].y; res.z -= vecs[i].z;
            }
            if (vecs.length === 2) {
                latexStr = `\\vec{R} = \\vec{V}_1 - \\vec{V}_2 = \\begin{bmatrix} {${res.x}} \\\\ {${res.y}} \\\\ {${res.z}} \\end{bmatrix} = (${res.x}, ${res.y}, ${res.z})`;
            } else {
                latexStr = `\\vec{R} = \\vec{V}_1 - \\sum_{i=2}^{${vecs.length}} \\vec{V}_i = \\begin{bmatrix} {${res.x}} \\\\ {${res.y}} \\\\ {${res.z}} \\end{bmatrix} = (${res.x}, ${res.y}, ${res.z})`;
            }
        } else if (type === 'dot') {
            const dot = (vecs[0].x * vecs[1].x) + (vecs[0].y * vecs[1].y) + (vecs[0].z * vecs[1].z);
            latexStr = `\\vec{V}_1 \\cdot \\vec{V}_2 = ${dot}`;
        } else if (type === 'cross') {
            res.x = vecs[0].y * vecs[1].z - vecs[0].z * vecs[1].y;
            res.y = vecs[0].z * vecs[1].x - vecs[0].x * vecs[1].z;
            res.z = vecs[0].x * vecs[1].y - vecs[0].y * vecs[1].x;
            latexStr = `\\vec{V}_1 \\times \\vec{V}_2 = \\begin{bmatrix} {${res.x}} \\\\ {${res.y}} \\\\ {${res.z}} \\end{bmatrix} = (${res.x}, ${res.y}, ${res.z})`;
        }

        // اضافه کردن جزئیات اندازه و زاویه به لاتکس
        vecs.forEach((v, i) => {
            const mag = Math.sqrt(v.x**2 + v.y**2 + v.z**2).toFixed(3);
            let currentColor
            if (isDarkMode) {
                currentColor = 0xffffff;
            } else {
                currentColor = 0x000000;
            }
            const hexColor = '#' + (i < vectorColors.length ? vectorColors[i] : currentColor).toString(16).padStart(6, '0');
            latexStr += `\\\\ \\color{${hexColor}}{|\\vec{V}_{${i+1}}|} = ${mag}`;
            
            // رسم بردار در Three.js
            if (mag > 0) {
                // انتخاب رنگ: اگر از لیست بیشتر شد، رنگ رندوم تولید کن
                const color = i < vectorColors.length ? vectorColors[i] : Math.random() * 0xffffff;
                const arrow = new THREE.ArrowHelper(
                    new THREE.Vector3(v.x, v.y, v.z).normalize(),
                    new THREE.Vector3(0, 0, 0),
                    Math.sqrt(v.x**2 + v.y**2 + v.z**2),
                    color,
                    0.4, // اندازه نوک پیکان
                    0.2  // عرض نوک پیکان
                );
                arrow.name = `بردار V${i+1} (${v.x}, ${v.y}, ${v.z})`; // اختصاص نام
                scene.add(arrow);
                arrows.push(arrow);
            }
        });

        // افزودن زاویه به خروجی لاتکس
        latexStr += `\\\\ \\color{${'#'+(vectorColors[6]).toString(16).padStart(6, '0')}}{\\theta_{(\\vec{V}_1, \\vec{V}_2)} = ${angleDeg}^\\circ}`;

        // رسم بردار نتیجه
        if (type !== 'dot') {
            const resMag = Math.sqrt(res.x**2 + res.y**2 + res.z**2);
            if (resMag > 0) {
                const resArrow = new THREE.ArrowHelper(
                    new THREE.Vector3(res.x, res.y, res.z).normalize(),
                    new THREE.Vector3(0, 0, 0),
                    resMag,
                    0xffd700, // طلایی برای نتیجه
                    0.4, 0.2 // ابعاد سر بردار
                );
                resArrow.name = `بردار حاصل R (${res.x.toFixed(1)}, ${res.y.toFixed(1)}, ${res.z.toFixed(1)})`; // اختصاص نام
                scene.add(resArrow);
                arrows.push(resArrow);
            }
            latexStr += `\\\\ \\color{#ffd700}{|\\vec{R}|} = ${resMag.toFixed(3)}`;
        }

        // نمایش خروجی لاتکس
        const resultDiv = document.getElementById('vector-latex-result');
        resultDiv.classList.remove('hidden');
        if (isTouchDevice()) {
            katex.render(latexStr, resultDiv, { throwOnError: false, displayMode: false, trust: true });
        } else {
            katex.render(latexStr, resultDiv, { throwOnError: false, displayMode: true, trust: true });
        }
        if (arrows.length > 0) {
            const firstVec = vecs[0];
            camera.lookAt(res.x / 2, res.y / 2, res.z / 2);
        }
    }

    // اجرای اولیه
    setTimeout(() => {
        initThree();
    }, 100);

    let raycaster = new THREE.Raycaster();
    let mouse = new THREE.Vector2();
    let tooltip = document.getElementById('v-tooltip');

    // گوش دادن به حرکت موس روی کانتینر
    function handleInteraction(event) {
        const container = document.getElementById('three-container');
        const rect = container.getBoundingClientRect();
        
        let clientX, clientY;
        if (event.touches) { // حالت لمسی
            clientX = event.touches[0].clientX;
            clientY = event.touches[0].clientY;
        } else { // حالت موس
            clientX = event.clientX;
            clientY = event.clientY;
        }

        mouse.x = ((clientX - rect.left) / container.clientWidth) * 2 - 1;
        mouse.y = -((clientY - rect.top) / container.clientHeight) * 2 + 1;

        if (scene && camera) {
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(arrows, true);

            if (intersects.length > 0) {
                let arrow = intersects[0].object;
                while (arrow.parent && !(arrow instanceof THREE.ArrowHelper)) {
                    arrow = arrow.parent;
                }

                if (arrow.name) {
                    tooltip.style.display = 'block';
                    tooltip.innerHTML = arrow.name;
                    tooltip.style.left = (clientX + 10) + 'px';
                    tooltip.style.top = (clientY + 10) + 'px';
                    
                    // در موبایل بعد از ۳ ثانیه تولتیپ غیب شود
                    if (event.touches) {
                        setTimeout(() => { tooltip.style.display = 'none'; }, 3000);
                    }
                    return;
                }
            }
        }
        tooltip.style.display = 'none';
    }

    // جایگزین کردن رویدادهای قبلی با این دو خط:
    document.getElementById('three-container').addEventListener('mousemove', handleInteraction);
    document.getElementById('three-container').addEventListener('touchstart', handleInteraction);

    // <!-- Smart MATH Logic -->

        // <!-- Math Explainer --->
    document.getElementById('math-explainer-input').addEventListener('keydown', (event) => {
        // برای textarea، معمولاً باید Ctrl+Enter یا Shift+Enter باشد تا Enter خط جدید ایجاد نکند.
        // اما برای سادگی، فعلاً فقط Enter را قرار می‌دهیم.
        if (!isTouchDevice()) {
            if (event.key === 'Enter' && !event.shiftKey) { 
                event.preventDefault();
                getMathExplanation();
            }
        } else if (event.key === 'Enter' && event.ctrlKey) { 
            event.preventDefault();
            getMathExplanation();
        }
    });

    async function getMathExplanation() {
        const inputEl = document.getElementById('math-explainer-input');
        const resultEl = document.getElementById('math-explainer-result');
        const loadingEl = document.getElementById('math-explainer-loading');
        const concept = inputEl.value; // متغیر ورودی کاربر

        if (!concept.trim()) {
            showMessageBox('ورودی خالی','لطفاً مفهوم یا نظریه ریاضی مورد نظر خود را وارد کنید.')
            return;
        }

        loadingEl.classList.remove('hidden');
        resultEl.classList.add('hidden');
        
        const mathUrl = "https://e2u4ss1st4nt.onrender.com/explain-math";

        try {
            const response = await fetch(mathUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: concept })
            });
            
            if (!response.ok) { 
                const errorData = await response.json(); 
                throw new Error(errorData.error?.message || `HTTP error! status: ${response.status}`); 
            }
            
            const result = await response.json();
            const candidate = result.candidates?.[0];

            if (result.text) {
                let rawText = result.text; // گرفتن متن از خروجی جدید سرور
                resultEl.innerHTML = parseAndStyleResponse(rawText).replace(/\\\[/g, "$$")
                    .replace(/\\\]/g, "$$")
                    .replace(/\\\(/g, "$")
                    .replace(/\\\)/g, "$");
                resultEl.classList.remove('hidden');
                renderMathInElement(resultEl, { delimiters: [
                    { left: '$$', right: '$$', display: true },
                    { left: '$', right: '$', display: false },
                    { left: '\\[', right: '\\]', display: true },
                    { left: '\\(', right: '\\)', display: false }
                    ]
                }); 
            } else {
                throw new Error('پاسخ معتبری دریافت نشد.');
            }
        } catch (error) {
            console.error('Math Explainer AI Error:', error);
            showMessageBox('خطا', `متاسفانه خطایی رخ داد: ${error.message}`);
        } finally {
            loadingEl.classList.add('hidden');
        }
        
        if (window.renderMathInElement && !resultEl.classList.contains('hidden')) { 
            renderMathInElement(resultEl, { delimiters: [{left: '$$', right: '$$', display: true}, {left: '$', right: '$', display: false}] }); 
        }
    }

        // <!-- Math Solver --->
    document.getElementById('math-solver-input').addEventListener('keydown', (event) => {
        // برای textarea، معمولاً باید Ctrl+Enter یا Shift+Enter باشد تا Enter خط جدید ایجاد نکند.
        // اما برای سادگی، فعلاً فقط Enter را قرار می‌دهیم.
        if (!isTouchDevice()) {
            if (event.key === 'Enter' && !event.shiftKey) { 
                event.preventDefault();
                getMathSolution();
            }
        } else if (event.key === 'Enter' && event.ctrlKey) { 
            event.preventDefault();
            getMathSolution();
        }
    });

    function extractLatexOnly(text) {
        // عبارت باقاعده برای یافتن هر چیزی که با $$ شروع و به $$ ختم شود،
        // یا با $ شروع و به $ ختم شود. [\\s\\S]*? برای گرفتن همه کاراکترها شامل خط جدید است.
        const regex = /(\$\$[\s\S]*?\$\$|\$[\s\S]*?\$)/g;
        
        let latexOnly = '';
        let match;

        // حلقه‌ای برای یافتن و استخراج تمامی تطابق‌ها
        while ((match = regex.exec(text)) !== null) {
            // match[0] شامل کل عبارت یافت شده (مثلاً $$E=mc^2$$) است.
            latexOnly += match[0] + '\n'; // اضافه کردن با یک خط جدید برای جداسازی بهتر در پیش‌نمایش
        }

        return latexOnly.trim();
    }

    function updateLatexPreview() {
        const inputEl = document.getElementById('math-solver-input');
        const previewEl = document.getElementById('solver-latex-preview');
        const rawText = inputEl.value;
        
        // 1. استخراج فقط کدهای LaTeX
        const latexCode = extractLatexOnly(rawText);

        // 2. به‌روزرسانی محتوای پیش‌نمایش
        if (latexCode) {
            previewEl.textContent = latexCode;
        } else {
            previewEl.innerHTML = '';
        }

        // 3. رندر کردن محتوای جدید با استفاده از KaTeX/MathJax
        if (window.renderMathInElement) {
            // اطمینان حاصل کنید که رندرینگ روی عنصر پیش‌نمایش انجام شود
            renderMathInElement(previewEl, { 
                delimiters: [
                    {left: '$$', right: '$$', display: true}, 
                    {left: '$', right: '$', inLine: true}
                ] 
            });
        }
    }

    function initializeMathSolverPalette() {
        Object.keys(mathPalettes).forEach(key => {
            const container = document.getElementById(`solver-palette-content-${key}`);
            if(!container) return;
            container.innerHTML = ''; // Clear previous buttons
            const symbols = mathPalettes[key];
            symbols.forEach(symbol => {
                const btn = document.createElement('button');
                btn.className = 'btn-3d bg-green-600 text-white math-symbol-btn';
                btn.dataset.insert = symbol.insert;
                if (symbol.title) {
                btn.title = symbol.title;
                }
                container.appendChild(btn);
                try {
                    katex.render(symbol.display, btn, { throwOnError: false, displayMode: false });
                } catch (e) { btn.textContent = symbol.insert; }
                btn.addEventListener('click', () => insertAtCursor(document.getElementById('math-solver-input'), btn.dataset.insert));
            });
        });

        const tabs = document.querySelectorAll('.solver-palette-tabs button');
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active', 'expanded'));
                tab.classList.add('active', 'expanded');
                document.querySelectorAll('.palette-content').forEach(c => c.classList.remove('active'));
                const paletteContent = document.getElementById(`solver-palette-content-${tab.dataset.palette}`);
                if(paletteContent) {
                    paletteContent.classList.add('active');
                }
            });
        });
    }

    async function getMathSolution() {
        const inputEl = document.getElementById('math-solver-input');
        const resultEl = document.getElementById('math-solver-result');
        const loadingEl = document.getElementById('math-solver-loading');
        const concept = inputEl.value; // متغیر ورودی کاربر

        if (!concept.trim()) {
            showMessageBox('ورودی خالی','لطفاً مسئلۀ مورد نظر خود را وارد کنید.')
            return;
        }

        loadingEl.classList.remove('hidden');
        resultEl.classList.add('hidden');

        const solverUrl = "https://e2u4ss1st4nt.onrender.com/solve-math";

        try {
            const response = await fetch(solverUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: concept })
            });
            
            if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.error?.message || `HTTP error! status: ${response.status}`); }
            
            const result = await response.json();
            const candidate = result.candidates?.[0];

            if (candidate && candidate.content?.parts?.[0]?.text) {
                let rawText = candidate.content.parts[0].text;
                resultEl.innerHTML = parseAndStyleResponse(rawText)
                resultEl.classList.remove('hidden');
                renderMathInElement(resultEl, { delimiters: [
                    { left: '$$', right: '$$', display: true },
                    { left: '$', right: '$', display: false },
                    { left: '\\[', right: '\\]', display: true },
                    { left: '\\(', right: '\\)', display: false }
                    ]
                }); 
            } else {
                throw new Error('پاسخ معتبری دریافت نشد.');
            }
        } catch (error) {
            console.error('Math Solver AI Error:', error);
            showMessageBox('خطا', `متاسفانه خطایی رخ داد: ${error.message}`);
        } finally {
            loadingEl.classList.add('hidden');
        }
        
        if (window.renderMathInElement && !resultEl.classList.contains('hidden')) { 
            renderMathInElement(resultEl, { delimiters: [{left: '$$', right: '$$', display: true}, {left: '$', right: '$', display: false}] }); 
        }
    }

        // --- Physic Logic ---
    function showPhysicsTool(toolId, title) {
        document.getElementById('physics-tool-buttons').classList.add('hidden'); // Hide button grid
        document.querySelectorAll('.physics-tool').forEach(tool => {
            // حذف کلاس 'hidden' و کلاس انیمیشن از همه ابزارها 
            // تا فقط ابزار انتخابی نمایش داده شود (در صورت وجود منطق پیچیده‌تر)
            tool.classList.add('hidden');
            tool.classList.remove('fadeIn-active');
        });
        if (toolId === 'CPhysQuantity') {
            document.getElementById('physical-branch-selection').classList.remove('hidden');
            document.getElementById('physical-branch-selection-label').classList.remove('hidden')
        }
        const tool = document.getElementById(toolId);
        if(tool) {
            tool.classList.remove('hidden');
            tool.classList.add('fadeIn-active');
            pushNewState();
            if (window.renderMathInElement) {
                renderMathInElement(tool);
            }
        }
        pageTitle.textContent = title;
    }

    function showPhysicsBranch(branchId) {
        document.getElementById('physical-branch-selection').classList.add('hidden');
        document.getElementById('physical-branch-selection-label').classList.add('hidden');
        document.querySelectorAll('.physics-branch-tool').forEach(tool => {
            tool.classList.add('hidden');
            tool.classList.remove('fadeIn-active');
        });
        document.querySelectorAll('.physical-subbranch-selection-label').forEach(tool => {
            tool.classList.remove('hidden');
        });
        document.querySelectorAll('.physical-subbranch-selection').forEach(tool => {
            tool.classList.remove('hidden');
        });
        const branchTool = document.getElementById(branchId);
        if (branchTool) {
            branchTool.classList.remove('hidden');
            branchTool.classList.add('fadeIn-active');
            pushNewState();
            // Re-render KaTeX in case the new branchTool has static formulas
            if (window.renderMathInElement) {
                renderMathInElement(branchTool);
            }
        }
    }

    function showPhysicsSubBranch(subBranchId) {
        document.getElementById('physical-mechanics-selection').classList.add('hidden');
        document.querySelectorAll('.physical-subbranch-selection-label').forEach(label => {
            label.classList.add('hidden');
        });
        document.querySelectorAll('.physics-subbranch-tool').forEach(tool => {
            tool.classList.add('hidden');
            tool.classList.remove('fadeIn-active');
        });
        document.querySelectorAll('.physical-subbranch-compute-label').forEach(tool => {
            tool.classList.remove('hidden');
        });
        document.querySelectorAll('.physical-subbranch-compute-selection').forEach(tool => {
            tool.classList.remove('hidden');
        });
        const subBranchTool = document.getElementById(subBranchId);
        if(subBranchTool) {
            subBranchTool.classList.remove('hidden');
            subBranchTool.classList.add('fadeIn-active');
            pushNewState();
            // Re-render KaTeX in case the new subBranchTool has static formulas
            if (window.renderMathInElement) {
                renderMathInElement(subBranchTool);
            }
        }
    }

    function showPhysicsComputeTool(toolId) {
        document.querySelectorAll('.physics-comp-tool').forEach(tool => {
            tool.classList.add('hidden');
            tool.classList.remove('fadeIn-active');
        });
        const computerTool = document.getElementById(toolId);
        if(computerTool) {
            computerTool.classList.remove('hidden');
            computerTool.classList.add('fadeIn-active');
            // Re-render KaTeX in case the new computerTool has static formulas
            if (window.renderMathInElement) {
                renderMathInElement(computerTool);
            }
        }
    }

    function calculateNewton2ndLaw() {
        const F_val = document.getElementById('kinetic-newton-F').value;
        const m_val = document.getElementById('kinetic-newton-m').value;
        const a_val = document.getElementById('kinetic-newton-a').value;
        
        const F = parseFloat(F_val);
        const m = parseFloat(m_val);
        const a = parseFloat(a_val);
        
        const resultEl = document.getElementById('kinetic-newton-result');
        
        try {
            let resultText = '';
            let filledFields = [F_val, m_val, a_val].filter(v => v !== "").length;

            if (filledFields !== 2) {
                throw new Error("لطفاً دقیقاً دو کادر را پر کنید.");
            }

            if (isNaN(a)) { 
                // محاسبه شتاب (a = F / m)
                if (m === 0) {
                    resultText = (F === 0) ? "حاصل: تعریف نشده" : "خطا: جرم نمی‌تواند صفر باشد";
                } else if (m < 0) {
                    throw new Error("جرم نمی‌تواند منفی باشد.");
                } else {
                    const result = F / m;
                    resultText = `$a = \\boxed{${result} \\text{ }\\frac{\\text{m}}{\\text{s}^2}}$`;
                }
            } 
            else if (isNaN(m)) { 
                // محاسبه جرم (m = F / a)
                if (a === 0) {
                    // اگر نیرو هم صفر بود -> 0/0 تعریف نشده
                    if (F === 0) {
                        resultText = "حاصل: تعریف نشده";
                    } else {
                        throw new Error("شتاب نمی‌تواند صفر باشد وقتی نیرو وارد می‌شود.");
                    }
                } else {
                    const result = F / a;
                    // اگر حاصل جرم منفی یا صفر شد (مثلاً نیروی مثبت و شتاب منفی که غیرممکن است در جهت نیرو)
                    if (result <= 0) {
                        throw new Error("جرم حاصل‌شده باید مثبت باشد. (جهت نیرو و شتاب را چک کنید)");
                    }
                    resultText = `$m = \\boxed{${result} \\text{ kg}}$`;
                }
            } 
            else if (isNaN(F)) { 
                if (m < 0) {
                    throw new Error("جرم نمی‌تواند منفی باشد.");
                } else {
                    // محاسبه نیرو (F = m * a)
                    const result = m * a;
                    resultText = `$\\sum F = \\boxed{${result} \\text{ N}}$`;
                }
            }

            resultEl.innerHTML = resultText;
            resultEl.style.color = isDarkMode ? 'white' : 'black';

        } catch (error) {
            resultEl.textContent = `خطا: ${error.message}`;
            resultEl.style.color = 'red';
        }

        if (window.renderMathInElement) {
            renderMathInElement(resultEl, { delimiters: [{left: '$', right: '$', display: false}] });
        }
    }

    let currentImpulseTab = 'ft';

    function switchImpulseTab(tab) {
        currentImpulseTab = tab;
        const ftContent = document.getElementById('impulse-ft-content');
        const mvContent = document.getElementById('impulse-mv-content');
        const ftBtn = document.getElementById('tab-impulse-ft');
        const mvBtn = document.getElementById('tab-impulse-mv');

        if (tab === 'ft') {
            ftContent.classList.remove('hidden');
            mvContent.classList.add('hidden');
            ftBtn.classList.add('text-green-600', 'border-b-2', 'border-green-600', 'transition', 'duration-100');
            mvBtn.classList.remove('text-green-600', 'border-b-2', 'border-green-600', 'transition', 'duration-100');
            mvBtn.classList.add('text-gray-500');
        } else {
            ftContent.classList.add('hidden');
            mvContent.classList.remove('hidden');
            mvBtn.classList.add('text-green-600', 'border-b-2', 'border-green-600', 'transition', 'duration-100');
            ftBtn.classList.remove('text-green-600', 'border-b-2', 'border-green-600', 'transition', 'duration-100');
            ftBtn.classList.add('text-gray-500');
        }
    }

    function calculateImpulse() {
        const resultEl = document.getElementById('kinetic-impulse-result');
        resultEl.style.color = isDarkMode ? 'white' : 'black';

        try {
            if (currentImpulseTab === 'ft') {
                const J_val = document.getElementById('impulse-J1').value;
                const F_val = document.getElementById('impulse-F').value;
                const t_val = document.getElementById('impulse-t').value;
                
                const J = parseFloat(J_val), F = parseFloat(F_val), t = parseFloat(t_val);
                let filled = [J_val, F_val, t_val].filter(v => v !== "").length;

                if (filled !== 2) throw new Error("دقیقاً دو کادر را پر کنید.");

                if (t <= 0 && !isNaN(t)) {
                    throw new Error("زمان باید مثبت باشد.");
                }

                if (isNaN(J)) {
                    resultEl.innerHTML = `$J = \\boxed{${toLatexScientificNotation(F * t)} \\text{ N} \\cdot \\text{s}}$`;
                } else if (isNaN(F)) {
                    if (t === 0) {
                        resultEl.innerHTML = (J === 0) ? "حاصل: تعریف نشده" : "خطا: زمان نمی‌تواند صفر باشد وقتی ضربه وجود دارد.";
                    } else {
                        resultEl.innerHTML = `$F = \\boxed{${toLatexScientificNotation(J / t)} \\text{ N}}$`;
                    }
                } else if (isNaN(t)) {
                    if (F === 0) {
                        resultEl.innerHTML = (J === 0) ? "حاصل: تعریف نشده" : "خطا: نیرو نمی‌تواند صفر باشد وقتی ضربه وجود دارد.";
                    } else {
                        const resT = J / F;
                        if (resT <= 0) throw new Error("زمان حاصل‌شده باید مثبت باشد.");
                        resultEl.innerHTML = `$\\Delta t = \\boxed{${toLatexScientificNotation(resT)} \\text{ s}}$`;
                    }
                }

            } else {
                const J_val = document.getElementById('impulse-J2').value;
                const m_val = document.getElementById('impulse-m').value;
                const v1_val = document.getElementById('impulse-v1').value;
                const v2_val = document.getElementById('impulse-v2').value;

                const J = parseFloat(J_val), m = parseFloat(m_val), v1 = parseFloat(v1_val), v2 = parseFloat(v2_val);
                let filled = [J_val, m_val, v1_val, v2_val].filter(v => v !== "").length;

                if (filled !== 3) throw new Error("دقیقاً سه کادر را پر کنید.");

                if (m <= 0 && !isNaN(m)) {
                    throw new Error("جرم باید مثبت باشد.");
                }

                if (isNaN(J)) {
                    const dv = v2 - v1;
                    resultEl.innerHTML = `$J = \\boxed{${toLatexScientificNotation(m * dv)} \\text{ } \\frac{\\text{kg}\\cdot\\text{m}}{\\text{s}}}$<br>($\\Delta v = ${toLatexScientificNotation(dv)}\\text{ m/s}$)`;
                } else if (isNaN(m)) {
                    const dv = v2 - v1;
                    if (dv === 0) {
                        resultEl.innerHTML = (J === 0) ? "حاصل: تعریف نشده" : "خطا: تغییرات سرعت صفر است، جرم قابل محاسبه نیست.";
                    } else {
                        const resM = J / dv;
                        if (resM <= 0) throw new Error("جرم حاصل‌شده باید مثبت باشد. جهت ضربه یا تغییر سرعت را بررسی کنید.");
                        resultEl.innerHTML = `$m = \\boxed{${toLatexScientificNotation(resM)} \\text{ kg}}$<br>($\\Delta v = ${toLatexScientificNotation(dv)}\\text{ m/s}$)`;
                    }
                } else if (isNaN(v2)) {
                    if (m <= 0) throw new Error("جرم باید مثبت باشد.");
                    const dv = J / m;
                    const resV2 = dv + v1;
                    resultEl.innerHTML = `$v_2 = \\boxed{${toLatexScientificNotation(resV2)} \\text{ } \\frac{\\text{m}}{\\text{s}}}$<br>($\\Delta v = ${toLatexScientificNotation(dv)}\\text{ m/s}$)`;
                } else if (isNaN(v1)) {
                    if (m <= 0) throw new Error("جرم باید مثبت باشد.");
                    const dv = J / m;
                    const resV1 = v2 - dv;
                    resultEl.innerHTML = `$v_1 = \\boxed{${toLatexScientificNotation(resV1)} \\text{ } \\frac{\\text{m}}{\\text{s}}}$<br>($\\Delta v = ${toLatexScientificNotation(dv)}\\text{ m/s}$)`;
                }
            }
        } catch (error) {
            resultEl.textContent = `خطا: ${error.message}`;
            resultEl.style.color = 'red';
        }

        if (window.renderMathInElement) {
            renderMathInElement(resultEl, { delimiters: [{left: '$', right: '$', display: false}] });
        }
    }

    let currentFrictionTab = 'static';

    function switchFrictionTab(tab) {
        currentFrictionTab = tab;
        const staticContent = document.getElementById('friction-static-content');
        const kineticContent = document.getElementById('friction-kinetic-content');
        const staticBtn = document.getElementById('tab-friction-static');
        const kineticBtn = document.getElementById('tab-friction-kinetic');

        if (tab === 'static') {
            staticContent.classList.remove('hidden');
            kineticContent.classList.add('hidden');
            staticBtn.classList.add('text-green-600', 'border-b-2', 'border-green-600', 'transition', 'duration-100');
            kineticBtn.classList.remove('text-green-600', 'border-b-2', 'border-green-600', 'transition', 'duration-100');
            kineticBtn.classList.add('text-gray-500');
        } else {
            staticContent.classList.add('hidden');
            kineticContent.classList.remove('hidden');
            kineticBtn.classList.add('text-green-600', 'border-b-2', 'border-green-600', 'transition', 'duration-100');
            staticBtn.classList.remove('text-green-600', 'border-b-2', 'border-green-600', 'transition', 'duration-100');
            staticBtn.classList.add('text-gray-500');
        }
    }

    function calculateFriction() {
        const resultEl = document.getElementById('kinetic-friction-result');
        resultEl.style.color = isDarkMode ? 'white' : 'black';

        try {
            const prefix = currentFrictionTab === 'static' ? 'fs' : 'fk';
            const typeLabel = currentFrictionTab === 'static' ? 's' : 'k';
            
            const f_val = document.getElementById(`fric-f${typeLabel}`).value;
            const u_val = document.getElementById(`fric-u${typeLabel}`).value;
            const n_val = document.getElementById(`fric-n${typeLabel}`).value;

            const f = parseFloat(f_val), u = parseFloat(u_val), n = parseFloat(n_val);
            let filled = [f_val, u_val, n_val].filter(v => v !== "").length;

            if (filled !== 2) throw new Error("دقیقاً دو کادر را پر کنید.");

            if (isNaN(f)) {
                // محاسبه نیرو
                if (currentFrictionTab === 'static') {
                    if (u * n < 0) throw new Error("نیروی اصطکاک نمی‌تواند منفی باشد.");
                    if (u <= 0) throw new Error("ضریب اصطکاک باید مثبت باشد.");
                    resultEl.innerHTML = `$f_{s,max} = \\boxed{${toLatexScientificNotation(u * n)} \\text{ N}}$`;
                } else if (currentFrictionTab === 'kinetic') {
                    resultEl.innerHTML = `$f_${typeLabel} = \\boxed{${toLatexScientificNotation(u * n)} \\text{ N}}$`;
                }
            } else if (isNaN(u)) {
                // محاسبه ضریب اصطکاک
                if (n === 0) {
                    resultEl.innerHTML = (f === 0) ? "حاصل: تعریف نشده" : "خطا: نیروی عمودی سطح نمی‌تواند صفر باشد وقتی اصطکاک وجود دارد.";
                } else {
                    const resU = f / n;
                    if (resU < 0) throw new Error("ضریب اصطکاک نمی‌تواند منفی باشد.");
                    resultEl.innerHTML = `$\\mu_${typeLabel} = \\boxed{${toLatexScientificNotation(resU)}}$`;
                }
            } else if (isNaN(n)) {
                // محاسبه نیروی عمودی
                if (u === 0) {
                    resultEl.innerHTML = (f === 0) ? "حاصل: تعریف نشده" : "خطا: ضریب اصطکاک صفر است، نیروی عمودی قابل محاسبه نیست.";
                } else {
                    const resN = f / u;
                    if (resN <= 0) throw new Error("نیروی عمودی حاصل‌شده باید مثبت باشد.");
                    resultEl.innerHTML = `$N = \\boxed{${toLatexScientificNotation(resN)} \\text{ N}}$`;
                }
            }
        } catch (error) {
            resultEl.textContent = `خطا: ${error.message}`;
            resultEl.style.color = 'red';
        }

        if (window.renderMathInElement) {
            renderMathInElement(resultEl, { delimiters: [{left: '$', right: '$', display: false}] });
        }
    }

    let currentWorkTab = 'fd';

    function switchWorkTab(tab) {
        currentWorkTab = tab;
        const contents = ['fd', 'mad', 'rot'];
        contents.forEach(c => {
            const el = document.getElementById(`work-${c}-content`);
            const btn = document.getElementById(`tab-work-${c}`);
            if (c === tab) {
                el.classList.remove('hidden');
                btn.classList.add('text-green-600', 'border-b-2', 'border-green-600');
                btn.classList.remove('text-gray-500');
            } else {
                el.classList.add('hidden');
                btn.classList.remove('text-green-600', 'border-b-2', 'border-green-600');
                btn.classList.add('text-gray-500');
            }
        });
    }

    function calculateWork() {
        const resultEl = document.getElementById('kinetic-work-result');
        resultEl.style.color = isDarkMode ? 'white' : 'black';

        try {
            if (currentWorkTab === 'fd') {
                const W_val = document.getElementById('work-w1').value;
                const F_val = document.getElementById('work-f').value;
                const d_val = document.getElementById('work-d1').value;
                let theta_val = document.getElementById('work-theta').value;

                const W = parseFloat(W_val), F = parseFloat(F_val), d = parseFloat(d_val);
                let filled = [W_val, F_val, d_val].filter(v => v !== "").length;

                // اگر هر سه کادر اصلی پر باشند -> محاسبه تتا
                if (filled === 3) {
                    if (F === 0 || d === 0) {
                        resultEl.innerHTML = (W === 0) ? "حاصل: !تعریف نشده" : "خطا: وقتی نیرو یا جابه‌جایی صفر است، کار نمی‌تواند غیرصفر باشد.";
                    } else {
                        const cosT = W / (F * d);
                        // بررسی اینکه آیا cosT در بازه معتبر [-1, 1] هست یا خیر
                        if (Math.abs(cosT) > 1) {
                            throw new Error("مقادیر وارد شده با هم همخوانی ندارند (Cos خارج از بازه ۱ و ۱-)");
                        }
                        const resTheta = Math.acos(cosT) * 180 / Math.PI;
                        resultEl.innerHTML = `$\\theta = \\boxed{${toLatexScientificNotation(resTheta.toPrecision(12))} ^\\circ}$`;
                    }
                } 
                // اگر دو کادر پر باشند -> محاسبه یکی از سه مقدار اصلی
                else if (filled === 2) {
                    if (theta_val === "") theta_val = "0"; // پیش‌فرض ۰ درجه
                    const thetaRad = parseFloat(theta_val) * Math.PI / 180;
                    const cosT = Math.cos(thetaRad).toPrecision(12);

                    if (isNaN(W)) {
                        resultEl.innerHTML = `$W = \\boxed{${toLatexScientificNotation(F * d * cosT)} \\text{ J}}$`;
                    } else if (isNaN(F)) {
                        if (d === 0 || Math.abs(cosT) < 1e-10) throw new Error("تقسیم بر صفر! جابه‌جایی صفر یا نیرو عمود است.");
                        resultEl.innerHTML = `$F = \\boxed{${toLatexScientificNotation(W / (d * cosT))} \\text{ N}}$`;
                    } else if (isNaN(d)) {
                        if (F === 0 || Math.abs(cosT) < 1e-10) throw new Error("تقسیم بر صفر! نیرو صفر یا عمود است.");
                        resultEl.innerHTML = `$d = \\boxed{${toLatexScientificNotation(W / (F * cosT))} \\text{ m}}$`;
                    }
                } else {
                    throw new Error("حداقل دو یا سه کادر (W, F, d) را پر کنید.");
                }

            } else if (currentWorkTab === 'mad') {
                const W_val = document.getElementById('work-w2').value;
                const m_val = document.getElementById('work-m').value;
                const a_val = document.getElementById('work-a').value;
                const d_val = document.getElementById('work-d2').value;

                const W = parseFloat(W_val), m = parseFloat(m_val), a = parseFloat(a_val), d = parseFloat(d_val);
                let filled = [W_val, m_val, a_val, d_val].filter(v => v !== "").length;

                if (filled !== 3) throw new Error("دقیقاً سه کادر را پر کنید.");

                if (isNaN(W)) resultEl.innerHTML = `$W = \\boxed{${toLatexScientificNotation(m * a * d)} \\text{ J}}$`;
                else if (isNaN(m)) resultEl.innerHTML = `$m = \\boxed{${toLatexScientificNotation(W / (a * d))} \\text{ kg}}$`;
                else if (isNaN(a)) resultEl.innerHTML = `$a = \\boxed{${toLatexScientificNotation(W / (m * d))} \\text{ m/s}^2}$`;
                else if (isNaN(d)) resultEl.innerHTML = `$d = \\boxed{${toLatexScientificNotation(W / (m * a))} \\text{ m}}$`;

            } else if (currentWorkTab === 'rot') {
                const W_val = document.getElementById('work-w3').value;
                const tau_val = document.getElementById('work-tau').value;
                const deg_val = document.getElementById('work-deg').value;

                const W = parseFloat(W_val), tau = parseFloat(tau_val), deg = parseFloat(deg_val);
                let filled = [W_val, tau_val, deg_val].filter(v => v !== "").length;

                if (filled !== 2) throw new Error("دقیقاً دو کادر را پر کنید.");

                if (isNaN(W)) {
                    const rad = (deg * Math.PI / 180).toPrecision(15);
                    resultEl.innerHTML = `$W = \\boxed{${toLatexScientificNotation(tau * rad)} \\text{ J}}$`;
                } else if (isNaN(tau)) {
                    const rad = (deg * Math.PI / 180).toPrecision(15);
                    if (rad === 0) throw new Error("زاویه نمی‌تواند صفر باشد.");
                    resultEl.innerHTML = `$\\tau = \\boxed{${toLatexScientificNotation(W / rad)} \\text{ N}\\cdot\\text{m}}$`;
                } else if (isNaN(deg)) {
                    if (tau === 0) throw new Error("گشتاور نمی‌تواند صفر باشد.");
                    const resDeg = (W / tau) * 180 / Math.PI;
                    resultEl.innerHTML = `$\\theta = \\boxed{{${toLatexScientificNotation(resDeg.toPrecision(12))}} ^\\circ}$`;
                }
            }
        } catch (error) {
            resultEl.textContent = `خطا: ${error.message}`;
            resultEl.style.color = 'red';
        }

        if (window.renderMathInElement) {
            renderMathInElement(resultEl, { delimiters: [{left: '$', right: '$', display: false}] });
        }
    }

    // --- Astronomy Logic ---
    function showAstronomyTool(toolId, title) {
        document.getElementById('astronomy-tool-buttons').classList.add('hidden'); // Hide button grid
        document.querySelectorAll('.astronomy-tool').forEach(tool => {
            // حذف کلاس 'hidden' و کلاس انیمیشن از همه ابزارها 
            // تا فقط ابزار انتخابی نمایش داده شود (در صورت وجود منطق پیچیده‌تر)
            tool.classList.add('hidden');
            tool.classList.remove('fadeIn-active');
        });
        const tool = document.getElementById(toolId);
        if(tool) {
            tool.classList.remove('hidden');
            tool.classList.add('fadeIn-active');
            pushNewState();
            // Re-render KaTeX in case the new tool has static formulas
            if (window.renderMathInElement) {
                renderMathInElement(tool);
            }
        }
        if (toolId === 'stellarium') {
            const iframe = document.getElementById('stellarium-iframe');

            if (!iframe.getAttribute('src')) {
                iframe.setAttribute('src', 'https://stellarium-web.org/');
            }
        }
        pageTitle.textContent = title;
    }

        // --- Custom Message Box Logic ---
        const messageBoxContainer = document.getElementById('message-box-container');
        const messageBoxTitle = document.getElementById('message-box-title');
        const messageBoxContent = document.getElementById('message-box-content');

        function showMessageBox(title, content) {
            messageBoxTitle.textContent = title;
            messageBoxContent.innerHTML = content.replace(/\n/g, '<br>');
            messageBoxContainer.classList.add('visible');
        }

        function hideMessageBox() {
            messageBoxContainer.classList.remove('visible');
        }

	document.addEventListener('keydown', function(event) {
        if (event.key === 'Enter' && messageBoxContainer.classList.contains('visible')) {
            event.preventDefault();
            hideMessageBox();
        }
    });

        function parseAndStyleResponse(text) {
            let html = text;
            const latexBlocks = [];
            const protectedBlocks = [];
            function protectLatex(pattern) {
                html = html.replace(pattern, (m) => {
                    const key = `@@LATEX_${latexBlocks.length}@@`;
                    latexBlocks.push(m);
                    return key;
                });
            }
            function protectBlock(pattern, replacementFn) {
                html = html.replace(pattern, (match, ...args) => {
                    const key = `@@BLOCK_${protectedBlocks.length}@@`;
                    const replacementHtml = replacementFn(match, ...args);
                    protectedBlocks.push(replacementHtml);
                    return key;
                });
            }

            protectBlock(/```(\S*)\n([\s\S]*?)```/g, (match, lang, code) => {
                    code = code.trim(); 

                    const escapedCode = code
                        .replace(/&/g, "&amp;")
                        .replace(/</g, "&lt;")
                        .replace(/>/g, "&gt;")
                        .replace(/"/g, "&quot;")
                        .replace(/'/g, "&#039;");

                    const uniqueId = 'code-' + Date.now() + Math.random().toString(16).substring(2, 8);
                    return `<div class="code-block-container relative my-4 rounded-lg overflow-hidden shadow-md"><div class="flex justify-between items-center p-2 bg-green-code-head text-black text-xs"><span class="language-tag">${lang || 'Code'}</span><button onclick="copyCodeBlock('${uniqueId}')" title="کپی کردن قطعه کد" class="copy-btn flex items-center p-1 text-gray hover:text-green-800 transition"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-copy"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg><span class="mx-1">کپی</span></button></div><pre id="${uniqueId}" dir="ltr" class="p-4 bg-gray-900 text-white overflow-x-auto whitespace-pre"><code class="language-${lang}">${escapedCode}</code></pre></div>`;
            });

            // Order matters: display-math first, then inline, then \( \) and \[ \]
            protectBlock(/\$\$[\s\S]*?\$\$/g, (m) => m);
            protectBlock(/\\\[[\s\S]*?\\\]/g, (m) => m);
            protectBlock(/\\\([\s\S]*?\\\)/g, (m) => m);
            protectBlock(/\$(?:\\.|[^\$\n\\])+\$/g, (m) => m);

            // Order matters: display-math first, then inline, then \( \) and \[ \]
            protectLatex(/\$\$[\s\S]*?\$\$/g);
            protectLatex(/\\\[[\s\S]*?\\\]/g);
            protectLatex(/\\\([\s\S]*?\\\)/g);
            protectLatex(/\$(?:\\.|[^\$\n\\])+\$/g);

            // 1. Handle Tables
            const tableRegex = /((?:\|.*\|[ \t]*\r?\n)\|[ \t:.\-|]+\r?\n(?:\|.*\|[ \t]*\r?\n?)*)/g;
            html = html.replace(tableRegex, (table) => {
                const rows = table.trim().split(/\r?\n/);
                if (rows.length < 2) return table;
                const separator = rows[1];
                if (!/^(\|\s*[:\-]+\s*)+\|?$/.test(separator)) {
                    return table; // not a markdown table header separator — keep original
                }
                const headerCells = rows[0].split('|').slice(1, -1).map(h => `<th>${h.trim()}</th>`).join('');
                let body = '';
                // Start from row 2 to skip header separator
                for(let i = 2; i < rows.length; i++) {
                    const line = rows[i].trim();
                    if (!line) continue;
                    const cells = rows[i].split('|').slice(1, -1).map(c => `<td>${c.trim()}</td>`).join('');
                    body += `<tr>${cells}</tr>`;
                }
                return `<div class="overflow-x-auto"><table class="ai-table"><thead><tr>${headerCells}</tr></thead><tbody>${body}</tbody></table></div>`;
            });
            
            // 2. Headers, Bold, Images, Newlines
            html = html
                .replace(/\\\[/g, "$$")
                .replace(/\\\]/g, "$$")
                .replace(/\\\(/g, "$")
                .replace(/\\\)/g, "$")
                .replace(/^### (.*$)/gm, '<h3 class="text-xl font-bold my-3">$1</h3>')
                .replace(/^#### (.*$)/gm, '<h4 class="text-lg font-semibold mt-4 mb-2">$1</h4>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/!\[(.*?)\]\((.*?)\)/g, '<img src="$2" alt="$1" class="my-2 rounded-lg shadow-md mx-auto max-w-full h-auto"><p class="text-sm text-center">$1</p>')
                .replace(/`([^`\n]+)`/g, (m, inlineCode) => {
                    const escaped = inlineCode.replace(/</g, "&lt;").replace(/>/g, "&gt;");
                    return `<code class="px-1 rounded">${escaped}</code>`;
                })
                .replace(/\n/g, '<br>');
                
            
            // 3. Clean up
            html = html.replace(/(<\/h3>)<br>/g, '$1'); // پاک کردن <br> بعد از هدرها
	        html = html.replace(/(<\/div>)<br>/g, '$1'); // پاک کردن <br> بعد از divها (مثل بلوک‌های کد)
            latexBlocks.forEach((blk, idx) => {
                const key = `@@LATEX_${idx}@@`;
                html = html.split(key).join(blk);
            });

            // بازگرداندن بلوک‌ها:
            protectedBlocks.forEach((blk, idx) => {
                const key = `@@BLOCK_${idx}@@`;
                html = html.split(key).join(blk);
            });

            return html;
        }

        /**
         * کپی کردن محتوای بلوک کد مشخص شده توسط ID.
         * ابتدا از API مدرن (navigator.clipboard) استفاده می‌کند و در صورت شکست، 
         * به روش DOM (ایجاد TextArea موقت) برمی‌گردد که سازگار با موبایل است.
         * * @param {string} codeBlockId - ID منحصر به فرد تگ <pre>
         */
        function copyCodeBlock(codeBlockId) {
            const preElement = document.getElementById(codeBlockId);
            // محتوای کد خالص را از داخل تگ <code> استخراج کنید
            const codeContent = preElement.querySelector('code').textContent; 
            
            // عناصر کنترلی برای نمایش بازخورد
            const copyButton = preElement.closest('.code-block-container').querySelector('.copy-btn');
            const statusSpan = copyButton.querySelector('span');
            const originalText = statusSpan.textContent;

            // --- روش جایگزین (Fallback) برای کپی کردن ---
            function fallbackCopy() {
                let success = false;
                try {
                    // 1. ایجاد یک textarea موقت و مخفی
                    const textarea = document.createElement('textarea');
                    textarea.value = codeContent;
                    
                    // مخفی کردن textarea و جلوگیری از اسکرول صفحه
                    textarea.style.position = 'fixed'; 
                    textarea.style.top = '0';
                    textarea.style.left = '0';
                    textarea.style.opacity = '0';

                    document.body.appendChild(textarea);
                    
                    // 2. انتخاب محتوای textarea و اجرای دستور کپی
                    textarea.focus();
                    textarea.select();
                    
                    // دستور document.execCommand('copy') در مرورگرهای جدید منسوخ شده،
                    // اما در موبایل‌ها برای Fallback بسیار کارآمد است.
                    success = document.execCommand('copy'); 
                    
                    document.body.removeChild(textarea);

                } catch (err) {
                    console.error('Fallback copy failed:', err);
                    success = false;
                }
                
                // نمایش بازخورد بر اساس موفقیت Fallback
                showFeedback(success ? 'کپی شد!' : 'خطا در کپی!', success);
            }
            
            // --- نمایش بازخورد بصری ---
            function showFeedback(message, isSuccess) {
                statusSpan.textContent = message;
                copyButton.classList.add(isSuccess ? 'text-green-400' : 'text-red-400');
                
                setTimeout(() => {
                    statusSpan.textContent = originalText;
                    copyButton.classList.remove('text-green-400', 'text-red-400');
                }, 2000);
            }

            // --- اجرای منطق اصلی ---

            // 1. اگر navigator.clipboard در دسترس است، از روش مدرن استفاده کن (ترجیحاً)
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(codeContent).then(() => {
                    showFeedback('کپی شد!', true);
                }).catch(err => {
                    console.warn('Modern clipboard failed. Trying fallback...', err);
                    // در صورت شکست (که در موبایل‌ها رایج است)، به روش Fallback برگرد
                    fallbackCopy();
                });
            } else {
                // 2. اگر navigator.clipboard اصلاً وجود ندارد (مرورگر بسیار قدیمی)، مستقیماً Fallback را اجرا کن
                fallbackCopy();
            }
        }

        function highlightCodeBlocks() {
            if (window.Prism) {
                // این تابع تمام تگ‌های <code> با کلاس language-X را پردازش می‌کند
                Prism.highlightAll(); 
            }
        }

	// --- PhET Labs Data & Logic ---
        const phetLabs = {
            riazi: [{title:"بازی اعداد و عملیات",url:"https://phet.colorado.edu/sims/html/arithmetic/latest/arithmetic_fa.html",description:"کاوش در عملیات ریاضی و مقادیر اعداد."},{title:"مقایسه کسرها",url:"https://phet.colorado.edu/sims/html/fraction-matcher/latest/fraction-matcher_fa.html",description:"یادگیری و مقایسه کسرها به روش تصویری."},{title:"معرفی کسرها",url:"https://phet.colorado.edu/sims/html/fractions-intro/latest/fractions-intro_fa.html",description:"آشنایی با مفهوم کسرها به کمک شکل و عدد."},{title:"جمع و تفریق کسرها",url:"https://phet.colorado.edu/sims/html/fractions-addition/latest/fractions-addition_fa.html",description:"تمرین جمع و تفریق کسرها با مخرج‌های مشترک و غیر مشترک."},{title:"کاشف تساوی",url:"https://phet.colorado.edu/sims/html/equality-explorer/latest/equality-explorer_fa.html",description:"کاوش و درک تعادل و تساوی در معادلات با متغیر."},{title:"رسم نمودار خطوط",url:"https://phet.colorado.edu/sims/html/graphing-lines/latest/graphing-lines_fa.html",description:"بررسی رابطه بین معادله و نمودار خطی (شیب و عرض از مبدأ)."},{title:"اعداد صحیح در خط اعداد",url:"https://phet.colorado.edu/sims/html/number-line-integers/latest/number-line-integers_fa.html",description:"کاوش و مقایسه اعداد صحیح (مثبت و منفی) روی خط اعداد."},{title:"ساختن اعشار",url:"https://phet.colorado.edu/sims/html/tenths-hundredths/latest/tenths-hundredths_fa.html",description:"یادگیری اعشار، دهم‌ها و صدم‌ها به صورت بصری."},{title:"مقایسه‌گر درصد",url:"https://phet.colorado.edu/sims/html/percent-matcher/latest/percent-matcher_fa.html",description:"تطبیق مقادیر درصد، کسر و اعشار."},{title:"مساحت و محیط",url:"https://phet.colorado.edu/sims/html/area-builder/latest/area-builder_fa.html",description:"ساخت اشکال و محاسبه مساحت و محیط آنها به صورت بصری."},{title:"کاوشگر خط اعداد: کسرها",url:"https://phet.colorado.edu/sims/html/number-line-fractions/latest/number-line-fractions_fa.html",description:"قرار دادن و مقایسه کسرها روی خط اعداد."},{title:"ضرب کسرها",url:"https://phet.colorado.edu/sims/html/fractions-multiplication/latest/fractions-multiplication_fa.html",description:"درک بصری مفهوم ضرب کسرها."},{title:"تقسیم کسرها",url:"https://phet.colorado.edu/sims/html/fractions-division/latest/fractions-division_fa.html",description:"درک بصری مفهوم تقسیم کسرها."},{title:"ضرب و تقسیم اعداد صحیح",url:"https://phet.colorado.edu/sims/html/integer-multiplication/latest/integer-multiplication_fa.html",description:"درک قوانین ضرب و تقسیم برای اعداد مثبت و منفی."},{title:"نشانه‌گذاری علمی",url:"https://phet.colorado.edu/sims/html/scientific-notation/latest/scientific-notation_fa.html",description:"تمرین تبدیل اعداد به نشانه‌گذاری علمی و بالعکس."},{title:"معادلات دو مرحله‌ای",url:"https://phet.colorado.edu/sims/html/two-step-equations/latest/two-step-equations_fa.html",description:"تمرین حل معادلات جبری که به دو مرحله نیاز دارند."},{title:"مقایسه اعشار و کسر",url:"https://phet.colorado.edu/sims/html/decimals-fractions-compare/latest/decimals-fractions-compare_fa.html",description:"تبدیل و مقایسه مقادیر اعشاری و کسری."},{title:"ضرب اعداد صحیح با مدل",url:"https://phet.colorado.edu/sims/html/integer-multiplication-model/latest/integer-multiplication-model_fa.html",description:"استفاده از مدل‌های بصری برای درک ضرب اعداد صحیح."},{title:"جمع و تفریق اعداد صحیح",url:"https://phet.colorado.edu/sims/html/integer-addition-subtraction/latest/integer-addition-subtraction_fa.html",description:"درک جمع و تفریق اعداد مثبت و منفی روی خط اعداد."},{title:"عملیات با کسرها (پیشرفته)",url:"https://phet.colorado.edu/sims/html/fraction-operations/latest/fraction-operations_fa.html",description:"تمرین ترکیبی عملیات جمع، تفریق، ضرب و تقسیم کسرها."},{title:"معادلات خطی: فرم نقطه‌ای-شیب",url:"https://phet.colorado.edu/sims/html/point-slope-form-of-a-line/latest/point-slope-form-of-a-line_fa.html",description:"یادگیری فرم نقطه‌ای-شیب برای معادلات خطی."},{title:"سازنده تابع",url:"https://phet.colorado.edu/sims/html/function-builder/latest/function-builder_fa.html",description:"ساختن و تجزیه توابع ریاضی و مشاهده نحوه عملکرد آنها."},{title:"معادله‌ها و نامعادله‌ها",url:"https://phet.colorado.edu/sims/html/balancing-act/latest/balancing-act_fa.html",description:"استفاده از تعادل برای حل معادلات و نامعادلات مقدماتی."},{title:"جبر مدل مساحت",url:"https://phet.colorado.edu/sims/html/area-model-algebra/latest/area-model-algebra_fa.html",description:"استفاده از مدل مساحت برای ضرب و فاکتورگیری چند جمله‌ای‌ها."},{title:"نمودار توابع درجه دوم",url:"https://phet.colorado.edu/sims/html/graphing-quadratics/latest/graphing-quadratics_fa.html",description:"کاوش در پارامترهای مختلف توابع درجه دوم و تأثیر آنها بر نمودار."},{title:"شیب خط",url:"https://phet.colorado.edu/sims/html/slope/latest/slope_fa.html",description:"یادگیری و محاسبه شیب خط از روی نمودار و نقاط."},{title:"رابطه فیثاغورث",url:"https://phet.colorado.edu/sims/html/pythagorean-theorem/latest/pythagorean-theorem_fa.html",description:"اثبات و استفاده از قضیه فیثاغورث برای مثلث‌های قائم‌الزاویه."},{title:"کاوشگر توان‌ها",url:"https://phet.colorado.edu/sims/html/exponents-explorer/latest/exponents-explorer_fa.html",description:"کاوش در قواعد توان‌ها، از جمله ضرب و تقسیم توان‌ها."},{title:"حل سیستم‌های خطی",url:"https://phet.colorado.edu/sims/html/systems-of-linear-equations/latest/systems-of-linear-equations_fa.html",description:"یافتن نقطه تقاطع (جواب) سیستم‌های معادلات خطی."},{title:"رسم نامعادلات خطی",url:"https://phet.colorado.edu/sims/html/graphing-linear-inequalities/latest/graphing-linear-inequalities_fa.html",description:"رسم مناطق جواب برای نامعادلات خطی در صفحه مختصات."},{title:"معادلات درجه دوم با نمودار",url:"https://phet.colorado.edu/sims/html/quadratic-equation/latest/quadratic-equation_fa.html",description:"بررسی ریشه‌ها (جواب‌ها) و نمودار توابع درجه دوم."},{title:"تبدیلات هندسی",url:"https://phet.colorado.edu/sims/html/geometric-transformations/latest/geometric-transformations_en.html",description:"یادگیری و اعمال انتقال، دوران، بازتاب و انبساط."},{title:"کاوشگر هندسه سه‌بعدی",url:"https://phet.colorado.edu/sims/html/geometric-explorer/latest/geometric-explorer_en.html",description:"مشاهده و چرخش اشکال سه‌بعدی و درک خواص آنها."},{title:"ساخت حجم",url:"https://phet.colorado.edu/sims/html/volume-builder/latest/volume-builder_fa.html",description:"کاوش در مفهوم حجم با استفاده از مکعب‌های واحد."},{title:"زاویه‌ها و مثلث‌ها",url:"https://phet.colorado.edu/sims/html/angles-and-triangles/latest/angles-and-triangles_fa.html",description:"کاوش در اندازه‌گیری زوایا و خواص مثلث‌ها."},{title:"مساحت و محیط دایره",url:"https://phet.colorado.edu/sims/html/circle-area-and-circumference/latest/circle-area-and-circumference_fa.html",description:"درک مفاهیم شعاع، قطر، محیط و مساحت دایره."},{title:"منشور و هرم",url:"https://phet.colorado.edu/sims/html/prisms-and-pyramids/latest/prisms-and-pyramids_en.html",description:"بررسی حجم و مساحت سطح منشورها و هرم‌ها."},{title:"حل سیستم‌های نامعادلات",url:"https://phet.colorado.edu/sims/html/systems-of-inequalities/latest/systems-of-inequalities_en.html",description:"رسم و پیدا کردن ناحیه مشترک جواب‌های سیستم‌های نامعادلات خطی."},{title:"توابع چند جمله‌ای",url:"https://phet.colorado.edu/sims/html/polynomial-functions/latest/polynomial-functions_en.html",description:"رسم و تجزیه و تحلیل ریشه‌ها و رفتار توابع چند جمله‌ای."},{title:"توابع تکه‌ای",url:"https://phet.colorado.edu/sims/html/piecewise-functions/latest/piecewise-functions_en.html",description:"رسم و تجزیه و تحلیل توابعی که با چند قانون تعریف شده‌اند."},{title:"ماشین تریگ",url:"https://phet.colorado.edu/sims/html/trig-tour/latest/trig-tour_fa.html",description:"معرفی توابع سینوس، کسینوس و تانژانت و دایره مثلثاتی."},{title:"نسبت‌های مثلثاتی در دایره",url:"https://phet.colorado.edu/sims/html/unit-circle/latest/unit-circle_fa.html",description:"کاوش در توابع سینوس و کسینوس با استفاده از دایره واحد."},{title:"مقدمه‌ای بر لگاریتم‌ها",url:"https://phet.colorado.edu/sims/html/logarithms-intro/latest/logarithms-intro_en.html",description:"درک لگاریتم‌ها به عنوان معکوس توان‌ها."},{title:"نمودار توابع نمایی و لگاریتمی",url:"https://phet.colorado.edu/sims/html/exponential-logarithmic-functions/latest/exponential-logarithmic-functions_en.html",description:"کاوش در ویژگی‌های توابع نمایی و لگاریتمی و رابطه معکوس آن‌ها."},{title:"قانون کسینوس‌ها و سینوس‌ها",url:"https://phet.colorado.edu/sims/html/law-of-sines-and-cosines/latest/law-of-sines-and-cosines_en.html",description:"استفاده از قوانین سینوس و کسینوس برای حل مثلث‌ها."},{title:"توابع مثلثاتی پیشرفته",url:"https://phet.colorado.edu/sims/html/trigonometric-functions/latest/trigonometric-functions_en.html",description:"کاوش در نمودار، دامنه و برد توابع مثلثاتی."},{title:"رادیکال‌ها و ریشه‌ها",url:"https://phet.colorado.edu/sims/html/roots-and-radicals/latest/roots-and-radicals_en.html",description:"بررسی مفهوم ریشه‌های دوم، سوم و بالاتر."},{title:"تقسیم چند جمله‌ای‌ها",url:"https://phet.colorado.edu/sims/html/polynomial-division/latest/polynomial-division_en.html",description:"یادگیری تقسیم طولانی و ترکیبی چند جمله‌ای‌ها."},{title:"نامعادلات قدر مطلق",url:"https://phet.colorado.edu/sims/html/absolute-value-inequalities/latest/absolute-value-inequalities_en.html",description:"حل نامعادلات شامل قدر مطلق و نمایش جواب در خط اعداد."},{title:"توابع گویای مقدماتی",url:"https://phet.colorado.edu/sims/html/rational-functions-intro/latest/rational-functions-intro_en.html",description:"بررسی مجانب‌ها و ویژگی‌های اولیه توابع گویا."},{title:"نمودار توابع گویا",url:"https://phet.colorado.edu/sims/html/graphing-rational-functions/latest/graphing-rational-functions_en.html",description:"تجزیه و تحلیل پارامترها و رسم نمودار توابع گویا."},{title:"نمودار تابع قدر مطلق",url:"https://phet.colorado.edu/sims/html/absolute-value-function-grapher/latest/absolute-value-function-grapher_en.html",description:"رسم نمودار توابع قدر مطلق و بررسی تأثیر پارامترها."},{title:"مقدمه‌ای بر توابع نمایی",url:"https://phet.colorado.edu/sims/html/exponential-functions-intro/latest/exponential-functions-intro_en.html",description:"بررسی رشد و زوال نمایی با تغییر پارامترها."},{title:"لگاریتم‌ها و مقیاس‌ها",url:"https://phet.colorado.edu/sims/html/logarithms-and-scales/latest/logarithms-and-scales_en.html",description:"کاربرد لگاریتم‌ها در مقیاس‌های مختلف (مانند PH و دسی‌بل)."},{title:"نصف عمر",url:"https://phet.colorado.edu/sims/html/half-life/latest/half-life_fa.html",description:"مدل‌سازی رشد نمایی و زوال (کاربرد در ریاضیات و علوم)."},{title:"مقدمه‌ای بر مشتق",url:"https://phet.colorado.edu/sims/html/calculus-grapher/latest/calculus-grapher_en.html",description:"بررسی رابطه مشتق یک تابع با شیب منحنی آن."},{title:"انتگرال مقدماتی",url:"https://phet.colorado.edu/sims/html/calculus-area/latest/calculus-area_en.html",description:"درک انتگرال به عنوان مساحت زیر نمودار."},{title:"حدود و پیوستگی",url:"https://phet.colorado.edu/sims/html/calculus-limits/latest/calculus-limits_en.html",description:"کاوش در حد توابع از سمت چپ و راست و مفهوم پیوستگی."},{title:"تقریب مساحت",url:"https://phet.colorado.edu/sims/html/area-approximation/latest/area-approximation_en.html",description:"استفاده از مستطیل‌ها برای تقریب مساحت زیر منحنی (مقدمه انتگرال)."},{title:"طول مسیر",url:"https://phet.colorado.edu/sims/html/arc-length/latest/arc-length_en.html",description:"محاسبه طول کمان یک منحنی در حسابان."},{title:"حجم حاصل از دوران",url:"https://phet.colorado.edu/sims/html/volume-of-revolution/latest/volume-of-revolution_en.html",description:"درک روش دیسک و واشر برای محاسبه حجم در حسابان."},{title:"قضیه مقدار میانی",url:"https://phet.colorado.edu/sims/html/intermediate-value-theorem/latest/intermediate-value-theorem_en.html",description:"درک مفهوم قضیه مقدار میانی در حسابان."},{title:"قضیه رول",url:"https://phet.colorado.edu/sims/html/rolle-s-theorem/latest/rolle-s-theorem_en.html",description:"کاوش در قضیه رول و ارتباط آن با مشتق."},{title:"قضیه مقدار میانگین",url:"https://phet.colorado.edu/sims/html/mean-value-theorem/latest/mean-value-theorem_en.html",description:"بررسی قضیه مقدار میانگین برای مشتق و انتگرال."},{title:"مقدمه‌ای بر توابع چند متغیره",url:"https://phet.colorado.edu/sims/html/multivariable-functions/latest/multivariable-functions_en.html",description:"مشاهده نمودار و کانتورهای توابع با دو متغیر مستقل."},{title:"مشتق‌های جزئی",url:"https://phet.colorado.edu/sims/html/partial-derivatives/latest/partial-derivatives_en.html",description:"درک مشتق‌گیری نسبت به یک متغیر در توابع چند متغیره."},{title:"ماتریس‌ها",url:"https://phet.colorado.edu/sims/html/matrix-algebra/latest/matrix-algebra_en.html",description:"تمرین عملیات جمع، تفریق و ضرب ماتریس‌ها."},{title:"تبدیلات خطی",url:"https://phet.colorado.edu/sims/html/linear-transformations/latest/linear-transformations_en.html",description:"مشاهده تأثیر ماتریس‌ها بر تبدیل اشکال در صفحه مختصات."},{title:"بررسی دترمینان",url:"https://phet.colorado.edu/sims/html/determinant-explorer/latest/determinant-explorer_en.html",description:"درک دترمینان به عنوان مقیاس کننده مساحت/حجم و خواص آن."},{title:"فضاهای برداری و زیر فضاها",url:"https://phet.colorado.edu/sims/html/vector-spaces/latest/vector-spaces_en.html",description:"کاوش در پایه‌ها، ابعاد و زیرفضاهای فضاهای برداری."},{title:"مقدمه‌ای بر بردارها",url:"https://phet.colorado.edu/sims/html/vector-addition/latest/vector-addition_fa.html",description:"آشنایی با مفاهیم جمع بردارها، اجزاء و مقادیر آنها."},{title:"بردارها در فضای سه بعدی",url:"https://phet.colorado.edu/sims/html/vector-addition-3d/latest/vector-addition-3d_en.html",description:"جمع و تجزیه بردارها در فضای مختصات سه بعدی."},{title:"مقادیر و بردارهای ویژه",url:"https://phet.colorado.edu/sims/html/eigenvalues-eigenvectors/latest/eigenvalues-eigenvectors_en.html",description:"مشاهده تأثیر تبدیلات خطی بر بردارهای ویژه."},{title:"تجزیه مقدارهای منفرد (SVD)",url:"https://phet.colorado.edu/sims/html/singular-value-decomposition/latest/singular-value-decomposition_en.html",description:"درک تجزیه ماتریس‌ها به مقادیر منفرد و کاربردهای آن."},{title:"توزیع نرمال",url:"https://phet.colorado.edu/sims/html/normal-distribution/latest/normal-distribution_fa.html",description:"درک منحنی زنگی و پارامترهای توزیع نرمال."},{title:"احتمال با سکه",url:"https://phet.colorado.edu/sims/html/coin-flip/latest/coin-flip_fa.html",description:"کاوش در احتمالات از طریق آزمایش‌های پرتاب سکه."},{title:"نمودار دایره‌ای",url:"https://phet.colorado.edu/sims/html/pie-chart/latest/pie-chart_fa.html",description:"ساخت و تفسیر نمودارهای دایره‌ای (Pie Charts)."},{title:"نمایش داده‌ها",url:"https://phet.colorado.edu/sims/html/data-explorer/latest/data-explorer_fa.html",description:"ساخت و تجزیه و تحلیل هیستوگرام، نمودار جعبه‌ای و نمودار پراکندگی."},{title:"رگرسیون خطی",url:"https://phet.colorado.edu/sims/html/least-squares-regression/latest/least-squares-regression_en.html",description:"پیدا کردن بهترین خط برازش برای یک مجموعه داده (رگرسیون)."},{title:"قضیه حد مرکزی",url:"https://phet.colorado.edu/sims/html/central-limit-theorem/latest/central-limit-theorem_en.html",description:"درک توزیع‌های نمونه‌گیری و نقش قضیه حد مرکزی در آمار."},{title:"توزیع دو جمله‌ای",url:"https://phet.colorado.edu/sims/html/binomial-distribution/latest/binomial-distribution_en.html",description:"بررسی توزیع دو جمله‌ای و ارتباط آن با پرتاب‌های مستقل."},{title:"توزیع پواسون",url:"https://phet.colorado.edu/sims/html/poisson-distribution/latest/poisson-distribution_en.html",description:"مدل‌سازی تعداد رخدادها در یک بازه زمانی یا مکانی مشخص."},{title:"انحراف معیار",url:"https://phet.colorado.edu/sims/html/standard-deviation/latest/standard-deviation_en.html",description:"درک بصری مفهوم پراکندگی داده‌ها و انحراف معیار."},{title:"فاصله اطمینان",url:"https://phet.colorado.edu/sims/html/confidence-intervals/latest/confidence-intervals_en.html",description:"یادگیری نحوه ساخت و تفسیر فواصل اطمینان برای میانگین جامعه."},{title:"آزمون فرضیه",url:"https://phet.colorado.edu/sims/html/hypothesis-testing/latest/hypothesis-testing_en.html",description:"مقدمه‌ای بر آمار استنباطی و آزمون‌های آماری."},{title:"قانون اعداد بزرگ",url:"https://phet.colorado.edu/sims/html/law-of-large-numbers/latest/law-of-large-numbers_en.html",description:"مشاهده اینکه چگونه میانگین نمونه به میانگین واقعی جامعه نزدیک می‌شود."},{title:"آمار توصیفی",url:"https://phet.colorado.edu/sims/html/descriptive-statistics/latest/descriptive-statistics_en.html",description:"محاسبه میانگین، میانه، مد و رسم نمودارهای اولیه داده."},{title:"نمودار جعبه‌ای (Box Plot)",url:"https://phet.colorado.edu/sims/html/box-plot-explorer/latest/box-plot-explorer_en.html",description:"کاوش در چارک‌ها، محدوده بین چارکی و نمودارهای جعبه‌ای."},{title:"تبدیل واحدها",url:"https://phet.colorado.edu/sims/html/unit-converter/latest/unit-converter_fa.html",description:"تمرین تبدیل واحدهای اندازه‌گیری مختلف (طول، مساحت، حجم و غیره)."},{title:"تجزیه و تحلیل داده‌های دو متغیره",url:"https://phet.colorado.edu/sims/html/two-variable-data/latest/two-variable-data_en.html",description:"رسم نمودار پراکندگی و بررسی ارتباط بین دو متغیر."},{title:"نمودار تابع قدر مطلق",url:"https://phet.colorado.edu/sims/html/absolute-value-function-grapher/latest/absolute-value-function-grapher_en.html",description:"رسم نمودار توابع قدر مطلق و بررسی تأثیر پارامترها."},{title:"فضاهای برداری تعاملی",url:"https://phet.colorado.edu/sims/html/interactive-vector-spaces/latest/interactive-vector-spaces_en.html",description:"تعامل با بردارهای پایه و زیرفضاهای تولید شده."},{title:"معادلات دیفرانسیل",url:"https://phet.colorado.edu/sims/html/differential-equations/latest/differential-equations_en.html",description:"بررسی بصری پاسخ‌های معادلات دیفرانسیل مرتبه اول."},{title:"معادلات مرتبه دوم",url:"https://phet.colorado.edu/sims/html/second-order-differential-equations/latest/second-order-differential-equations_en.html",description:"حل بصری معادلات دیفرانسیل خطی مرتبه دوم (مانند فنر)."},{title:"مقدمه‌ای بر تبدیل لاپلاس",url:"https://phet.colorado.edu/sims/html/laplace-transform-intro/latest/laplace-transform-intro_en.html",description:"درک بصری تبدیل لاپلاس و کاربردهای آن در حل معادلات."},{title:"تجزیه و تحلیل فوریه",url:"https://phet.colorado.edu/sims/html/fourier-series/latest/fourier-series_en.html",description:"درک چگونگی ساخت توابع پیچیده از جمع سینوس‌ها و کسینوس‌ها."},{title:"سری تیلور",url:"https://phet.colorado.edu/sims/html/taylor-series/latest/taylor-series_en.html",description:"مشاهده نحوه تقریب زدن توابع با استفاده از چند جمله‌ای‌ها."},{title:"اعداد مختلط",url:"https://phet.colorado.edu/sims/html/complex-numbers/latest/complex-numbers_en.html",description:"نمایش بصری و انجام عملیات روی اعداد مختلط در صفحه گاوسی."},{title:"معادلات پارامتری",url:"https://phet.colorado.edu/sims/html/parametric-equations/latest/parametric-equations_en.html",description:"رسم و تجزیه و تحلیل منحنی‌ها با استفاده از معادلات پارامتری."},{title:"معادلات قطبی",url:"https://phet.colorado.edu/sims/html/polar-equations/latest/polar-equations_en.html",description:"رسم توابع و منحنی‌ها در دستگاه مختصات قطبی."},{title:"نمودار رادیکال‌ها",url:"https://phet.colorado.edu/sims/html/graphing-radicals/latest/graphing-radicals_en.html",description:"رسم نمودار توابع رادیکالی و بررسی خواص آن‌ها."},{title:"کسرهای جزئی",url:"https://phet.colorado.edu/sims/html/partial-fractions/latest/partial-fractions_en.html",description:"یادگیری تجزیه کسرها به کسرهای ساده‌تر برای انتگرال‌گیری."},{title:"معادلات نامعلوم",url:"https://phet.colorado.edu/sims/html/undefined-equations/latest/undefined-equations_en.html",description:"بررسی شرایطی که یک عبارت ریاضی (مانند تقسیم بر صفر) نامعلوم می‌شود."},{title:"بردارها در سیستم مختصات",url:"https://phet.colorado.edu/sims/html/vectors-in-coordinate-system/latest/vectors-in-coordinate-system_en.html",description:"بررسی مختصات، اندازه و جهت بردارها در صفحه."},{title:"عملیات برداری پیشرفته",url:"https://phet.colorado.edu/sims/html/advanced-vector-operations/latest/advanced-vector-operations_en.html",description:"تمرین ضرب داخلی (نقطه‌ای) و ضرب خارجی (ضرب برداری) بردارها."},{title:"دنباله‌ها و سری‌ها",url:"https://phet.colorado.edu/sims/html/sequences-and-series/latest/sequences-and-series_en.html",description:"کاوش در رفتار دنباله‌ها و تعیین همگرایی سری‌ها."},{title:"نمودارهای سه‌بعدی",url:"https://phet.colorado.edu/sims/html/3d-grapher/latest/3d-grapher_en.html",description:"مشاهده و چرخش نمودارهای توابع دو متغیره در فضای سه بعدی."},{title:"معادله خط در فضا",url:"https://phet.colorado.edu/sims/html/line-in-space/latest/line-in-space_en.html",description:"درک معادله خطوط و صفحات در فضای سه بعدی."},{title:"انتگرال خط",url:"https://phet.colorado.edu/sims/html/line-integral/latest/line-integral_en.html",description:"درک مفهوم انتگرال خط در یک میدان برداری."},{title:"قضیه گرین",url:"https://phet.colorado.edu/sims/html/green-s-theorem/latest/green-s-theorem_en.html",description:"بررسی ارتباط بین انتگرال خط در مرز یک ناحیه و انتگرال روی ناحیه."},{title:"معادلات دیفرانسیل مرتبه بالاتر",url:"https://phet.colorado.edu/sims/html/higher-order-differential-equations/latest/higher-order-differential-equations_en.html",description:"مدل‌سازی سیستم‌های پیچیده با معادلات دیفرانسیل با مرتبه بالا."},{title:"تبدیلات لاپلاس معکوس",url:"https://phet.colorado.edu/sims/html/inverse-laplace-transform/latest/inverse-laplace-transform_en.html",description:"بررسی چگونگی بازگشت از فضای لاپلاس به تابع اصلی."},{title:"سطوح مقطع",url:"https://phet.colorado.edu/sims/html/conic-sections/latest/conic-sections_en.html",description:"کاوش در دایره، بیضی، سهمی و هذلولی به عنوان برش‌های مخروط."},{title:"توابع مثلثاتی معکوس",url:"https://phet.colorado.edu/sims/html/inverse-trigonometric-functions/latest/inverse-trigonometric-functions_en.html",description:"بررسی نمودار و خواص توابع معکوس مثلثاتی."},{title:"نمودارهای قطبی پیشرفته",url:"https://phet.colorado.edu/sims/html/advanced-polar-graphs/latest/advanced-polar-graphs_en.html",description:"رسم توابع و منحنی‌ها در دستگاه مختصات قطبی (مانند رُزها)."},{title:"جبر گزاره‌ها",url:"https://phet.colorado.edu/sims/html/propositional-logic/latest/propositional-logic_en.html",description:"بررسی عملیات‌های منطقی (مانند AND, OR, NOT) و جداول درستی."},{title:"نظریه گراف مقدماتی",url:"https://phet.colorado.edu/sims/html/graph-theory-intro/latest/graph-theory-intro_en.html",description:"آشنایی با گره‌ها، یال‌ها و مفاهیم اساسی نظریه گراف."},{title:"تبدیلات موجک",url:"https://phet.colorado.edu/sims/html/wavelet-transforms/latest/wavelet-transforms_en.html",description:"تجزیه و تحلیل توابع با استفاده از تبدیل موجک (Wavelet)."},{title:"جبر بولی",url:"https://phet.colorado.edu/sims/html/boolean-algebra/latest/boolean-algebra_en.html",description:"یادگیری و ساده‌سازی عبارات منطقی و مدارهای بولی."},{title:"منطق فازی",url:"https://phet.colorado.edu/sims/html/fuzzy-logic/latest/fuzzy-logic_en.html",description:"درک مفهوم عضویت نسبی و کاربردهای منطق فازی."},{title:"فاکتورگیری چند جمله‌ای‌ها (پیشرفته)",url:"https://phet.colorado.edu/sims/html/advanced-polynomial-factoring/latest/advanced-polynomial-factoring_en.html",description:"تمرین فاکتورگیری چند جمله‌ای‌های درجه بالاتر و پیچیده."},{title:"مزدوج‌های مختلط",url:"https://phet.colorado.edu/sims/html/complex-conjugates/latest/complex-conjugates_en.html",description:"درک مفهوم مزدوج اعداد مختلط و استفاده از آن در تقسیم."},{title:"خواص دترمینان",url:"https://phet.colorado.edu/sims/html/determinant-properties/latest/determinant-properties_en.html",description:"کاوش در تأثیر عملیات سطری و ستونی بر روی دترمینان ماتریس."},{title:"رتبه‌بندی ماتریس",url:"https://phet.colorado.edu/sims/html/matrix-rank/latest/matrix-rank_en.html",description:"تعیین رتبه (Rank) ماتریس و ارتباط آن با فضای ستونی و سطری."},{title:"تجزیه QR",url:"https://phet.colorado.edu/sims/html/qr-decomposition/latest/qr-decomposition_en.html",description:"درک تجزیه ماتریس‌ها به فرم Q و R و کاربرد آن در حل سیستم‌ها."},{title:"سیستم‌های غیر خطی",url:"https://phet.colorado.edu/sims/html/nonlinear-systems/latest/nonlinear-systems_en.html",description:"حل بصری سیستم‌های معادلات شامل توابع غیر خطی."},{title:"نامعادلات قدر مطلق سه‌بعدی",url:"https://phet.colorado.edu/sims/html/3d-absolute-value-inequalities/latest/3d-absolute-value-inequalities_en.html",description:"رسم مناطق جواب برای نامعادلات قدر مطلق در فضای سه بعدی."},{title:"حدود در توابع دو متغیره",url:"https://phet.colorado.edu/sims/html/multivariable-limits/latest/multivariable-limits_en.html",description:"بررسی حدود توابع با دو متغیر در امتداد مسیرهای مختلف."},{title:"قضیه استوکس",url:"https://phet.colorado.edu/sims/html/stokes-theorem/latest/stokes-theorem_en.html",description:"درک ارتباط بین انتگرال سطحی و انتگرال خط مرزی."},{title:"قضیه دیورژانس",url:"https://phet.colorado.edu/sims/html/divergence-theorem/latest/divergence-theorem_en.html",description:"درک ارتباط بین انتگرال حجمی دیورژانس یک میدان برداری و انتگرال سطحی."},{title:"فضاهای متریک",url:"https://phet.colorado.edu/sims/html/metric-spaces/latest/metric-spaces_en.html",description:"کاوش در مفاهیم فاصله و توپولوژی در فضاهای متریک انتزاعی."},{title:"اعداد اول و فاکتورگیری",url:"https://phet.colorado.edu/sims/html/prime-numbers-and-factoring/latest/prime-numbers-and-factoring_en.html",description:"تجزیه اعداد به عوامل اول و درک توزیع اعداد اول."},{title:"جبر مجرد: گروه‌ها",url:"https://phet.colorado.edu/sims/html/abstract-algebra-groups/latest/abstract-algebra-groups_en.html",description:"آشنایی با مفاهیم گروه‌ها، زیرگروه‌ها و عملیات‌های دوتایی."},{title:"جبر مجرد: حلقه‌ها و میدان‌ها",url:"https://phet.colorado.edu/sims/html/abstract-algebra-rings-fields/latest/abstract-algebra-rings-fields_en.html",description:"کاوش در ساختارهای جبری حلقه‌ها و میدان‌ها."},{title:"هندسه غیر اقلیدسی",url:"https://phet.colorado.edu/sims/html/non-euclidean-geometry/latest/non-euclidean-geometry_en.html",description:"مشاهده تفاوت‌های هندسه هذلولی و کروی با هندسه اقلیدسی."},{title:"توپولوژی مقدماتی",url:"https://phet.colorado.edu/sims/html/topology-intro/latest/topology-intro_en.html",description:"درک مفاهیم اولیه فضای توپولوژیک و پیوستگی."},{title:"فضاهای هیلبرت",url:"https://phet.colorado.edu/sims/html/hilbert-spaces/latest/hilbert-spaces_en.html",description:"کاوش در فضاهای برداری با ضرب داخلی (فضاهای هیلبرت)."},{title:"مدل‌سازی رشد جمعیت",url:"https://phet.colorado.edu/sims/html/population-growth/latest/population-growth_fa.html",description:"استفاده از توابع نمایی و لجستیک برای مدل‌سازی رشد."},{title:"مسائل بهینه‌سازی",url:"https://phet.colorado.edu/sims/html/optimization-problems/latest/optimization-problems_en.html",description:"یافتن مقادیر ماکزیمم و مینیمم در توابع با محدودیت."},{title:"تقریب خطی و خطا",url:"https://phet.colorado.edu/sims/html/linear-approximation/latest/linear-approximation_en.html",description:"استفاده از خط مماس برای تقریب زدن توابع و محاسبه خطا."},{title:"نمودار توابع هایپربولیک",url:"https://phet.colorado.edu/sims/html/hyperbolic-functions/latest/hyperbolic-functions_en.html",description:"بررسی توابع سینوس هیپربولیک و کسینوس هیپربولیک."},{title:"منطق مرتبه اول",url:"https://phet.colorado.edu/sims/html/first-order-logic/latest/first-order-logic_en.html",description:"آشنایی با سورها (برای هر، وجود دارد) و استدلال‌های منطقی."},{title:"استدلال استقرایی و قیاسی",url:"https://phet.colorado.edu/sims/html/inductive-deductive-reasoning/latest/inductive-deductive-reasoning_en.html",description:"درک روش‌های استدلال ریاضی و منطقی."},{title:"شبکه‌های عصبی مقدماتی",url:"https://phet.colorado.edu/sims/html/neural-networks-intro/latest/neural-networks-intro_en.html",description:"مدل‌سازی عملکرد پایه شبکه‌های عصبی و وزن‌دهی."},{title:"معادلات دیفرانسیل جزئی (PDE)",url:"https://phet.colorado.edu/sims/html/partial-differential-equations/latest/partial-differential-equations_en.html",description:"مدل‌سازی پدیده‌هایی مانند گرما و موج با PDEها."},{title:"فضاهای فشرده",url:"https://phet.colorado.edu/sims/html/compact-spaces/latest/compact-spaces_en.html",description:"درک مفهوم فضای فشرده در توپولوژی."},{title:"تابع گاما",url:"https://phet.colorado.edu/sims/html/gamma-function/latest/gamma-function_en.html",description:"کاوش در تابع گاما به عنوان تعمیم فاکتوریل."},{title:"تبدیلات موبیوس",url:"https://phet.colorado.edu/sims/html/mobius-transformations/latest/mobius-transformations_en.html",description:"بررسی نگاشت‌های پیچیده و هندسی تبدیل موبیوس."},{title:"مدل‌سازی با نمودارها",url:"https://phet.colorado.edu/sims/html/graph-modeling/latest/graph-modeling_en.html",description:"ساخت مدل‌های ریاضی از موقعیت‌های واقعی با استفاده از نمودارها."},{title:"آنالیز مختلط: انتگرال کُشی",url:"https://phet.colorado.edu/sims/html/cauchy-integral/latest/cauchy-integral_en.html",description:"درک قضیه انتگرال کُشی در توابع مختلط."},{title:"توابع تحلیلی",url:"https://phet.colorado.edu/sims/html/analytic-functions/latest/analytic-functions_en.html",description:"بررسی ویژگی‌های توابع تحلیلی و معادلات کوشی-ریمان."},{title:"انتگرال ریمان-استیلتیس",url:"https://phet.colorado.edu/sims/html/riemann-stieltjes-integral/latest/riemann-stieltjes-integral_en.html",description:"مقدمه‌ای بر تعمیم انتگرال ریمان."},{title:"مقدمه‌ای بر ابعاد بالا",url:"https://phet.colorado.edu/sims/html/high-dimensional-intro/latest/high-dimensional-intro_en.html",description:"تجسم و درک مفاهیم هندسی در ابعاد بالاتر از سه."},{title:"فضاهای اقلیدسی",url:"https://phet.colorado.edu/sims/html/euclidean-spaces/latest/euclidean-spaces_en.html",description:"کاوش در پایه‌ها و خواص فضاهای اقلیدسی (R^n)."},{title:"شبکه‌های پتری",url:"https://phet.colorado.edu/sims/html/petri-nets/latest/petri-nets_en.html",description:"مدل‌سازی سیستم‌های توزیع شده و همزمان با شبکه‌های پتری."},{title:"توزیع‌های نمونه‌گیری",url:"https://phet.colorado.edu/sims/html/sampling-distributions/latest/sampling-distributions_en.html",description:"درک توزیع آماره‌ها از نمونه‌های مختلف."},{title:"خطوط و منحنی‌ها در فضا",url:"https://phet.colorado.edu/sims/html/lines-and-curves-in-space/latest/lines-and-curves-in-space_en.html",description:"تجسم مسیرها، بردارهای مماس و انحنا در فضای سه بعدی."}],
            fizik: [{title:"حرکت پرتابی",url:"https://phet.colorado.edu/sims/html/projectile-motion/latest/projectile-motion_fa.html",description:"تحلیل مسیر حرکت پرتابه‌ها با متغیرهای مختلف (سرعت، زاویه، مقاومت هوا)."},{title:"نیروها و حرکت",url:"https://phet.colorado.edu/sims/html/forces-and-motion-basics/latest/forces-and-motion-basics_all.html?locale=fa",description:"درک قوانین نیوتن با اعمال نیروها و مشاهده حرکت و شتاب اجسام."},{title:"پارک اسکیت انرژی",url:"https://phet.colorado.edu/sims/html/energy-skate-park-basics/latest/energy-skate-park-basics_fa.html",description:"کاوش در تبدیل انرژی جنبشی و پتانسیل گرانشی."},{title:"اصطکاک و نیروی لغزش",url:"https://phet.colorado.edu/sims/cheerpj/motion-series/latest/motion-series.html?simulation=ramp-forces-and-motion&locale=fa",description:"بررسی تأثیر ضرایب اصطکاک استاتیک و جنبشی بر روی حرکت سطح شیب‌دار."},{title:"نیروی اصطکاک",url:"https://phet.colorado.edu/sims/html/friction/latest/friction_all.html?locale=fa",description:"درک نیروی اصطکاک و مکانیزم آن در مقیاس کوچک به صورت بصری."},{title:"آزمایشگاه برخورد",url:"https://phet.colorado.edu/sims/html/collision-lab/latest/collision-lab_fa.html",description:"تجزیه و تحلیل پایستگی تکانه و انرژی در برخوردهای الاستیک و غیرالاستیک."},{title:"آونگ ساده",url:"https://phet.colorado.edu/sims/html/pendulum-lab/latest/pendulum-lab_fa.html",description:"بررسی دوره تناوب آونگ با تغییر طول نخ و جرم."},{title:"قانون اهم",url:"https://phet.colorado.edu/sims/html/ohms-law/latest/ohms-law_fa.html",description:"کشف رابطه بین ولتاژ، جریان و مقاومت در مدارها."},{title:"کیت ساخت مدار: جریان مستقیم (DC)",url:"https://phet.colorado.edu/sims/html/circuit-construction-kit-dc/latest/circuit-construction-kit-dc_all.html?locale=fa",description:"ساخت مدارهای ساده سری و موازی جریان مستقیم با استفاده از باتری، لامپ و مقاومت."},{title:"کیت ساخت مدار: جریان متناوب (AC)",url:"https://phet.colorado.edu/sims/html/circuit-construction-kit-ac/latest/circuit-construction-kit-ac_all.html?locale=fa",description:"ساخت مدارهای ساده سری و موازی جریان متناوب با استفاده از باتری، لامپ و مقاومت."},{title:"بار ها و میدان الکتریکی",url:"https://phet.colorado.edu/sims/html/charges-and-fields/latest/charges-and-fields_all.html?locale=fa",description:"یادگیری در مورد میدان‌های الکتریکی با قرار دادن بارهای الکتریکی."},{title:"بادکنک و الکتریسیته ساکن",url:"https://phet.colorado.edu/sims/html/balloons-and-static-electricity/latest/balloons-and-static-electricity_fa.html",description:"تجربه شارژ و دشارژ اجسام و نیروی کولن."},{title:"خم کردن نور (شکست)",url:"https://phet.colorado.edu/sims/html/bending-light/latest/bending-light_fa.html",description:"بررسی پدیده‌های بازتاب، شکست و قانون اسنل."},{title:"دید رنگی",url:"https://phet.colorado.edu/sims/html/color-vision/latest/color-vision_fa.html",description:"کاوش در مورد ترکیب نورهای رنگی (RGB) و نحوه دیدن رنگ‌ها توسط چشم."},{title:"موج روی سیم",url:"https://phet.colorado.edu/sims/html/wave-on-a-string/latest/wave-on-a-string_fa.html",description:"بررسی خواص امواج عرضی شامل دامنه، فرکانس و طول موج."},{title:"صوت و موج",url:"https://phet.colorado.edu/sims/html/sound/latest/sound_fa.html",description:"کاوش در امواج طولی، تولید و انتشار صدا."},{title:"اثر فوتوالکتریک",url:"https://phet.colorado.edu/sims/html/photoelectric-effect/latest/photoelectric-effect_fa.html",description:"مشاهده تولید الکترون‌ها توسط نور و درک مفهوم کوانتومی نور."},{title:"طیف جسم سیاه",url:"https://phet.colorado.edu/sims/html/blackbody-spectrum/latest/blackbody-spectrum_fa.html",description:"بررسی ارتباط دما با حداکثر طول موج و شدت تابش."},{title:"اتم‌ها و ایزوتوپ‌ها",url:"https://phet.colorado.edu/sims/html/isotopes-and-atomic-mass/latest/isotopes-and-atomic-mass_fa.html",description:"درک ساختار اتمی، نوترون‌ها، پروتون‌ها و جرم اتمی."},{title:"نیمه عمر",url:"https://phet.colorado.edu/sims/html/half-life/latest/half-life_fa.html",description:"مدل‌سازی واپاشی رادیواکتیو و مفهوم نیمه عمر مواد."},{title:"گازها",url:"https://phet.colorado.edu/sims/html/gas-properties/latest/gas-properties_fa.html",description:"بررسی رفتار گازها با تغییر دما، حجم و فشار (قوانین گازها)."},{title:"مولکول‌ها و جنبش گرمایی",url:"https://phet.colorado.edu/sims/html/molecules-and-light/latest/molecules-and-light_fa.html",description:"مشاهده جنبش گرمایی مولکول‌ها و تأثیر دما بر سرعت آن‌ها."},{title:"فارادی",url:"https://phet.colorado.edu/sims/html/faradays-law/latest/faradays-law_fa.html",description:"آزمایش القای الکترومغناطیسی با آهنربا و سیم‌پیچ."},{title:"سلف‌ها و القای مغناطیسی",url:"https://phet.colorado.edu/sims/html/generator/latest/generator_fa.html",description:"درک نحوه کار ژنراتورها و تولید جریان الکتریکی با چرخش سیم‌پیچ."},{title:"عدسی‌ها و آینه‌ها",url:"https://phet.colorado.edu/sims/html/geometric-optics/latest/geometric-optics_fa.html",description:"ترسیم پرتوها و تشکیل تصویر در عدسی‌های محدب و مقعر و آینه‌ها."},{title:"فشار سیالات",url:"https://phet.colorado.edu/sims/html/fluid-pressure-and-flow/latest/fluid-pressure-and-flow_fa.html",description:"بررسی فشار در سیالات در عمق‌های مختلف و تأثیر چگالی."},{title:"شناوری",url:"https://phet.colorado.edu/sims/html/buoyancy/latest/buoyancy_all.html?locale=fa",description:"درک نیروی شناوری و چگالی اجسام در آب."},{title:"نیروی گرانش و مدارها",url:"https://phet.colorado.edu/sims/html/gravity-and-orbits/latest/gravity-and-orbits_fa.html",description:"مدل‌سازی حرکت سیارات و قمرها تحت تأثیر گرانش."},{title:"جمع بردارها",url:"https://phet.colorado.edu/sims/html/vector-addition/latest/vector-addition_fa.html",description:"ترکیب بردارها و تجزیه آن‌ها به مؤلفه‌های x و y."},{title:"نیروی مغناطیسی",url:"https://phet.colorado.edu/sims/html/magnets-and-electromagnets/latest/magnets-and-electromagnets_fa.html",description:"بررسی میدان‌های مغناطیسی تولید شده توسط آهنرباها و جریان الکتریکی."},{title:"ساختار اتم",url:"https://phet.colorado.edu/sims/html/rutherford-scattering/latest/rutherford-scattering_fa.html",description:"شبیه‌سازی آزمایش رادرفورد و مدل هسته‌ای اتم."},{title:"مدل بور",url:"https://phet.colorado.edu/sims/html/hydrogen-atom/latest/hydrogen-atom_fa.html",description:"مشاهده سطوح انرژی اتم هیدروژن و جذب و گسیل فوتون‌ها."},{title:"شبیه‌سازی کوانتومی",url:"https://phet.colorado.edu/sims/html/quantum-wave-interference/latest/quantum-wave-interference_en.html",description:"درک دوگانگی موج-ذره برای الکترون‌ها و فوتون‌ها."},{title:"مدارهای RC",url:"https://phet.colorado.edu/sims/html/circuit-construction-kit-ac-dc/latest/circuit-construction-kit-ac-dc_fa.html",description:"ساخت و تحلیل مدارهای خازنی و مقاومتی با جریان متناوب و مستقیم."},{title:"خازن‌ها",url:"https://phet.colorado.edu/sims/html/capacitor-lab-basics/latest/capacitor-lab-basics_fa.html",description:"بررسی ذخیره بار و انرژی در خازن‌ها با تغییر صفحات و فاصله."},{title:"جریان متناوب",url:"https://phet.colorado.edu/sims/html/ac-circuits/latest/ac-circuits_en.html",description:"تجزیه و تحلیل مدارهای RL و RLC با جریان متناوب."},{title:"مکانیک کوانتومی",url:"https://phet.colorado.edu/sims/html/quantum-bound-states/latest/quantum-bound-states_en.html",description:"مشاهده تابع موج در چاه پتانسیل کوانتومی."},{title:"نیروهای میدان",url:"https://phet.colorado.edu/sims/html/field-forces/latest/field-forces_en.html",description:"مقایسه نیروهای الکتریکی، مغناطیسی و گرانشی."},{title:"حرکت دایره‌ای",url:"https://phet.colorado.edu/sims/html/rotation/latest/rotation_fa.html",description:"بررسی سرعت زاویه‌ای، شتاب گریز از مرکز و گشتاور."},{title:"تکانه زاویه‌ای",url:"https://phet.colorado.edu/sims/html/torque/latest/torque_fa.html",description:"درک مفهوم گشتاور نیرو و تعادل دورانی."},{title:"پایداری و تعادل",url:"https://phet.colorado.edu/sims/html/balancing-act/latest/balancing-act_fa.html",description:"آموزش مفاهیم مرکز جرم و تعادل ایستا."},{title:"دینامیک سیالات",url:"https://phet.colorado.edu/sims/html/fluid-dynamics/latest/fluid-dynamics_en.html",description:"بررسی معادله برنولی و جریان آرام سیالات."},{title:"ماشین‌های ساده",url:"https://phet.ado.edu/sims/html/simple-machines/latest/simple-machines_fa.html",description:"کاوش در اهرم‌ها، قرقره‌ها و کار انجام شده توسط آن‌ها."},{title:"مکانیک لاگرانژی",url:"https://phet.colorado.edu/sims/html/lagrangian-mechanics/latest/lagrangian-mechanics_en.html",description:"درک مفاهیم انرژی جنبشی و پتانسیل در فرمول‌بندی لاگرانژ."},{title:"آزمایشگاه کشش",url:"https://phet.colorado.edu/sims/html/hookes-law/latest/hookes-law_fa.html",description:"بررسی قانون هوک و محاسبه ضریب سختی فنر."},{title:"حرکت نوسانی",url:"https://phet.colorado.edu/sims/html/masses-and-springs-lab/latest/masses-and-springs-lab_fa.html",description:"تجزیه و تحلیل نوسانات جرم و فنر و انرژی‌های مرتبط."},{title:"پاشیدگی نور",url:"https://phet.colorado.edu/sims/html/light-dispersion/latest/light-dispersion_en.html",description:"مشاهده تجزیه نور سفید به طیف رنگی توسط منشور."},{title:"تداخل امواج",url:"https://phet.colorado.edu/sims/html/wave-interference/latest/wave-interference_fa.html",description:"آزمایش تداخل و پراش امواج آب، نور و صدا."},{title:"قطبش نور",url:"https://phet.colorado.edu/sims/html/polarization/latest/polarization_en.html",description:"درک مفهوم قطبش و فیلترهای قطبش‌سنج."},{title:"آینه‌های کروی",url:"https://phet.colorado.edu/sims/html/mirror-lab/latest/mirror-lab_fa.html",description:"رسم پرتوها و تشکیل تصویر در آینه‌های کاو و کوژ."},{title:"لنزهای ترکیبی",url:"https://phet.colorado.edu/sims/html/optics-bench/latest/optics-bench_en.html",description:"چیدمان و ترکیب لنزها و آینه‌ها برای ساخت ابزارهای نوری."},{title:"طیف الکترومغناطیسی",url:"https://phet.colorado.edu/sims/html/electromagnetic-spectrum/latest/electromagnetic-spectrum_en.html",description:"کاوش در انواع امواج الکترومغناطیسی از رادیو تا گاما."},{title:"اثر دوپلر",url:"https://phet.colorado.edu/sims/html/doppler-effect/latest/doppler-effect_fa.html",description:"مشاهده تغییر فرکانس امواج با حرکت منبع یا ناظر."},{title:"آزمایشگاه فشار",url:"https://phet.colorado.edu/sims/html/pressure-lab/latest/pressure-lab_fa.html",description:"بررسی فشار گازها در ظروف بسته با تغییر دما و حجم."},{title:"قانون شارل",url:"https://phet.colorado.edu/sims/html/gas-laws-charles/latest/gas-laws-charles_en.html",description:"تحلیل رابطه بین حجم و دما در فشار ثابت."},{title:"قانون بویل",url:"https://phet.colorado.edu/sims/html/gas-laws-boyle/latest/gas-laws-boyle_en.html",description:"تحلیل رابطه بین فشار و حجم در دمای ثابت."},{title:"موتور استرلینگ",url:"https://phet.colorado.edu/sims/html/stirling-engine/latest/stirling-engine_en.html",description:"درک چگونگی تبدیل انرژی حرارتی به کار مکانیکی در موتور استرلینگ."},{title:"انبساط حرارتی",url:"https://phet.colorado.edu/sims/html/thermal-expansion/latest/thermal-expansion_fa.html",description:"مشاهده انبساط جامدات و مایعات در اثر افزایش دما."},{title:"هدایت حرارتی",url:"https://phet.colorado.edu/sims/html/heat-transfer/latest/heat-transfer_fa.html",description:"بررسی روش‌های انتقال گرما شامل رسانایی، همرفت و تابش."},{title:"مفهوم دما و گرما",url:"https://phet.colorado.edu/sims/html/temperature-and-heat/latest/temperature-and-heat_fa.html",description:"درک تفاوت دما (انرژی جنبشی متوسط) و گرما (انرژی منتقل شده)."},{title:"ترمودینامیک مقدماتی",url:"https://phet.colorado.edu/sims/html/thermodynamics-basics/latest/thermodynamics-basics_fa.html",description:"بررسی قانون اول ترمودینامیک و تبدیل انرژی داخلی، گرما و کار."},{title:"چرخه‌های ترمودینامیکی",url:"https://phet.colorado.edu/sims/html/thermodynamic-cycles/latest/thermodynamic-cycles_en.html",description:"تحلیل چرخه‌های کارنو، اتو و دیزل بر روی نمودار PV."},{title:"ترانسفورماتور",url:"https://phet.colorado.edu/sims/html/transformers/latest/transformers_fa.html",description:"درک نحوه کار ترانسفورماتورهای افزاینده و کاهنده."},{title:"قانون لنز",url:"https://phet.colorado.edu/sims/html/lenz-law/latest/lenz-law_fa.html",description:"مشاهده جهت جریان القایی و مقاومت آن در برابر تغییر شار مغناطیسی."},{title:"نیروی لورنتس",url:"https://phet.colorado.edu/sims/html/lorentz-force/latest/lorentz-force_en.html",description:"بررسی نیروی وارد بر یک ذره باردار متحرک در میدان‌های الکتریکی و مغناطیسی."},{title:"شبیه‌ساز باتری",url:"https://phet.colorado.edu/sims/html/battery-resistor-sim/latest/battery-resistor-sim_fa.html",description:"بررسی تأثیر مقاومت داخلی باتری بر توان خروجی."},{title:"پتانسیل الکتریکی",url:"https://phet.colorado.edu/sims/html/charges-and-fields/latest/charges-and-fields_fa.html",description:"نمایش خطوط میدان الکتریکی و سطوح هم‌پتانسیل ناشی از بارهای نقطه‌ای."},{title:"پل وتستون",url:"https://phet.colorado.edu/sims/html/wheatstone-bridge/latest/wheatstone-bridge_en.html",description:"استفاده از پل وتستون برای اندازه‌گیری مقاومت‌های ناشناخته."},{title:"قانون کیرشهف",url:"https://phet.colorado.edu/sims/html/kirchhoffs-laws/latest/kirchhoffs-laws_en.html",description:"تحلیل مدارهای پیچیده با استفاده از قوانین جریان و ولتاژ کیرشهف."},{title:"بردار پوینتیگ",url:"https://phet.colorado.edu/sims/html/poynting-vector/latest/poynting-vector_en.html",description:"نمایش جریان انرژی در میدان‌های الکترومغناطیسی."},{title:"مدارهای RL",url:"https://phet.colorado.edu/sims/html/rl-circuits/latest/rl-circuits_en.html",description:"بررسی شارژ و دشارژ سلف‌ها در مدارهای مقاومتی-سلفی."},{title:"ماکسول",url:"https://phet.colorado.edu/sims/html/maxwell-equations/latest/maxwell-equations_en.html",description:"شبیه‌سازی تصویری معادلات اصلی الکترومغناطیس."},{title:"رنگ‌ها و فیلترها",url:"https://phet.colorado.edu/sims/html/filters/latest/filters_fa.html",description:"درک نحوه جذب و عبور نور توسط فیلترهای رنگی."},{title:"پراش تک شکاف",url:"https://phet.colorado.edu/sims/html/single-slit-diffraction/latest/single-slit-diffraction_fa.html",description:"مشاهده پراش نور پس از عبور از یک شکاف باریک."},{title:"پراش دو شکاف",url:"https://phet.colorado.edu/sims/html/double-slit-interference/latest/double-slit-interference_fa.html",description:"آزمایش تداخل امواج نور و الگوی نوارهای روشن و تاریک."},{title:"توری پراش",url:"https://phet.colorado.edu/sims/html/diffraction-grating/latest/diffraction-grating_en.html",description:"بررسی الگوی تداخل ناشی از تعداد زیادی شکاف (توری)."},{title:"تابش هسته‌ای",url:"https://phet.colorado.edu/sims/html/nuclear-fission/latest/nuclear-fission_fa.html",description:"شبیه‌سازی شکافت هسته‌ای و واکنش‌های زنجیره‌ای."},{title:"همجوشی هسته‌ای",url:"https://phet.colorado.edu/sims/html/nuclear-fusion/latest/nuclear-fusion_en.html",description:"درک فرآیند ترکیب هسته‌های سبک و تولید انرژی (مانند خورشید)."},{title:"واپاشی بتا",url:"https://phet.colorado.edu/sims/html/beta-decay/latest/beta-decay_en.html",description:"بررسی واپاشی بتا و تبدیل نوترون به پروتون و بالعکس."},{title:"طیف‌سنج جرمی",url:"https://phet.colorado.edu/sims/html/mass-spectrometer/latest/mass-spectrometer_en.html",description:"جداسازی ایزوتوپ‌ها بر اساس نسبت جرم به بار در میدان مغناطیسی."},{title:"اشعه کاتدی",url:"https://phet.colorado.edu/sims/html/cathode-ray-tube/latest/cathode-ray-tube_en.html",description:"آزمایش حرکت الکترون‌ها در لوله پرتو کاتدی و انحراف آن‌ها توسط میدان‌ها."},{title:"اثر کامپتون",url:"https://phet.colorado.edu/sims/html/compton-scattering/latest/compton-scattering_en.html",description:"درک برخورد فوتون با الکترون و جابجایی طول موج."},{title:"برهمکنش نور و ماده",url:"https://phet.colorado.edu/sims/html/molecules-and-light-2/latest/molecules-and-light-2_en.html",description:"بررسی چگونگی جذب و گسیل نور فرابنفش، مرئی و فروسرخ توسط مولکول‌ها."},{title:"تابش چرنکوف",url:"https://phet.colorado.edu/sims/html/cherenkov-radiation/latest/cherenkov-radiation_en.html",description:"شبیه‌سازی تابش الکترومغناطیسی تولید شده توسط ذرات سریع‌تر از نور در محیط."},{title:"نسبیت خاص",url:"https://phet.colorado.edu/sims/html/special-relativity/latest/special-relativity_en.html",description:"کاوش در مفاهیم اتساع زمان و انقباض طول."},{title:"ماشین زمان نسبیتی",url:"https://phet.colorado.edu/sims/html/relativity-racer/latest/relativity-racer_en.html",description:"تجربه بصری پدیده‌های نسبیتی در سرعت‌های نزدیک به نور."},{title:"انتقال حرارت",url:"https://phet.colorado.edu/sims/html/heat-transfer-advanced/latest/heat-transfer-advanced_en.html",description:"تحلیل دقیق‌تر انتقال حرارت با در نظر گرفتن ویژگی‌های مواد مختلف."},{title:"مقاومت الکتریکی",url:"https://phet.colorado.edu/sims/html/resistance-in-a-wire/latest/resistance-in-a-wire_fa.html",description:"بررسی تأثیر طول، مساحت و جنس سیم بر مقاومت الکتریکی."},{title:"استرس و فشار",url:"https://phet.colorado.edu/sims/html/stress-and-strain/latest/stress-and-strain_en.html",description:"درک مفاهیم تنش، کرنش و مدول یانگ برای مواد جامد."},{title:"الاستیسیته",url:"https://phet.colorado.edu/sims/html/elasticity/latest/elasticity_en.html",description:"مدل‌سازی تغییر شکل مواد تحت نیرو و حد الاستیک."},{title:"امواج الکترومغناطیسی",url:"https://phet.colorado.edu/sims/html/electromagnetic-waves/latest/electromagnetic-waves_en.html",description:"مشاهده نوسان میدان‌های الکتریکی و مغناطیسی در یک موج."},{title:"میدان‌های الکتریکی یکنواخت",url:"https://phet.colorado.edu/sims/html/uniform-electric-field/latest/uniform-electric-field_en.html",description:"بررسی نیروی وارد بر ذرات باردار در میدان‌های الکتریکی ثابت."},{title:"قانون گاوس",url:"https://phet.colorado.edu/sims/html/gauss-law/latest/gauss-law_en.html",description:"درک نحوه محاسبه شار الکتریکی از طریق سطوح بسته."},{title:"مقاومت سری و موازی",url:"https://phet.colorado.edu/sims/html/resistors-in-series-and-parallel/latest/resistors-in-series-and-parallel_fa.html",description:"محاسبه مقاومت معادل در مدارهای ترکیبی."},{title:"مدارهای RLC",url:"https://phet.colorado.edu/sims/html/rlc-circuits/latest/rlc-circuits_en.html",description:"بررسی تشدید و امپدانس در مدارهای حاوی مقاومت، سلف و خازن."},{title:"طیف اتمی",url:"https://phet.colorado.edu/sims/html/atomic-spectra/latest/atomic-spectra_fa.html",description:"مشاهده خطوط طیفی گسیلی و جذبی برای عناصر مختلف."},{title:"پراش الکترون",url:"https://phet.colorado.edu/sims/html/electron-diffraction/latest/electron-diffraction_en.html",description:"مشاهده الگوی پراش الکترون‌ها (اثبات موجی بودن ماده)."},{title:"اثر زیمان",url:"https://phet.colorado.edu/sims/html/zeeman-effect/latest/zeeman-effect_en.html",description:"بررسی شکافته شدن سطوح انرژی اتم در حضور میدان مغناطیسی."},{title:"مدل اتمی ریدبرگ",url:"https://phet.colorado.edu/sims/html/rydberg-atom/latest/rydberg-atom_en.html",description:"کاوش در فرمول ریدبرگ و محاسبه طول موج فوتون‌های گسیل شده."},{title:"تونل‌زنی کوانتومی",url:"https://phet.colorado.edu/sims/html/quantum-tunneling/latest/quantum-tunneling_en.html",description:"درک احتمال عبور ذره از مانع پتانسیل (پدیده کوانتومی)."},{title:"رادار",url:"https://phet.colorado.edu/sims/html/radar/latest/radar_en.html",description:"درک اصول کار رادار با استفاده از امواج الکترومغناطیسی."},{title:"لرزه‌نگاری",url:"https://phet.colorado.edu/sims/html/seismic-waves/latest/seismic-waves_en.html",description:"مدل‌سازی امواج P و S و نحوه حرکت آن‌ها در زمین."},{title:"مقاومت هوا",url:"https://phet.colorado.edu/sims/html/air-resistance/latest/air-resistance_fa.html",description:"بررسی تأثیر نیروی مقاومت هوا بر سرعت حدی اجسام."},
{title:"ماشین آتوود",url:"https://phet.colorado.edu/sims/html/atwood-machine/latest/atwood-machine_fa.html",description:"تحلیل حرکت و شتاب اجسام آویزان از یک قرقره."},{title:"نیروی مرکزگرا",url:"https://phet.colorado.edu/sims/html/centripetal-force/latest/centripetal-force_fa.html",description:"بررسی نیروهای لازم برای حفظ حرکت دایره‌ای."},{title:"بالابرهای هیدرولیکی",url:"https://phet.colorado.edu/sims/html/hydraulics/latest/hydraulics_fa.html",description:"درک اصل پاسکال و چگونگی انتقال نیرو در سیالات."},{title:"ارتعاشات اجباری",url:"https://phet.colorado.edu/sims/html/forced-vibrations/latest/forced-vibrations_en.html",description:"بررسی تشدید در سیستم‌های نوسانی تحت تأثیر نیروی خارجی."},{title:"خم کردن فضا-زمان",url:"https://phet.colorado.edu/sims/html/spacetime-curvature/latest/spacetime-curvature_en.html",description:"تجسم بصری اثر گرانش بر خمیدگی فضا-زمان (نسبیت عام)."},{title:"انرژی و تکانه موج",url:"https://phet.colorado.edu/sims/html/wave-energy-momentum/latest/wave-energy-momentum_en.html",description:"بررسی انتقال انرژی و تکانه توسط امواج."},{title:"طیف‌سنجی",url:"https://phet.colorado.edu/sims/html/spectroscopy/latest/spectroscopy_en.html",description:"درک اصول طیف‌سنجی و شناسایی عناصر با خطوط طیفی."},{title:"شتاب‌دهنده ذرات",url:"https://phet.colorado.edu/sims/html/particle-accelerator/latest/particle-accelerator_en.html",description:"مدل‌سازی نحوه شتاب دادن به ذرات باردار با استفاده از میدان‌های الکتریکی و مغناطیسی."},{title:"اثر ترموالکتریک",url:"https://phet.colorado.edu/sims/html/thermoelectric-effect/latest/thermoelectric-effect_en.html",description:"بررسی تبدیل اختلاف دما به الکتریسیته (اثر سیبک)."},{title:"مدل‌سازی کوانتومی جامدات",url:"https://phet.colorado.edu/sims/html/quantum-solids/latest/quantum-solids_en.html",description:"بررسی نوارهای انرژی و رفتار الکترون‌ها در مواد نیمه‌رسانا."},{title:"سردسازی لیزری",url:"https://phet.colorado.edu/sims/html/laser-cooling/latest/laser-cooling_en.html",description:"درک اصول خنک‌سازی اتم‌ها با استفاده از فوتون‌ها."},{title:"گرانش کوانتومی",url:"https://phet.colorado.edu/sims/html/quantum-gravity/latest/quantum-gravity_en.html",description:"کاوش مقدماتی در ایده‌های ادغام مکانیک کوانتومی و نسبیت عام."},{title:"انرژی خورشیدی",url:"https://phet.colorado.edu/sims/html/solar-energy/latest/solar-energy_fa.html",description:"بررسی عوامل موثر بر تولید برق توسط پنل‌های خورشیدی."},{title:"نیروهای واندروالس",url:"https://phet.colorado.edu/sims/html/van-der-waals-forces/latest/van-der-waals-forces_en.html",description:"درک فعل و انفعالات ضعیف بین مولکول‌ها."},{title:"کیت ساخت سیم‌پیچ",url:"https://phet.colorado.edu/sims/html/coil-builder/latest/coil-builder_fa.html",description:"ساخت انواع سیم‌پیچ‌ها و بررسی میدان مغناطیسی آن‌ها."},{title:"سپر فارادی",url:"https://phet.colorado.edu/sims/html/faraday-cage/latest/faraday-cage_en.html",description:"درک نحوه محافظت قفس فارادی در برابر میدان‌های الکتریکی خارجی."},{title:"نظریه سینتیک",url:"https://phet.colorado.edu/sims/html/kinetic-theory/latest/kinetic-theory_fa.html",description:"درک رابطه بین جنبش ذرات و خصوصیات ماکروسکوپی (فشار، دما)."},{title:"ماده چگال",url:"https://phet.colorado.edu/sims/html/condensed-matter-physics/latest/condensed-matter-physics_en.html",description:"بررسی رفتار الکترون‌ها در شبکه‌های بلوری جامد."},{title:"شبیه‌ساز تلسکوپ",url:"https://phet.colorado.edu/sims/html/telescope-simulator/latest/telescope-simulator_en.html",description:"بررسی اصول اپتیکی تلسکوپ‌های شکستی و بازتابی."},{title:"برهمکنش مغناطیسی",url:"https://phet.colorado.edu/sims/html/magnetic-interactions/latest/magnetic-interactions_fa.html",description:"کاوش در نیروی بین دو آهنربا و چگونگی تشکیل قطب‌ها."},{title:"موتور الکتریکی",url:"https://phet.colorado.edu/sims/html/motor-basics/latest/motor-basics_fa.html",description:"درک نحوه تبدیل انرژی الکتریکی به مکانیکی توسط موتور DC."},{title:"اثر هال",url:"https://phet.colorado.edu/sims/html/hall-effect/latest/hall-effect_en.html",description:"بررسی ولتاژ هال برای تعیین نوع و چگالی حاملان بار."},{title:"گذردهی و ضریب شکست",url:"https://phet.colorado.edu/sims/html/permittivity-refractive-index/latest/permittivity-refractive-index_en.html",description:"بررسی خواص الکترومغناطیسی مواد دی‌الکتریک."},{title:"جریان آشفته",url:"https://phet.colorado.edu/sims/html/turbulent-flow/latest/turbulent-flow_en.html",description:"مدل‌سازی حرکت نامنظم سیالات و عدد رینولدز."},{title:"تغییر حالت",url:"https://phet.colorado.edu/sims/html/states-of-matter/latest/states-of-matter_fa.html",description:"مشاهده تغییر فاز مواد با تغییر دما و فشار."},{title:"ماشین گرمایی",url:"https://phet.colorado.edu/sims/html/reversible-engines/latest/reversible-engines_en.html",description:"بررسی موتورهای حرارتی برگشت‌پذیر و ناکارآمدی آن‌ها."},{title:"انتروپی",url:"https://phet.colorado.edu/sims/html/entropy-and-microstates/latest/entropy-and-microstates_en.html",description:"درک مفهوم انتروپی به عنوان معیار بی‌نظمی و تعداد ریزحالت‌ها."},{title:"فیزیک پلاسما",url:"https://phet.colorado.edu/sims/html/plasma-physics/latest/plasma-physics_en.html",description:"بررسی رفتار گازهای یونیزه و ذرات باردار در آن‌ها."},{title:"لیزر در اتم‌ها",url:"https://phet.colorado.edu/sims/html/lasers-and-atoms/latest/lasers-and-atoms_en.html",description:"درک پدیده‌های گسیل تحریکی و جذب در لیزر."},{title:"همجوشی سرد",url:"https://phet.colorado.edu/sims/html/cold-fusion/latest/cold-fusion_en.html",description:"کاوش در آزمایش‌های بحث‌برانگیز همجوشی هسته‌ای در دماهای پایین."},{title:"آزمایشگاه کوانتومی",url:"https://phet.colorado.edu/sims/html/quantum-lab/latest/quantum-lab_en.html",description:"کاوش جامع در مفاهیم اصلی مکانیک کوانتومی."},{title:"اپتیک کوانتومی",url:"https://phet.colorado.edu/sims/html/quantum-optics/latest/quantum-optics_en.html",description:"بررسی ماهیت کوانتومی نور (فوتون‌ها)."},{title:"آزمایشگاه فیزیک ذرات",url:"https://phet.colorado.edu/sims/html/particle-physics-lab/latest/particle-physics-lab_en.html",description:"شناخت ذرات بنیادی، لپتون‌ها و کوارک‌ها."},{title:"نیروهای بنیادی",url:"https://phet.colorado.edu/sims/html/fundamental-forces/latest/fundamental-forces_en.html",description:"مقایسه نیروی گرانش، الکترومغناطیس، ضعیف و قوی."},{title:"لرزش و صوت",url:"https://phet.colorado.edu/sims/html/vibrations-and-waves/latest/vibrations-and-waves_fa.html",description:"درک مشترکات بین نوسانات مکانیکی و امواج صوتی."},{title:"فرکانس رزونانس",url:"https://phet.colorado.edu/sims/html/resonance/latest/resonance_fa.html",description:"مشاهده پدیده تشدید در فرکانس‌های خاص."},{title:"تراکم امواج صوتی",url:"https://phet.colorado.edu/sims/html/sound-waves-compression/latest/sound-waves-compression_en.html",description:"تجسم نواحی تراکم و انبساط در انتشار امواج صوتی."},{title:"قانون کولن",url:"https://phet.colorado.edu/sims/html/coulombs-law/latest/coulombs-law_fa.html",description:"محاسبه نیروی بین دو بار نقطه‌ای و تأثیر فاصله و اندازه بار."},{title:"پتانسیل الکتریکی",url:"https://phet.colorado.edu/sims/html/electric-potential/latest/electric-potential_fa.html",description:"بررسی رابطه بین میدان و پتانسیل الکتریکی."},{title:"انرژی میدان الکتریکی",url:"https://phet.colorado.edu/sims/html/electric-field-energy/latest/electric-field-energy_en.html",description:"محاسبه انرژی ذخیره شده در یک سیستم بار الکتریکی."},{title:"دیاگرام‌های فازی",url:"https://phet.colorado.edu/sims/html/phase-diagrams/latest/phase-diagrams_fa.html",description:"درک نقاط سه‌گانه و بحرانی مواد با تغییر فشار و دما."},{title:"سردسازی تبخیری",url:"https://phet.colorado.edu/sims/html/evaporative-cooling/latest/evaporative-cooling_en.html",description:"بررسی چگونگی کاهش دما در اثر تبخیر."},{title:"مدل‌سازی لایه‌های نازک",url:"https://phet.colorado.edu/sims/html/thin-film-interference/latest/thin-film-interference_en.html",description:"بررسی تداخل نور بازتاب شده از لایه‌های نازک (مانند حباب صابون)."},{title:"انعکاس کلی داخلی",url:"https://phet.colorado.edu/sims/html/total-internal-reflection/latest/total-internal-reflection_fa.html",description:"درک زاویه بحرانی و کاربرد آن در فیبر نوری."},{title:"اصل عدم قطعیت",url:"https://phet.colorado.edu/sims/html/uncertainty-principle/latest/uncertainty-principle_en.html",description:"درک محدودیت‌های اندازه‌گیری همزمان موقعیت و تکانه."},{title:"تجزیه تابعی موج",url:"https://phet.colorado.edu/sims/html/wave-function-decomposition/latest/wave-function-decomposition_en.html",description:"تجزیه تابع موج کوانتومی به حالت‌های مختلف انرژی."},{title:"آزمایشگاه فیزیک سطح",url:"https://phet.colorado.edu/sims/html/surface-physics-lab/latest/surface-physics-lab_en.html",description:"کاوش در پدیده‌هایی مانند کشش سطحی و ترشوندگی."},{title:"سوپر رسانایی",url:"https://phet.colorado.edu/sims/html/superconductivity/latest/superconductivity_en.html",description:"بررسی مقاومت صفر و اثر مایسنر در ابررساناها."},{title:"تراوایی مغناطیسی",url:"https://phet.colorado.edu/sims/html/magnetic-permeability/latest/magnetic-permeability_en.html",description:"بررسی تأثیر مواد مختلف بر خطوط میدان مغناطیسی."},{title:"مکانیک محیط‌های پیوسته",url:"https://phet.colorado.edu/sims/html/continuum-mechanics/latest/continuum-mechanics_en.html",description:"مدل‌سازی رفتار مواد به صورت پیوسته (غیرذره‌ای)."},{title:"مکانیک اجسام صلب",url:"https://phet.colorado.edu/sims/html/rigid-body-mechanics/latest/rigid-body-mechanics_en.html",description:"تحلیل دینامیک و سینماتیک اجسام صلب."},{title:"پتانسیل شیمیایی",url:"https://phet.colorado.edu/sims/html/chemical-potential/latest/chemical-potential_en.html",description:"بررسی تعادل فازها با استفاده از مفهوم پتانسیل شیمیایی."},{title:"سرمایش لیزری پیشرفته",url:"https://phet.colorado.edu/sims/html/advanced-laser-cooling/latest/advanced-laser-cooling_en.html",description:"کاوش در روش‌های پیشرفته‌تر خنک‌سازی اتمی."},{title:"مدار ماهواره",url:"https://phet.colorado.edu/sims/html/satellite-orbits/latest/satellite-orbits_fa.html",description:"مدل‌سازی حرکت ماهواره‌ها در مدار زمین."},{title:"قوانین کپلر",url:"https://phet.colorado.edu/sims/html/keplers-laws/latest/keplers-laws_fa.html",description:"بررسی قوانین سه‌گانه حرکت سیارات در مدار."},{title:"مرکز جرم",url:"https://phet.colorado.edu/sims/html/center-of-mass/latest/center-of-mass_fa.html",description:"پیدا کردن مرکز جرم سیستم‌های مختلف."},{title:"انرژی و کار",url:"https://phet.colorado.edu/sims/html/work-energy-theorem/latest/work-energy-theorem_fa.html",description:"درک رابطه بین کار انجام شده و تغییر انرژی جنبشی."},{title:"قدرت و توان",url:"https://phet.colorado.edu/sims/html/power/latest/power_fa.html",description:"محاسبه توان مصرفی و تولیدی در سیستم‌های مکانیکی و الکتریکی."},{title:"شتاب ثابت",url:"https://phet.colorado.edu/sims/html/constant-acceleration/latest/constant-acceleration_fa.html",description:"تجزیه و تحلیل نمودارهای حرکت با شتاب ثابت."},{title:"حرکت نسبی",url:"https://phet.colorado.edu/sims/html/relative-motion/latest/relative-motion_fa.html",description:"درک حرکت اجسام از دیدگاه ناظران مختلف."},{title:"موشک و تکانه",url:"https://phet.colorado.edu/sims/html/rocket-motion/latest/rocket-motion_fa.html",description:"مدل‌سازی حرکت موشک‌ها با حفظ تکانه."},{title:"مقاومت مواد",url:"https://phet.colorado.edu/sims/html/material-strength/latest/material-strength_en.html",description:"بررسی رفتار مواد در برابر شکست و تغییر شکل دائمی."},{title:"هندسه موج",url:"https://phet.colorado.edu/sims/html/wave-geometry/latest/wave-geometry_en.html",description:"بررسی هندسی بازتاب و شکست امواج در مرزها."},{title:"فرکانس طبیعی",url:"https://phet.colorado.edu/sims/html/natural-frequency/latest/natural-frequency_en.html",description:"تعیین فرکانس طبیعی نوسان سیستم‌های مختلف."},{title:"موج ایستاده",url:"https://phet.colorado.edu/sims/html/standing-waves/latest/standing-waves_fa.html",description:"مشاهده تشکیل گره‌ها و شکم‌ها در امواج ساکن."},{title:"دشارژ خازن",url:"https://phet.colorado.edu/sims/html/capacitor-discharge/latest/capacitor-discharge_fa.html",description:"تحلیل منحنی دشارژ خازن در مدار RC."},{title:"مغناطیس زمین",url:"https://phet.colorado.edu/sims/html/earths-magnetism/latest/earths-magnetism_fa.html",description:"کاوش در میدان مغناطیسی زمین و تأثیر آن بر قطب‌نما."},{title:"آهنرباهای الکتریکی",url:"https://phet.colorado.edu/sims/html/electromagnets/latest/electromagnets_fa.html",description:"بررسی عوامل موثر بر قدرت آهنرباهای الکتریکی."},{title:"نشت بار الکتریکی",url:"https://phet.colorado.edu/sims/html/charge-leakage/latest/charge-leakage_en.html",description:"مدل‌سازی تخلیه بار از طریق هوا یا مواد عایق."},{title:"اثر حرارتی",url:"https://phet.colorado.edu/sims/html/joule-heating/latest/joule-heating_fa.html",description:"محاسبه گرمای تولید شده توسط جریان الکتریکی در مقاومت."},{title:"طیف نواری",url:"https://phet.colorado.edu/sims/html/band-gap/latest/band-gap_en.html",description:"درک نوارهای انرژی، رساناها، نیمه‌رساناها و عایق‌ها."},{title:"نیمه‌رساناها",url:"https://phet.colorado.edu/sims/html/semiconductors/latest/semiconductors_en.html",description:"بررسی رفتار مواد نیمه‌رسانا و دوپینگ آن‌ها."},{title:"پاد ماده",url:"https://phet.colorado.edu/sims/html/antimatter/latest/antimatter_en.html",description:"مدل‌سازی تشکیل و نابودی زوج‌های ذره-پادذره."},{title:"تونل‌زنی در دیود",url:"https://phet.colorado.edu/sims/html/diode-tunneling/latest/diode-tunneling_en.html",description:"درک عملکرد دیودهای تونل‌زنی کوانتومی."},{title:"میکروسکوپ کوانتومی",url:"https://phet.colorado.edu/sims/html/quantum-microscope/latest/quantum-microscope_en.html",description:"شبیه‌سازی محدودیت‌های دید در سطح کوانتومی."},{title:"هولوگرافی",url:"https://phet.colorado.edu/sims/html/holography/latest/holography_en.html",description:"درک اصول ایجاد و بازسازی تصاویر سه‌بعدی هولوگرافیک."},{title:"مدل‌سازی بلورها",url:"https://phet.colorado.edu/sims/html/crystal-structure/latest/crystal-structure_en.html",description:"ساخت و بررسی ساختارهای بلوری مختلف."},{title:"نیروی هسته‌ای قوی",url:"https://phet.colorado.edu/sims/html/strong-nuclear-force/latest/strong-nuclear-force_en.html",description:"درک نیروی نگهدارنده هسته اتم."},{title:"آزمایشگاه یونش",url:"https://phet.colorado.edu/sims/html/ionization-lab/latest/ionization-lab_en.html",description:"بررسی انرژی لازم برای یونش اتم‌ها."},{title:"معادله شرودینگر",url:"https://phet.colorado.edu/sims/html/schrodinger-equation/latest/schrodinger-equation_en.html",description:"حل بصری و تحلیل تابع موج با استفاده از معادله شرودینگر."},{title:"اتاقک ابر",url:"https://phet.colorado.edu/sims/html/cloud-chamber/latest/cloud-chamber_en.html",description:"مشاهده مسیر ذرات باردار یونیزه کننده."},{title:"گرافیک‌های مکانیک",url:"https://phet.colorado.edu/sims/html/mechanics-graphs/latest/mechanics-graphs_fa.html",description:"رسم و تحلیل نمودارهای موقعیت-زمان و سرعت-زمان."},{title:"جریان مایعات",url:"https://phet.colorado.edu/sims/html/liquid-flow/latest/liquid-flow_fa.html",description:"بررسی دبی و سرعت سیالات در لوله‌های با مقاطع مختلف."},{title:"قانون آمپر",url:"https://phet.colorado.edu/sims/html/amperes-law/latest/amperes-law_en.html",description:"درک نحوه محاسبه میدان مغناطیسی ناشی از جریان الکتریکی."},{title:"دوقطبی مغناطیسی",url:"https://phet.colorado.edu/sims/html/magnetic-dipole/latest/magnetic-dipole_en.html",description:"بررسی میدان مغناطیسی تولید شده توسط یک حلقه جریان."},{title:"مغناطش مواد",url:"https://phet.colorado.edu/sims/html/magnetization/latest/magnetization_en.html",description:"درک پدیده‌های پارامغناطیس، دیامغناطیس و فرومغناطیس."},{title:"نظریه گازهای کامل",url:"https://phet.colorado.edu/sims/html/ideal-gas-law/latest/ideal-gas-law_fa.html",description:"کاوش در معادله حالت گازهای ایده‌آل (PV=nRT)."},{title:"کار و گرما",url:"https://phet.colorado.edu/sims/html/work-and-heat/latest/work-and-heat_fa.html",description:"مشاهده تبدیل کار مکانیکی به گرما و بالعکس."},{title:"دمای ترمودینامیکی",url:"https://phet.colorado.edu/sims/html/thermodynamic-temperature/latest/thermodynamic-temperature_en.html",description:"درک مقیاس دمای مطلق (کلوین)."},{title:"ماشین بخار",url:"https://phet.colorado.edu/sims/html/steam-engine/latest/steam-engine_en.html",description:"مدل‌سازی عملکرد اولیه موتورهای بخار."},{title:"عدسی‌های ضخیم",url:"https://phet.colorado.edu/sims/html/thick-lenses/latest/thick-lenses_en.html",description:"تحلیل عدسی‌هایی که ضخامت آن‌ها قابل اغماض نیست."},{title:"لابراتوار طیف‌سنجی",url:"https://phet.colorado.edu/sims/html/spectrometer-lab/latest/spectrometer-lab_en.html",description:"استفاده از طیف‌سنج برای تحلیل منابع نوری."},{title:"انتشار نور",url:"https://phet.colorado.edu/sims/html/light-propagation/latest/light-propagation_en.html",description:"مدل‌سازی انتشار نور به صورت فوتون و موج."},{title:"فرکانس زاویه‌ای",url:"https://phet.colorado.edu/sims/html/angular-frequency/latest/angular-frequency_fa.html",description:"درک رابطه بین فرکانس، دوره تناوب و فرکانس زاویه‌ای."},{title:"تغییر مکان موج",url:"https://phet.colorado.edu/sims/html/wave-displacement/latest/wave-displacement_fa.html",description:"نمایش تغییر مکان هر نقطه از محیط در طول موج."},{title:"میدان پتانسیل گرانشی",url:"https://phet.colorado.edu/sims/html/gravitational-potential-field/latest/gravitational-potential-field_en.html",description:"نمایش پتانسیل و میدان گرانشی اطراف اجرام."},{title:"شبیه‌ساز مدارهای نوری",url:"https://phet.colorado.edu/sims/html/optical-circuits/latest/optical-circuits_en.html",description:"استفاده از نور به جای الکتریسیته برای انتقال سیگنال."},{title:"معادلات اویلر-لاگرانژ",url:"https://phet.colorado.edu/sims/html/euler-lagrange-equations/latest/euler-lagrange-equations_en.html",description:"حل مسائل مکانیکی با استفاده از فرمولاسیون لاگرانژی."},{title:"نظریه میدان کوانتومی",url:"https://phet.colorado.edu/sims/html/quantum-field-theory/latest/quantum-field-theory_en.html",description:"مقدمه‌ای بر مفاهیم کوانتیزاسیون میدان‌ها."},{title:"آزمایشگاه لورنتس",url:"https://phet.colorado.edu/sims/html/lorentz-lab/latest/lorentz-lab_en.html",description:"بررسی دقیق‌تر برهمکنش‌های الکترومغناطیسی و نیروی لورنتس."},{title:"مدارهای منطقی",url:"https://phet.colorado.edu/sims/html/logic-gates/latest/logic-gates_en.html",description:"ساخت مدارهای دیجیتال با استفاده از گیت‌های منطقی (AND, OR, NOT)."},{title:"فیزیک بیومکانیک",url:"https://phet.colorado.edu/sims/html/biomechanics/latest/biomechanics_en.html",description:"کاربرد قوانین مکانیک در سیستم‌های بیولوژیکی (مانند راه رفتن)."},{title:"فیزیک پزشکی",url:"https://phet.colorado.edu/sims/html/medical-physics/latest/medical-physics_en.html",description:"بررسی اصول فیزیکی تصویربرداری (مانند MRI و CT)."},{title:"نظریه گراف در فیزیک",url:"https://phet.colorado.edu/sims/html/graph-theory-in-physics/latest/graph-theory-in-physics_en.html",description:"استفاده از گراف‌ها برای مدل‌سازی سیستم‌های فیزیکی."},{title:"انرژی‌های تجدیدپذیر",url:"https://phet.colorado.edu/sims/html/renewable-energy/latest/renewable-energy_fa.html",description:"مقایسه منابع انرژی باد، خورشیدی و هیدرولیک."},{title:"سیستم‌های دینامیکی",url:"https://phet.colorado.edu/sims/html/dynamical-systems/latest/dynamical-systems_en.html",description:"مدل‌سازی رفتار سیستم‌های فیزیکی که با زمان تغییر می‌کنند."},{title:"آشوب کوانتومی",url:"https://phet.colorado.edu/sims/html/quantum-chaos/latest/quantum-chaos_en.html",description:"بررسی سیستم‌های کوانتومی که رفتار آشوبناک از خود نشان می‌دهند."},{title:"اثر زیمان غیرعادی",url:"https://phet.colorado.edu/sims/html/anomalous-zeeman-effect/latest/anomalous-zeeman-effect_en.html",description:"درک شکافته شدن سطوح انرژی با در نظر گرفتن اسپین الکترون."},{title:"مدل‌های اتمی پیشرفته",url:"https://phet.colorado.edu/sims/html/advanced-atomic-models/latest/advanced-atomic-models_en.html",description:"مقایسه مدل‌های اتمی مختلف (دالتون، تامسون، رادرفورد، بور)."},{title:"ساختار مولکولی",url:"https://phet.colorado.edu/sims/html/molecular-structure/latest/molecular-structure_fa.html",description:"بررسی شکل و هندسه مولکول‌ها و پیوندهای شیمیایی."},{title:"تعادل شیمیایی",url:"https://phet.colorado.edu/sims/html/reaction-equilibrium/latest/reaction-equilibrium_fa.html",description:"درک تعادل واکنش‌های شیمیایی و اصل لوشاتلیه."},{title:"تغییر شکل کوانتومی",url:"https://phet.colorado.edu/sims/html/quantum-deformation/latest/quantum-deformation_en.html",description:"بررسی چگونگی تغییر شکل اتم‌ها و هسته‌ها در میدان‌ها."},{title:"ذرات مجازی",url:"https://phet.colorado.edu/sims/html/virtual-particles/latest/virtual-particles_en.html",description:"درک نقش ذرات مجازی در فعل و انفعالات بنیادی."},{title:"تابش سنکروترون",url:"https://phet.colorado.edu/sims/html/synchrotron-radiation/latest/synchrotron-radiation_en.html",description:"مدل‌سازی تابش الکترومغناطیسی از ذرات پرسرعت منحرف شده."},{title:"مقدمه‌ای بر ابرتقارن",url:"https://phet.colorado.edu/sims/html/supersymmetry-intro/latest/supersymmetry-intro_en.html",description:"کاوش در ایده‌های نظریه ابرتقارن در فیزیک ذرات."},{title:"انرژی تاریک و ماده تاریک",url:"https://phet.colorado.edu/sims/html/dark-energy-matter/latest/dark-energy-matter_en.html",description:"مدل‌سازی تأثیر انرژی و ماده تاریک بر انبساط جهان."},{title:"نظریه ریسمان",url:"https://phet.colorado.edu/sims/html/string-theory-intro/latest/string-theory-intro_en.html",description:"مقدمه‌ای بصری بر مفهوم ابعاد اضافی و ارتعاش ریسمان‌ها."},{title:"انرژی خلاء",url:"https://phet.colorado.edu/sims/html/vacuum-energy/latest/vacuum-energy_en.html",description:"درک انرژی مرتبط با نوسانات کوانتومی در فضای خالی."},{title:"فیزیک کیهان‌شناسی",url:"https://phet.colorado.edu/sims/html/cosmology-basics/latest/cosmology-basics_en.html",description:"کاوش در مدل‌های استاندارد کیهان‌شناسی و پیدایش جهان."},{title:"آزمایشگاه نسبیت عام",url:"https://phet.colorado.edu/sims/html/general-relativity-lab/latest/general-relativity-lab_en.html",description:"شبیه‌سازی سیاهچاله‌ها و عدسی گرانشی."},{title:"دینامیک سیالات پیشرفته",url:"https://phet.colorado.edu/sims/html/advanced-fluid-dynamics/latest/advanced-fluid-dynamics_en.html",description:"بررسی دقیق‌تر ویسکوزیته و جریان‌های لایه‌ای."},{title:"اصول آکوستیک",url:"https://phet.colorado.edu/sims/html/acoustics-basics/latest/acoustics-basics_en.html",description:"درک مفاهیم شدت، گام و تن در صوت."},{title:"نظریه میدان میانگین",url:"https://phet.colorado.edu/sims/html/mean-field-theory/latest/mean-field-theory_en.html",description:"استفاده از تقریبات برای تحلیل سیستم‌های با تعداد زیاد ذرات."},{title:"فیزیک سطح بلور",url:"https://phet.colorado.edu/sims/html/crystal-surface-physics/latest/crystal-surface-physics_en.html",description:"بررسی خواص اتم‌ها و پیوندها در سطح مواد بلوری."},{title:"الاستیسیته غیرخطی",url:"https://phet.colorado.edu/sims/html/nonlinear-elasticity/latest/nonlinear-elasticity_en.html",description:"مدل‌سازی تغییر شکل مواد فراتر از حد الاستیک."},{title:"آزمایشگاه نانوفیزیک",url:"https://phet.colorado.edu/sims/html/nanophysics-lab/latest/nanophysics-lab_en.html",description:"بررسی پدیده‌های فیزیکی در مقیاس نانو."},{title:"فیزیک پیزوالکتریک",url:"https://phet.colorado.edu/sims/html/piezoelectric-physics/latest/piezoelectric-physics_en.html",description:"درک تولید بار الکتریکی در اثر تنش مکانیکی و بالعکس."},{title:"انتقال گرما تابشی",url:"https://phet.colorado.edu/sims/html/radiative-heat-transfer/latest/radiative-heat-transfer_en.html",description:"مدل‌سازی انتقال گرما از طریق تابش الکترومغناطیسی."},{title:"آزمایشگاه لایه‌های نازک",url:"https://phet.colorado.edu/sims/html/thin-layers-lab/latest/thin-layers-lab_en.html",description:"بررسی خواص مواد در ابعاد لایه‌ای نانو."},{title:"فیزیک اپتیک کوانتومی",url:"https://phet.colorado.edu/sims/html/quantum-optical-devices/latest/quantum-optical-devices_en.html",description:"بررسی ابزارهای نوری مبتنی بر اصول کوانتومی."},{title:"شبیه‌ساز لیزر پیشرفته",url:"https://phet.colorado.edu/sims/html/advanced-laser-simulator/latest/advanced-laser-simulator_en.html",description:"مدل‌سازی دقیق‌تر عملکرد لیزر با پمپاژ نوری."},{title:"نانو لوله‌های کربنی",url:"https://phet.colorado.edu/sims/html/carbon-nanotubes/latest/carbon-nanotubes_en.html",description:"بررسی خواص مکانیکی و الکتریکی نانولوله‌های کربنی."},{title:"دینامیک مولکولی",url:"https://phet.colorado.edu/sims/html/molecular-dynamics/latest/molecular-dynamics_en.html",description:"شبیه‌سازی حرکت و برهمکنش اتم‌ها و مولکول‌ها در طول زمان."},{title:"مکانیک آماری",url:"https://phet.colorado.edu/sims/html/statistical-mechanics/latest/statistical-mechanics_en.html",description:"بررسی خواص ماکروسکوپی سیستم‌ها از دیدگاه آماری ذرات."},{title:"توزیع بولتزمان",url:"https://phet.colorado.edu/sims/html/boltzmann-distribution/latest/boltzmann-distribution_en.html",description:"درک نحوه توزیع ذرات در سطوح مختلف انرژی."},{title:"مدل آیزینگ",url:"https://phet.colorado.edu/sims/html/ising-model/latest/ising-model_en.html",description:"مدل‌سازی پدیده‌های فیزیکی مانند فرومغناطیس و انتقال فاز."},{title:"نظریه گرافیک",url:"https://phet.colorado.edu/sims/html/graphing-physics-data/latest/graphing-physics-data_fa.html",description:"یادگیری نحوه ترسیم و تفسیر انواع نمودارها در فیزیک."},{title:"مدل‌سازی عددی",url:"https://phet.colorado.edu/sims/html/numerical-modeling/latest/numerical-modeling_en.html",description:"درک روش‌های عددی برای حل معادلات دیفرانسیل فیزیکی."},{title:"معادلات حرکت اویلر",url:"https://phet.colorado.edu/sims/html/euler-motion-equations/latest/euler-motion-equations_en.html",description:"استفاده از معادلات اویلر برای تحلیل حرکت سیالات و اجسام صلب."},{title:"نظریه شوک و موج",url:"https://phet.colorado.edu/sims/html/shock-wave-theory/latest/shock-wave-theory_en.html",description:"درک تشکیل و انتشار امواج شوک در سیالات."},{title:"قوانین سیمرغ",url:"https://phet.colorado.edu/sims/html/phoenix-laws/latest/phoenix-laws_en.html",description:"کاوش در قوانین فرضی فیزیک فراتر از مدل استاندارد."},{title:"همجوشی لیزری",url:"https://phet.colorado.edu/sims/html/laser-fusion/latest/laser-fusion_en.html",description:"مدل‌سازی همجوشی هسته‌ای با استفاده از پرتوهای لیزر."},{title:"اثر زِنِر",url:"https://phet.colorado.edu/sims/html/zener-effect/latest/zener-effect_en.html",description:"بررسی عملکرد دیودهای زنر در ولتاژ شکست معکوس."},{title:"مگنتواستاتیک",url:"https://phet.colorado.edu/sims/html/magnetostatics/latest/magnetostatics_en.html",description:"بررسی میدان‌های مغناطیسی ثابت در طول زمان."},{title:"الکترواستاتیک پیشرفته",url:"https://phet.colorado.edu/sims/html/advanced-electrostatics/latest/advanced-electrostatics_en.html",description:"تحلیل توزیع بار در اجسام هادی و دی‌الکتریک."},{title:"مدل‌سازی حرارت و کار",url:"https://phet.colorado.edu/sims/html/heat-and-work-modeling/latest/heat-and-work-modeling_fa.html",description:"شبیه‌سازی فرآیندهای آدیاباتیک، ایزوبار و ایزوترمال."},{title:"مغناطیس دائم",url:"https://phet.colorado.edu/sims/html/permanent-magnets/latest/permanent-magnets_fa.html",description:"درک منشأ و خواص آهنرباهای دائمی."},{title:"ساختار هسته",url:"https://phet.colorado.edu/sims/html/nuclear-structure/latest/nuclear-structure_fa.html",description:"بررسی مدل قطره مایع و مدل پوسته‌ای هسته اتم."},{title:"برهمکنش نوترون",url:"https://phet.colorado.edu/sims/html/neutron-interaction/latest/neutron-interaction_en.html",description:"مدل‌سازی برخورد نوترون با هسته و پدیده‌های پراکندگی."},{title:"رابطه E=mc²",url:"https://phet.colorado.edu/sims/html/emc-squared/latest/emc-squared_fa.html",description:"درک مفهوم هم‌ارزی جرم و انرژی."},{title:"هندسه نسبیتی",url:"https://phet.colorado.edu/sims/html/relativistic-geometry/latest/relativistic-geometry_en.html",description:"کاوش در مفهوم فضا-زمان در چارچوب نسبیت خاص."},{title:"ساختار بلوری پیشرفته",url:"https://phet.colorado.edu/sims/html/advanced-crystal-structures/latest/advanced-crystal-structures_en.html",description:"بررسی ساختارهای شبکه بلوری پیچیده‌تر و نقص‌های آن‌ها."},{title:"انتقال حرارت در خلاء",url:"https://phet.colorado.edu/sims/html/heat-transfer-vacuum/latest/heat-transfer-vacuum_en.html",description:"مدل‌سازی انتقال گرما فقط از طریق تابش (بدون رسانایی و همرفت)."},{title:"دینامیک گازهای رقیق",url:"https://phet.colorado.edu/sims/html/rarefied-gas-dynamics/latest/rarefied-gas-dynamics_en.html",description:"بررسی رفتار گازها در فشار پایین و طول آزاد مسیر بلند."},{title:"نظریه پتانسیل",url:"https://phet.colorado.edu/sims/html/potential-theory/latest/potential-theory_en.html",description:"حل معادلات لاپلاس و پواسون برای پتانسیل‌های الکتریکی و گرانشی."},{title:"سیستم‌های نوری پیچیده",url:"https://phet.colorado.edu/sims/html/complex-optical-systems/latest/complex-optical-systems_en.html",description:"تحلیل سیستم‌های نوری شامل چند عدسی و آینه."},{title:"فیزیک بیوفوتونیک",url:"https://phet.colorado.edu/sims/html/biophotonics/latest/biophotonics_en.html",description:"کاربرد نور در تصویربرداری پزشکی و علوم زیستی."},{title:"مدل‌سازی مواد",url:"https://phet.colorado.edu/sims/html/material-modeling/latest/material-modeling_en.html",description:"ساخت مدل‌های رایانه‌ای برای شبیه‌سازی خواص مواد."},{title:"میدان‌های الکترومغناطیسی متغیر",url:"https://phet.colorado.edu/sims/html/time-varying-fields/latest/time-varying-fields_en.html",description:"بررسی میدان‌هایی که با زمان تغییر کرده و موج الکترومغناطیسی ایجاد می‌کنند."},{title:"نظریه کوانتومی میدان‌های الکترومغناطیسی",url:"https://phet.colorado.edu/sims/html/quantum-electromagnetic-fields/latest/quantum-electromagnetic-fields_en.html",description:"کاوش در مفهوم فوتون به عنوان کوانتای میدان الکترومغناطیسی."},{title:"شبیه‌ساز تلسکوپ پیشرفته",url:"https://phet.colorado.edu/sims/html/advanced-telescope-simulator/latest/advanced-telescope-simulator_en.html",description:"شبیه‌سازی تلسکوپ‌های بزرگ و اپتیک تطبیقی."},{title:"هوا-هوازی دینامیک",url:"https://phet.colorado.edu/sims/html/aerodynamics/latest/aerodynamics_en.html",description:"درک نیروهای بالابر و کشش در اجسام متحرک در هوا."},{title:"مدل‌سازی پلاسما",url:"https://phet.colorado.edu/sims/html/plasma-modeling/latest/plasma-modeling_en.html",description:"مدل‌سازی حرکت ذرات در پلاسمای داغ (مانند توکامک)."},{title:"ژئوفیزیک",url:"https://phet.colorado.edu/sims/html/geophysics/latest/geophysics_en.html",description:"بررسی ساختار داخلی زمین با استفاده از امواج لرزه‌ای."},{title:"فیزیک اقیانوس",url:"https://phet.colorado.edu/sims/html/ocean-physics/latest/ocean-physics_en.html",description:"مدل‌سازی جریان‌ها، امواج و ترمودینامیک اقیانوسی."},{title:"مکانیک مداری",url:"https://phet.colorado.edu/sims/html/orbital-mechanics/latest/orbital-mechanics_en.html",description:"تحلیل مانورهای مداری و انتقال به مدارهای دیگر."},{title:"شبیه‌ساز ترمز",url:"https://phet.colorado.edu/sims/html/braking-system/latest/braking-system_fa.html",description:"درک اصول هیدرولیکی ترمز و تبدیل انرژی."},{title:"طنین صدا",url:"https://phet.colorado.edu/sims/html/sound-resonance/latest/sound-resonance_fa.html",description:"بررسی پدیده تشدید در ستون‌های هوا و ابزارهای موسیقی."},{title:"انتشار رادیو",url:"https://phet.colorado.edu/sims/html/radio-wave-propagation/latest/radio-wave-propagation_en.html",description:"مدل‌سازی انتشار امواج رادیویی در محیط‌های مختلف."},{title:"مدارهای LC",url:"https://phet.colorado.edu/sims/html/lc-circuits/latest/lc-circuits_fa.html",description:"بررسی نوسانات الکتریکی در مدارهای سلف-خازن."},{title:"سنجش از دور",url:"https://phet.colorado.edu/sims/html/remote-sensing-physics/latest/remote-sensing-physics_en.html",description:"درک اصول فیزیکی سنجش از دور و تجزیه و تحلیل داده‌ها."},{title:"ابررسانایی پیشرفته",url:"https://phet.colorado.edu/sims/html/advanced-superconductivity/latest/advanced-superconductivity_en.html",description:"بررسی نظریه BCS و کوانتوم مغناطیس."},{title:"ترانزیستورها",url:"https://phet.colorado.edu/sims/html/transistor-basics/latest/transistor-basics_fa.html",description:"درک عملکرد ترانزیستورها به عنوان سوئیچ و تقویت‌کننده."},{title:"دیودها و یکسوسازها",url:"https://phet.colorado.edu/sims/html/diode-rectifiers/latest/diode-rectifiers_fa.html",description:"بررسی یکسوسازی جریان متناوب توسط دیود."},{title:"فیزیک حالت جامد",url:"https://phet.colorado.edu/sims/html/solid-state-physics/latest/solid-state-physics_en.html",description:"کاوش در ساختار بلوری، پیوندها و خواص الکترونی جامدات."},{title:"پلاسمونیک",url:"https://phet.colorado.edu/sims/html/plasmonics/latest/plasmonics_en.html",description:"بررسی نوسانات الکترون‌های آزاد در سطح فلزات."},{title:"ابزار دقیق کوانتومی",url:"https://phet.colorado.edu/sims/html/quantum-instrumentation/latest/quantum-instrumentation_en.html",description:"شبیه‌سازی ابزارهای اندازه‌گیری حساس کوانتومی."},{title:"نانو مواد",url:"https://phet.colorado.edu/sims/html/nanomaterials/latest/nanomaterials_en.html",description:"بررسی خواص منحصر به فرد مواد در مقیاس نانو."},{title:"فیزیک بیومواد",url:"https://phet.colorado.edu/sims/html/biomaterials-physics/latest/biomaterials-physics_en.html",description:"بررسی خواص مکانیکی و حرارتی مواد بیولوژیکی."},{title:"فیزیک اتمی کاربردی",url:"https://phet.colorado.edu/sims/html/applied-atomic-physics/latest/applied-atomic-physics_en.html",description:"کاربرد اصول فیزیک اتمی در صنایع و فناوری."},{title:"گداخت و شکافت کنترل شده",url:"https://phet.colorado.edu/sims/html/controlled-fusion-fission/latest/controlled-fusion-fission_en.html",description:"مدل‌سازی فرآیندهای هسته‌ای کنترل شده برای تولید انرژی."},{title:"فیزیک شتاب‌دهنده",url:"https://phet.colorado.edu/sims/html/accelerator-physics/latest/accelerator-physics_en.html",description:"بررسی دینامیک پرتو در شتاب‌دهنده‌های ذرات."},{title:"نظریه ماتریس چگالی",url:"https://phet.colorado.edu/sims/html/density-matrix-theory/latest/density-matrix-theory_en.html",description:"درک ابزارهای ریاضی برای توصیف سیستم‌های کوانتومی مخلوط."},{title:"اپتیک فوریه",url:"https://phet.colorado.edu/sims/html/fourier-optics/latest/fourier-optics_en.html",description:"درک پردازش تصویر با استفاده از تبدیل فوریه."},{title:"مدل‌سازی اپتیک تطبیقی",url:"https://phet.colorado.edu/sims/html/adaptive-optics-modeling/latest/adaptive-optics-modeling_en.html",description:"شبیه‌سازی سیستم‌های اپتیکی که اعوجاج را تصحیح می‌کنند."},{title:"نظریه کوانتومی اطلاعات",url:"https://phet.colorado.edu/sims/html/quantum-information-theory/latest/quantum-information-theory_en.html",description:"مقدمه‌ای بر بیت‌های کوانتومی (کیوبیت) و درهم‌تنیدگی."},{title:"ریاضی فیزیک",url:"https://phet.colorado.edu/sims/html/mathematical-physics-methods/latest/mathematical-physics-methods_en.html",description:"بررسی روش‌های ریاضی (توابع خاص، معادلات دیفرانسیل) در فیزیک."},{title:"فیزیک اتمی هسته‌ای",url:"https://phet.colorado.edu/sims/html/atomic-nuclear-physics/latest/atomic-nuclear-physics_fa.html",description:"مروری بر مفاهیم اتمی و هسته‌ای (انرژی بستگی، ترازهای انرژی)."},{title:"فیزیک لوله‌های کاتدی",url:"https://phet.colorado.edu/sims/html/cathode-ray-physics/latest/cathode-ray-physics_en.html",description:"بررسی عمیق‌تر حرکت پرتو الکترون در میدان‌ها."},{title:"مکانیک کوانتومی پیشرفته",url:"https://phet.colorado.edu/sims/html/advanced-quantum-mechanics/latest/advanced-quantum-mechanics_en.html",description:"کاوش در پتانسیل‌های سه‌بعدی و مدل‌های کوانتومی پیچیده‌تر."},{title:"نظریه میدان‌های کلاسیک",url:"https://phet.colorado.edu/sims/html/classical-field-theory/latest/classical-field-theory_en.html",description:"درک مفاهیم میدان‌های الکترومغناطیسی و گرانشی به صورت کلاسیک."},{title:"مدل استاندارد ذرات",url:"https://phet.colorado.edu/sims/html/standard-model-particles/latest/standard-model-particles_en.html",description:"بررسی طبقه‌بندی ذرات بنیادی در مدل استاندارد."},{title:"نظریه ریسمان مقدماتی",url:"https://phet.colorado.edu/sims/html/intro-string-theory/latest/intro-string-theory_en.html",description:"مقدمه‌ای بر ساختار ریسمان‌ها و ارتعاشات آن‌ها."},{title:"جاذبه کوانتومی حلقه",url:"https://phet.colorado.edu/sims/html/loop-quantum-gravity/latest/loop-quantum-gravity_en.html",description:"کاوش در یکی از نظریه‌های جایگزین گرانش کوانتومی."},{title:"انتقال جرم و حرارت",url:"https://phet.colorado.edu/sims/html/mass-and-heat-transfer/latest/mass-and-heat-transfer_en.html",description:"بررسی همزمان انتقال جرم و گرما در سیستم‌های فیزیکی."},{title:"مدل‌سازی انتشار",url:"https://phet.colorado.edu/sims/html/diffusion-modeling/latest/diffusion-modeling_en.html",description:"شبیه‌سازی حرکت ذرات و انتشار مواد در محیط."},{title:"الکترودینامیک کوانتومی",url:"https://phet.colorado.edu/sims/html/quantum-electrodynamics/latest/quantum-electrodynamics_en.html",description:"درک برهمکنش‌های الکترومغناطیسی با استفاده از نظریه میدان کوانتومی."},{title:"مکانیک محیط متراکم",url:"https://phet.colorado.edu/sims/html/condensed-matter-mechanics/latest/condensed-matter-mechanics_en.html",description:"بررسی خواص مکانیکی مواد جامد و مایع."},{title:"مغناطیس دائم پیشرفته",url:"https://phet.colorado.edu/sims/html/advanced-permanent-magnets/latest/advanced-permanent-magnets_fa.html",description:"بررسی جزئیات ساختار داخلی و میدان مغناطیسی آهنرباها."},{title:"نظریه آشوب کلاسیک",url:"https://phet.colorado.edu/sims/html/classical-chaos-theory/latest/classical-chaos-theory_en.html",description:"درک وابستگی حساس به شرایط اولیه در سیستم‌های کلاسیک."},{title:"مدل‌سازی لایه‌ای مواد",url:"https://phet.colorado.edu/sims/html/layered-material-modeling/latest/layered-material-modeling_en.html",description:"بررسی خواص فیزیکی مواد مرکب لایه‌ای."},{title:"فیزیک هسته‌ای کاربردی",url:"https://phet.colorado.edu/sims/html/applied-nuclear-physics/latest/applied-nuclear-physics_en.html",description:"کاربرد فیزیک هسته‌ای در پزشکی و صنعت (مانند رادیوایزوتوپ‌ها)."},{title:"پدیده‌های بحرانی",url:"https://phet.colorado.edu/sims/html/critical-phenomena/latest/critical-phenomena_en.html",description:"بررسی رفتار مواد نزدیک به نقاط بحرانی (مانند انتقال فاز)."},{title:"مدار مجتمع",url:"https://phet.colorado.edu/sims/html/integrated-circuits-basics/latest/integrated-circuits-basics_fa.html",description:"آشنایی با اصول عملکرد مدارهای مجتمع و تراشه‌ها."},{title:"گیت‌های منطقی پیشرفته",url:"https://phet.colorado.edu/sims/html/advanced-logic-gates/latest/advanced-logic-gates_en.html",description:"ساخت مدارهای پیچیده‌تر با استفاده از گیت‌های XOR، XNOR و ناند."},{title:"فیزیک نور و صدا",url:"https://phet.colorado.edu/sims/html/light-and-sound-physics/latest/light-and-sound-physics_fa.html",description:"مقایسه خواص امواج الکترومغناطیسی و مکانیکی."},{title:"اصول سنجش",url:"https://phet.colorado.edu/sims/html/measurement-principles/latest/measurement-principles_fa.html",description:"درک خطاهای اندازه‌گیری و دقت ابزارهای فیزیکی."},{title:"اثر حرارتی پیشرفته",url:"https://phet.colorado.edu/sims/html/advanced-thermal-effects/latest/advanced-thermal-effects_en.html",description:"بررسی جزئیات بیشتر پدیده‌های سیبک، پلتیه و تامسون."},{title:"دینامیک مولکولی کوانتومی",url:"https://phet.colorado.edu/sims/html/quantum-molecular-dynamics/latest/quantum-molecular-dynamics_en.html",description:"شبیه‌سازی حرکت اتم‌ها با در نظر گرفتن اثرات کوانتومی."},{title:"هندسه نوری",url:"https://phet.colorado.edu/sims/html/optical-geometry/latest/optical-geometry_fa.html",description:"بررسی هندسه مسیر نور در سیستم‌های نوری مختلف."},{title:"فیزیک محیط‌زیست",url:"https://phet.colorado.edu/sims/html/environmental-physics/latest/environmental-physics_en.html",description:"کاربرد قوانین فیزیک برای تحلیل پدیده‌های زیست‌محیطی (گرمایش زمین، آلودگی)."},{title:"انتقال حرارت همرفتی",url:"https://phet.colorado.edu/sims/html/convective-heat-transfer/latest/convective-heat-transfer_fa.html",description:"بررسی انتقال گرما از طریق حرکت سیالات."},{title:"حرکت نوسانی میرا",url:"https://phet.colorado.edu/sims/html/damped-oscillations/latest/damped-oscillations_fa.html",description:"تحلیل کاهش دامنه نوسان به دلیل نیروهای میرایی."},{title:"سیستم‌های چند ذره‌ای",url:"https://phet.colorado.edu/sims/html/many-body-systems/latest/many-body-systems_en.html",description:"مدل‌سازی حرکت و برهمکنش مجموعه‌ای از ذرات."},{title:"الاستومرها",url:"https://phet.colorado.edu/sims/html/elastomers/latest/elastomers_en.html",description:"بررسی خواص الاستیکی و تغییر شکل پلیمرها."},{title:"فیزیک پدال گاز",url:"https://phet.colorado.edu/sims/html/gas-pedal-physics/latest/gas-pedal-physics_en.html",description:"درک مکانیک و ترمودینامیک مرتبط با عملکرد خودرو."},{title:"مدار مغناطیسی",url:"https://phet.colorado.edu/sims/html/magnetic-circuits/latest/magnetic-circuits_en.html",description:"تحلیل مدارهای مغناطیسی (مانند ترانسفورماتور) با مفهوم شار مغناطیسی."},{title:"طیف‌سنجی رزونانس مغناطیسی هسته‌ای",url:"https://phet.colorado.edu/sims/html/nmr-spectroscopy/latest/nmr-spectroscopy_en.html",description:"درک اصول MRI و طیف‌سنجی NMR."},{title:"فیزیک لیزر پیشرفته",url:"https://phet.colorado.edu/sims/html/advanced-laser-physics/latest/advanced-laser-physics_en.html",description:"بررسی پایداری کاواک و آستانه لیزر."},{title:"فیزیک پدیده‌های بحرانی",url:"https://phet.colorado.edu/sims/html/critical-phenomena-physics/latest/critical-phenomena-physics_en.html",description:"بررسی جامع پدیده‌های بحرانی و انتقال‌های فازی مرتبه دوم."},{title:"اتاقک حباب",url:"https://phet.colorado.edu/sims/html/bubble-chamber/latest/bubble-chamber_en.html",description:"مشاهده مسیر ذرات بنیادی در یک اتاقک حباب."},{title:"کوانتوم هولوگرافی",url:"https://phet.colorado.edu/sims/html/quantum-holography/latest/quantum-holography_en.html",description:"مقدمه‌ای بر استفاده از اصول کوانتومی برای تصویربرداری هولوگرافیک."},{title:"تکینگی گرانشی",url:"https://phet.colorado.edu/sims/html/gravitational-singularity/latest/gravitational-singularity_en.html",description:"تجسم مفهوم تکینگی در سیاهچاله‌ها."},{title:"فیزیک سیالات غیرنیوتنی",url:"https://phet.colorado.edu/sims/html/non-newtonian-fluids/latest/non-newtonian-fluids_en.html",description:"بررسی سیالاتی که ویسکوزیته آن‌ها به تنش برشی بستگی دارد."},{title:"مدل‌سازی آب‌وهوا",url:"https://phet.colorado.edu/sims/html/weather-modeling/latest/weather-modeling_en.html",description:"استفاده از اصول ترمودینامیک و دینامیک سیالات برای پیش‌بینی هوا."},{title:"صوت‌شناسی معماری",url:"https://phet.colorado.edu/sims/html/architectural-acoustics/latest/architectural-acoustics_en.html",description:"بررسی تأثیر شکل اتاق بر بازتاب و جذب صدا."},{title:"اپتیک کوانتومی کاربردی",url:"https://phet.edu/sims/html/applied-quantum-optics/latest/applied-quantum-optics_en.html",description:"کاربرد عملی اصول کوانتومی نور در مخابرات و سنسورها."},{title:"فیزیک پرتو ایکس",url:"https://phet.colorado.edu/sims/html/xray-physics/latest/xray-physics_en.html",description:"درک تولید و جذب اشعه ایکس."},{title:"فیزیک سنسورها",url:"https://phet.colorado.edu/sims/html/sensor-physics/latest/sensor-physicsen.html",description:"بررسی اصول عملکرد انواع حسگرهای فیزیکی (حرارتی، نوری، مغناطیسی)."},{title:"گرافن",url:"https://phet.colorado.edu/sims/html/graphene-physics/latest/graphene-physics_en.html",description:"بررسی خواص الکترونی و مکانیکی گرافن (ماده دوبعدی)."},{title:"مدل‌سازی توربین",url:"https://phet.colorado.edu/sims/html/turbine-modeling/latest/turbine-modeling_fa.html",description:"درک تبدیل انرژی سیال به انرژی مکانیکی در توربین‌ها."},{title:"سنسورهای نانو",url:"https://phet.colorado.edu/sims/html/nano-sensors/latest/nano-sensors_en.html",description:"بررسی حسگرهایی با ابعاد نانومتری و حساسیت بالا."},{title:"انتقال حرارت صنعتی",url:"https://phet.colorado.edu/sims/html/industrial-heat-transfer/latest/industrial-heat-transfer_en.html",description:"مدل‌سازی مبدل‌های حرارتی و کاربردهای صنعتی."},{title:"فیزیک خودرو",url:"https://phet.colorado.edu/sims/html/car-physics/latest/car-physics_fa.html",description:"بررسی نیروها، کار، و انرژی در حرکت خودرو."},{title:"فیزیک بیو سیالات",url:"https://phet.colorado.edu/sms/html/biofluid-physics/latest/biofluid-physics_en.html",description:"کاربرد اصول سیالات در سیستم‌های زیستی (مانند جریان خون)."},{title:"ساختار لوله‌های کربنی",url:"https://phet.co/sims/html/carbon-nanotube-structure/latest/carbon-nanotube-structure_en.html",description:"بررسی انواع ساختار و جهت‌گیری نانولوله‌های کربنی."},{title:"دینامیک غیر خطی",url:"https://phet.colorado.edu/sims/html/nonlinear-dynamics/latest/nonlinear-dynamics_en.html",description:"مدل‌سازی سیستم‌های دینامیکی که معادلات حرکت آن‌ها خطی نیست."},{title:"شبیه‌سازی کوانتومی سیستم‌ها",url:"https://phet.colorado.edu/sims/html/quantum-system-simulation/latest/quantum-system-simulation_en.html",description:"استفاده از رایانه‌های کوانتومی فرضی برای حل مسائل فیزیکی."},{title:"هندسه نسبیت عام",url:"https://phet.colorado.edu/sims/html/geometry-of-general-relativity/latest/geometry-of-general-relativity_en.html",description:"تجسم متریک فضا-زمان در نزدیکی جرم‌های بزرگ."},{title:"فیزیک نوترینو",url:"https://phet.colorado.edu/sims/html/neutrino-physics/latest/neutrino-physics_en.html",description:"کاوش در خواص اسرارآمیز نوترینوها و نوسانات آن‌ها."},{title:"فیزیک بیوساختار",url:"https://phet.colorado.edu/sims/html/biostructure-physics/latest/biostructure-physics_en.html",description:"بررسی پایداری و دینامیک ساختارهای مولکولی زیستی."},{title:"جریان الکتریکی در پلاسما",url:"https://phet.colorado.edu/sims/html/plasma-currents/latest/plasma-currents_en.html",description:"مدل‌سازی حرکت دسته‌جمعی ذرات باردار در پلاسما."},{title:"مغناطیس حیاتی",url:"https://phet.colorado.edu/sims/html/biomagnetism/latest/biomagnetism_en.html",description:"بررسی میدان‌های مغناطیسی ضعیف تولید شده توسط موجودات زنده (مانند مغز)."},{title:"روباتیک فیزیک",url:"https://phet.colorado.edu/sims/html/robotics-physics/latest/robotics-physics_fa.html",description:"کاربرد قوانین فیزیک در طراحی و کنترل سیستم‌های روباتیک."},{title:"مدل‌سازی بیولوژیکی",url:"https://phet.colorado.edu/sims/html/biological-modeling/latest/biological-modeling_en.html",description:"استفاده از ریاضیات و فیزیک برای مدل‌سازی فرآیندهای زیستی."},{title:"ساختمان‌های هوشمند",url:"https://phet.colorado.edu/sims/html/smart-buildings-physics/latest/smart-buildings-physics_en.html",description:"بررسی اصول فیزیکی صرفه‌جویی در انرژی در ساختمان‌ها."},{title:"برهمکنش نور و ماده پیشرفته",url:"https://phet.co/sims/html/advanced-light-matter-interaction/latest/advanced-light-matter-interaction_en.html",description:"بررسی دقیق‌تر برهمکنش نور با الکترون‌ها و هسته‌ها."},{title:"فیزیک سیستم‌های پیچیده",url:"https://phet.colorado.edu/sims/html/complex-systems-physics/latest/complex-systems-physics_en.html",description:"درک رفتار سیستم‌های دارای اجزای زیاد و برهمکنش‌های پیچیده."},{title:"نظریه انتشار",url:"https://phet.colorado.edu/sims/html/propagation-theory/latest/propagation-theory_en.html",description:"بررسی انتشار امواج و سیگنال‌ها در محیط‌های مختلف."},{title:"فیزیک زمین‌شناسی",url:"https://phet.colorado.edu/sims/html/geology-physics/latest/geology-physics_en.html",description:"کاربرد مکانیک و ترمودینامیک در فرآیندهای زمین‌شناختی."},{title:"مکانیک اجسام صلب پیشرفته",url:"https://phet.colorado.edu/sims/html/advanced-rigid-body-mechanics/latest/advanced-rigid-body-mechanics_en.html",description:"تحلیل حرکت سه‌بعدی و ژیروسکوپ‌ها."},{title:"نظریه مغناطیسی حوزه",url:"https://phet.colorado.edu/sims/html/magnetic-domain-theory/latest/magnetic-domain-theory_en.html",description:"درک حوزه‌های مغناطیسی و فرآیند مغناطش و غیرمغناطش."},{title:"فیزیک خورشیدی",url:"https://phet.colorado.edu/sims/html/solar-physics/latest/solar-physics_en.html",description:"کاوش در ساختار خورشید، لکه‌های خورشیدی و بادهای خورشیدی."},{title:"انتقال حرارت پیشرفته",url:"https://phet.colorado.edu/sims/html/advanced-heat-transfer/latest/advanced-heat-transfer_en.html",description:"بررسی معادلات دیفرانسیل انتقال حرارت در مواد ناهمگن."},{title:"تکنولوژی‌های نانو",url:"https://phet.colorado.edu/sims/html/nanotechnologies/latest/nanotechnologies_en.html",description:"مقدمه‌ای بر ابزار و کاربردهای فناوری نانو در فیزیک."},{title:"انرژی هسته‌ای",url:"https://phet.colorado.edu/sims/html/nuclear-energy-applications/latest/nuclear-energy-applications_fa.html",description:"بررسی کاربرد صلح‌آمیز انرژی هسته‌ای در نیروگاه‌ها."},{title:"مدل‌سازی جریان",url:"https://phet.co/sims/html/fluid-flow-modeling/latest/fluid-flow-modeling_fa.html",description:"شبیه‌سازی جریان‌های مختلف سیال و موانع."},{title:"اپتیک فوتونیک",url:"https://phet.colorado.edu/sims/html/photonics-optics/latest/photonics-optics_en.html",description:"درک چگونگی استفاده از فوتون‌ها برای انتقال و پردازش اطلاعات."},{title:"مکانیک محیط متراکم پیشرفته",url:"https://phet.co/sims/html/advanced-condensed-matter-mechanics/latest/advanced-condensed-matter-mechanics_en.html",description:"تحلیل نظریه باند و رفتار جمعی الکترون‌ها در جامدات."}],
            shimi: [{"title":"ساختن یک اتم","url":"https://phet.colorado.edu/sims/html/build-an-atom/latest/build-an-atom_fa.html","description":"نحوه ساختن اتم‌ها، یون‌ها و ایزوتوپ‌ها با استفاده از پروتون، نوترون و الکترون."},{"title":"ایزوتوپ‌ها و جرم اتمی","url":"https://phet.colorado.edu/sims/html/isotopes-and-atomic-mass/latest/isotopes-and-atomic-mass_fa.html","description":"درک مفهوم ایزوتوپ و چگونگی محاسبه جرم اتمی میانگین."},{"title":"اشکال مولکولی","url":"https://phet.colorado.edu/sims/html/molecule-shapes/latest/molecule-shapes_fa.html","description":"کاوش در مورد هندسه مولکولی بر اساس نظریه دافعه زوج الکترون‌های لایه ظرفیت (VSEPR)."},{"title":"خواص گازها","url":"https://phet.colorado.edu/sims/html/gas-properties/latest/gas-properties_fa.html","description":"بررسی رابطه بین فشار، حجم، دما و مقدار گازها بر اساس قانون گازهای ایده‌آل."},{"title":"موازنه واکنش‌های شیمیایی","url":"https://phet.colorado.edu/sims/html/balancing-chemical-equations/latest/balancing-chemical-equations_fa.html","description":"تمرین و یادگیری موازنه کردن واکنش‌های شیمیایی با استفاده از ضرایب استوکیومتری."},{"title":"غلظت","url":"https://phet.colorado.edu/sims/html/concentration/latest/concentration_fa.html","description":"تغییر مقدار حل‌شونده و حلال برای مشاهده تغییرات غلظت و مولیته محلول."},{"title":"اسیدها و بازها","url":"https://phet.colorado.edu/sims/html/acid-base-solutions/latest/acid-base-solutions_fa.html","description":"درک تفاوت بین اسیدهای قوی، ضعیف، بازهای قوی و ضعیف و اندازه‌گیری pH."},{"title":"نردبان pH","url":"https://phet.colorado.edu/sims/html/ph-scale/latest/ph-scale_fa.html","description":"اندازه‌گیری pH مایعات روزمره و درک نحوه اثر رقیق‌سازی بر آن."},{"title":"واکنش‌دهنده‌های محدودکننده","url":"https://phet.colorado.edu/sims/html/limiting-reactants/latest/limiting-reactants_fa.html","description":"درک این که کدام واکنش‌دهنده زودتر مصرف می‌شود و میزان تولید محصول را محدود می‌کند."},{"title":"حالت‌های ماده","url":"https://phet.colorado.edu/sims/html/states-of-matter/latest/states-of-matter_fa.html","description":"مشاهده رفتار اتم‌ها و مولکول‌ها در حالت‌های جامد، مایع و گاز با تغییر دما و فشار."},{"title":"برهم‌کنش‌های اتمی","url":"https://phet.colorado.edu/sims/html/atomic-interactions/latest/atomic-interactions_fa.html","description":"بررسی نیروهای جاذبه و دافعه بین دو اتم و تأثیر آن‌ها بر تشکیل پیوند."},{"title":"ترکیبات یونی","url":"https://phet.colorado.edu/sims/html/salts-and-solubility/latest/salts-and-solubility_fa.html","description":"کاوش در مورد حلالیت نمک‌ها، تشکیل یون و تعادل رسوب‌گذاری."},{"title":"قانون بیر (Beer's Law)","url":"https://phet.colorado.edu/sims/html/beers-law-lab/latest/beers-law-lab_fa.html","description":"استفاده از طیف‌سنج مجازی برای درک رابطه بین غلظت یک محلول و میزان جذب نور آن."},{"title":"فعل و انفعالات و نرخ‌ها","url":"https://phet.colorado.edu/sims/html/reactions-and-rates/latest/reactions-and-rates_fa.html","description":"بررسی نحوه تأثیر انرژی فعال‌سازی، دما و غلظت بر سرعت واکنش‌های شیمیایی."},{"title":"نیروهای بین مولکولی","url":"https://phet.colorado.edu/sims/html/intermolecular-forces/latest/intermolecular-forces_en.html","description":"مشاهده چگونگی تأثیر نیروهای بین مولکولی (مانند پیوند هیدروژنی) بر خواص مواد."},{"title":"تعادل شیمیایی","url":"https://phet.colorado.edu/sims/html/reactions-and-rates/latest/reactions-and-rates_en.html#equilibrium","description":"مدل‌سازی تعادل شیمیایی و اعمال اصل لوشاتلیه برای جابه‌جایی تعادل."},{"title":"آب‌وهوا و اثر گلخانه‌ای","url":"https://phet.colorado.edu/sims/html/the-greenhouse-effect/latest/the-greenhouse-effect_fa.html","description":"بررسی تأثیر گازهای گلخانه‌ای (مانند CO₂) در مقیاس اتمی بر دمای سیاره."},{"title":"شکافت هسته‌ای","url":"https://phet.colorado.edu/sims/html/nuclear-fission/latest/nuclear-fission_fa.html","description":"مدل‌سازی فرآیند شکافت هسته‌ای و ایجاد یک راکتور زنجیره‌ای."},{"title":"آزمایشگاه چگالی","url":"https://phet.colorado.edu/sims/html/density/latest/density_fa.html","description":"یادگیری محاسبه چگالی و نحوه شناور ماندن یا غرق شدن اجسام."},{"title":"مکانیک کوانتومی اتم هیدروژن","url":"https://phet.colorado.edu/sims/html/quantum-mechanics-for-hydrogen-atom/latest/quantum-mechanics-for-hydrogen-atom_en.html","description":"مدل‌سازی پیشرفته اوربیتال‌ها و لایه‌های انرژی در اتم هیدروژن."},{"title":"شیمی و انرژی: اشکال انرژی","url":"https://phet.colorado.edu/sims/html/energy-forms-and-changes/latest/energy-forms-and-changes_fa.html","description":"مشاهده انتقال و تبدیل انواع انرژی (شیمیایی، گرمایی، مکانیکی) در سیستم‌ها."},{"title":"طیف سیاهه‌وار","url":"https://phet.colorado.edu/sims/html/blackbody-spectrum/latest/blackbody-spectrum_en.html","description":"بررسی گسیل تابش از جسم سیاه با تغییر دما (مفاهیم کوانتومی مرتبط)."},{"title":"کاوش در الکترون‌ها و مدارها","url":"https://phet.colorado.edu/sims/html/electric-field-hockey/latest/electric-field-hockey_en.html","description":"بازی برای درک نیروی الکتریکی بین بارهای مثبت و منفی (مربوط به پیوند یونی)."},{"title":"تعادل فاز","url":"https://phet.colorado.edu/sims/html/phase-diagrams/latest/phase-diagrams_en.html","description":"بررسی دیاگرام فازها و نحوه تغییر حالت مواد با دما و فشار."},{"title":"غلظت پیشرفته","url":"https://phet.colorado.edu/sims/html/molarity/latest/molarity_en.html","description":"محاسبه دقیق مولیته و تغییر حجم محلول."},{"title":"مولاریته (Molarity)","url":"https://phet.colorado.edu/sims/html/molarity/latest/molarity_en.html","description":"تغییر مقدار ماده و حجم برای محاسبه دقیق غلظت مولار."},{"title":"تیتراسیون اسید-باز","url":"https://phet.colorado.edu/sims/html/acid-base-titration/latest/acid-base-titration_en.html","description":"اجرای مجازی تیتراسیون برای تعیین غلظت ناشناخته."},{"title":"فشار اتمسفر","url":"https://phet.colorado.edu/sims/html/under-pressure/latest/under-pressure_en.html","description":"بررسی تغییر فشار هوا در شرایط مختلف محیطی."},{"title":"مقیاس pH (پیشرفته)","url":"https://phet.colorado.edu/sims/html/ph-scale-basics/latest/ph-scale-basics_en.html","description":"مدل‌سازی pH با مشاهده یون‌های H⁺ و OH⁻ در سطح میکروسکوپی."},{"title":"جریان حرارتی","url":"https://phet.colorado.edu/sims/html/energy-forms-and-changes/latest/energy-forms-and-changes_en.html#thermalsystems","description":"مدل‌سازی انتقال گرما و دمای تعادل بین مواد مختلف."},{"title":"ترمودینامیک و قوانین گاز","url":"https://phet.colorado.edu/sims/html/gas-properties/latest/gas-properties_en.html#laws","description":"کاوش در قوانین بویل، شارل و آووگادرو با تغییر پارامترهای گازها."},{"title":"دما و انرژی جنبشی","url":"https://phet.colorado.edu/sims/html/states-of-matter/latest/states-of-matter_en.html#kinetic","description":"مشاهده ارتباط بین دمای ماده و انرژی جنبشی ذرات آن."},{"title":"تشکیل پیوند یونی","url":"https://phet.colorado.edu/sims/html/build-a-molecule/latest/build-a-molecule_en.html#ionic","description":"تمرین ساختن مولکول‌ها و درک نحوه تشکیل پیوند یونی."},{"title":"شیمی آلی: ساختارها","url":"https://phet.colorado.edu/sims/html/molecules-and-light/latest/molecules-and-light_en.html","description":"بررسی جذب نور توسط مولکول‌های مختلف (مفاهیم شیمی آلی)."},{"title":"نیمه‌عمر","url":"https://phet.colorado.edu/sims/html/radioactive-dating/latest/radioactive-dating_en.html","description":"درک مفهوم نیمه‌عمر و استفاده از آن برای تاریخ‌گذاری رادیواکتیو."},{"title":"حلالیت","url":"https://phet.colorado.edu/sims/html/salts-and-solubility/latest/salts-and-solubility_en.html#solubility","description":"تغییر دما و مشاهده حلالیت نمک‌ها در آب."},{"title":"فرآیندهای رسوبی","url":"https://phet.colorado.edu/sims/html/salts-and-solubility/latest/salts-and-solubility_en.html#precipitation","description":"مشاهده تشکیل رسوب و تعادل در محلول‌های یونی."},{"title":"الکترونگاتیوی و پیوند","url":"https://phet.colorado.edu/sims/html/bonding/latest/bonding_en.html","description":"کاوش در مورد نحوه تأثیر الکترونگاتیوی بر ماهیت پیوند (یونی یا کووالانسی)."},{"title":"محلول‌های بافر","url":"https://phet.colorado.edu/sims/html/acid-base-solutions/latest/acid-base-solutions_en.html#buffer","description":"درک عملکرد محلول‌های بافر و نحوه مقاومت آن‌ها در برابر تغییرات pH."},{"title":"الکتروشیمی: سلول گالوانی","url":"https://phet.colorado.edu/sims/html/ph-scale-basics/latest/ph-scale-basics_en.html","description":"شبیه‌سازی سلول گالوانی و درک تبدیل انرژی شیمیایی به الکتریکی."},{"title":"واکنش‌های اکسایش-کاهش","url":"https://phet.colorado.edu/sims/html/reactions-and-rates/latest/reactions-and-rates_en.html#redox","description":"مدل‌سازی انتقال الکترون‌ها و اعداد اکسایش در واکنش‌ها."},{"title":"محتوای حرارتی","url":"https://phet.colorado.edu/sims/html/energy-forms-and-changes/latest/energy-forms-and-changes_en.html#heatcontent","description":"مقایسه گرمای ویژه و تغییرات دمایی مواد مختلف."},{"title":"پتانسیل یونش","url":"https://phet.colorado.edu/sims/html/build-an-atom/latest/build-an-atom_en.html#ionization","description":"مشاهده انرژی مورد نیاز برای حذف الکترون از اتم."},{"title":"ساختار اتمی: بور","url":"https://phet.colorado.edu/sims/html/rutherford-scattering/latest/rutherford-scattering_en.html","description":"درک مدل‌های اتمی (مانند رادرفورد) و توزیع بار در هسته."},{"title":"دیاگرام فاز H₂O","url":"https://phet.colorado.edu/sims/html/states-of-matter-basics/latest/states-of-matter-basics_en.html#waterphase","description":"مشاهده نقاط سه‌گانه و بحرانی آب."},{"title":"نوسانگر هارمونیک","url":"https://phet.colorado.edu/sims/html/pendulum-lab/latest/pendulum-lab_en.html","description":"تحلیل حرکت نوسانی در فیزیک (مربوط به ارتعاشات مولکولی در شیمی فیزیک)."},{"title":"شیمی و فیزیک: تراکم‌پذیری","url":"https://phet.colorado.edu/sims/html/pressure-and-depth/latest/pressure-and-depth_en.html","description":"بررسی فشار در مایعات و گازها (مفهوم تراکم‌پذیری)."},{"title":"مولکول‌ها و نور","url":"https://phet.colorado.edu/sims/html/molecules-and-light/latest/molecules-and-light_en.html","description":"بررسی نحوه جذب و گسیل فوتون‌ها توسط مولکول‌های مختلف."},{"title":"ساختن ترکیبات","url":"https://phet.colorado.edu/sims/html/build-a-molecule/latest/build-a-molecule_en.html","description":"تمرین ساخت مولکول‌های ساده با رعایت قواعد پیوند."},{"title":"اندازه‌گیری حرارت","url":"https://phet.colorado.edu/sims/html/energy-forms-and-changes/latest/energy-forms-and-changes_en.html#calorimetry","description":"شبیه‌سازی کالری‌متری برای اندازه‌گیری تغییرات آنتالپی."},{"title":"بررسی اسیدیته و بازیته","url":"https://phet.colorado.edu/sims/html/acid-base-solutions/latest/acid-base-solutions_en.html#ionization","description":"مشاهده درصد یونش اسیدها و بازهای قوی و ضعیف."},{"title":"تعادل یونی","url":"https://phet.colorado.edu/sims/html/salts-and-solubility/latest/salts-and-solubility_en.html#ionicstrength","description":"بررسی قدرت یونی محلول‌ها و تأثیر آن بر حلالیت."},{"title":"انتقال انرژی گرمایی","url":"https://phet.colorado.edu/sims/html/energy-forms-and-changes/latest/energy-forms-and-changes_en.html#transfer","description":"مدل‌سازی انتقال حرارت از طریق رسانایی، همرفت و تابش."},{"title":"نیروی واندروالسی","url":"https://phet.colorado.edu/sims/html/atomic-interactions/latest/atomic-interactions_en.html#van-der-waals","description":"کاوش در مورد نیروهای پراکندگی لاندن بین اتم‌ها."},{"title":"ترکیبات آلی: مونوپلیمرها","url":"https://phet.colorado.edu/sims/html/build-a-molecule/latest/build-a-molecule_en.html#polymers","description":"مقدمه‌ای بر ساختار پلیمری."},{"title":"سنجش آب","url":"https://phet.colorado.edu/sims/html/ph-scale/latest/ph-scale_en.html#waterquality","description":"ارزیابی کیفیت آب بر اساس pH و آلودگی‌ها."},{"title":"گازها: حجم و مول","url":"https://phet.colorado.edu/sims/html/gas-properties/latest/gas-properties_en.html#volume-mole","description":"بررسی قانون آووگادرو و رابطه حجم با تعداد مول."},{"title":"شیمی و انرژی: سلول‌های خورشیدی","url":"https://phet.colorado.edu/sims/html/solar-cell/latest/solar-cell_en.html","description":"اصول تبدیل نور به انرژی الکتریکی (فتوشیمی)."},{"title":"تعادل: ثابت K","url":"https://phet.colorado.edu/sims/html/reactions-and-rates/latest/reactions-and-rates_en.html#Keq","description":"محاسبه ثابت تعادل (K) برای واکنش‌های مختلف."},{"title":"رادیواکتیویته","url":"https://phet.colorado.edu/sims/html/alpha-decay/latest/alpha-decay_en.html","description":"مدل‌سازی واپاشی آلفا و تغییر اتمی."},{"title":"آزمایشگاه pH (پیشرفته)","url":"https://phet.colorado.edu/sims/html/ph-scale-advanced/latest/ph-scale-advanced_en.html","description":"تنظیم غلظت‌های اولیه و pKₐ برای مشاهده منحنی‌های یونش."},{"title":"پیوند کووالانسی","url":"https://phet.colorado.edu/sims/html/bonding/latest/bonding_en.html#covalent","description":"درک اشتراک الکترون بین اتم‌ها و تشکیل پیوندهای کووالانسی."},{"title":"تعادل شیمیایی (پیشرفته)","url":"https://phet.colorado.edu/sims/html/reaction-equilibrium/latest/reaction-equilibrium_en.html","description":"تحلیل عمیق‌تر حالت تعادل با تغییر دما و غلظت."},{"title":"جدول تناوبی","url":"https://phet.colorado.edu/sims/html/build-an-atom/latest/build-an-atom_en.html#periodic","description":"نمایش جایگاه اتم‌ها در جدول تناوبی بر اساس تعداد پروتون."},{"title":"انرژی یونش","url":"https://phet.colorado.edu/sims/html/build-an-atom/latest/build-an-atom_en.html#ionization-energy","description":"مشاهده روند تغییر انرژی یونش در طول دوره‌ها و گروه‌ها."},{"title":"شیمی و فیزیک: گرما و دما","url":"https://phet.colorado.edu/sims/html/states-of-matter/latest/states-of-matter_en.html#heat","description":"تفاوت بین گرما و دما در مقیاس مولکولی."},{"title":"تراکم (Condensation)","url":"https://phet.colorado.edu/sims/html/states-of-matter/latest/states-of-matter_en.html#condensation","description":"مشاهده فرآیند میعان و تغییر حالت از گاز به مایع."},{"title":"رسانایی محلول","url":"https://phet.colorado.edu/sims/html/acid-base-solutions/latest/acid-base-solutions_en.html#conductivity","description":"بررسی رسانایی الکتریکی محلول‌های اسیدی و بازی."},{"title":"محاسبات استوکیومتری","url":"https://phet.colorado.edu/sims/html/limiting-reactants/latest/limiting-reactants_en.html#calculations","description":"بخش محاسباتی برای تمرین استوکیومتری و درصد بازده."},{"title":"سینتیک مرتبه اول","url":"https://phet.colorado.edu/sims/html/reactions-and-rates/latest/reactions-and-rates_en.html#first-order","description":"مدل‌سازی نیمه‌عمر و نرخ واکنش‌های مرتبه اول."},{"title":"فشار جزئی گازها","url":"https://phet.colorado.edu/sims/html/gas-properties/latest/gas-properties_en.html#partial-pressure","description":"درک قانون دالتون در مورد فشار جزئی گازها در یک مخلوط."},{"title":"نوسانگر هیدروژن","url":"https://phet.colorado.edu/sims/html/quantum-mechanics-for-hydrogen-atom/latest/quantum-mechanics-for-hydrogen-atom_en.html#oscillator","description":"کاوش در مورد مدل نوسانگر هارمونیک کوانتومی."},{"title":"چگالی: بخش مایعات","url":"https://phet.colorado.edu/sims/html/density/latest/density_en.html#liquid","description":"آزمایش با مایعات مختلف برای درک مفهوم چگالی و شناوری."},{"title":"آنتالپی پیوند","url":"https://phet.colorado.edu/sims/html/energy-forms-and-changes/latest/energy-forms-and-changes_en.html#bondenergy","description":"مشاهده آزاد شدن یا جذب انرژی هنگام تشکیل و شکستن پیوندها."}],
            zist: [{"title":"انتخاب طبیعی","url":"https://phet.colorado.edu/sims/html/natural-selection/latest/natural-selection_fa.html","description":"کاوش در اصول انتخاب طبیعی و مشاهده نحوه تغییر صفات در طول نسل‌ها."},{"title":"مدل DNA","url":"https://www.google.com/search?q=https://phet.colorado.edu/sims/html/build-a-dna-molecule/latest/build-a-dna-molecule_en.html","description":"نحوه ساختار مارپیچ دوگانه DNA جفت شدن بازها و تکرار آن."},{"title":"تعبیر ژن: مبانی","url":"https://phet.colorado.edu/sims/html/gene-expression-essentials/latest/gene-expression-essentials_en.html","description":"درک چگونگی تبدیل DNA  به RNA و سپس به پروتئین (سنتز پروتئین)."},{"title":"تعبیر ژن: اپرون لاکتوز","url":"https://www.google.com/search?q=https://phet.colorado.edu/sims/html/gene-expression-lac-operon/latest/gene-expression-lac-operon_en.html","description":"مدل‌سازی چگونگی تنظیم روشن و خاموش شدن ژن‌ها در پاسخ به محیط (مورد اپرون لاکتوز)."},{"title":"جهش و صفات","url":"https://www.google.com/search?q=https://phet.colorado.edu/sims/html/gene-expression-essentials/latest/gene-expression-essentials_en.html%23mutation","description":"مشاهده تأثیر تغییرات DNA (جهش) بر ساختار پروتئین و صفات."},{"title":"نردبان pH","url":"https://phet.colorado.edu/sims/html/ph-scale/latest/ph-scale_fa.html","description":"اندازه‌گیری pH مایعات زیستی و درک اهمیت اسیدیته در سیستم‌های زنده."},{"title":"اسیدها و بازها","url":"https://phet.colorado.edu/sims/html/acid-base-solutions/latest/acid-base-solutions_fa.html","description":"بررسی عملکرد اسیدها و بازهای قوی و ضعیف و نقش آن‌ها در تعادل بیوشیمیایی."},{"title":"غلظت","url":"https://phet.colorado.edu/sims/html/concentration/latest/concentration_fa.html","description":"آموزش مفهوم غلظت و نحوه تأثیر آن بر واکنش‌های بیوشیمیایی و انتقال غشاء."},{"title":"قانون بیر (Beer's Law)","url":"https://phet.colorado.edu/sims/html/beers-law-lab/latest/beers-law-lab_fa.html","description":"استفاده از طیف‌سنج مجازی برای اندازه‌گیری غلظت ترکیبات زیستی (مانند پروتئین‌ها)."},{"title":"انتقال مواد در غشاء","url":"https://phet.colorado.edu/sims/html/diffusion/latest/diffusion_en.html","description":"مدل‌سازی انتشار (Diffusion) و اسمز (Osmosis) و حرکت ذرات در عرض غشای سلولی."},{"title":"فتوسنتز","url":"https://www.google.com/search?q=https://phet.colorado.edu/sims/html/greenhouse-effect/latest/greenhouse-effect_fa.html%23photosynthesis","description":"بررسی جذب CO₂ و تولید O₂ و قند توسط گیاهان در فرآیند فتوسنتز."},{"title":"تنفس سلولی","url":"https://www.google.com/search?q=https://phet.colorado.edu/sims/html/energy-forms-and-changes/latest/energy-forms-and-changes_fa.html%23respiration","description":"درک آزاد شدن انرژی در هنگام تجزیه مولکول‌های غذا در سلول (متابولیسم)."},{"title":"اشکال مولکولی","url":"https://phet.colorado.edu/sims/html/molecule-shapes/latest/molecule-shapes_fa.html","description":"کاوش در هندسه مولکول‌های زیستی کوچک و تأثیر آن بر عملکرد (مانند اتصال آنزیم‌ها)."},{"title":"ساختن ترکیبات","url":"https://phet.colorado.edu/sims/html/build-a-molecule/latest/build-a-molecule_en.html","description":"تمرین ساخت مولکول‌های ساده و درک قواعد پیوند شیمیایی در بیومولکول‌ها."},{"title":"نیروهای بین مولکولی","url":"https://phet.colorado.edu/sims/html/intermolecular-forces/latest/intermolecular-forces_en.html","description":"مشاهده چگونگی تأثیر نیروهای بین مولکولی (مانند پیوند هیدروژنی) بر ساختار پروتئین و DNA."},{"title":"خواص گازها","url":"https://phet.colorado.edu/sims/html/gas-properties/latest/gas-properties_fa.html","description":"بررسی فشار و حجم گازها، مرتبط با تبادل گاز در ریه‌ها و گیاهان."},{"title":"اثر گلخانه‌ای","url":"https://phet.colorado.edu/sims/html/the-greenhouse-effect/latest/the-greenhouse-effect_fa.html","description":"درک چگونگی تأثیر گازهای جوی بر آب‌وهوا و اکوسیستم‌ها."},{"title":"تعادل شیمیایی","url":"https://phet.colorado.edu/sims/html/reactions-and-rates/latest/reactions-and-rates_en.html#equilibrium","description":"مدل‌سازی تعادل شیمیایی، مرتبط با عملکرد آنزیم و بافرها."},{"title":"نیروهای الکتریکی (یون‌ها)","url":"https://phet.colorado.edu/sims/html/electric-field-hockey/latest/electric-field-hockey_en.html","description":"بازی برای درک نیروی بین بارهای الکتریکی، مرتبط با پتانسیل غشاء و سیگنال‌های عصبی."},{"title":"شیمی و انرژی: اشکال انرژی","url":"https://phet.colorado.edu/sims/html/energy-forms-and-changes/latest/energy-forms-and-changes_fa.html","description":"بررسی تبدیل انرژی (شیمیایی، گرمایی) در فرآیندهای حیاتی (ترمودینامیک زیستی)."},{"title":"رادیواکتیویته و نیمه‌عمر","url":"https://phet.colorado.edu/sims/html/radioactive-dating/latest/radioactive-dating_en.html","description":"درک مفهوم نیمه‌عمر برای تاریخ‌گذاری فسیل‌ها و نمونه‌های زیستی."},{"title":"دما و انرژی جنبشی","url":"https://phet.colorado.edu/sims/html/states-of-matter/latest/states-of-matter_en.html#kinetic","description":"مشاهده ارتباط دما با حرکت مولکول‌ها و سرعت واکنش‌های بیوشیمیایی."},{"title":"شیمی آلی: مونوپلیمرها","url":"https://phet.colorado.edu/sims/html/build-a-molecule/latest/build-a-molecule_en.html#polymers","description":"مقدمه‌ای بر ساختار پلیمری در مولکول‌های زیستی بزرگ (مانند کربوهیدرات‌ها و پروتئین‌ها)."},{"title":"ژن‌ها و صفات","url":"https://www.google.com/search?q=https://phet.colorado.edu/sims/html/gene-expression-basics/latest/gene-expression-basics_en.html%23traits","description":"بررسی توارث و نحوه انتقال صفات از والدین به فرزندان."},{"title":"محلول‌های بافر","url":"https://phet.colorado.edu/sims/html/acid-base-solutions/latest/acid-base-solutions_en.html#buffer","description":"درک نحوه مقاومت محلول‌های بافر در برابر تغییر pH (مانند خون)."},{"title":"واکنش‌دهنده‌های محدودکننده","url":"https://phet.colorado.edu/sims/html/limiting-reactants/latest/limiting-reactants_fa.html","description":"درک اینکه کدام ماده اولیه سرعت یک واکنش بیوشیمیایی را محدود می‌کند."},{"title":"مولکول‌ها و نور","url":"https://phet.colorado.edu/sims/html/molecules-and-light/latest/molecules-and-light_en.html","description":"بررسی جذب نور توسط مولکول‌های مختلف (مفاهیم مربوط به رنگدانه‌های گیاهی)."},{"title":"بیوم‌ها و اکوسیستم‌ها","url":"https://www.google.com/search?q=https://phet.colorado.edu/sims/html/natural-selection/latest/natural-selection_en.html%23ecosystems","description":"کاوش در روابط بین موجودات زنده و محیط زیست آن‌ها."},{"title":"نوسانگر هیدروژن","url":"https://phet.colorado.edu/sims/html/quantum-mechanics-for-hydrogen-atom/latest/quantum-mechanics-for-hydrogen-atom_en.html#oscillator","description":"مدل‌سازی ارتعاشات مولکولی (مقدمه‌ای بر طیف‌سنجی زیستی)."},{"title":"سینتیک مرتبه اول","url":"https://phet.colorado.edu/sims/html/reactions-and-rates/latest/reactions-and-rates_en.html#first-order","description":"مدل‌سازی سرعت واکنش‌های آنزیمی."},{"title":"موازنه واکنش‌های شیمیایی","url":"https://phet.colorado.edu/sims/html/balancing-chemical-equations/latest/balancing-chemical-equations_fa.html","description":"تمرین موازنه واکنش‌ها، مرتبط با موازنه فرآیندهای متابولیک."},{"title":"آزمایشگاه چگالی","url":"https://phet.colorado.edu/sims/html/density/latest/density_fa.html","description":"محاسبه چگالی، مرتبط با شناوری در آب (سلول‌ها و موجودات دریایی)."},{"title":"آب‌وهوا و اقلیم","url":"https://www.google.com/search?q=https://phet.colorado.edu/sims/html/climate-change/latest/climate-change_en.html","description":"بررسی عوامل تغییرات اقلیمی و تأثیر آن‌ها بر حیات وحش و اکوسیستم‌ها."},{"title":"ساختار اتمی: بور","url":"https://phet.colorado.edu/sims/html/rutherford-scattering/latest/rutherford-scattering_en.html","description":"درک مدل‌های اتمی، مرتبط با شیمی حیات."},{"title":"نیروی واندروالسی","url":"https://phet.colorado.edu/sims/html/atomic-interactions/latest/atomic-interactions_en.html#van-der-waals","description":"کاوش در مورد نیروهای ضعیف بین مولکولی، مرتبط با تاخوردگی پروتئین."},{"title":"انتقال انرژی گرمایی","url":"https://phet.colorado.edu/sims/html/energy-forms-and-changes/latest/energy-forms-and-changes_en.html#transfer","description":"مدل‌سازی انتقال گرما و تنظیم دمای بدن در موجودات زنده."},{"title":"پتانسیل یونش","url":"https://phet.colorado.edu/sims/html/build-an-atom/latest/build-an-atom_en.html#ionization","description":"مشاهده انرژی مورد نیاز برای حذف الکترون از اتم‌ها در فرآیندهای اکسایش/کاهش زیستی."},{"title":"ترمودینامیک و قوانین گاز","url":"https://phet.colorado.edu/sims/html/gas-properties/latest/gas-properties_en.html#laws","description":"کاوش در قوانین گازهای ایده‌آل (بویل، شارل)، مرتبط با فیزیولوژی تنفسی."},{"title":"تشکیل پیوند یونی","url":"https://phet.colorado.edu/sims/html/build-a-molecule/latest/build-a-molecule_en.html#ionic","description":"تمرین درک پیوند یونی، مرتبط با یون‌های ضروری برای حیات (Na, K, Ca)."},{"title":"تعادل یونی","url":"https://phet.colorado.edu/sims/html/salts-and-solubility/latest/salts-and-solubility_en.html#ionicstrength","description":"بررسی قدرت یونی محلول‌ها و تأثیر آن بر محیط داخل سلول."},{"title":"فعل و انفعالات و نرخ‌ها","url":"https://phet.colorado.edu/sims/html/reactions-and-rates/latest/reactions-and-rates_fa.html","description":"بررسی نحوه تأثیر انرژی فعال‌سازی و دما بر سرعت واکنش‌های آنزیمی."},{"title":"چگالی: بخش مایعات","url":"https://phet.colorado.edu/sims/html/density/latest/density_en.html#liquid","description":"درک چگالی مایعات، مرتبط با آب و محیط داخلی سلول‌ها."},{"title":"آنزیم‌ها و سوبستراها","url":"https://www.google.com/search?q=https://phet.colorado.edu/sims/html/reactions-and-rates/latest/reactions-and-rates_en.html%23enzymes","description":"مدل‌سازی نحوه اتصال آنزیم‌ها به سوبستراها و کاتالیز کردن واکنش‌ها (شبیه‌سازی فرضی)."},{"title":"متابولیسم و ATP","url":"https://www.google.com/search?q=https://phet.colorado.edu/sims/html/energy-forms-and-changes/latest/energy-forms-and-changes_en.html%23atp","description":"درک چرخه تبدیل ATP به ADP و نقش آن در انرژی سلولی (شبیه‌سازی فرضی)."},{"title":"همئوستازیس","url":"https://www.google.com/search?q=https://phet.colorado.edu/sims/html/gas-properties/latest/gas-properties_en.html%23homeostasis","description":"بررسی پایداری محیط داخلی بدن در برابر تغییرات خارجی (شبیه‌سازی فرضی)."},{"title":"پدیده مقاومت آنتی‌بیوتیکی","url":"https://www.google.com/search?q=https://phet.colorado.edu/sims/html/natural-selection/latest/natural-selection_en.html%23antibiotic","description":"مدل‌سازی انتخاب طبیعی سریع در جمعیت‌های باکتریایی (شبیه‌سازی فرضی)."},{"title":"سلول‌های بنیادی","url":"https://www.google.com/search?q=https://phet.colorado.edu/sims/html/build-an-atom/latest/build-an-atom_en.html%23cells","description":"مفاهیم تمایز سلولی و پتانسیل سلول‌های بنیادی (شبیه‌سازی فرضی)."},{"title":"ژنومیکس و CRISPR","url":"https://www.google.com/search?q=https://phet.colorado.edu/sims/html/dna-model/latest/dna-model_en.html%23crispr","description":"مقدمه‌ای بر ویرایش ژن و کاربردهای آن (شبیه‌سازی فرضی/مقدماتی)."},{"title":"طیف سیاهه‌وار","url":"https://phet.colorado.edu/sims/html/blackbody-spectrum/latest/blackbody-spectrum_en.html","description":"بررسی گسیل تابش، مرتبط با دمای بدن و انرژی در محیط زیست."},{"title":"رسانایی محلول","url":"https://phet.colorado.edu/sims/html/acid-base-solutions/latest/acid-base-solutions_en.html#conductivity","description":"بررسی رسانایی الکتریکی محلول‌ها، مرتبط با هدایت عصبی."}]
        };
        
        function displayLabs(subjectKey) {
            const labs = phetLabs[subjectKey];
            const listContainer = document.getElementById('lab-list');
            document.getElementById('lab-list-container').style.display = 'block';
            document.getElementById('lab-iframe-container').classList.add('hidden');
            const subjectTitles = { 'riazi': 'ریاضی', 'fizik': 'فیزیک', 'shimi': 'شیمی', 'zist': 'زیست' };
            document.getElementById('lab-list-title').textContent = `آزمایش‌های مجازی: ${subjectTitles[subjectKey]}`;
            listContainer.innerHTML = '';
            labs.forEach(lab => {
                const labCard = document.createElement('div');
                labCard.className = 'p-4 bg-gray-50 border-r-4 border-green-500 rounded-lg shadow-md cursor-pointer hover:bg-green-50 transition';
                labCard.innerHTML = `<h4 class="text-lg font-bold text-green-700">${lab.title}</h4><p class="text-sm text-gray-600 mt-1">${lab.description}</p>`;
                labCard.onclick = () => loadPhetLab(lab.url);
                listContainer.appendChild(labCard);
            });
            document.querySelectorAll('.subject-btn').forEach(btn => btn.classList.remove('ring-4', 'ring-green-500'));
            document.querySelector(`.subject-btn[data-subject="${subjectKey}"]`).classList.add('ring-4', 'ring-green-500');
        }

        function loadPhetLab(labUrl) {
            document.getElementById('lab-list-container').style.display = 'none';
            document.getElementById('lab-iframe-container').classList.remove('hidden');
            document.getElementById('lab-iframe').src = labUrl;
        }

        function initializeLabsPage() {
            document.querySelectorAll('.subject-btn').forEach(button => {
                button.addEventListener('click', (e) => displayLabs(e.currentTarget.dataset.subject));
            });
        }
        
	// --- Games Page Logic ---
        const gamesList = [
            { name: "تتریس کلاسیک", url: "https://tetris.com/play-tetris" },
            { name: "ماین‌سویپر (مین‌یاب)", url: "https://minesweeper.online/" },
	        { name: "بازی حدس عدد", url: "https://kamyarg1390d-source.github.io/" },
	        { name: "بازی حدس پرچم", url: "https://kamyarg1390d-source.github.io/GuessFlag/" },
	        { name: "How SMART U R?", url: "https://kamyarg1390d-source.github.io/HowSMARTUR/" },
        ];
        function loadGame(gameUrl) {
            const iframeContainer = document.getElementById('game-iframe-container');
            const iframe = document.getElementById('game-iframe');
            const placeholder = document.getElementById('iframe-placeholder');

            iframeContainer.classList.remove('hidden');
            placeholder.classList.add('hidden');
            iframe.src = gameUrl;
        }
        
        // Function to dynamically create game buttons
        function initializeGamesPage() {
            const buttonsContainer = document.getElementById('game-buttons');
            buttonsContainer.innerHTML = ''; // Clear previous content

            gamesList.forEach(game => {
                const button = document.createElement('button');
                button.className = 'w-full text-center p-4 btn-3d btn-green text-lg';
                button.textContent = game.name;
                button.onclick = () => loadGame(game.url);
                buttonsContainer.appendChild(button);
            });
        }

    </script>
</body>
</html>
